00001E2A Starting Address
Assembler used: EASy68K Editor/Assembler v5.16.01
Created On: 1/14/2021 12:27:47 PM

00000000                             1  ; =============================================================================
00000000                             2  ; TITLE    : MAIN PROGRAM
00000000                             3  ; AUTHOR   : RUBEN PALMER PEREZ 
00000000                             4  ; HISTORY  : 
00000000                             5  ; =============================================================================
00000000                             6              OPT     MEX
00001000                             7              ORG     $1000
00001000                             8  
00001000                             9  ; --- CODE INCLUDES -----------------------------------------------------------
00001000                            10  
00001000                            11              INCLUDE "SYSCONST.X68"          ; SYSTEM CONSTANTS
00001000                            12  ; =============================================================================
00001000                            13  ; TITLE    : SYSTEM CONSTANTS
00001000                            14  ; AUTHOR   : ANTONI BURGUERA
00001000                            15  ; HISTORY  : XX-XXX-201X - CREATION
00001000                            16  ;            11-OCT-2020 - MINOR CHANGES
00001000                            17  ; =============================================================================
00001000                            18  
00001000                            19  ; --- TRAP RELATED CONSTANTS --------------------------------------------------
00001000                            20  
00001000  =00000000                 21  KBDTRAP     EQU     0                       ; KEYBOARD UPDATE TRAP
00001000  =00000001                 22  SCRTRAP     EQU     1                       ; SCREEN REFRESH TRAP
00001000                            23  
00001000                            24  ; --- KEY CODES (EASy68K)
00001000                            25  
00001000  =00000020                 26  KBDCHRSP    EQU     $20                     ; SPACE KEY
00001000  =0000004D                 27  KBDCHRMK    EQU     'M'                     ; M KEY
00001000  =00000010                 28  KBDCHRSH    EQU     $10                     ; SHIFT KEY
00001000  =00000050                 29  KBDCHRPK    EQU     'P'                     ; P KEY
00001000  =00000025                 30  KBDCHRLF    EQU     $25                     ; LEFT KEY
00001000  =00000026                 31  KBDCHRUP    EQU     $26                     ; UP KEY
00001000  =00000027                 32  KBDCHRRT    EQU     $27                     ; RIGHT KEY
00001000  =00000028                 33  KBDCHRDN    EQU     $28                     ; DOWN KEY
00001000                            34  
00001000                            35  ; --- KEYBOARD MAPPING --------------------------------------------------------
00001000                            36  
00001000  =00000025                 37  KBDLEFT     EQU     KBDCHRLF                ; LEFT BUTTON
00001000  =00000026                 38  KBDUP       EQU     KBDCHRUP                ; UP BUTTON
00001000  =00000027                 39  KBDRIGHT    EQU     KBDCHRRT                ; RIGHT BUTTON
00001000  =00000028                 40  KBDDOWN     EQU     KBDCHRDN                ; DOWN BUTTON
00001000  =00000020                 41  KBDFIRE1    EQU     KBDCHRSP                ; FIRE 1 BUTTON
00001000  =0000004D                 42  KBDFIRE2    EQU     KBDCHRMK                ; FIRE 2 BUTTON
00001000  =00000010                 43  KBDFIRE3    EQU     KBDCHRSH                ; FIRE 3 BUTTON
00001000  =00000050                 44  KBDPAUSE    EQU     KBDCHRPK                ; PAUSE BUTTON
00001000                            45  
00001000                            46  ; --- KEYBOARD BITFIELD MASKS -------------------------------------------------
00001000                            47  ; CONVENIENCE CONSTANTS TO ACCESS THE FOLLOWING BIT-FIELD.
00001000                            48  ; THIS BIT-FIELD IS USED BY SYSTEM VARS (KBDVAL) AND (KBDEDGE).
00001000                            49  ; +---+---+---+---+---+---+---+---+
00001000                            50  ; | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |
00001000                            51  ; +---+---+---+---+---+---+---+---+
00001000                            52  ;   |   |   |   |   |   |   |   |
00001000                            53  ;   |   |   |   |   |   |   |   +---------- LEFT BUTTON
00001000                            54  ;   |   |   |   |   |   |   +-------------- UP BUTTON
00001000                            55  ;   |   |   |   |   |   +------------------ RIGHT BUTTON
00001000                            56  ;   |   |   |   |   +---------------------- DOWN BUTTON
00001000                            57  ;   |   |   |   +-------------------------- FIRE 1 BUTTON
00001000                            58  ;   |   |   +------------------------------ FIRE 2 BUTTON
00001000                            59  ;   |   +---------------------------------- FIRE 3 BUTTON
00001000                            60  ;   +-------------------------------------- PAUSE BUTTON
00001000                            61  
00001000  =00000001                 62  KBDMSKLF    EQU     %00000001
00001000  =00000002                 63  KBDMSKUP    EQU     %00000010
00001000  =00000004                 64  KBDMSKRT    EQU     %00000100
00001000  =00000008                 65  KBDMSKDN    EQU     %00001000
00001000  =00000010                 66  KBDMSKF1    EQU     %00010000
00001000  =00000020                 67  KBDMSKF2    EQU     %00100000
00001000  =00000040                 68  KBDMSKF3    EQU     %01000000
00001000  =00000080                 69  KBDMSKPS    EQU     %10000000
00001000                            70  
00001000                            71  ; --- KEYBOARD BITFIELD POSITIONS ---------------------------------------------
00001000                            72  
00001000  =00000000                 73  KBDBITLF    EQU     0
00001000  =00000001                 74  KBDBITUP    EQU     1
00001000  =00000002                 75  KBDBITRT    EQU     2
00001000  =00000003                 76  KBDBITDN    EQU     3
00001000  =00000004                 77  KBDBITF1    EQU     4
00001000  =00000005                 78  KBDBITF2    EQU     5
00001000  =00000006                 79  KBDBITF3    EQU     6
00001000  =00000007                 80  KBDBITPS    EQU     7
00001000                            81  
00001000                            82  ; --- SCREEN RELATED CONSTANTS ------------------------------------------------
00001000                            83  
00001000  =00000280                 84  SCRWIDTH    EQU     640                     ; SCREEN WIDTH (PIXELS)
00001000  =000001E0                 85  SCRHEIGH    EQU     480                     ; SCREEN HEIGHT (PIXELS)
00001000  =00000001                 86  SCRIRQ      EQU     1                       ; SCREEN INTERRUPT NUMBER
00001000  =00000014                 87  SCRTIM      EQU     20                       ; SCREEN TIMER (MS)
00001000                            88  
00001000                            89  ; --- DYNAMIC MEMORY CONSTANTS ------------------------------------------------
00001000                            90  
00001000  =00000040                 91  DMMBSIZE    EQU     64                      ; BLOCK SIZE (BYTES). POWER OF TWO
00001000  =00000032                 92  DMMBNUM     EQU     50                      ; NUMBER OF BLOCKS
00001000  =00000000                 93  DMMSYSID    EQU     0                       ; SYSTEM OWNER ID (MUST BE 0)
00001000  =00000000                 94  -------------------- end include --------------------
00001000                            95              INCLUDE "SYSTEM.X68"            ; SYSTEM CODE
00001000                            96  ; =============================================================================
00001000                            97  ; TITLE    : SYSTEM MANAGEMENT (SYSTEM CODE)
00001000                            98  ; AUTHOR   : ANTONI BURGUERA
00001000                            99  ; COMMENTS : IT IS DIVIDED IN THREE BLOCKS:
00001000                           100  ;            - SYS : GENERIC.
00001000                           101  ;            - SCR : SCREEN MANAGEMENT.
00001000                           102  ;            - KBD : KEYBOARD MANAGEMENT.
00001000                           103  ; HISTORY  : XX-XXX-201X - CREATION
00001000                           104  ;            11-OCT-2020 - MINOR CHANGES
00001000                           105  ; =============================================================================
00001000                           106  
00001000                           107  ; -----------------------------------------------------------------------------
00001000                           108  SYSINIT
00001000                           109  ; INITIALIZES THE SYSTEM
00001000                           110  ; INPUT    - NONE
00001000                           111  ; OUTPUT   - NONE
00001000                           112  ; MODIFIES - NONE
00001000                           113  ; -----------------------------------------------------------------------------
00001000  205F                     114              MOVE.L  (A7)+,A0                ; GET RETURN ADDRESS
00001002  4EB9 000010B4            115              JSR     KBDINIT                 ; INIT KEYBOARD
00001008  4EB9 0000101C            116              JSR     SCRINIT                 ; INIT SCREEN
0000100E  4EB9 00001114            117              JSR     DMMINIT                 ; INIT DYNAMIC MEMORY
00001014  027C DFFF                118              ANDI.W  #$DFFF,SR               ; SWITCH TO USER
00001018  2F08                     119              MOVE.L  A0,-(A7)                ; PUT RETURN ADDRESS
0000101A  4E75                     120              RTS
0000101C                           121  
0000101C                           122  ; =============================================================================
0000101C                           123  ; SCREEN MANAGEMENT (SYSTEM CODE)
0000101C                           124  ; =============================================================================
0000101C                           125  
0000101C                           126  ; -----------------------------------------------------------------------------
0000101C                           127  SCRINIT
0000101C                           128  ; INITIALIZES THE SCREEN, SCREEN-RELATED INTERRUPT AND VARS.
0000101C                           129  ; INPUT    - NONE
0000101C                           130  ; OUTPUT   - NONE
0000101C                           131  ; MODIFIES - D0,D1,D2,D3
0000101C                           132  ; -----------------------------------------------------------------------------
0000101C  007C 0700                133              ORI.W   #$0700,SR               ; DISABLE ALL INT
00001020  21FC 0000109A 0084       134              MOVE.L  #SCRUPD,($80+SCRTRAP*4) ; INSTALL TRAP
00001028  223C 028001E0            135              MOVE.L  #SCRWIDTH<<16|SCRHEIGH,D1 ; SET RESOLUTION
0000102E  103C 0021                136              MOVE.B  #33,D0
00001032  4E4F                     137              TRAP    #15
00001034  7201                     138              MOVE.L  #1,D1                   ; SET WINDOWED MODE
00001036  4E4F                     139              TRAP    #15
00001038  323C FF00                140              MOVE.W  #$FF00,D1               ; CLEAR VISIBLE BUFFER
0000103C  103C 000B                141              MOVE.B  #11,D0
00001040  4E4F                     142              TRAP    #15
00001042  123C 0011                143              MOVE.B  #17,D1                  ; ENABLE DOUBLE BUFFER
00001046  103C 005C                144              MOVE.B  #92,D0
0000104A  4E4F                     145              TRAP    #15
0000104C  323C FF00                146              MOVE.W  #$FF00,D1               ; CLEAR HIDDEN BUFFER
00001050  103C 000B                147              MOVE.B  #11,D0
00001054  4E4F                     148              TRAP    #15
00001056  21FC 0000108C 0064       149              MOVE.L  #SCRISR,($60+SCRIRQ*4)  ; SET EXCEPTION VECTOR
0000105E  123C 0005                150              MOVE.B  #5,D1                   ; ENABLE EXCEPTION PROCESSING
00001062  103C 0020                151              MOVE.B  #32,D0
00001066  4E4F                     152              TRAP    #15
00001068  143C 0081                153              MOVE.B  #%10000000|SCRIRQ,D2    ; ENABLE AUTO-IRQ
0000106C  163C 0014                154              MOVE.B  #SCRTIM,D3
00001070  123C 0006                155              MOVE.B  #6,D1
00001074  103C 0020                156              MOVE.B  #32,D0
00001078  4E4F                     157              TRAP    #15
0000107A  4239 00001E54            158              CLR.B   (SCRINTCT)              ; PREPARE INTERRUPT FLAG
00001080  4239 00001E55            159              CLR.B   (SCRCYCCT)              ; PREPARE CYCLE COUNTER
00001086  027C F8FF                160              ANDI.W  #$F8FF,SR               ; ENABLE INTS
0000108A  4E75                     161              RTS
0000108C                           162  
0000108C                           163  ; -----------------------------------------------------------------------------
0000108C                           164  SCRISR
0000108C                           165  ; SCREEN TIMER ISR. INCREASES THE INTERRUPT COUNTER AND UPDATES DOUBLE BUFFER.
0000108C                           166  ; INPUT    - NONE
0000108C                           167  ; OUTPUT   - NONE
0000108C                           168  ; MODIFIES - NONE
0000108C                           169  ; -----------------------------------------------------------------------------
0000108C  5239 00001E54            170              ADDQ.B  #1,(SCRINTCT)           ; UPDATE INT FLAG/COUNTER
00001092  5239 00001E55            171              ADDQ.B  #1,(SCRCYCCT)           ; UPDATE CYCLE COUNTER
00001098  4E73                     172              RTE
0000109A                           173  
0000109A                           174  ; -----------------------------------------------------------------------------
0000109A                           175  SCRUPD
0000109A                           176  ; TRAP SERVICE ROUTINE IN CHARGE OF VISUALIZING CURRENT FRAME AND CLEARING
0000109A                           177  ; BUFFER FOR THE NEXT ONE.
0000109A                           178  ; INPUT    - NONE
0000109A                           179  ; OUTPUT   - NONE
0000109A                           180  ; MODIFIES - NONE
0000109A                           181  ; -----------------------------------------------------------------------------
0000109A  48A7 C000                182              MOVEM.W D0-D1,-(A7)
0000109E  103C 005E                183              MOVE.B  #94,D0                  ; UPDATE DOUBLE BUFFER
000010A2  4E4F                     184              TRAP    #15
000010A4  323C FF00                185              MOVE.W  #$FF00,D1               ; CLEAR HIDDEN BUFFER
000010A8  103C 000B                186              MOVE.B  #11,D0
000010AC  4E4F                     187              TRAP    #15
000010AE  4C9F 0003                188              MOVEM.W (A7)+,D0-D1
000010B2  4E73                     189              RTE
000010B4                           190  
000010B4                           191  ; =============================================================================
000010B4                           192  ; KEYBOARD MANAGEMENT (SYSTEM CODE)
000010B4                           193  ; =============================================================================
000010B4                           194  
000010B4                           195  ; -----------------------------------------------------------------------------
000010B4                           196  KBDINIT
000010B4                           197  ; INITIALIZES THE SYSTEM VARIABLES KBDSYS AND KBDVAL
000010B4                           198  ; INPUT    - NONE
000010B4                           199  ; OUTPUT   - NONE
000010B4                           200  ; MODIFIES - NONE
000010B4                           201  ; -----------------------------------------------------------------------------
000010B4  4239 00001E52            202              CLR.B   (KBDVAL)                ; INIT VARS
000010BA  4239 00001E53            203              CLR.B   (KBDEDGE)
000010C0  21FC 000010CA 0080       204              MOVE.L  #KBDREAD,($80+KBDTRAP*4) ; INSTALL
000010C8  4E75                     205              RTS
000010CA                           206  
000010CA                           207  ; -----------------------------------------------------------------------------
000010CA                           208  KBDREAD
000010CA                           209  ; TRAP SERVICE ROUTINE.
000010CA                           210  ; UPDATES THE SYSTEM VARIABLES KBDEDGE AND KBDVAL ACCORDING TO THE BITFIELD
000010CA                           211  ; DESCRIBED IN SYSCONST. KBDVAL HOLDS THE CURRENT VALUES AND KBDEFGE HOLDS
000010CA                           212  ; RISING EDGES FROM PREVIOUS CALL TO THE CURRENT ONE.
000010CA                           213  ; INPUT    - NONE
000010CA                           214  ; OUTPUT   - (KBDVAL) AND (KBDEDGE)
000010CA                           215  ; MODIFIES - NONE
000010CA                           216  ; -----------------------------------------------------------------------------
000010CA  48E7 F000                217              MOVEM.L D0-D3,-(A7)
000010CE  103C 0013                218              MOVE.B  #19,D0
000010D2  223C 50104D20            219              MOVE.L  #KBDPAUSE<<24+KBDFIRE3<<16+KBDFIRE2<<8+KBDFIRE1,D1
000010D8  4E4F                     220              TRAP    #15
000010DA  6100 002A                221              BSR     .STORE                  ; STORE FIRE1,FIRE2,FIRE3 AND PAUSE
000010DE  223C 28272625            222              MOVE.L  #KBDDOWN<<24+KBDRIGHT<<16+KBDUP<<8+KBDLEFT,D1
000010E4  4E4F                     223              TRAP    #15
000010E6  6100 001E                224              BSR     .STORE                  ; STORE KEY UP,DOWN,LEFT AND RIGTH.
000010EA  1039 00001E52            225              MOVE.B  (KBDVAL),D0             ; COMPUTE EDGE.
000010F0  4600                     226              NOT.B   D0                      ; EDGE=NOT(PREVIOUS) AND CURRENT.
000010F2  C002                     227              AND.B   D2,D0
000010F4  13C2 00001E52            228              MOVE.B  D2,(KBDVAL)             ; STORE VALUES (PRESS AND EDGE)
000010FA  13C0 00001E53            229              MOVE.B  D0,(KBDEDGE)
00001100  4CDF 000F                230              MOVEM.L (A7)+,D0-D3
00001104  4E73                     231              RTE
00001106                           232  
00001106  363C 0003                233  .STORE      MOVE.W  #3,D3                   ; TRANSLATES THE 8-BIT ENCODING
0000110A  E189                     234  .LOOP       LSL.L   #8,D1                   ; OF TRAP #15 TASK 19 INTO A 1-BIT
0000110C  E312                     235              ROXL.B  #1,D2                   ; PER KEYPRESS ENCODING
0000110E  51CB FFFA                236              DBRA.W  D3,.LOOP
00001112  4E75                     237              RTS
00001114                           238  
00001114                           239  ; =============================================================================
00001114                           240  ; DYNAMIC MEMORY MANAGEMENT (SYSTEM CODE)
00001114                           241  ; DYNAMIC MEMORY IS A SET OF DMMBNUM SLOTS OF DMMBSIZE BYTES EACH ONE.
00001114                           242  ; DMMBSIZE MUST BE POWER OF TWO. A SLOT HAS:
00001114                           243  ; - HEADER - 1 WORD. SPECIFIES THE OWNER (0 MEANS OWNED BY SYSTEM)
00001114                           244  ; - DATA   - DMMBSIZE - 2 BYTES. MAY CONTAIN VARS AND ANY KIND OF DATA RELATED
00001114                           245  ;            THE THE OWNER. IF OWNER==0, DATA IS MEANINGLESS.
00001114                           246  ; =============================================================================
00001114                           247  
00001114                           248  ; -----------------------------------------------------------------------------
00001114                           249  DMMINIT
00001114                           250  ; INITIALIZES THE DYNAMIC MEMORY TO ALL OWNED BY SYSTEM.
00001114                           251  ; INPUT    - NONE
00001114                           252  ; OUTPUT   - NONE
00001114                           253  ; MODIFIES - NONE
00001114                           254  ; -----------------------------------------------------------------------------
00001114  48E7 8080                255              MOVEM.L D0/A0,-(A7)
00001118  41F9 00001E80            256              LEA     DMMDATA,A0
0000111E  303C 0031                257              MOVE.W  #DMMBNUM-1,D0
00001122  30BC 0000                258  .LOOP       MOVE.W  #DMMSYSID,(A0)
00001126  D1FC 00000040            259              ADD.L   #DMMBSIZE,A0
0000112C  51C8 FFF4                260              DBRA.W  D0,.LOOP
00001130  4CDF 0101                261              MOVEM.L (A7)+,D0/A0
00001134  4E75                     262              RTS
00001136                           263  
00001136                           264  ; -----------------------------------------------------------------------------
00001136                           265  DMMFIRST
00001136                           266  ; SEARCHES THE FIRST MEMORY SLOT NOT OWNED BY SYSTEM AND OUTPUTS A POINTER
00001136                           267  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00001136                           268  ; INPUT    - NONE
00001136                           269  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00001136                           270  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001136                           271  ; -----------------------------------------------------------------------------
00001136  41F9 00001E80            272              LEA     DMMDATA,A0
0000113C  4A58                     273  DMMFRLOP    TST.W   (A0)+
0000113E  6600 0016                274              BNE     DMMFRFND
00001142  D1FC 0000003E            275              ADD.L   #DMMBSIZE-2,A0
00001148  B1FC 00002AFF            276  DMMFRCOM    CMP.L   #DMMDATA+DMMBSIZE*DMMBNUM-1,A0
0000114E  6DEC                     277              BLT     DMMFRLOP
00001150  207C 00000000            278              MOVE.L  #0,A0
00001156  4E75                     279  DMMFRFND    RTS
00001158                           280  
00001158                           281  ; -----------------------------------------------------------------------------
00001158                           282  DMMNEXT
00001158                           283  ; SEARCHES THE NEXT MEMORY SLOT NOT OWNED BY SYSTEM AND OUTPUTS A POINTER
00001158                           284  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00001158                           285  ; INPUT    - A0   : POINTER WITHIN THE CURRENT SLOT
00001158                           286  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00001158                           287  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001158                           288  ; -----------------------------------------------------------------------------
00001158  2F00                     289              MOVE.L  D0,-(A7)
0000115A  2008                     290              MOVE.L  A0,D0
0000115C  C0BC FFFFFFC0            291              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
00001162  0680 00000040            292              ADD.L   #DMMBSIZE,D0
00001168  2040                     293              MOVE.L  D0,A0
0000116A  201F                     294              MOVE.L  (A7)+,D0
0000116C  60DA                     295              BRA     DMMFRCOM
0000116E                           296  
0000116E                           297  ; -----------------------------------------------------------------------------
0000116E                           298  DMMFRSTO
0000116E                           299  ; SEARCHES THE FIRST MEMORY SLOT WITH THE SPECIFIED ID AND OUTPUTS A POINTER
0000116E                           300  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
0000116E                           301  ; INPUT    - D0.W : ID TO SEARCH
0000116E                           302  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
0000116E                           303  ; MODIFIES - NONE (ASIDE OF OUTPUT)
0000116E                           304  ; -----------------------------------------------------------------------------
0000116E  41F9 00001E80            305              LEA     DMMDATA,A0
00001174  B058                     306  DMMFLOOP    CMP.W   (A0)+,D0
00001176  6700 0016                307              BEQ     DMMFFND
0000117A  D1FC 0000003E            308              ADD.L   #DMMBSIZE-2,A0
00001180  B1FC 00002AFF            309  DMMFCOM     CMP.L   #DMMDATA+DMMBSIZE*DMMBNUM-1,A0
00001186  6DEC                     310              BLT     DMMFLOOP
00001188  207C 00000000            311              MOVE.L  #0,A0
0000118E  4E75                     312  DMMFFND     RTS
00001190                           313  
00001190                           314  ; -----------------------------------------------------------------------------
00001190                           315  DMMNEXTO
00001190                           316  ; SEARCHES THE NEXT MEMORY SLOT WITH THE SPECIFIED ID AND OUTPUTS A POINTER
00001190                           317  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00001190                           318  ; INPUT    - D0.W : ID TO SEARCH
00001190                           319  ;            A0   : POINTER WITHIN THE CURRENT SLOT
00001190                           320  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00001190                           321  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001190                           322  ; -----------------------------------------------------------------------------
00001190  2F00                     323              MOVE.L  D0,-(A7)
00001192  2008                     324              MOVE.L  A0,D0
00001194  C0BC FFFFFFC0            325              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
0000119A  0680 00000040            326              ADD.L   #DMMBSIZE,D0
000011A0  2040                     327              MOVE.L  D0,A0
000011A2  201F                     328              MOVE.L  (A7)+,D0
000011A4  60DA                     329              BRA     DMMFCOM
000011A6                           330  
000011A6                           331  ; -----------------------------------------------------------------------------
000011A6                           332  DMMALLOC
000011A6                           333  ; SEARCHES THE FIRST FREE (SYS OWNED) SLOT, ASSIGNS TO THE SPECIFIED OWNER
000011A6                           334  ; AND RETURNS A POINTER TO THE CORRESPONDING DATA (SLOT ADDRESS + 2)
000011A6                           335  ; INPUT    - D0.W : ID TO ASSIGN
000011A6                           336  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FREE SPACE
000011A6                           337  ; MODIFIES - NONE (ASIDE OF OUTPUT)
000011A6                           338  ; -----------------------------------------------------------------------------
000011A6  3F00                     339              MOVE.W  D0,-(A7)
000011A8  4240                     340              CLR.W   D0
000011AA  4EB8 116E                341              JSR     DMMFRSTO
000011AE  301F                     342              MOVE.W  (A7)+,D0
000011B0  B1FC 00000000            343              CMP.L   #0,A0
000011B6  6700 0006                344              BEQ     .END
000011BA  3140 FFFE                345              MOVE.W  D0,-2(A0)
000011BE  4E75                     346  .END        RTS
000011C0                           347  
000011C0                           348  ; -----------------------------------------------------------------------------
000011C0                           349  DMMFREE
000011C0                           350  ; FREES THE SLOT TO WHICH THE PROVIDED POINTER BELONGS BY SETTING ITS OWNED TO
000011C0                           351  ; SYSTEM (0)
000011C0                           352  ; INPUT    - A0   : POINTER BELONGING TO THE SLOT TO FREE
000011C0                           353  ; OUTPUT   - NONE
000011C0                           354  ; MODIFIES - NONE
000011C0                           355  ; -----------------------------------------------------------------------------
000011C0  48E7 8080                356              MOVEM.L D0/A0,-(A7)
000011C4  2008                     357              MOVE.L  A0,D0
000011C6  C0BC FFFFFFC0            358              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
000011CC  2040                     359              MOVE.L  D0,A0
000011CE  4250                     360              CLR.W   (A0)
000011D0  4CDF 0101                361              MOVEM.L (A7)+,D0/A0
000011D4  4E75                     362              RTS
000011D4  4E75                     363  -------------------- end include --------------------
000011D6                           364              INCLUDE "CONST.X68"             ; GAME CONSTANTS
000011D6                           365  ; =============================================================================
000011D6                           366  ; TITLE    : GAME CONSTANTS
000011D6                           367  ; AUTHOR   :
000011D6                           368  ; HISTORY  :
000011D6                           369  ; =============================================================================
000011D6                           370  
000011D6                           371  ; TILE RELATED CONSTANTS 
000011D6  =00000020                372  TILEDIM     EQU     32         ; TILE SET DIMENSIONS && PLAYER SPEED
000011D6  =00745B6D                373  TILEDARK    EQU     $00745B6D  ; TILE SET DARK COLOR 
000011D6  =00CCE0EA                374  TILELIGH    EQU     $00CCE0EA  ; TILE SET LIGHT COLOR
000011D6  =00957EA0                375  TILEDETA    EQU     $00957ea0  ; TILE SET DETAIL COLOR
000011D6  =0030252D                376  TILEDDARK   EQU     $0030252d  ; TILE SET EXTRA DARK
000011D6                           377  
000011D6                           378  ; BUTTONS
000011D6  =00000050                379  BUTTONWIDTH EQU     80
000011D6  =0000002D                380  BUTTONHEIGH EQU     45
000011D6  =000000D5                381  BUTTONX1    EQU     213
000011D6  =000001AA                382  BUTTONX2    EQU     426
000011D6  =00000190                383  BUTTONY     EQU     400
000011D6                           384  
000011D6                           385  ; STRINGS 
000011D6= 59 4F 55 20 44 4F ...    386  NOKEYSTRING DC.B    'YOU DO NOT HAVE ANY KEYS', 0
000011EF= 53 4F 4D 45 20 50 ...    387  DEATHSTRING DC.B    'SOME PART OF YOUR SOUL  FADES AWAY', 0
00001212= 59 4F 55 20 48 41 ...    388  SUSSERTOD   DC.B    'YOU HAD SO MUCH TO LIVE FOR, YET YOU WENT DOWN THE DUNGEON', 0
0000124D= 20 4C 45 56 45 4C ...    389  LEVELSTRING DC.B    ' LEVEL: ', 0
00001256= 44 4F 57 4E 20 54 ...    390  TITLESTRING DC.B    'DOWN THE DUNGEON HOLE!!!', 0
0000126F= 57 48 59 20 44 49 ...    391  SUBTITLESTR DC.B    'WHY DID YOU COME HERE?', 0
00001286= 28 50 55 53 48 20 ...    392  NEXTSTR     DC.B    '(PUSH SPACE TO CONTINUE)', 0 
0000129F= 28 44 4F 20 4E 4F ...    393  BECARESTR   DC.B    '(DO NOT RUSH YOURSELF)', 0
000012B6= 52 45 54 52 59 00        394  RETRYSTR    DC.B    'RETRY', 0
000012BC= 45 58 49 54 00           395  EXITSTR     DC.B    'EXIT', 0
000012C1= 45 41 53 59 00           396  EASYSTR     DC.B    'EASY', 0
000012C6= 4E 4F 52 4D 41 4C 00     397  NORMALSTR   DC.B    'NORMAL', 0                  
000012CE                           398              DS.W    0
000012CE                           399  
000012CE  =0000000C                400  ENEMYMAXCNT EQU     12                      
000012CE                           401  
000012CE                           402  ; ID'S FOR AGENTS AND MATRIX IN CASE TORCH SHADER IS IMPLEMENTED
000012CE  =00000001                403  EMPTYID     EQU     1                       ; VOID IDENTIFIER
000012CE  =00000002                404  WALLID      EQU     2                       ; WALL IDENTIFIER
000012CE  =00000003                405  FLOORID     EQU     3                       ; FLOOR IDENTIFIER | ONLY USEFUL IF TILE SET IS IMPLEMENTED
000012CE  =00000004                406  STAIRID     EQU     4                       ; STAIR IDENTIFIER
000012CE  =00000005                407  KEYID       EQU     5                       ; KEY IDENTIFIER
000012CE  =00000006                408  PLYRID      EQU     6                       ; PLAYER IDENTIFIER
000012CE  =00000007                409  ENEMYID     EQU     7                       ; TRAP IDENTIFIER
000012CE                           410  
000012CE                           411  ; STATES ID
000012CE  =00000000                412  STAMM       EQU     0                       ; STATE MAIN MENU
000012CE  =00000001                413  STAGP       EQU     1                       ; STATE GAME PLAY
000012CE  =00000002                414  STADM       EQU     2                       ; STATE DEATH MENU
000012CE                           415  
000012CE                           416  ; PSEUDO-RANDOM GENERATOR VECTORS
000012CE= 0100 0220 0180 0...      417  XVALUES     DC.W    $100, $220, $180, $1C0, $80, $C0, $200, $E0, $160, $120
000012E2= 0060 01E0 00A0 0...      418              DC.W    $60, $1E0, $A0, $1A0, $140
000012EC                           419  
000012EC= 00D0 0090 00B0 0...      420  YVALUES     DC.W    $D0, $90, $B0, $F0, $B0, $90, $190, $110, $170, $190
00001300= 00B0 01B0 00B0 0...      421              DC.W    $B0, $1B0, $B0, $130, $D0, $50, $170, $190, $130, $110
00001314= 01B0 0150 0090 0...      422              DC.W    $1B0, $150, $90, $90, $110, $30, $70, $150, $90, $10
00001328= 01B0 00F0 00D0 0...      423              DC.W    $1B0, $F0, $D0, $D0, $90, $1B0, $B0, $170, $130, $190
0000133C= 00F0 0030 0150 0...      424              DC.W    $F0, $30, $150, $50, $170, $110, $1B0, $170, $150, $150
00001350= 0070 01B0 0030 0...      425              DC.W    $70, $1B0, $30, $F0, $10, $90, $F0, $70, $D0, $170
00001364= 0050 00B0 00D0 0...      426              DC.W    $50, $B0, $D0, $190, $90, $170, $50, $50, $50, $90
00001378= 0090 01B0 0030 0...      427              DC.W    $90, $1B0, $30, $110, $130, $50, $B0, $110, $F0, $70
0000138C= 0010 01B0 0110 0...      428              DC.W    $10, $1B0, $110, $50, $D0, $F0, $F0, $30, $30, $150
000013A0= 00B0 0030 0110 0...      429              DC.W    $B0, $30, $110, $110, $1B0, $190, $30, $30, $170, $170
000013B4= 0030 0190 0130 0...      430              DC.W    $30, $190, $130, $90, $50, $90, $110, $150, $190, $110
000013C8= 0050 0110 00F0 0...      431              DC.W    $50, $110, $F0, $190, $1B0, $170, $70, $1B0, $F0, $1B0
000013DC= 0050 0130 0150 0...      432              DC.W    $50, $130, $150, $130, $70, $30, $D0, $150, $50, $130
000013F0= 00B0 0010 0010 0...      433              DC.W    $B0, $10, $10, $30, $90, $F0, $B0, $70, $B0, $70
00001404= 0070 00B0 0010 0...      434              DC.W    $70, $B0, $10, $130, $70, $70, $150, $B0, $130, $1B0
00001418= 0030 0190 0130 0...      435              DC.W    $30, $190, $130, $D0, $10, $1D0, $150, $110, $F0, $10
0000142C= 0190 0070 0130 0...      436              DC.W    $190, $70, $130, $F0, $10, $70, $10, $30, $190, $D0
00001440= 0170 0150 0010 0...      437              DC.W    $170, $150, $10, $50, $170, $D0, $F0, $B0, $B0, $D0
00001454= 0190 0090 00B0 0...      438              DC.W    $190, $90, $B0, $90, $190, $10, $110, $90, $110, $130
00001468= 0010 0050 00D0 0...      439              DC.W    $10, $50, $D0, $50, $1B0, $170, $F0, $150, $F0, $10
0000147C= 0150 0070 0170 0...      440              DC.W    $150, $70, $170, $110, $D0, $50, $1B0, $30, $150, $170
00001490= 0130 0030 0070 0...      441              DC.W    $130, $30, $70, $190, $130, $30, $150, $130, $190, $10
000014A4= 0010 00D0 0070 0...      442              DC.W    $10, $D0, $70, $D0, $B0
000014A4= 0010 00D0 0070 0...      443  -------------------- end include --------------------
000014AE                           444              INCLUDE "UTIL.X68"              ; UTILITY MANAGER
000014AE                           445  UTILPEN     MACRO
000014AE                           446  ;   IN:  \1 AS THE COLOR, FORMATED AS #00BBGGRR
000014AE                           447  ;   OUT: NONE
000014AE                           448  ;   MOD: D0, D1    
000014AE                           449  ;   DES: MACRO TO SET PEN COLOR
000014AE                           450  
000014AE                           451          MOVE.B  #80, D0 
000014AE                           452          MOVE.L  \1, D1
000014AE                           453          TRAP    #15
000014AE                           454          ENDM
000014AE                           455  
000014AE                           456  UTILFILL    MACRO
000014AE                           457  ;   IN:  \1 AS THE COLOR, FORMATED AS #00BBGGRR
000014AE                           458  ;   OUT: NONE
000014AE                           459  ;   MOD: D0, D1
000014AE                           460  ;   DES: MACRO TO SET FILL COLOR
000014AE                           461  
000014AE                           462          MOVE.B  #81, D0
000014AE                           463          MOVE.L  \1, D1
000014AE                           464          TRAP    #15
000014AE                           465          ENDM
000014AE                           466  
000014AE                           467  UTILTEXT    MACRO
000014AE                           468  ;   IN:  \1 TEXT 
000014AE                           469  ;        \2 TEXT X
000014AE                           470  ;        \3 TEXT Y
000014AE                           471  ;   OUT: NONE
000014AE                           472  ;   MOD: D0-D2 / A1
000014AE                           473  ;   DES: PRINTS THE 0 TERINATED STRING IN \1 IN COORDINATES \2 \3
000014AE                           474  
000014AE                           475          LEA     \1, A1
000014AE                           476          MOVE.W  \2, D1
000014AE                           477          MOVE.W  \3, D2
000014AE                           478  
000014AE                           479          MOVE.W  #95, D0
000014AE                           480          TRAP    #15
000014AE                           481          ENDM
000014AE                           482  
000014AE                           483  UTILTILE    MACRO
000014AE                           484  ;   IN:  \1 PROCEDURE OF THE TRAP #15
000014AE                           485  ;        \2 X COORDINATE
000014AE                           486  ;        \3 Y COORDINATE
000014AE                           487  ;   OUT: NONE
000014AE                           488  ;   MOD: D1-D4
000014AE                           489  ;   DES: DRAWS A GRAPHIC AT \2 \3
000014AE                           490          MOVE.W  \2, D1               ; D1 = X CENTER
000014AE                           491          MOVE.W  \3, D2               ; D1 = Y CENTER
000014AE                           492          MOVE.W  D1, D3
000014AE                           493          MOVE.W  D2, D4
000014AE                           494          SUB.W   #TILEDIM/2, D1              ; SET TOP LEFT CORNER
000014AE                           495          SUB.W   #TILEDIM/2, D2              ; SET TOP LEFT CORNER 
000014AE                           496          ADD.W   #TILEDIM/2, D3              ; SET LOW RIGHT CORNER
000014AE                           497          ADD.W   #TILEDIM/2, D4              ; SET LOW RIGHT CORNER
000014AE                           498  
000014AE                           499          MOVE.W  \1, D0
000014AE                           500          TRAP    #15
000014AE                           501          ENDM
000014AE                           502  
000014AE                           503  UTILCOLL    
000014AE                           504  ;   IN:  D0 X0 COORDINATE
000014AE                           505  ;        D1 Y0 COORDINATE
000014AE                           506  ;   OUT: D2.B = FF IF COLLISION, 00 ELSEWISE
000014AE                           507  ;   MOD: D2
000014AE                           508  ;   DES: CHECKS IF ELEMENTS 0 AND 1 HAVE THE SAME POSITION 
000014AE                           509  
000014AE  4242                     510          CLR     D2
000014B0  B079 00002B00            511          CMP.W   (PLAYERX), D0   ; COMPARE X COORDINATES
000014B6  6600 0010                512          BNE .NOCOL
000014BA  B279 00002B02            513          CMP.W   (PLAYERY), D1   ; COMPARE Y COORDINATES
000014C0  6600 0006                514          BNE .NOCOL
000014C4  143C 00FF                515          MOVE.B  #$FF, D2
000014C8                           516  .NOCOL
000014C8  4E75                     517          RTS
000014CA                           518  
000014CA                           519  
000014CA                           520      
000014CA                           521  -------------------- end include --------------------
000014CA                           522              INCLUDE "RANDOM.X68"            ; PSEUDO - RANDOM GENERATOR
000014CA                           523  ; =============================================================================
000014CA                           524  ; TITLE    : PSEUDO-RANDOM NUMBER GENERATOR
000014CA                           525  ; AUTHOR   : RUBEN PALMER PEREZ 
000014CA                           526  ; COMMENTS : VERY LAZY AND STUPID "ALGORITHM" IMPLEMENTED.
000014CA                           527  ; HISTORY  : 
000014CA                           528  ; =============================================================================
000014CA                           529  
000014CA                           530  ; -----------------------------------------------------------------------------
000014CA                           531  RNDINIT
000014CA                           532  ; INITIALIZES RANDOM NUMBER GENERATOR
000014CA                           533  ; INPUT    - NONE
000014CA                           534  ; OUTPUT   - NONE
000014CA                           535  ; MODIFIES - NONE
000014CA                           536  ; -----------------------------------------------------------------------------
000014CA  4279 00002B1A            537              CLR     (RNGXINDEX)
000014D0  4279 00002B1C            538              CLR     (RNGYINDEX)
000014D6                           539  
000014D6  4E75                     540              RTS
000014D8                           541  ; -----------------------------------------------------------------------------
000014D8                           542  RNGX
000014D8                           543  ; PROVIDES A PSEUDO-RANDOM BYTE
000014D8                           544  ; INPUT    - NONE
000014D8                           545  ; OUTPUT   - D0.L RANDOM VALUE (ONLY BYTE)
000014D8                           546  ; MODIFIES - NONE (ASIDE OF OUTPUT)
000014D8                           547  ; -----------------------------------------------------------------------------
000014D8  2F08                     548              MOVE.L  A0,-(A7)
000014DA                           549  
000014DA  41F8 12CE                550              LEA     XVALUES, A0
000014DE  4280                     551              CLR.L   D0
000014E0                           552              
000014E0  1039 00002B1A            553              MOVE.B  (RNGXINDEX), D0
000014E6  E348                     554              LSL.W   #1, D0     
000014E8  D0C0                     555              ADD.W   D0, A0
000014EA  3010                     556              MOVE.W  (A0), D0
000014EC  5239 00002B1A            557              ADDQ.B  #1, (RNGXINDEX)
000014F2  0C79 0C00 00002B1A       558              CMP     #$0C00, (RNGXINDEX)
000014FA  6600 0008                559              BNE     .NOVERFLOW     
000014FE  4279 00002B1A            560              CLR     (RNGXINDEX)
00001504                           561  .NOVERFLOW            
00001504  205F                     562              MOVE.L  (A7)+, A0
00001506  4E75                     563              RTS
00001508                           564  ; -----------------------------------------------------------------------------
00001508                           565  RNGY
00001508                           566  ; PROVIDES A PSEUDO-RANDOM BYTE
00001508                           567  ; INPUT    - NONE
00001508                           568  ; OUTPUT   - D0.L RANDOM VALUE (ONLY BYTE)
00001508                           569  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001508                           570  ; -----------------------------------------------------------------------------
00001508  2F08                     571              MOVE.L  A0,-(A7)
0000150A                           572  
0000150A  41F8 12EC                573              LEA     YVALUES, A0
0000150E  4280                     574              CLR.L   D0
00001510                           575              
00001510  1039 00002B1C            576              MOVE.B  (RNGYINDEX), D0
00001516  E348                     577              LSL.W   #1, D0  
00001518  D0C0                     578              ADD.W   D0, A0
0000151A  3010                     579              MOVE.W  (A0), D0
0000151C  5239 00002B1C            580              ADDQ.B  #1, (RNGYINDEX)
00001522  0C79 E100 00002B1C       581              CMP     #$E100, (RNGYINDEX)
0000152A  6600 0008                582              BNE     .NOVERFLOW
0000152E  4279 00002B1C            583              CLR     (RNGYINDEX)
00001534                           584  .NOVERFLOW
00001534  205F                     585              MOVE.L  (A7)+, A0
00001536  4E75                     586              RTS
00001538                           587  
00001538                           588  -------------------- end include --------------------
00001538                           589              INCLUDE "AGENTLST.X68"          ; AGENT MANAGER
00001538                           590  ; =============================================================================
00001538                           591  ; TITLE    : AGENT LIST
00001538                           592  ; AUTHOR   : ANTONI BURGUERA
00001538                           593  ; COMMENTS : EACH AGENT HAS A DATA BLOCK FROM DMM AS FOLLOWS:
00001538                           594  ;              +0 - LONG : UPDATE SUBROUTINE POINTER
00001538                           595  ;              +4 - LONG : PLOT SUBROUTINE POINTER
00001538                           596  ;              +8:END    : DATA (AGENT SPECIFIC)
00001538                           597  ; HISTORY  : XX-XXX-201X - CREATION
00001538                           598  ;            11-OCT-2020 - MINOR CHANGES
00001538                           599  ; =============================================================================
00001538                           600  
00001538                           601  ; -----------------------------------------------------------------------------
00001538                           602  AGLADD
00001538                           603  ; CREATES A NEW AGENT
00001538                           604  ; INPUT    - A1 - POINTER TO AGENT INIT FUNCTION
00001538                           605  ;            A2 - POINTER TO AGENT UPDATE FUNCTION
00001538                           606  ;            A3 - POINTER TO AGENT PLOT FUNCTION
00001538                           607  ;            D0 - AGENT TYPE (USED AS OWNED BY DMM)
00001538                           608  ;            D1 - AGENT INITIALIZATION PARAMETER 1
00001538                           609  ;            D2 - AGENT INITIALIZATION PARAMETER 2
00001538                           610  ;            D3 - AGENT INITIALIZATION PARAMETER 3
00001538                           611  ; OUTPUT   - NONE
00001538                           612  ; MODIFIES - NONE
00001538                           613  ; -----------------------------------------------------------------------------
00001538  2F08                     614              MOVE.L  A0,-(A7)
0000153A  4EB8 11A6                615              JSR     DMMALLOC
0000153E  B1FC 00000000            616              CMP.L   #0,A0
00001544  6700 0008                617              BEQ     .END
00001548  20CA                     618              MOVE.L  A2,(A0)+
0000154A  20CB                     619              MOVE.L  A3,(A0)+
0000154C  4E91                     620              JSR     (A1)
0000154E  205F                     621  .END        MOVE.L  (A7)+,A0
00001550  4E75                     622              RTS
00001552                           623  
00001552                           624  ; -----------------------------------------------------------------------------
00001552                           625  AGLUPDT
00001552                           626  ; UPDATES THE AGENT LIST. PRIOR TO CALLING THE UPDATE FUNCTIONS, A0 IS SET
00001552                           627  ; TO THE DATA BLOCK OF THE CORRESPONDING SLOT.
00001552                           628  ; INPUT    - NONE
00001552                           629  ; OUTPUT   - NONE
00001552                           630  ; MODIFIES - NONE
00001552                           631  ; -----------------------------------------------------------------------------
00001552  48E7 00C0                632              MOVEM.L A0-A1,-(A7)
00001556  4EB8 1136                633              JSR     DMMFIRST
0000155A  B1FC 00000000            634  .LOOP       CMP.L   #0,A0
00001560  6700 000E                635              BEQ     .END
00001564  2250                     636              MOVE.L  (A0),A1
00001566  5088                     637              ADD.L   #8,A0
00001568  4E91                     638              JSR     (A1)
0000156A  4EB8 1158                639              JSR     DMMNEXT
0000156E  60EA                     640              BRA     .LOOP
00001570  4CDF 0300                641  .END        MOVEM.L (A7)+,A0-A1
00001574  4E75                     642              RTS
00001576                           643  
00001576                           644  ; -----------------------------------------------------------------------------
00001576                           645  AGLPLOT
00001576                           646  ; PLOTS THE AGENT LIST. PRIOR TO CALLING THE UPDATE FUNCTIONS, A0 IS SET
00001576                           647  ; TO THE DATA BLOCK OF THE CORRESPONDING SLOT.
00001576                           648  ; INPUT    - NONE
00001576                           649  ; OUTPUT   - NONE
00001576                           650  ; MODIFIES - NONE
00001576                           651  ; -----------------------------------------------------------------------------
00001576  48E7 00C0                652              MOVEM.L A0-A1,-(A7)
0000157A  4EB8 1136                653              JSR     DMMFIRST
0000157E  B1FC 00000000            654  .LOOP       CMP.L   #0,A0
00001584  6700 0010                655              BEQ     .END
00001588  2268 0004                656              MOVE.L  4(A0),A1
0000158C  5088                     657              ADD.L   #8,A0
0000158E  4E91                     658              JSR     (A1)
00001590  4EB8 1158                659              JSR     DMMNEXT
00001594  60E8                     660              BRA     .LOOP
00001596  4CDF 0300                661  .END        MOVEM.L (A7)+,A0-A1
0000159A  4E75                     662              RTS
0000159C                           663  
0000159C                           664  ; -----------------------------------------------------------------------------
0000159C  =000011C0                665  AGLKILL     EQU     DMMFREE
0000159C                           666  ; KILLS THE AGENT BY RELEASING ITS MEMORY
0000159C                           667  ; INPUT    - A0 POINTER WITHIN THE AGENT MEMORY
0000159C                           668  ; OUTPUT   - NONE
0000159C                           669  ; MODIFIES - NONE
0000159C                           670  ; NOTE     - IT IS JUST A WRAPPER FOR DMMFREE
0000159C                           671  ; -----------------------------------------------------------------------------
0000159C                           672  
0000159C                           673  ;------------------------------------------------------------------------------
0000159C                           674  AGLFKIL
0000159C                           675  ; DES       :       KILLS ALL AGENTS WITH ID 'X'
0000159C                           676  ; IN        :       D0 AGENT ID
0000159C                           677  ; OUT   :   NONE
0000159C                           678  ; MOD       :       REMOVES ALL AGENTS WITH ID D0. MEMORY
0000159C                           679  ;------------------------------------------------------------------------------
0000159C  48E7 00C0                680              MOVEM.L A0-A1,-(A7)
000015A0  4EB8 116E                681              JSR     DMMFRSTO
000015A4  B1FC 00000000            682  .LOOP       CMP.L   #0, A0
000015AA  6700 000C                683              BEQ     .END            ; AGENT LIST IS EMPTY
000015AE  4EB8 11C0                684              JSR     AGLKILL
000015B2  4EB8 116E                685              JSR     DMMFRSTO        ; SEARCH NEXT AGENT WITH ID D0
000015B6  60EC                     686              BRA     .LOOP
000015B8  4CDF 0300                687  .END        MOVEM.L (A7)+,A0-A1
000015BC  4E75                     688              RTS
000015BC  4E75                     689  -------------------- end include --------------------
000015BE                           690              INCLUDE "PLAYER.X68"            ; PLAYER MANAGER
000015BE                           691  ; =============================================================================
000015BE                           692  ; TITLE    : PLAYER MANAGER
000015BE                           693  ; AUTHOR   : RUBEN PALMER PEREZ 
000015BE                           694  ; COMMENTS : 
000015BE                           695  ; =============================================================================
000015BE                           696  
000015BE                           697  ;---------------------------------------------------------------------
000015BE                           698  PLAYERINIT
000015BE                           699  ; DES       :       INIT METHOD FOR THE PLAYER. SET PLAYER TO CENTER
000015BE                           700  ; IN        :       NONE
000015BE                           701  ; OUT       :       NONE
000015BE                           702  ; MOD       :       (PLAYERX) WITH X COORDINATE
000015BE                           703  ;           (PLAYERY) WITH Y COORDINATE
000015BE                           704  ;---------------------------------------------------------------------
000015BE  33FC 0140 00002B00       705              MOVE.W #SCRWIDTH/2, (PLAYERX)       ; SET PLAYER TO CENTER
000015C6  33FC 00F0 00002B02       706              MOVE.W #SCRHEIGH/2, (PLAYERY)       ; SET PLAYER TO CENTER
000015CE  4E75                     707              RTS
000015D0                           708  
000015D0                           709  ;---------------------------------------------------------------------
000015D0                           710  PLAYERUPDT  
000015D0                           711  ; DES       :       CHECKS IF PLAYER HAS TO MOVE SOMEWHERE
000015D0                           712  ; IN        :       NONE
000015D0                           713  ; OUT       :       NONE
000015D0                           714  ; MOD       :       (PLAYERX)||(PLAYERY) DEPENDS ON MOVEMENT
000015D0                           715  ;---------------------------------------------------------------------
000015D0                           716  
000015D0  0839 0000 00001E55       717              BTST.B  #0, (SCRCYCCT)
000015D8  6600 0092                718              BNE     .END  
000015DC  0839 0000 00001E52       719              BTST.B  #KBDBITLF, (KBDVAL)         ; LEFT KEY PRESSED
000015E4  6600 0028                720              BNE     .MOVEL
000015E8  0839 0002 00001E52       721              BTST.B  #KBDBITRT, (KBDVAL)         ; RIGHT KEY PRESSED
000015F0  6600 0034                722              BNE     .MOVER
000015F4  0839 0001 00001E52       723              BTST.B  #KBDBITUP, (KBDVAL)         ; UP KEY PRESSED
000015FC  6600 0040                724              BNE     .MOVEU
00001600  0839 0003 00001E52       725              BTST.B  #KBDBITDN, (KBDVAL)         ; DOWN KEY PRESSED
00001608  6600 004C                726              BNE     .MOVED
0000160C  4E75                     727              RTS
0000160E                           728  .MOVEL
0000160E  0C79 0070 00002B00       729              CMP.W   #TILEDIM/2+(SCRWIDTH-SCRHEIGH)-64, (PLAYERX)       ; LEFT BOUNDARY
00001616  6E00 0004                730              BGT     .RMVEL
0000161A  4E75                     731              RTS
0000161C                           732  .RMVEL
0000161C  0479 0020 00002B00       733              SUB.W   #TILEDIM, (PLAYERX)         ; MOVE LEFT
00001624  4E75                     734              RTS
00001626                           735  
00001626                           736  .MOVER
00001626  0C79 020F 00002B00       737              CMP.W   #SCRHEIGH-1-TILEDIM/2+64, (PLAYERX)    ; RIGHT BOUNDARY
0000162E  6D00 0004                738              BLT     .RMVER
00001632  4E75                     739              RTS
00001634                           740  .RMVER
00001634  0679 0020 00002B00       741              ADD.W   #TILEDIM, (PLAYERX)         ; MOVE RIGHT
0000163C  4E75                     742              RTS
0000163E                           743  
0000163E                           744  .MOVEU
0000163E  0C79 0010 00002B02       745              CMP.W   #TILEDIM/2, (PLAYERY)       ; TOP BOUNDARY
00001646  6E00 0004                746              BGT     .RMVEU
0000164A  4E75                     747              RTS
0000164C                           748  .RMVEU
0000164C  0479 0020 00002B02       749              SUB.W   #TILEDIM, (PLAYERY)         ; MOVE UP
00001654  4E75                     750              RTS
00001656                           751  
00001656                           752  .MOVED
00001656  0C79 01CF 00002B02       753              CMP.W   #SCRHEIGH-1-TILEDIM/2, (PLAYERY)    ; BOTTOM BOUNDARY
0000165E  6D00 0004                754              BLT     .RMVED
00001662  4E75                     755              RTS
00001664                           756  .RMVED
00001664  0679 0020 00002B02       757              ADD.W   #TILEDIM, (PLAYERY)         ; MOVE DOWN
0000166C                           758  .END
0000166C  4E75                     759              RTS
0000166E                           760  
0000166E                           761  ;-------------------------------------------------------------------
0000166E                           762  PLAYERPLOT
0000166E                           763  ; DES       :       PLOTS THE PLAYER GRAPHICS
0000166E                           764  ; IN        :       NONE
0000166E                           765  ; OUT       :       NONE
0000166E                           766  ; MOD       :       NONE
0000166E                           767  ;-------------------------------------------------------------------
0000166E  48E7 F800                768              MOVEM.L D0-D4, -(A7)
00001672                           769m             UTILPEN #TILELIGH                         
00001672                           770m ;   IN:  #TILELIGH AS THE COLOR, FORMATED AS #00BBGGRR
00001672                           771m ;   OUT: NONE
00001672                           772m ;   MOD: D0, D1    
00001672                           773m ;   DES: MACRO TO SET PEN COLOR
00001672                           774m 
00001672  103C 0050                775m         MOVE.B  #80, D0 
00001676  223C 00CCE0EA            776m         MOVE.L  #TILELIGH, D1
0000167C  4E4F                     777m         TRAP    #15
0000167E                           778m         ENDM
0000167E                           779  
0000167E                           780m             UTILFILL #TILELIGH
0000167E                           781m ;   IN:  #TILELIGH AS THE COLOR, FORMATED AS #00BBGGRR
0000167E                           782m ;   OUT: NONE
0000167E                           783m ;   MOD: D0, D1
0000167E                           784m ;   DES: MACRO TO SET FILL COLOR
0000167E                           785m 
0000167E  103C 0051                786m         MOVE.B  #81, D0
00001682  223C 00CCE0EA            787m         MOVE.L  #TILELIGH, D1
00001688  4E4F                     788m         TRAP    #15
0000168A                           789m         ENDM
0000168A                           790              
0000168A                           791m             UTILTILE #87, (PLAYERX), (PLAYERY)
0000168A                           792m ;   IN:  #87 PROCEDURE OF THE TRAP #15
0000168A                           793m ;        (PLAYERX) X COORDINATE
0000168A                           794m ;        (PLAYERY) Y COORDINATE
0000168A                           795m ;   OUT: NONE
0000168A                           796m ;   MOD: D1-D4
0000168A                           797m ;   DES: DRAWS A GRAPHIC AT (PLAYERX) (PLAYERY)
0000168A  3239 00002B00            798m         MOVE.W  (PLAYERX), D1               ; D1 = X CENTER
00001690  3439 00002B02            799m         MOVE.W  (PLAYERY), D2               ; D1 = Y CENTER
00001696  3601                     800m         MOVE.W  D1, D3
00001698  3802                     801m         MOVE.W  D2, D4
0000169A  0441 0010                802m         SUB.W   #TILEDIM/2, D1              ; SET TOP LEFT CORNER
0000169E  0442 0010                803m         SUB.W   #TILEDIM/2, D2              ; SET TOP LEFT CORNER 
000016A2  0643 0010                804m         ADD.W   #TILEDIM/2, D3              ; SET LOW RIGHT CORNER
000016A6  0644 0010                805m         ADD.W   #TILEDIM/2, D4              ; SET LOW RIGHT CORNER
000016AA                           806m 
000016AA  303C 0057                807m         MOVE.W  #87, D0
000016AE  4E4F                     808m         TRAP    #15
000016B0                           809m         ENDM
000016B0  4CDF 001F                810              MOVEM.L (A7)+,D0-D4
000016B4  4E75                     811              RTS
000016B6                           812  
000016B6                           813  
000016B6                           814  -------------------- end include --------------------
000016B6                           815              INCLUDE "MAP.X68"               ; MAP MANAGER
000016B6                           816  ;-------------------------------------------------------
000016B6                           817  MAPPLOT
000016B6                           818  ; DES       :       PLOTS MAP BORDERS
000016B6                           819  ; IN        :       NONE
000016B6                           820  ; OUT       :       NONE
000016B6                           821  ; MOD       :       NONE
000016B6                           822  ;-------------------------------------------------------
000016B6  48E7 F800                823          MOVEM.L D0-D4, -(A7)
000016BA                           824          
000016BA                           825m         UTILPEN #TILEDARK
000016BA                           826m ;   IN:  #TILEDARK AS THE COLOR, FORMATED AS #00BBGGRR
000016BA                           827m ;   OUT: NONE
000016BA                           828m ;   MOD: D0, D1    
000016BA                           829m ;   DES: MACRO TO SET PEN COLOR
000016BA                           830m 
000016BA  103C 0050                831m         MOVE.B  #80, D0 
000016BE  223C 00745B6D            832m         MOVE.L  #TILEDARK, D1
000016C4  4E4F                     833m         TRAP    #15
000016C6                           834m         ENDM
000016C6                           835m         UTILFILL #TILEDARK
000016C6                           836m ;   IN:  #TILEDARK AS THE COLOR, FORMATED AS #00BBGGRR
000016C6                           837m ;   OUT: NONE
000016C6                           838m ;   MOD: D0, D1
000016C6                           839m ;   DES: MACRO TO SET FILL COLOR
000016C6                           840m 
000016C6  103C 0051                841m         MOVE.B  #81, D0
000016CA  223C 00745B6D            842m         MOVE.L  #TILEDARK, D1
000016D0  4E4F                     843m         TRAP    #15
000016D2                           844m         ENDM
000016D2                           845  
000016D2  4241                     846          CLR     D1                          ; LEFT BORDER
000016D4  4242                     847          CLR     D2                      
000016D6  363C 004F                848          MOVE.W  #79, D3
000016DA  383C 01E0                849          MOVE.W  #SCRHEIGH, D4
000016DE  303C 0057                850          MOVE.W  #87, D0
000016E2  4E4F                     851          TRAP    #15
000016E4                           852  
000016E4  323C 0231                853          MOVE.W  #561, D1                    ; RIGHT BORDER                                
000016E8  363C 0280                854          MOVE.W  #SCRWIDTH, D3
000016EC  4E4F                     855          TRAP    #15
000016EE                           856          
000016EE  4CDF 001F                857          MOVEM.L (A7)+,D0-D4
000016F2                           858  
000016F2  4E75                     859          RTS
000016F2  4E75                     860  -------------------- end include --------------------
000016F4                           861              INCLUDE "KEY.X68"               ; KEY MANAGER
000016F4                           862  ;---------------------------------------------------------------
000016F4                           863  KEYINIT             
000016F4                           864  ; DES       :       INIT METHOD TO KEY OBJECT
000016F4                           865  ; IN        :       NONE
000016F4                           866  ; OUT       :       NONE
000016F4                           867  ; MOD       :       (KEYX) WITH X POSITION 
000016F4                           868  ;           (KEYY) WITH Y POSITION
000016F4                           869  ;---------------------------------------------------------------
000016F4  2F00                     870              MOVE.L D0, -(A7)
000016F6  4EB8 14D8                871              JSR     RNGX
000016FA  33C0 00002B04            872              MOVE.W  D0, (KEYX)
00001700  4EB8 1508                873              JSR     RNGY
00001704  33C0 00002B06            874              MOVE.W  D0, (KEYY)
0000170A  201F                     875              MOVE.L  (A7)+, D0
0000170C  4E75                     876              RTS
0000170E                           877  
0000170E                           878  ;---------------------------------------------------------------
0000170E                           879  KEYUPDT
0000170E                           880  ; DES       :       SEES IF PLAYER IS ON THE SAME BLOCK AS HIMSELF
0000170E                           881  ; IN        :       NONE
0000170E                           882  ; OUT       :       NONE
0000170E                           883  ; MOD       :       (KEYOBTAINED) IF PLAYER IS IN THE SAME POSITION AS HIMSELF             
0000170E                           884  ;---------------------------------------------------------------
0000170E                           885              
0000170E  48E7 E000                886                  MOVEM.L D0-D2, -(A7)
00001712                           887             
00001712  3039 00002B04            888              MOVE.W  (KEYX), D0
00001718  3239 00002B06            889              MOVE.W  (KEYY), D1
0000171E  4EB8 14AE                890              JSR     UTILCOLL
00001722  B43C 00FF                891              CMP.B   #$FF, D2
00001726  6600 000A                892              BNE     .END
0000172A  13FC 0001 00002B10       893              MOVE.B  #1, (KEYOBTEINED)           ; THE PLAYER IS IN THE POSITION OF THE KEY
00001732                           894  .END
00001732  4CDF 0007                895              MOVEM.L (A7)+, D0-D2
00001736  4E75                     896              RTS
00001738                           897  ;--------------------------------------------------------------
00001738                           898  KEYPLOT             
00001738                           899  ; DES       :       PLOTS THE KEY GRAPHIC
00001738                           900  ; IN        :       NONE
00001738                           901  ; OUT       :       NONE
00001738                           902  ; MOD       :       NONE
00001738                           903  ;--------------------------------------------------------------
00001738  0C39 0001 00002B10       904              CMP.B   #1, (KEYOBTEINED)
00001740  6700 003C                905              BEQ     .NOKEY
00001744  48E7 F800                906              MOVEM.L D0-D4, -(A7)
00001748                           907m             UTILPEN #TILELIGH
00001748                           908m ;   IN:  #TILELIGH AS THE COLOR, FORMATED AS #00BBGGRR
00001748                           909m ;   OUT: NONE
00001748                           910m ;   MOD: D0, D1    
00001748                           911m ;   DES: MACRO TO SET PEN COLOR
00001748                           912m 
00001748  103C 0050                913m         MOVE.B  #80, D0 
0000174C  223C 00CCE0EA            914m         MOVE.L  #TILELIGH, D1
00001752  4E4F                     915m         TRAP    #15
00001754                           916m         ENDM
00001754                           917  
00001754                           918m             UTILTILE #91, (KEYX), (KEYY)             
00001754                           919m ;   IN:  #91 PROCEDURE OF THE TRAP #15
00001754                           920m ;        (KEYX) X COORDINATE
00001754                           921m ;        (KEYY) Y COORDINATE
00001754                           922m ;   OUT: NONE
00001754                           923m ;   MOD: D1-D4
00001754                           924m ;   DES: DRAWS A GRAPHIC AT (KEYX) (KEYY)
00001754  3239 00002B04            925m         MOVE.W  (KEYX), D1               ; D1 = X CENTER
0000175A  3439 00002B06            926m         MOVE.W  (KEYY), D2               ; D1 = Y CENTER
00001760  3601                     927m         MOVE.W  D1, D3
00001762  3802                     928m         MOVE.W  D2, D4
00001764  0441 0010                929m         SUB.W   #TILEDIM/2, D1              ; SET TOP LEFT CORNER
00001768  0442 0010                930m         SUB.W   #TILEDIM/2, D2              ; SET TOP LEFT CORNER 
0000176C  0643 0010                931m         ADD.W   #TILEDIM/2, D3              ; SET LOW RIGHT CORNER
00001770  0644 0010                932m         ADD.W   #TILEDIM/2, D4              ; SET LOW RIGHT CORNER
00001774                           933m 
00001774  303C 005B                934m         MOVE.W  #91, D0
00001778  4E4F                     935m         TRAP    #15
0000177A                           936m         ENDM
0000177A                           937             
0000177A  4CDF 001F                938              MOVEM.L (A7)+,D0-D4
0000177E                           939  .NOKEY            
0000177E  4E75                     940              RTS
0000177E  4E75                     941  -------------------- end include --------------------
00001780                           942              INCLUDE "STAIRS.X68"            ; STAIR MANAGER 
00001780                           943  STAIRSINIT          ; RANDOM POSTION
00001780  2F00                     944              MOVE.L D0, -(A7)
00001782  4EB8 14D8                945              JSR     RNGX
00001786  33C0 00002B08            946              MOVE.W  D0, (STAIRSX)
0000178C  4EB8 1508                947              JSR     RNGY
00001790  33C0 00002B0A            948              MOVE.W  D0, (STAIRSY)
00001796  201F                     949              MOVE.L  (A7)+, D0
00001798  4279 00002B16            950              CLR     ONSTAIRS
0000179E  4E75                     951              RTS
000017A0                           952  STAIRSUPDT          
000017A0  48E7 E070                953              MOVEM.L D0-D2/A1-A3, -(A7)
000017A4  3039 00002B08            954              MOVE.W  (STAIRSX), D0
000017AA  3239 00002B0A            955              MOVE.W  (STAIRSY), D1
000017B0  4EB8 14AE                956              JSR     UTILCOLL
000017B4  B43C 00FF                957              CMP.B   #$FF, D2
000017B8  6600 0062                958              BNE     .ENDD
000017BC                           959              
000017BC                           960              ; THE PLAYER IS IN THE POSITION OF THE STAIRS
000017BC  0C39 0001 00002B10       961              CMP.B   #1, (KEYOBTEINED)
000017C4  6600 004A                962              BNE     .NOKEY
000017C8  4EB8 16F4                963              JSR     KEYINIT
000017CC  4EB8 1780                964              JSR     STAIRSINIT
000017D0                           965  
000017D0                           966  ; CREATE ENEMIES BASED ON LEVEL 
000017D0  4280                     967              CLR.L   D0
000017D2  303C 0007                968              MOVE.W  #ENEMYID, D0
000017D6  4EB8 159C                969              JSR     AGLFKIL     ; KILLS ALL AGENTS WITH ID       
000017DA  3239 00002B1E            970              MOVE.W (LEVEL), D1
000017E0                           971              
000017E0                           972  .ENEMYADD
000017E0  43F9 000018A6            973              LEA     ENEMYINIT, A1
000017E6  45F9 000018BE            974              LEA     ENEMYUPDT, A2
000017EC  47F9 000018E2            975              LEA     ENEMYPLOT, A3
000017F2  303C 0007                976              MOVE.W  #ENEMYID, D0
000017F6                           977              
000017F6  4EB8 1538                978              JSR     AGLADD
000017FA  51C9 FFE4                979              DBRA.W    D1, .ENEMYADD
000017FE                           980  
000017FE  13FC 0000 00002B10       981              MOVE.B  #0, (KEYOBTEINED)
00001806  5279 00002B1E            982              ADDQ.W  #1, (LEVEL)
0000180C  6000 0014                983              BRA     .END
00001810                           984  .NOKEY      ; SAME POSITION NO KEY
00001810  33FC 0001 00002B16       985              MOVE.W  #1, (ONSTAIRS)
00001818  6000 0008                986              BRA     .END
0000181C                           987              
0000181C                           988  .ENDD
0000181C  4279 00002B16            989              CLR     ONSTAIRS
00001822                           990  .END
00001822                           991              
00001822  4CDF 0E07                992              MOVEM.L (A7)+, D0-D2/A1-A3
00001826  4E75                     993              RTS
00001828                           994              
00001828                           995  STAIRSPLOT          
00001828  48E7 F800                996              MOVEM.L D0-D4, -(A7)
0000182C                           997                      
0000182C                           998m             UTILPEN #TILELIGH
0000182C                           999m ;   IN:  #TILELIGH AS THE COLOR, FORMATED AS #00BBGGRR
0000182C                          1000m ;   OUT: NONE
0000182C                          1001m ;   MOD: D0, D1    
0000182C                          1002m ;   DES: MACRO TO SET PEN COLOR
0000182C                          1003m 
0000182C  103C 0050               1004m         MOVE.B  #80, D0 
00001830  223C 00CCE0EA           1005m         MOVE.L  #TILELIGH, D1
00001836  4E4F                    1006m         TRAP    #15
00001838                          1007m         ENDM
00001838                          1008m             UTILFILL #TILELIGH 
00001838                          1009m ;   IN:  #TILELIGH AS THE COLOR, FORMATED AS #00BBGGRR
00001838                          1010m ;   OUT: NONE
00001838                          1011m ;   MOD: D0, D1
00001838                          1012m ;   DES: MACRO TO SET FILL COLOR
00001838                          1013m 
00001838  103C 0051               1014m         MOVE.B  #81, D0
0000183C  223C 00CCE0EA           1015m         MOVE.L  #TILELIGH, D1
00001842  4E4F                    1016m         TRAP    #15
00001844                          1017m         ENDM
00001844                          1018                              
00001844  0C39 0001 00002B10      1019              CMP.B   #1, (KEYOBTEINED)
0000184C  6700 002C               1020              BEQ     .KEYOBTEINED
00001850                          1021m             UTILTILE #88, (STAIRSX), (STAIRSY)
00001850                          1022m ;   IN:  #88 PROCEDURE OF THE TRAP #15
00001850                          1023m ;        (STAIRSX) X COORDINATE
00001850                          1024m ;        (STAIRSY) Y COORDINATE
00001850                          1025m ;   OUT: NONE
00001850                          1026m ;   MOD: D1-D4
00001850                          1027m ;   DES: DRAWS A GRAPHIC AT (STAIRSX) (STAIRSY)
00001850  3239 00002B08           1028m         MOVE.W  (STAIRSX), D1               ; D1 = X CENTER
00001856  3439 00002B0A           1029m         MOVE.W  (STAIRSY), D2               ; D1 = Y CENTER
0000185C  3601                    1030m         MOVE.W  D1, D3
0000185E  3802                    1031m         MOVE.W  D2, D4
00001860  0441 0010               1032m         SUB.W   #TILEDIM/2, D1              ; SET TOP LEFT CORNER
00001864  0442 0010               1033m         SUB.W   #TILEDIM/2, D2              ; SET TOP LEFT CORNER 
00001868  0643 0010               1034m         ADD.W   #TILEDIM/2, D3              ; SET LOW RIGHT CORNER
0000186C  0644 0010               1035m         ADD.W   #TILEDIM/2, D4              ; SET LOW RIGHT CORNER
00001870                          1036m 
00001870  303C 0058               1037m         MOVE.W  #88, D0
00001874  4E4F                    1038m         TRAP    #15
00001876                          1039m         ENDM
00001876  6000 0028               1040              BRA     .END
0000187A                          1041  .KEYOBTEINED
0000187A                          1042m             UTILTILE #91, (STAIRSX), (STAIRSY)
0000187A                          1043m ;   IN:  #91 PROCEDURE OF THE TRAP #15
0000187A                          1044m ;        (STAIRSX) X COORDINATE
0000187A                          1045m ;        (STAIRSY) Y COORDINATE
0000187A                          1046m ;   OUT: NONE
0000187A                          1047m ;   MOD: D1-D4
0000187A                          1048m ;   DES: DRAWS A GRAPHIC AT (STAIRSX) (STAIRSY)
0000187A  3239 00002B08           1049m         MOVE.W  (STAIRSX), D1               ; D1 = X CENTER
00001880  3439 00002B0A           1050m         MOVE.W  (STAIRSY), D2               ; D1 = Y CENTER
00001886  3601                    1051m         MOVE.W  D1, D3
00001888  3802                    1052m         MOVE.W  D2, D4
0000188A  0441 0010               1053m         SUB.W   #TILEDIM/2, D1              ; SET TOP LEFT CORNER
0000188E  0442 0010               1054m         SUB.W   #TILEDIM/2, D2              ; SET TOP LEFT CORNER 
00001892  0643 0010               1055m         ADD.W   #TILEDIM/2, D3              ; SET LOW RIGHT CORNER
00001896  0644 0010               1056m         ADD.W   #TILEDIM/2, D4              ; SET LOW RIGHT CORNER
0000189A                          1057m 
0000189A  303C 005B               1058m         MOVE.W  #91, D0
0000189E  4E4F                    1059m         TRAP    #15
000018A0                          1060m         ENDM
000018A0                          1061  
000018A0                          1062  .END
000018A0  4CDF 001F               1063              MOVEM.L (A7)+,D0-D4
000018A4  4E75                    1064              RTS
000018A6                          1065  
000018A6                          1066  
000018A6                          1067  -------------------- end include --------------------
000018A6                          1068              INCLUDE "ENEMY.X68"             ; ENEMY MANAGER
000018A6                          1069  ;   LOCAL VARIABLES:
000018A6                          1070  ;       XCENTER -   (A0)    WORD
000018A6                          1071  ;       YCENTER -   2(A0)   WORD
000018A6                          1072  ;       ID      -   
000018A6                          1073  ;------------------------------------------------------------------------------
000018A6                          1074  ENEMYINIT
000018A6                          1075  ; DES       :       ENEMY INIT
000018A6                          1076  ; IN        :       NONE
000018A6                          1077  ; OUT       :       NONE
000018A6                          1078  ; MOD       :       (A0) WITH X COORDINATE
000018A6                          1079  ;           2(A0) WITH Y COORDINATE
000018A6                          1080  ;------------------------------------------------------------------------------
000018A6                          1081                   
000018A6  48E7 8000               1082              MOVEM.L  D0, -(A7)
000018AA                          1083              ; move.w #1, d1 ????            
000018AA  4EB8 14D8               1084              JSR     RNGX
000018AE  3080                    1085              MOVE.W  D0, (A0)        ; MOVE X COORDINATE TO (A0) | AGENT CONTROL
000018B0  4EB8 1508               1086              JSR     RNGY 
000018B4  3140 0002               1087              MOVE.W  D0, 2(A0)       ; MOVE Y COORDIANTE TO 2(A0) | AGENT CONTROL
000018B8                          1088  
000018B8  4CDF 0001               1089              MOVEM.L  (A7)+, D0
000018BC  4E75                    1090              RTS
000018BE                          1091  
000018BE                          1092  ;------------------------------------------------------------------------------
000018BE                          1093  ENEMYUPDT
000018BE                          1094  ; DES       :       ENEMY UPDATE. SEES IF PLAYER IS IN THE SAME BLOCK AS HIMSELF
000018BE                          1095  ; IN        :       NONE
000018BE                          1096  ; OUT       :       NONE
000018BE                          1097  ; MOD       :       (STANEXT) IN CASE PLAYER IS IN THE SAME BLOCK AS HIMSELF
000018BE                          1098  ;------------------------------------------------------------------------------
000018BE                          1099  
000018BE  48E7 E000               1100              MOVEM.L D0-D2, -(A7)
000018C2                          1101  
000018C2  3010                    1102              MOVE.W  (A0), D0
000018C4  3228 0002               1103              MOVE.W  2(A0), D1
000018C8  4EB8 14AE               1104              JSR     UTILCOLL
000018CC  B43C 00FF               1105              CMP.B   #$FF, D2
000018D0  6600 000A               1106              BNE     .END
000018D4                          1107              ; THE PLAYER IS IN THE POSITION OF THE STAIRS  
000018D4  33FC 0002 00002B0E      1108              MOVE.W  #STADM, (STANEXT)
000018DC                          1109  .END
000018DC  4CDF 0007               1110              MOVEM.L (A7)+, D0-D2
000018E0  4E75                    1111              RTS
000018E2                          1112  ;------------------------------------------------------------------------------
000018E2                          1113  ENEMYPLOT
000018E2                          1114  ; DES       :       ENEMY PLOT
000018E2                          1115  ; IN        :       NONE
000018E2                          1116  ; OUT       :       NONE
000018E2                          1117  ; MOD       :       NONE
000018E2                          1118  ;------------------------------------------------------------------------------
000018E2  48E7 F800               1119              MOVEM.L D0-D4, -(A7)
000018E6                          1120  
000018E6                          1121m             UTILPEN #TILEDETA                       
000018E6                          1122m ;   IN:  #TILEDETA AS THE COLOR, FORMATED AS #00BBGGRR
000018E6                          1123m ;   OUT: NONE
000018E6                          1124m ;   MOD: D0, D1    
000018E6                          1125m ;   DES: MACRO TO SET PEN COLOR
000018E6                          1126m 
000018E6  103C 0050               1127m         MOVE.B  #80, D0 
000018EA  223C 00957EA0           1128m         MOVE.L  #TILEDETA, D1
000018F0  4E4F                    1129m         TRAP    #15
000018F2                          1130m         ENDM
000018F2                          1131m             UTILFILL #TILEDETA
000018F2                          1132m ;   IN:  #TILEDETA AS THE COLOR, FORMATED AS #00BBGGRR
000018F2                          1133m ;   OUT: NONE
000018F2                          1134m ;   MOD: D0, D1
000018F2                          1135m ;   DES: MACRO TO SET FILL COLOR
000018F2                          1136m 
000018F2  103C 0051               1137m         MOVE.B  #81, D0
000018F6  223C 00957EA0           1138m         MOVE.L  #TILEDETA, D1
000018FC  4E4F                    1139m         TRAP    #15
000018FE                          1140m         ENDM
000018FE                          1141m             UTILTILE #87, (A0), 2(A0)
000018FE                          1142m ;   IN:  #87 PROCEDURE OF THE TRAP #15
000018FE                          1143m ;        (A0) X COORDINATE
000018FE                          1144m ;        2(A0) Y COORDINATE
000018FE                          1145m ;   OUT: NONE
000018FE                          1146m ;   MOD: D1-D4
000018FE                          1147m ;   DES: DRAWS A GRAPHIC AT (A0) 2(A0)
000018FE  3210                    1148m         MOVE.W  (A0), D1               ; D1 = X CENTER
00001900  3428 0002               1149m         MOVE.W  2(A0), D2               ; D1 = Y CENTER
00001904  3601                    1150m         MOVE.W  D1, D3
00001906  3802                    1151m         MOVE.W  D2, D4
00001908  0441 0010               1152m         SUB.W   #TILEDIM/2, D1              ; SET TOP LEFT CORNER
0000190C  0442 0010               1153m         SUB.W   #TILEDIM/2, D2              ; SET TOP LEFT CORNER 
00001910  0643 0010               1154m         ADD.W   #TILEDIM/2, D3              ; SET LOW RIGHT CORNER
00001914  0644 0010               1155m         ADD.W   #TILEDIM/2, D4              ; SET LOW RIGHT CORNER
00001918                          1156m 
00001918  303C 0057               1157m         MOVE.W  #87, D0
0000191C  4E4F                    1158m         TRAP    #15
0000191E                          1159m         ENDM
0000191E                          1160              
0000191E  4CDF 001F               1161              MOVEM.L (A7)+,D0-D4
00001922  4E75                    1162              RTS
00001924                          1163  
00001924                          1164  -------------------- end include --------------------
00001924                          1165              INCLUDE "MISC.X68"              ; MISCELLANEOUS MANAGER
00001924                          1166  ; ----------------------------------------------------------------------------- 
00001924                          1167  MISCPLOT
00001924                          1168  ; DES       :       PLOTS ALL MISC PROCEDURES
00001924                          1169  ; IN        :       NONE
00001924                          1170  ; OUT       :       NONE
00001924                          1171  ; MOD       :       NONE
00001924                          1172  ;------------------------------------------------------------------------------
00001924  4EB9 00001932           1173          JSR .LVLPLOT
0000192A  4EB9 00001956           1174          JSR .NOOKEYPLOT
00001930  4E75                    1175          RTS
00001932                          1176  
00001932                          1177  ;------------------------------------------------------------------------------
00001932                          1178  .LVLPLOT
00001932                          1179  ; DES       :       PLOTS LEVEL COUNTER ON THE TOP LEFT CORNER
00001932                          1180  ; IN        :       NONE
00001932                          1181  ; OUT       :       NONE
00001932                          1182  ; MOD       :       NONE
00001932                          1183  ;------------------------------------------------------------------------------
00001932  48E7 E040               1184          MOVEM.L D0-D2/A1, -(A7)
00001936                          1185          
00001936                          1186m         UTILFILL #00000000      
00001936                          1187m ;   IN:  #00000000 AS THE COLOR, FORMATED AS #00BBGGRR
00001936                          1188m ;   OUT: NONE
00001936                          1189m ;   MOD: D0, D1
00001936                          1190m ;   DES: MACRO TO SET FILL COLOR
00001936                          1191m 
00001936  103C 0051               1192m         MOVE.B  #81, D0
0000193A  7200                    1193m         MOVE.L  #00000000, D1
0000193C  4E4F                    1194m         TRAP    #15
0000193E                          1195m         ENDM
0000193E                          1196  
0000193E  43F8 124D               1197          LEA     LEVELSTRING, A1
00001942  4281                    1198          CLR.L   D1
00001944  3239 00002B1E           1199          MOVE.W  (LEVEL), D1
0000194A  103C 0011               1200          MOVE.B  #17,D0
0000194E  4E4F                    1201          TRAP    #15
00001950                          1202          
00001950  4CDF 0207               1203          MOVEM.L (A7)+, D0-D2/A1
00001954  4E75                    1204          RTS 
00001956                          1205  ;------------------------------------------------------------------------------
00001956                          1206  .NOOKEYPLOT
00001956                          1207  ; DES       :       PLOTS A TEXT IF PLAYER IS ON STAIRS AND HAS NO KEY
00001956                          1208  ; IN        :       NONE
00001956                          1209  ; OUT       :       NONE
00001956                          1210  ; MOD       :       NONE
00001956                          1211  ;------------------------------------------------------------------------------
00001956  0C79 0001 00002B16      1212          CMP     #1, (ONSTAIRS)
0000195E  6600 001C               1213          BNE     .END     
00001962  48E7 E040               1214          MOVEM.L D0-D2/A1, -(A7)
00001966                          1215m         UTILTEXT NOKEYSTRING, #SCRWIDTH/2-100, #SCRHEIGH/8  
00001966                          1216m ;   IN:  NOKEYSTRING TEXT 
00001966                          1217m ;        #SCRWIDTH/2-100 TEXT X
00001966                          1218m ;        #SCRHEIGH/8 TEXT Y
00001966                          1219m ;   OUT: NONE
00001966                          1220m ;   MOD: D0-D2 / A1
00001966                          1221m ;   DES: PRINTS THE 0 TERINATED STRING IN NOKEYSTRING IN COORDINATES #SCRWIDTH/2-100 #SCRHEIGH/8
00001966                          1222m 
00001966  43F8 11D6               1223m         LEA     NOKEYSTRING, A1
0000196A  323C 00DC               1224m         MOVE.W  #SCRWIDTH/2-100, D1
0000196E  343C 003C               1225m         MOVE.W  #SCRHEIGH/8, D2
00001972                          1226m 
00001972  303C 005F               1227m         MOVE.W  #95, D0
00001976  4E4F                    1228m         TRAP    #15
00001978                          1229m         ENDM
00001978  4CDF 0207               1230          MOVEM.L (A7)+, D0-D2/A1
0000197C                          1231  .END        
0000197C  4E75                    1232          RTS
0000197C  4E75                    1233  -------------------- end include --------------------
0000197E                          1234              INCLUDE "STATES.X68"            ; STATES MANAGER
0000197E                          1235  ; =============================================================================
0000197E                          1236  ; TITLE    : GAME STATE MANAGEMENT
0000197E                          1237  ; AUTHOR   : RUBEN PALMER PEREZ
0000197E                          1238  ; HISTORY  : 
0000197E                          1239  ; =============================================================================
0000197E                          1240  
0000197E                          1241  ; -----------------------------------------------------------------------------
0000197E                          1242  STAINIT
0000197E                          1243  ; INITALIZES THE STATE MANAGER
0000197E                          1244  ; INPUT    - NONE
0000197E                          1245  ; OUTPUT   - NONE
0000197E                          1246  ; MODIFIES - NONE
0000197E                          1247  ; -----------------------------------------------------------------------------
0000197E  33FC FFFF 00002B0C      1248              MOVE.W  #-1,(STACUR)            ; INVALID STATE, JUST TO FORCE INIT
00001986  33FC 0000 00002B0E      1249              MOVE.W  #0,(STANEXT)            ; INITIAL STATE
0000198E  4E75                    1250              RTS
00001990                          1251  
00001990                          1252  ; -----------------------------------------------------------------------------
00001990                          1253  STAUPD
00001990                          1254  ; PERFORMS STATE UPDATE AND INIT IF NECESSARY
00001990                          1255  ; INPUT    - NONE
00001990                          1256  ; OUTPUT   - NONE
00001990                          1257  ; MODIFIES - NONE
00001990                          1258  ; -----------------------------------------------------------------------------
00001990  48E7 8080               1259              MOVEM.L D0/A0,-(A7)
00001994  4280                    1260              CLR.L   D0
00001996  3039 00002B0E           1261              MOVE.W  (STANEXT),D0
0000199C  B079 00002B0C           1262              CMP.W   (STACUR),D0
000019A2  6700 0012               1263              BEQ     .DOUPD
000019A6  33C0 00002B0C           1264              MOVE.W  D0,(STACUR)             ; IF STATE CHANGED, DO INIT
000019AC  E588                    1265              LSL.L   #2,D0
000019AE  2040                    1266              MOVE.L  D0,A0
000019B0  2068 19CE               1267              MOVE.L  .INITBL(A0),A0
000019B4  4E90                    1268              JSR     (A0)
000019B6  4280                    1269  .DOUPD      CLR.L   D0                      ; IN ANY CASE, DO UPDATE
000019B8  3039 00002B0C           1270              MOVE.W  (STACUR),D0
000019BE  E588                    1271              LSL.L   #2,D0
000019C0  2040                    1272              MOVE.L  D0,A0
000019C2  2068 19DA               1273              MOVE.L  .UPDTBL(A0),A0
000019C6  4E90                    1274              JSR     (A0)
000019C8  4CDF 0101               1275              MOVEM.L (A7)+,D0/A0
000019CC  4E75                    1276              RTS
000019CE= 00001A10 00001B8E ...   1277  .INITBL     DC.L    STAMMI,STAGPI,STAEMPTY
000019DA= 00001A32 00001B9E ...   1278  .UPDTBL     DC.L    STAMMU,STAGPU,STADMU
000019E6                          1279  
000019E6                          1280  ; -----------------------------------------------------------------------------
000019E6                          1281  STAPLOT
000019E6                          1282  ; PERFORMS STATE PLOT
000019E6                          1283  ; INPUT    - NONE
000019E6                          1284  ; OUTPUT   - NONE
000019E6                          1285  ; MODIFIES - NONE
000019E6                          1286  ; -----------------------------------------------------------------------------
000019E6  48E7 8080               1287              MOVEM.L D0/A0,-(A7)
000019EA  4280                    1288              CLR.L   D0
000019EC  3039 00002B0C           1289              MOVE.W  (STACUR),D0
000019F2  E588                    1290              LSL.L   #2,D0
000019F4  2040                    1291              MOVE.L  D0,A0
000019F6  2068 1A02               1292              MOVE.L  .PLTTBL(A0),A0
000019FA  4E90                    1293              JSR     (A0)
000019FC  4CDF 0101               1294              MOVEM.L (A7)+,D0/A0
00001A00  4E75                    1295              RTS
00001A02= 00001AA8 00001BDA ...   1296  .PLTTBL     DC.L    STAMMP,STAGPP,STADMP
00001A0E                          1297  
00001A0E                          1298  ; -----------------------------------------------------------------------------
00001A0E                          1299  STAEMPTY
00001A0E                          1300  ; EMPTY SUBROUTINE FOR CASES WITH NOTHING TO DO
00001A0E                          1301  ; INPUT    - NONE
00001A0E                          1302  ; OUTPUT   - NONE
00001A0E                          1303  ; MODIFIES - NONE
00001A0E                          1304  ; NOTE     - JUST A PLACEHOLDER. NOTHING TO DO.
00001A0E                          1305  ; -----------------------------------------------------------------------------
00001A0E  4E75                    1306              RTS
00001A10                          1307  ;------------------------------------------------------------------------------
00001A10                          1308  STAMMI
00001A10                          1309  ; DES       :       MAIN MENU STATE INIT
00001A10                          1310  ; IN        :       NONE
00001A10                          1311  ; OUT       :       NONE
00001A10                          1312  ; MOD       :       NONE
00001A10                          1313  ;------------------------------------------------------------------------------
00001A10  2F00                    1314              MOVE.L  D0, -(A7)
00001A12  303C 0007               1315              MOVE.W  #7, D0
00001A16  4EB8 159C               1316              JSR     AGLFKIL
00001A1A  201F                    1317              MOVE.L  (A7)+, D0
00001A1C  4279 00002B1E           1318              CLR     (LEVEL)
00001A22  4279 00002B12           1319              CLR     (TORCHSHADDER)
00001A28  33FC 0003 00002B18      1320              MOVE.W  #3, TORCHRANGE
00001A30  4E75                    1321              RTS
00001A32                          1322  
00001A32                          1323  ;------------------------------------------------------------------------------
00001A32                          1324  STAMMU
00001A32                          1325  ; DES       :       MAIN MENU STATE UPDATE. CHECKS IF THE PLAYER HAS CLICKED ANY BUTTON ON SCREEN
00001A32                          1326  ; IN        :       NONE
00001A32                          1327  ; OUT       :       NONE
00001A32                          1328  ; MOD       :       NONE
00001A32                          1329  ;------------------------------------------------------------------------------
00001A32  48E7 F000               1330              MOVEM.L D0-D3, -(A7)
00001A36                          1331  
00001A36  303C 003C               1332              MOVE.W  #60, D0
00001A3A  323C 0012               1333              MOVE.W  #%00010010, D1  ; ACTIVATE MOUSE IRQ TO MOUSE DOWN AND UP
00001A3E  4E4F                    1334              TRAP    #15
00001A40                          1335              
00001A40                          1336          
00001A40  303C 003D               1337              MOVE.W  #61, D0
00001A44  4241                    1338              CLR     D1
00001A46  4E4F                    1339              TRAP    #15             
00001A48                          1340          
00001A48  B03C 0000               1341              CMP.B   #0, D0          ; CHECK IF LEFT BUTTON OF MOUSE IS PRESSED
00001A4C  6700 0054               1342              BEQ     .END            ; NOT PRESSED
00001A50  2601                    1343              MOVE.L  D1, D3
00001A52  E08B                    1344              LSR.L   #8, D3
00001A54  E08B                    1345              LSR.L   #8, D3
00001A56                          1346  
00001A56  B67C 0163               1347              CMP.W    #(BUTTONY-BUTTONHEIGH), D3
00001A5A  6F00 0046               1348              BLE     .END
00001A5E  B67C 01BD               1349              CMP.W   #(BUTTONY+BUTTONHEIGH), D3 
00001A62  6C00 003E               1350              BGE     .END
00001A66                          1351              
00001A66                          1352              
00001A66                          1353              ; RIGHT X COORDINATE 
00001A66                          1354              
00001A66  B27C 0085               1355              CMP.W   #(BUTTONX1-BUTTONWIDTH), D1    ; X COORDINATE
00001A6A  6F00 0016               1356              BLE     .X2
00001A6E  B27C 0125               1357              CMP.W   #(BUTTONX1+BUTTONWIDTH), D1   
00001A72  6C00 000E               1358              BGE     .X2
00001A76                          1359              ; EASY
00001A76  33FC 0001 00002B0E      1360              MOVE.W  #STAGP, (STANEXT)
00001A7E  6000 0022               1361              BRA     .END
00001A82                          1362  
00001A82  B27C 015A               1363  .X2         CMP.W   #(BUTTONX2-BUTTONWIDTH), D1    ; X COORDINATE
00001A86  6F00 001A               1364              BLE     .END
00001A8A  B27C 01FA               1365              CMP.W   #(BUTTONX2+BUTTONWIDTH), D1   
00001A8E  6C00 0012               1366              BGE     .END
00001A92                          1367              ; NORMAL
00001A92  33FC 0001 00002B12      1368              MOVE.W  #1, (TORCHSHADDER)
00001A9A  33FC 0001 00002B0E      1369              MOVE.W  #STAGP, (STANEXT)
00001AA2                          1370  .END        
00001AA2  4CDF 000F               1371              MOVEM.L (A7)+, D0-D3
00001AA6  4E75                    1372              RTS
00001AA8                          1373  
00001AA8                          1374  ;------------------------------------------------------------------------------
00001AA8                          1375  STAMMP
00001AA8                          1376  ; DES       :       MAIN MENU STATE PLOT
00001AA8                          1377  ; IN        :       NONE
00001AA8                          1378  ; OUT       :       NONE
00001AA8                          1379  ; MOD       :       NONE
00001AA8                          1380  ;------------------------------------------------------------------------------
00001AA8  48E7 C040               1381              MOVEM.L D0-D1/A1, -(A7)
00001AAC  323C 1C05               1382              MOVE.W  #((80-24)/2)<<8|5, D1
00001AB0  103C 000B               1383              MOVE.B  #11, D0
00001AB4  4E4F                    1384              TRAP    #15
00001AB6  43F8 1256               1385              LEA     TITLESTRING, A1
00001ABA  303C 000D               1386              MOVE.W  #13, D0
00001ABE  4E4F                    1387              TRAP    #15
00001AC0                          1388  
00001AC0  4281                    1389              CLR.L   D1
00001AC2  323C 1D07               1390              MOVE.W  #((80-22)/2)<<8|7, D1
00001AC6  103C 000B               1391              MOVE.B  #11, D0
00001ACA  4E4F                    1392              TRAP    #15
00001ACC  43F8 126F               1393              LEA     SUBTITLESTR, A1
00001AD0  303C 000D               1394              MOVE.W  #13, D0
00001AD4  4E4F                    1395              TRAP    #15
00001AD6                          1396  
00001AD6  4281                    1397              CLR.L   D1
00001AD8  323C 1D08               1398              MOVE.W  #((80-22)/2)<<8|8, D1
00001ADC  103C 000B               1399              MOVE.B  #11, D0
00001AE0  4E4F                    1400              TRAP    #15
00001AE2  43F8 129F               1401              LEA     BECARESTR, A1
00001AE6  303C 000D               1402              MOVE.W  #13, D0
00001AEA  4E4F                    1403              TRAP    #15
00001AEC                          1404  
00001AEC  0839 0004 00001E55      1405              BTST.B  #4, (SCRCYCCT)  ; TIMER 
00001AF4  6700 0092               1406              BEQ     .END
00001AF8                          1407              
00001AF8                          1408m             UTILFILL #$00000000
00001AF8                          1409m ;   IN:  #$00000000 AS THE COLOR, FORMATED AS #00BBGGRR
00001AF8                          1410m ;   OUT: NONE
00001AF8                          1411m ;   MOD: D0, D1
00001AF8                          1412m ;   DES: MACRO TO SET FILL COLOR
00001AF8                          1413m 
00001AF8  103C 0051               1414m         MOVE.B  #81, D0
00001AFC  7200                    1415m         MOVE.L  #$00000000, D1
00001AFE  4E4F                    1416m         TRAP    #15
00001B00                          1417m         ENDM
00001B00                          1418m             UTILPEN #$00FFFFFF
00001B00                          1419m ;   IN:  #$00FFFFFF AS THE COLOR, FORMATED AS #00BBGGRR
00001B00                          1420m ;   OUT: NONE
00001B00                          1421m ;   MOD: D0, D1    
00001B00                          1422m ;   DES: MACRO TO SET PEN COLOR
00001B00                          1423m 
00001B00  103C 0050               1424m         MOVE.B  #80, D0 
00001B04  223C 00FFFFFF           1425m         MOVE.L  #$00FFFFFF, D1
00001B0A  4E4F                    1426m         TRAP    #15
00001B0C                          1427m         ENDM
00001B0C  323C 00D5               1428              MOVE.W  #BUTTONX1, D1
00001B10  343C 0190               1429              MOVE.W  #BUTTONY, D2
00001B14  3601                    1430              MOVE.W  D1, D3
00001B16  3802                    1431              MOVE.W  D2, D4 
00001B18  0441 0028               1432              SUB.W   #BUTTONWIDTH/2, D1              ; SET TOP LEFT CORNER
00001B1C  0442 0016               1433              SUB.W   #BUTTONHEIGH/2, D2              ; SET TOP LEFT CORNER 
00001B20  0643 0028               1434              ADD.W   #BUTTONWIDTH/2, D3              ; SET LOW RIGHT CORNER
00001B24  0644 0016               1435              ADD.W   #BUTTONHEIGH/2, D4              ; SET LOW RIGHT CORNER
00001B28                          1436  
00001B28  303C 0057               1437              MOVE.W  #87, D0
00001B2C  4E4F                    1438              TRAP    #15                             ; DRAW RECTANGLE
00001B2E                          1439  
00001B2E  43F8 12C1               1440              LEA     EASYSTR, A1
00001B32  323C 00C5               1441              MOVE.W  #BUTTONX1-16, D1
00001B36  343C 0189               1442              MOVE.W  #BUTTONY-7, D2
00001B3A                          1443  
00001B3A  303C 005F               1444              MOVE.W  #95, D0
00001B3E  4E4F                    1445              TRAP    #15
00001B40                          1446  
00001B40                          1447              ; END
00001B40                          1448m             UTILFILL #$00000000
00001B40                          1449m ;   IN:  #$00000000 AS THE COLOR, FORMATED AS #00BBGGRR
00001B40                          1450m ;   OUT: NONE
00001B40                          1451m ;   MOD: D0, D1
00001B40                          1452m ;   DES: MACRO TO SET FILL COLOR
00001B40                          1453m 
00001B40  103C 0051               1454m         MOVE.B  #81, D0
00001B44  7200                    1455m         MOVE.L  #$00000000, D1
00001B46  4E4F                    1456m         TRAP    #15
00001B48                          1457m         ENDM
00001B48                          1458m             UTILPEN #$00FFFFFF
00001B48                          1459m ;   IN:  #$00FFFFFF AS THE COLOR, FORMATED AS #00BBGGRR
00001B48                          1460m ;   OUT: NONE
00001B48                          1461m ;   MOD: D0, D1    
00001B48                          1462m ;   DES: MACRO TO SET PEN COLOR
00001B48                          1463m 
00001B48  103C 0050               1464m         MOVE.B  #80, D0 
00001B4C  223C 00FFFFFF           1465m         MOVE.L  #$00FFFFFF, D1
00001B52  4E4F                    1466m         TRAP    #15
00001B54                          1467m         ENDM
00001B54  323C 01AA               1468              MOVE.W  #BUTTONX2, D1
00001B58  343C 0190               1469              MOVE.W  #BUTTONY, D2
00001B5C  3601                    1470              MOVE.W  D1, D3
00001B5E  3802                    1471              MOVE.W  D2, D4 
00001B60  0441 0028               1472              SUB.W   #BUTTONWIDTH/2, D1              ; SET TOP LEFT CORNER
00001B64  0442 0016               1473              SUB.W   #BUTTONHEIGH/2, D2              ; SET TOP LEFT CORNER 
00001B68  0643 0028               1474              ADD.W   #BUTTONWIDTH/2, D3              ; SET LOW RIGHT CORNER
00001B6C  0644 0016               1475              ADD.W   #BUTTONHEIGH/2, D4              ; SET LOW RIGHT CORNER
00001B70                          1476  
00001B70  303C 0057               1477              MOVE.W  #87, D0
00001B74  4E4F                    1478              TRAP    #15                             ; DRAW RECTANGLE
00001B76                          1479  
00001B76  43F8 12C6               1480              LEA     NORMALSTR, A1
00001B7A  323C 0194               1481              MOVE.W  #BUTTONX2-22, D1
00001B7E  343C 0189               1482              MOVE.W  #BUTTONY-7, D2
00001B82                          1483  
00001B82  303C 005F               1484              MOVE.W  #95, D0
00001B86  4E4F                    1485              TRAP    #15
00001B88                          1486  .END    
00001B88  4CDF 0203               1487              MOVEM.L (A7)+, D0-D1/A1
00001B8C                          1488             ;  UTILTEXT NEXTSTR, #SCRWIDTH/2, #SCRHEIGH-30
00001B8C  4E75                    1489              RTS
00001B8E                          1490  ;------------------------------------------------------------------------------
00001B8E                          1491  STAGPI
00001B8E                          1492  ; DES       :       GAME PLAY STATE INIT
00001B8E                          1493  ; IN        :       NONE
00001B8E                          1494  ; OUT       :       NONE
00001B8E                          1495  ; MOD       :       NONE
00001B8E                          1496  ;------------------------------------------------------------------------------
00001B8E                          1497  
00001B8E  4EB8 14CA               1498                  JSR     RNDINIT
00001B92  4EB8 15BE               1499              JSR     PLAYERINIT
00001B96  4EB8 16F4               1500              JSR     KEYINIT
00001B9A  4EF8 1780               1501              JMP     STAIRSINIT
00001B9E                          1502             
00001B9E                          1503  ;------------------------------------------------------------------------------
00001B9E                          1504  STAGPU
00001B9E                          1505  ; DES       :       GAME PLAY STATE UPDATE. 
00001B9E                          1506  ; IN        :       NONE
00001B9E                          1507  ; OUT       :       NONE
00001B9E                          1508  ; MOD       :       (TORCHRANGE) WHENEVER IT NEEDS TO BE MODIFIED "DIFFICULTY"
00001B9E                          1509  ;------------------------------------------------------------------------------
00001B9E                          1510              
00001B9E  0C79 0008 00002B1E      1511              CMP.W   #8, (LEVEL)
00001BA6  6700 001E               1512              BEQ     .CP1
00001BAA  0C79 000F 00002B1E      1513              CMP.W   #15, (LEVEL)
00001BB2  6700 001C               1514              BEQ     .CP2
00001BB6                          1515  
00001BB6  4EB8 15D0               1516  .CLASS      JSR     PLAYERUPDT
00001BBA  4EB8 170E               1517              JSR     KEYUPDT
00001BBE  4EB8 17A0               1518              JSR     STAIRSUPDT
00001BC2  4EF8 1552               1519              JMP     AGLUPDT
00001BC6                          1520  .CP1
00001BC6  33FC 0002 00002B18      1521              MOVE.W #2, (TORCHRANGE)
00001BCE  60E6                    1522              BRA    .CLASS
00001BD0                          1523  .CP2
00001BD0  33FC 0001 00002B18      1524              MOVE.W #1, (TORCHRANGE)
00001BD8  60DC                    1525              BRA     .CLASS
00001BDA                          1526  
00001BDA                          1527  ;------------------------------------------------------------------------------
00001BDA                          1528  STAGPP
00001BDA                          1529  ; DES       :       GAME PLAY STATE PLOT
00001BDA                          1530  ; IN        :       NONE
00001BDA                          1531  ; OUT       :       NONE
00001BDA                          1532  ; MOD       :       NONE
00001BDA                          1533  ;------------------------------------------------------------------------------
00001BDA  4EB8 16B6               1534              JSR     MAPPLOT
00001BDE  4EB8 166E               1535              JSR     PLAYERPLOT
00001BE2  4EB8 1738               1536              JSR     KEYPLOT
00001BE6  4EB8 1828               1537              JSR     STAIRSPLOT
00001BEA                          1538              
00001BEA  4EB8 1576               1539              JSR     AGLPLOT
00001BEE  0C79 0000 00002B12      1540              CMP     #0, (TORCHSHADDER)
00001BF6  6700 0008               1541              BEQ     .END
00001BFA  4EB9 00001D78           1542              JSR     SHADDERPLOT
00001C00                          1543              
00001C00                          1544  .END        
00001C00  4EB8 1924               1545              JSR     MISCPLOT
00001C04  4E75                    1546              RTS
00001C06                          1547  
00001C06                          1548  
00001C06                          1549  ;------------------------------------------------------------------------------
00001C06                          1550  STADMU
00001C06                          1551  ; DES       :       DEATH MENU STATE UPDATE. CHECKS IF PLAYER HAS CLICKED ANY BUTTON
00001C06                          1552  ; IN        :       NONE
00001C06                          1553  ; OUT       :       NONE
00001C06                          1554  ;MOD        :       NONE
00001C06                          1555  ;------------------------------------------------------------------------------
00001C06                          1556  ; STATE DEATH MENU UPDATE
00001C06  48E7 F000               1557              MOVEM.L D0-D3, -(A7)
00001C0A                          1558  
00001C0A  303C 003C               1559              MOVE.W  #60, D0
00001C0E  323C 0012               1560              MOVE.W  #%00010010, D1  ; ACTIVATE MOUSE IRQ TO MOUSE DOWN AND UP
00001C12  4E4F                    1561              TRAP    #15
00001C14                          1562              
00001C14                          1563          
00001C14  303C 003D               1564              MOVE.W  #61, D0
00001C18  4241                    1565              CLR     D1
00001C1A  4E4F                    1566              TRAP    #15             
00001C1C                          1567          
00001C1C  B03C 0000               1568              CMP.B   #0, D0          ; CHECK IF LEFT BUTTON OF MOUSE IS PRESSED
00001C20  6700 004A               1569              BEQ     .END            ; NOT PRESSED
00001C24  2601                    1570              MOVE.L  D1, D3
00001C26  E08B                    1571              LSR.L   #8, D3
00001C28  E08B                    1572              LSR.L   #8, D3
00001C2A                          1573  
00001C2A  B67C 0163               1574              CMP.W    #(BUTTONY-BUTTONHEIGH), D3
00001C2E  6F00 003C               1575              BLE     .END
00001C32  B67C 01BD               1576              CMP.W   #(BUTTONY+BUTTONHEIGH), D3 
00001C36  6C00 0034               1577              BGE     .END
00001C3A                          1578              
00001C3A                          1579              
00001C3A                          1580              ; RIGHT X COORDINATE 
00001C3A                          1581              
00001C3A  B27C 0085               1582              CMP.W   #(BUTTONX1-BUTTONWIDTH), D1    ; X COORDINATE
00001C3E  6F00 0016               1583              BLE     .X2
00001C42  B27C 0125               1584              CMP.W   #(BUTTONX1+BUTTONWIDTH), D1   
00001C46  6C00 000E               1585              BGE     .X2
00001C4A                          1586              ; RETRY
00001C4A  33FC 0000 00002B0E      1587              MOVE.W  #STAMM, (STANEXT)
00001C52  6000 0018               1588              BRA     .END
00001C56                          1589  
00001C56  B27C 015A               1590  .X2         CMP.W   #(BUTTONX2-BUTTONWIDTH), D1    ; X COORDINATE
00001C5A  6F00 0010               1591              BLE     .END
00001C5E  B27C 01FA               1592              CMP.W   #(BUTTONX2+BUTTONWIDTH), D1   
00001C62  6C00 0008               1593              BGE     .END
00001C66                          1594              ; EXIT
00001C66                          1595  
00001C66  4EB9 00001E4E           1596              JSR     LOOSE
00001C6C                          1597  .END        
00001C6C  4CDF 000F               1598              MOVEM.L (A7)+, D0-D3
00001C70  4E75                    1599              RTS
00001C72                          1600  
00001C72                          1601  ;------------------------------------------------------------------------------
00001C72                          1602  STADMP
00001C72                          1603  ; DES       :       DEATH MENU STATE PLOT
00001C72                          1604  ; IN        :       NONE
00001C72                          1605  ; OUT       :       NONE
00001C72                          1606  ; MOD       :       NONE
00001C72                          1607  ;------------------------------------------------------------------------------
00001C72  48E7 F840               1608          MOVEM.L D0-D4/A1, -(A7)
00001C76                          1609              ; -- BLACK SQUARE ---
00001C76                          1610m         UTILPEN #0                       
00001C76                          1611m ;   IN:  #0 AS THE COLOR, FORMATED AS #00BBGGRR
00001C76                          1612m ;   OUT: NONE
00001C76                          1613m ;   MOD: D0, D1    
00001C76                          1614m ;   DES: MACRO TO SET PEN COLOR
00001C76                          1615m 
00001C76  103C 0050               1616m         MOVE.B  #80, D0 
00001C7A  7200                    1617m         MOVE.L  #0, D1
00001C7C  4E4F                    1618m         TRAP    #15
00001C7E                          1619m         ENDM
00001C7E                          1620m         UTILFILL #0
00001C7E                          1621m ;   IN:  #0 AS THE COLOR, FORMATED AS #00BBGGRR
00001C7E                          1622m ;   OUT: NONE
00001C7E                          1623m ;   MOD: D0, D1
00001C7E                          1624m ;   DES: MACRO TO SET FILL COLOR
00001C7E                          1625m 
00001C7E  103C 0051               1626m         MOVE.B  #81, D0
00001C82  7200                    1627m         MOVE.L  #0, D1
00001C84  4E4F                    1628m         TRAP    #15
00001C86                          1629m         ENDM
00001C86                          1630  
00001C86  323C 0000               1631          MOVE.W  #0, D1               ; D1 = X CENTER
00001C8A  343C 0000               1632          MOVE.W  #0, D2               ; D1 = Y CENTER
00001C8E  363C 0280               1633          MOVE.W  #SCRWIDTH, D3
00001C92  383C 01E0               1634          MOVE.W  #SCRHEIGH, D4
00001C96                          1635  
00001C96  303C 0057               1636          MOVE.W  #87, D0
00001C9A  4E4F                    1637          TRAP    #15
00001C9C                          1638  
00001C9C                          1639          ; --- TEXT ---
00001C9C                          1640m         UTILFILL #0
00001C9C                          1641m ;   IN:  #0 AS THE COLOR, FORMATED AS #00BBGGRR
00001C9C                          1642m ;   OUT: NONE
00001C9C                          1643m ;   MOD: D0, D1
00001C9C                          1644m ;   DES: MACRO TO SET FILL COLOR
00001C9C                          1645m 
00001C9C  103C 0051               1646m         MOVE.B  #81, D0
00001CA0  7200                    1647m         MOVE.L  #0, D1
00001CA2  4E4F                    1648m         TRAP    #15
00001CA4                          1649m         ENDM
00001CA4  323C 1705               1650          MOVE.W  #((80-34)/2)<<8|5, D1
00001CA8  103C 000B               1651          MOVE.B  #11, D0
00001CAC  4E4F                    1652          TRAP    #15
00001CAE  43F8 11EF               1653          LEA     DEATHSTRING, A1
00001CB2  303C 000D               1654          MOVE.W  #13, D0
00001CB6  4E4F                    1655          TRAP    #15
00001CB8                          1656  
00001CB8                          1657         
00001CB8  33FC 0001 00002B14      1658          MOVE.W  #1, (DEATHTEXT2)    
00001CC0  4281                    1659          CLR.L   D1
00001CC2  323C 0B07               1660          MOVE.W  #((80-58)/2)<<8|7, D1
00001CC6  103C 000B               1661          MOVE.B  #11, D0
00001CCA  4E4F                    1662          TRAP    #15
00001CCC  43F8 1212               1663          LEA     SUSSERTOD, A1
00001CD0  303C 000D               1664          MOVE.W  #13, D0
00001CD4  4E4F                    1665          TRAP    #15
00001CD6                          1666  
00001CD6                          1667          ; BUTTONS
00001CD6  0839 0004 00001E55      1668          BTST.B  #4, (SCRCYCCT)  ; TIMER 
00001CDE  6700 0092               1669          BEQ     .END
00001CE2                          1670          ; RETRY
00001CE2                          1671m         UTILFILL #$00000000
00001CE2                          1672m ;   IN:  #$00000000 AS THE COLOR, FORMATED AS #00BBGGRR
00001CE2                          1673m ;   OUT: NONE
00001CE2                          1674m ;   MOD: D0, D1
00001CE2                          1675m ;   DES: MACRO TO SET FILL COLOR
00001CE2                          1676m 
00001CE2  103C 0051               1677m         MOVE.B  #81, D0
00001CE6  7200                    1678m         MOVE.L  #$00000000, D1
00001CE8  4E4F                    1679m         TRAP    #15
00001CEA                          1680m         ENDM
00001CEA                          1681m         UTILPEN #$00FFFFFF
00001CEA                          1682m ;   IN:  #$00FFFFFF AS THE COLOR, FORMATED AS #00BBGGRR
00001CEA                          1683m ;   OUT: NONE
00001CEA                          1684m ;   MOD: D0, D1    
00001CEA                          1685m ;   DES: MACRO TO SET PEN COLOR
00001CEA                          1686m 
00001CEA  103C 0050               1687m         MOVE.B  #80, D0 
00001CEE  223C 00FFFFFF           1688m         MOVE.L  #$00FFFFFF, D1
00001CF4  4E4F                    1689m         TRAP    #15
00001CF6                          1690m         ENDM
00001CF6  323C 00D5               1691          MOVE.W  #BUTTONX1, D1
00001CFA  343C 0190               1692          MOVE.W  #BUTTONY, D2
00001CFE  3601                    1693          MOVE.W  D1, D3
00001D00  3802                    1694          MOVE.W  D2, D4 
00001D02  0441 0028               1695          SUB.W   #BUTTONWIDTH/2, D1              ; SET TOP LEFT CORNER
00001D06  0442 0016               1696          SUB.W   #BUTTONHEIGH/2, D2              ; SET TOP LEFT CORNER 
00001D0A  0643 0028               1697          ADD.W   #BUTTONWIDTH/2, D3              ; SET LOW RIGHT CORNER
00001D0E  0644 0016               1698          ADD.W   #BUTTONHEIGH/2, D4              ; SET LOW RIGHT CORNER
00001D12                          1699  
00001D12  303C 0057               1700          MOVE.W  #87, D0
00001D16  4E4F                    1701          TRAP    #15                             ; DRAW RECTANGLE
00001D18                          1702  
00001D18  43F8 12B6               1703          LEA     RETRYSTR, A1
00001D1C  323C 00C2               1704          MOVE.W  #BUTTONX1-19, D1
00001D20  343C 0189               1705          MOVE.W  #BUTTONY-7, D2
00001D24                          1706  
00001D24  303C 005F               1707          MOVE.W  #95, D0
00001D28  4E4F                    1708          TRAP    #15
00001D2A                          1709          
00001D2A                          1710          ; END
00001D2A                          1711m         UTILFILL #$00000000
00001D2A                          1712m ;   IN:  #$00000000 AS THE COLOR, FORMATED AS #00BBGGRR
00001D2A                          1713m ;   OUT: NONE
00001D2A                          1714m ;   MOD: D0, D1
00001D2A                          1715m ;   DES: MACRO TO SET FILL COLOR
00001D2A                          1716m 
00001D2A  103C 0051               1717m         MOVE.B  #81, D0
00001D2E  7200                    1718m         MOVE.L  #$00000000, D1
00001D30  4E4F                    1719m         TRAP    #15
00001D32                          1720m         ENDM
00001D32                          1721m         UTILPEN #$00FFFFFF
00001D32                          1722m ;   IN:  #$00FFFFFF AS THE COLOR, FORMATED AS #00BBGGRR
00001D32                          1723m ;   OUT: NONE
00001D32                          1724m ;   MOD: D0, D1    
00001D32                          1725m ;   DES: MACRO TO SET PEN COLOR
00001D32                          1726m 
00001D32  103C 0050               1727m         MOVE.B  #80, D0 
00001D36  223C 00FFFFFF           1728m         MOVE.L  #$00FFFFFF, D1
00001D3C  4E4F                    1729m         TRAP    #15
00001D3E                          1730m         ENDM
00001D3E  323C 01AA               1731          MOVE.W  #BUTTONX2, D1
00001D42  343C 0190               1732          MOVE.W  #BUTTONY, D2
00001D46  3601                    1733          MOVE.W  D1, D3
00001D48  3802                    1734          MOVE.W  D2, D4 
00001D4A  0441 0028               1735          SUB.W   #BUTTONWIDTH/2, D1              ; SET TOP LEFT CORNER
00001D4E  0442 0016               1736          SUB.W   #BUTTONHEIGH/2, D2              ; SET TOP LEFT CORNER 
00001D52  0643 0028               1737          ADD.W   #BUTTONWIDTH/2, D3              ; SET LOW RIGHT CORNER
00001D56  0644 0016               1738          ADD.W   #BUTTONHEIGH/2, D4              ; SET LOW RIGHT CORNER
00001D5A                          1739  
00001D5A  303C 0057               1740          MOVE.W  #87, D0
00001D5E  4E4F                    1741          TRAP    #15                             ; DRAW RECTANGLE
00001D60                          1742  
00001D60  43F8 12BC               1743          LEA     EXITSTR, A1
00001D64  323C 019A               1744          MOVE.W  #BUTTONX2-16, D1
00001D68  343C 0189               1745          MOVE.W  #BUTTONY-7, D2
00001D6C                          1746  
00001D6C  303C 005F               1747          MOVE.W  #95, D0
00001D70  4E4F                    1748          TRAP    #15
00001D72                          1749  .END  
00001D72  4CDF 021F               1750          MOVEM.L (A7)+,D0-D4/A1
00001D76  4E75                    1751          RTS
00001D78                          1752  
00001D78                          1753  
00001D78                          1754  -------------------- end include --------------------
00001D78                          1755              INCLUDE "SHADDER.X68"           ; TORCH SHADDER
00001D78                          1756  ;-----------------------------------------------------------
00001D78                          1757  SHADDERPLOT
00001D78                          1758  ; DES       :       PLOTS THE TORCH SHADDER ON CENTERED ON THE PLAYER
00001D78                          1759  ; IN        :       NONE
00001D78                          1760  ; OUT       :       NONE
00001D78                          1761  ; MOD       :       NONE
00001D78                          1762  ;-----------------------------------------------------------
00001D78  48E7 F800               1763              MOVEM.L D0-D4, -(A7)
00001D7C                          1764  
00001D7C                          1765m             UTILPEN #TILEDDARK
00001D7C                          1766m ;   IN:  #TILEDDARK AS THE COLOR, FORMATED AS #00BBGGRR
00001D7C                          1767m ;   OUT: NONE
00001D7C                          1768m ;   MOD: D0, D1    
00001D7C                          1769m ;   DES: MACRO TO SET PEN COLOR
00001D7C                          1770m 
00001D7C  103C 0050               1771m         MOVE.B  #80, D0 
00001D80  223C 0030252D           1772m         MOVE.L  #TILEDDARK, D1
00001D86  4E4F                    1773m         TRAP    #15
00001D88                          1774m         ENDM
00001D88                          1775m             UTILFILL #TILEDDARK
00001D88                          1776m ;   IN:  #TILEDDARK AS THE COLOR, FORMATED AS #00BBGGRR
00001D88                          1777m ;   OUT: NONE
00001D88                          1778m ;   MOD: D0, D1
00001D88                          1779m ;   DES: MACRO TO SET FILL COLOR
00001D88                          1780m 
00001D88  103C 0051               1781m         MOVE.B  #81, D0
00001D8C  223C 0030252D           1782m         MOVE.L  #TILEDDARK, D1
00001D92  4E4F                    1783m         TRAP    #15
00001D94                          1784m         ENDM
00001D94                          1785  
00001D94                          1786  
00001D94  4241                    1787              CLR     D1                          ; LEFT BORDER
00001D96  4242                    1788              CLR     D2           
00001D98  3639 00002B00           1789              MOVE.W  (PLAYERX), D3       
00001D9E  3A39 00002B18           1790              MOVE.W  (TORCHRANGE), D5
00001DA4  CAFC 0020               1791              MULU.W  #TILEDIM, D5
00001DA8  0645 0010               1792              ADD.W   #(TILEDIM/2), D5      
00001DAC  9645                    1793              SUB.W   D5, D3
00001DAE  383C 01E0               1794              MOVE.W  #SCRHEIGH, D4
00001DB2  303C 0057               1795              MOVE.W  #87, D0
00001DB6  4E4F                    1796              TRAP    #15
00001DB8                          1797  
00001DB8                          1798                                                  ; RIGHT BORDER
00001DB8                          1799                
00001DB8  3239 00002B00           1800              MOVE.W  (PLAYERX), D1   
00001DBE  3A39 00002B18           1801              MOVE.W  (TORCHRANGE), D5
00001DC4  CAFC 0020               1802              MULU.W  #TILEDIM, D5
00001DC8  0645 0010               1803              ADD.W   #(TILEDIM/2), D5 
00001DCC  D245                    1804              ADD.W   D5, D1
00001DCE  363C 0280               1805              MOVE.W  #SCRWIDTH, D3
00001DD2  303C 0057               1806              MOVE.W  #87, D0
00001DD6  4E4F                    1807              TRAP    #15
00001DD8                          1808  
00001DD8                          1809                                                 ; TOP BORDER
00001DD8                          1810                
00001DD8  4241                    1811              CLR     D1
00001DDA  4242                    1812              CLR     D2
00001DDC  363C 0280               1813              MOVE.W  #SCRWIDTH, D3
00001DE0  3839 00002B02           1814              MOVE.W  (PLAYERY), D4 
00001DE6  3A39 00002B18           1815              MOVE.W  (TORCHRANGE), D5
00001DEC  CAFC 0020               1816              MULU.W  #TILEDIM, D5
00001DF0  0645 0010               1817              ADD.W   #(TILEDIM/2), D5          
00001DF4  9845                    1818              SUB.W   D5, D4     
00001DF6                          1819             
00001DF6  363C 0280               1820              MOVE.W  #SCRWIDTH, D3
00001DFA  303C 0057               1821              MOVE.W  #87, D0
00001DFE  4E4F                    1822              TRAP    #15
00001E00                          1823  
00001E00                          1824                                                 ; BOTTOM BORDER
00001E00  3439 00002B02           1825              MOVE.W  (PLAYERY), D2
00001E06  3A39 00002B18           1826              MOVE.W  (TORCHRANGE), D5
00001E0C  CAFC 0020               1827              MULU.W  #TILEDIM, D5
00001E10  0645 0010               1828              ADD.W   #(TILEDIM/2), D5           
00001E14  D445                    1829              ADD.W   D5, D2     
00001E16  363C 0280               1830              MOVE.W  #SCRWIDTH, D3
00001E1A  383C 01E0               1831              MOVE.W  #SCRHEIGH, D4
00001E1E  303C 0057               1832              MOVE.W  #87, D0
00001E22  4E4F                    1833              TRAP    #15
00001E24                          1834  
00001E24  4CDF 001F               1835              MOVEM.L (A7)+, D0-D4
00001E28  4E75                    1836              RTS
00001E28  4E75                    1837  -------------------- end include --------------------
00001E2A                          1838              
00001E2A                          1839  
00001E2A                          1840  ; --- INITIALIZE --------------------------------------------------------------
00001E2A                          1841  
00001E2A                          1842  START                                       ; INITIALIZE SYSTEM-RELATED STUFF
00001E2A  4EB8 1000               1843              JSR     SYSINIT 
00001E2E  4EB8 197E               1844              JSR     STAINIT
00001E32                          1845              
00001E32                          1846  ; --- UPDATE ------------------------------------------------------------------
00001E32                          1847  
00001E32  4E40                    1848  .LOOP       TRAP    #KBDTRAP                ; READ KEYBOARD
00001E34  4EB8 1990               1849              JSR     STAUPD
00001E38                          1850              
00001E38                          1851  ; --- WAIT SYNCH --------------------------------------------------------------
00001E38                          1852  
00001E38  4A39 00001E54           1853  .WINT       TST.B   (SCRINTCT)              ; WAIT FOR INTERRUPT
00001E3E  67F8                    1854              BEQ     .WINT
00001E40  4239 00001E54           1855              CLR.B   (SCRINTCT)
00001E46                          1856  
00001E46                          1857  ; --- PLOT --------------------------------------------------------------------
00001E46                          1858  
00001E46  4EB8 19E6               1859              JSR     STAPLOT
00001E4A  4E41                    1860              TRAP    #SCRTRAP                ; SHOW GRAPHICS
00001E4C  60E4                    1861              BRA     .LOOP                   ; MAIN LOOP
00001E4E                          1862  
00001E4E                          1863  ; --- DEATH -------------------------------------------------------------------
00001E4E                          1864  LOOSE
00001E4E  FFFF FFFF               1865              SIMHALT
00001E52                          1866  
00001E52                          1867  ; --- VARIABLES ---------------------------------------------------------------
00001E52                          1868  
00001E52                          1869              INCLUDE "SYSVAR.X68"
00001E52                          1870  ; =============================================================================
00001E52                          1871  ; TITLE    : SYSTEM VARIABLES
00001E52                          1872  ; AUTHOR   : ANTONI BURGUERA
00001E52                          1873  ; COMMENTS : NOTE THAT ALL THESE VARS ARE USED TO SHARE DATA FROM SYSTEM TO
00001E52                          1874  ;            USER. THUS THEY MUST NOT BE IN PROTECTED MEMORY.
00001E52                          1875  ;            NOTE THAT USING DMMDATA IN SUCH WAY IS A BAD IDEA, AS USER
00001E52                          1876  ;            APPLICATIONS CAN ALSO FREE OR CHANGE OWNERSHIP. NONETHELESS, FOR
00001E52                          1877  ;            THE SAKE OF THIS EXAMPLE THIS IS GOOD ENOUGH.
00001E52                          1878  ; HISTORY  : XX-XXX-201X - CREATION
00001E52                          1879  ;            11-OCT-2020 - MINOR CHANGES
00001E52                          1880  ; =============================================================================
00001E52                          1881  
00001E52                          1882  ; --- KEYBOARD RELATED VARIABLES ----------------------------------------------
00001E52                          1883  
00001E52                          1884  KBDVAL      DS.B    1                       ; KEY PRESSED=1
00001E53                          1885  KBDEDGE     DS.B    1                       ; KEY CHANGED=1
00001E54                          1886  
00001E54                          1887              DS.W    0
00001E54                          1888  
00001E54                          1889  ; --- SCREEN RELATED VARIABLES ------------------------------------------------
00001E54                          1890  
00001E54                          1891  SCRINTCT    DS.B    1                       ; INTERRUPT COUNTER/FLAG
00001E55                          1892  SCRCYCCT    DS.B    1                       ; CYCLE COUNTER
00001E56                          1893              DS.W    0
00001E56                          1894  
00001E56                          1895  ; --- DYNAMIC MEMORY VARIABLES ------------------------------------------------
00001E56                          1896  
00001E80                          1897              ORG     (*+DMMBSIZE-1)&-DMMBSIZE ; ALIGN TO DMMBSIZE
00001E80                          1898  DMMDATA     DS.B    DMMBSIZE*DMMBNUM        ; DYNAMIC MEMORY ALLOCATION SPACE
00002B00                          1899              DS.W    0                       ; JUST IN CASE (SIZE IS POW OF TWO)
00002B00                          1900  -------------------- end include --------------------
00002B00                          1901              INCLUDE "VAR.X68"
00002B00                          1902  ; =============================================================================
00002B00                          1903  ; TITLE    : GAME VARIABLES
00002B00                          1904  ; AUTHOR   :
00002B00                          1905  ; HISTORY  :
00002B00                          1906  ; =============================================================================
00002B00                          1907  
00002B00                          1908  ; POSITION
00002B00                          1909  PLAYERX     DS.W    1   ; PLAYER X COORDINATE
00002B02                          1910  PLAYERY     DS.W    1   ; PLAYER Y COORDINATE
00002B04                          1911  
00002B04                          1912  KEYX        DS.W    1   ; KEY X COORDINATE
00002B06                          1913  KEYY        DS.W    1   ; KEY Y COORDINATE
00002B08                          1914  
00002B08                          1915  STAIRSX     DS.W    1   ; STAIRS X COORDINATE
00002B0A                          1916  STAIRSY     DS.W    1   ; STAIRS Y COORDINATE
00002B0C                          1917  
00002B0C                          1918  STACUR      DS.W    1   ; CURRENT STATE
00002B0E                          1919  STANEXT     DS.W    1   ; NEXT STATE 
00002B10                          1920  
00002B10                          1921  ; BOOLEAN
00002B10= 0000                    1922  KEYOBTEINED DC.W    0   ; "BOOLEAN" VALUE, SELF EXPLANATORY 
00002B12= 0000                    1923  TORCHSHADDER DC.W   0   ; "BOOLEAN" VALUE TO SEEE IF SHADDER IS APPLIED OR NOT
00002B14= 0000                    1924  DEATHTEXT2  DC.W    0   ; "BOOLEAN" DEATH STRING SHOW 
00002B16= 0000                    1925  ONSTAIRS    DC.W    0   ; "BOOLEAN" VALUE TO TRACK IF PLAYER IS ON STAIRS
00002B18                          1926  
00002B18= 0005                    1927  TORCHRANGE  DC.W    5   ; TORCH RANGE FOR THE SHADDER 
00002B1A                          1928  ; ARRAY 
00002B1A                          1929  RNGXINDEX   DS.W    1   ; INDEX FOR THE X COORDINATE ON THE PSEUDO RANDOM GENERATOR
00002B1C                          1930  RNGYINDEX   DS.W    1   ; INDEX FOR THE Y COORDINATE ON THE PSEUDO RANDOM GENERATOR
00002B1E                          1931  
00002B1E= 0000                    1932  LEVEL       DC.W    0   ; LEVEL COUNTER
00002B20= 0002                    1933  SHADDERRANGE DC.W   2   ; SHADDER RANGE
00002B20= 0002                    1934  -------------------- end include --------------------
00002B22                          1935              END    START

No errors detected
No warnings generated


SYMBOL TABLE INFORMATION
Symbol-name         Value
-------------------------
AGLADD              1538
AGLADD:END          154E
AGLFKIL             159C
AGLFKIL:END         15B8
AGLFKIL:LOOP        15A4
AGLKILL             11C0
AGLPLOT             1576
AGLPLOT:END         1596
AGLPLOT:LOOP        157E
AGLUPDT             1552
AGLUPDT:END         1570
AGLUPDT:LOOP        155A
BECARESTR           129F
BUTTONHEIGH         2D
BUTTONWIDTH         50
BUTTONX1            D5
BUTTONX2            1AA
BUTTONY             190
DEATHSTRING         11EF
DEATHTEXT2          2B14
DMMALLOC            11A6
DMMALLOC:END        11BE
DMMBNUM             32
DMMBSIZE            40
DMMDATA             1E80
DMMFCOM             1180
DMMFFND             118E
DMMFIRST            1136
DMMFLOOP            1174
DMMFRCOM            1148
DMMFREE             11C0
DMMFRFND            1156
DMMFRLOP            113C
DMMFRSTO            116E
DMMINIT             1114
DMMINIT:LOOP        1122
DMMNEXT             1158
DMMNEXTO            1190
DMMSYSID            0
EASYSTR             12C1
EMPTYID             1
ENEMYID             7
ENEMYINIT           18A6
ENEMYMAXCNT         C
ENEMYPLOT           18E2
ENEMYUPDT           18BE
ENEMYUPDT:END       18DC
EXITSTR             12BC
FLOORID             3
KBDBITDN            3
KBDBITF1            4
KBDBITF2            5
KBDBITF3            6
KBDBITLF            0
KBDBITPS            7
KBDBITRT            2
KBDBITUP            1
KBDCHRDN            28
KBDCHRLF            25
KBDCHRMK            4D
KBDCHRPK            50
KBDCHRRT            27
KBDCHRSH            10
KBDCHRSP            20
KBDCHRUP            26
KBDDOWN             28
KBDEDGE             1E53
KBDFIRE1            20
KBDFIRE2            4D
KBDFIRE3            10
KBDINIT             10B4
KBDLEFT             25
KBDMSKDN            8
KBDMSKF1            10
KBDMSKF2            20
KBDMSKF3            40
KBDMSKLF            1
KBDMSKPS            80
KBDMSKRT            4
KBDMSKUP            2
KBDPAUSE            50
KBDREAD             10CA
KBDREAD:LOOP        110A
KBDREAD:STORE       1106
KBDRIGHT            27
KBDTRAP             0
KBDUP               26
KBDVAL              1E52
KEYID               5
KEYINIT             16F4
KEYOBTEINED         2B10
KEYPLOT             1738
KEYPLOT:NOKEY       177E
KEYUPDT             170E
KEYUPDT:END         1732
KEYX                2B04
KEYY                2B06
LEVEL               2B1E
LEVELSTRING         124D
LOOSE               1E4E
MAPPLOT             16B6
MISCPLOT            1924
MISCPLOT:END        197C
MISCPLOT:LVLPLOT    1932
MISCPLOT:NOOKEYPLOT  1956
NEXTSTR             1286
NOKEYSTRING         11D6
NORMALSTR           12C6
ONSTAIRS            2B16
PLAYERINIT          15BE
PLAYERPLOT          166E
PLAYERUPDT          15D0
PLAYERUPDT:END      166C
PLAYERUPDT:MOVED    1656
PLAYERUPDT:MOVEL    160E
PLAYERUPDT:MOVER    1626
PLAYERUPDT:MOVEU    163E
PLAYERUPDT:RMVED    1664
PLAYERUPDT:RMVEL    161C
PLAYERUPDT:RMVER    1634
PLAYERUPDT:RMVEU    164C
PLAYERX             2B00
PLAYERY             2B02
PLYRID              6
RETRYSTR            12B6
RNDINIT             14CA
RNGX                14D8
RNGX:NOVERFLOW      1504
RNGXINDEX           2B1A
RNGY                1508
RNGY:NOVERFLOW      1534
RNGYINDEX           2B1C
SCRCYCCT            1E55
SCRHEIGH            1E0
SCRINIT             101C
SCRINTCT            1E54
SCRIRQ              1
SCRISR              108C
SCRTIM              14
SCRTRAP             1
SCRUPD              109A
SCRWIDTH            280
SHADDERPLOT         1D78
SHADDERRANGE        2B20
STACUR              2B0C
STADM               2
STADMP              1C72
STADMP:END          1D72
STADMU              1C06
STADMU:END          1C6C
STADMU:X2           1C56
STAEMPTY            1A0E
STAGP               1
STAGPI              1B8E
STAGPP              1BDA
STAGPP:END          1C00
STAGPU              1B9E
STAGPU:CLASS        1BB6
STAGPU:CP1          1BC6
STAGPU:CP2          1BD0
STAINIT             197E
STAIRID             4
STAIRSINIT          1780
STAIRSPLOT          1828
STAIRSPLOT:END      18A0
STAIRSPLOT:KEYOBTEINED  187A
STAIRSUPDT          17A0
STAIRSUPDT:END      1822
STAIRSUPDT:ENDD     181C
STAIRSUPDT:ENEMYADD  17E0
STAIRSUPDT:NOKEY    1810
STAIRSX             2B08
STAIRSY             2B0A
STAMM               0
STAMMI              1A10
STAMMP              1AA8
STAMMP:END          1B88
STAMMU              1A32
STAMMU:END          1AA2
STAMMU:X2           1A82
STANEXT             2B0E
STAPLOT             19E6
STAPLOT:PLTTBL      1A02
START               1E2A
START:LOOP          1E32
START:WINT          1E38
STAUPD              1990
STAUPD:DOUPD        19B6
STAUPD:INITBL       19CE
STAUPD:UPDTBL       19DA
SUBTITLESTR         126F
SUSSERTOD           1212
SYSINIT             1000
TILEDARK            745B6D
TILEDDARK           30252D
TILEDETA            957EA0
TILEDIM             20
TILELIGH            CCE0EA
TITLESTRING         1256
TORCHRANGE          2B18
TORCHSHADDER        2B12
UTILCOLL            14AE
UTILCOLL:NOCOL      14C8
UTILFILL            CD
UTILPEN             0
UTILTEXT            196
UTILTILE            2C0
WALLID              2
XVALUES             12CE
YVALUES             12EC
