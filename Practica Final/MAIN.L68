00001E04 Starting Address
Assembler used: EASy68K Editor/Assembler v5.16.01
Created On: 1/9/2021 10:27:06 PM

00000000                             1  ; =============================================================================
00000000                             2  ; TITLE    : EXAMPLE GAME (MAIN PROGRAM)
00000000                             3  ; AUTHOR   : ANTONI BURGUERA
00000000                             4  ; HISTORY  : 10-OCT-2020 - CREATION
00000000                             5  ;            11-OCT-2020 - MINOR CHANGES
00000000                             6  ; =============================================================================
00000000                             7              OPT     MEX
00001000                             8              ORG     $1000
00001000                             9  
00001000                            10  ; --- CODE INCLUDES -----------------------------------------------------------
00001000                            11  
00001000                            12              INCLUDE "SYSCONST.X68"          ; SYSTEM CONSTANTS
00001000                            13  ; =============================================================================
00001000                            14  ; TITLE    : SYSTEM CONSTANTS
00001000                            15  ; AUTHOR   : ANTONI BURGUERA
00001000                            16  ; HISTORY  : XX-XXX-201X - CREATION
00001000                            17  ;            11-OCT-2020 - MINOR CHANGES
00001000                            18  ; =============================================================================
00001000                            19  
00001000                            20  ; --- TRAP RELATED CONSTANTS --------------------------------------------------
00001000                            21  
00001000  =00000000                 22  KBDTRAP     EQU     0                       ; KEYBOARD UPDATE TRAP
00001000  =00000001                 23  SCRTRAP     EQU     1                       ; SCREEN REFRESH TRAP
00001000                            24  
00001000                            25  ; --- KEY CODES (EASy68K)
00001000                            26  
00001000  =00000020                 27  KBDCHRSP    EQU     $20                     ; SPACE KEY
00001000  =0000004D                 28  KBDCHRMK    EQU     'M'                     ; M KEY
00001000  =00000010                 29  KBDCHRSH    EQU     $10                     ; SHIFT KEY
00001000  =00000050                 30  KBDCHRPK    EQU     'P'                     ; P KEY
00001000  =00000025                 31  KBDCHRLF    EQU     $25                     ; LEFT KEY
00001000  =00000026                 32  KBDCHRUP    EQU     $26                     ; UP KEY
00001000  =00000027                 33  KBDCHRRT    EQU     $27                     ; RIGHT KEY
00001000  =00000028                 34  KBDCHRDN    EQU     $28                     ; DOWN KEY
00001000                            35  
00001000                            36  ; --- KEYBOARD MAPPING --------------------------------------------------------
00001000                            37  
00001000  =00000025                 38  KBDLEFT     EQU     KBDCHRLF                ; LEFT BUTTON
00001000  =00000026                 39  KBDUP       EQU     KBDCHRUP                ; UP BUTTON
00001000  =00000027                 40  KBDRIGHT    EQU     KBDCHRRT                ; RIGHT BUTTON
00001000  =00000028                 41  KBDDOWN     EQU     KBDCHRDN                ; DOWN BUTTON
00001000  =00000020                 42  KBDFIRE1    EQU     KBDCHRSP                ; FIRE 1 BUTTON
00001000  =0000004D                 43  KBDFIRE2    EQU     KBDCHRMK                ; FIRE 2 BUTTON
00001000  =00000010                 44  KBDFIRE3    EQU     KBDCHRSH                ; FIRE 3 BUTTON
00001000  =00000050                 45  KBDPAUSE    EQU     KBDCHRPK                ; PAUSE BUTTON
00001000                            46  
00001000                            47  ; --- KEYBOARD BITFIELD MASKS -------------------------------------------------
00001000                            48  ; CONVENIENCE CONSTANTS TO ACCESS THE FOLLOWING BIT-FIELD.
00001000                            49  ; THIS BIT-FIELD IS USED BY SYSTEM VARS (KBDVAL) AND (KBDEDGE).
00001000                            50  ; +---+---+---+---+---+---+---+---+
00001000                            51  ; | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |
00001000                            52  ; +---+---+---+---+---+---+---+---+
00001000                            53  ;   |   |   |   |   |   |   |   |
00001000                            54  ;   |   |   |   |   |   |   |   +---------- LEFT BUTTON
00001000                            55  ;   |   |   |   |   |   |   +-------------- UP BUTTON
00001000                            56  ;   |   |   |   |   |   +------------------ RIGHT BUTTON
00001000                            57  ;   |   |   |   |   +---------------------- DOWN BUTTON
00001000                            58  ;   |   |   |   +-------------------------- FIRE 1 BUTTON
00001000                            59  ;   |   |   +------------------------------ FIRE 2 BUTTON
00001000                            60  ;   |   +---------------------------------- FIRE 3 BUTTON
00001000                            61  ;   +-------------------------------------- PAUSE BUTTON
00001000                            62  
00001000  =00000001                 63  KBDMSKLF    EQU     %00000001
00001000  =00000002                 64  KBDMSKUP    EQU     %00000010
00001000  =00000004                 65  KBDMSKRT    EQU     %00000100
00001000  =00000008                 66  KBDMSKDN    EQU     %00001000
00001000  =00000010                 67  KBDMSKF1    EQU     %00010000
00001000  =00000020                 68  KBDMSKF2    EQU     %00100000
00001000  =00000040                 69  KBDMSKF3    EQU     %01000000
00001000  =00000080                 70  KBDMSKPS    EQU     %10000000
00001000                            71  
00001000                            72  ; --- KEYBOARD BITFIELD POSITIONS ---------------------------------------------
00001000                            73  
00001000  =00000000                 74  KBDBITLF    EQU     0
00001000  =00000001                 75  KBDBITUP    EQU     1
00001000  =00000002                 76  KBDBITRT    EQU     2
00001000  =00000003                 77  KBDBITDN    EQU     3
00001000  =00000004                 78  KBDBITF1    EQU     4
00001000  =00000005                 79  KBDBITF2    EQU     5
00001000  =00000006                 80  KBDBITF3    EQU     6
00001000  =00000007                 81  KBDBITPS    EQU     7
00001000                            82  
00001000                            83  ; --- SCREEN RELATED CONSTANTS ------------------------------------------------
00001000                            84  
00001000  =00000280                 85  SCRWIDTH    EQU     640                     ; SCREEN WIDTH (PIXELS)
00001000  =000001E0                 86  SCRHEIGH    EQU     480                     ; SCREEN HEIGHT (PIXELS)
00001000  =00000001                 87  SCRIRQ      EQU     1                       ; SCREEN INTERRUPT NUMBER
00001000  =00000014                 88  SCRTIM      EQU     20                       ; SCREEN TIMER (MS)
00001000                            89  
00001000                            90  ; --- DYNAMIC MEMORY CONSTANTS ------------------------------------------------
00001000                            91  
00001000  =00000040                 92  DMMBSIZE    EQU     64                      ; BLOCK SIZE (BYTES). POWER OF TWO
00001000  =00000032                 93  DMMBNUM     EQU     50                      ; NUMBER OF BLOCKS
00001000  =00000000                 94  DMMSYSID    EQU     0                       ; SYSTEM OWNER ID (MUST BE 0)
00001000  =00000000                 95  -------------------- end include --------------------
00001000                            96              INCLUDE "SYSTEM.X68"            ; SYSTEM CODE
00001000                            97  ; =============================================================================
00001000                            98  ; TITLE    : SYSTEM MANAGEMENT (SYSTEM CODE)
00001000                            99  ; AUTHOR   : ANTONI BURGUERA
00001000                           100  ; COMMENTS : IT IS DIVIDED IN THREE BLOCKS:
00001000                           101  ;            - SYS : GENERIC.
00001000                           102  ;            - SCR : SCREEN MANAGEMENT.
00001000                           103  ;            - KBD : KEYBOARD MANAGEMENT.
00001000                           104  ; HISTORY  : XX-XXX-201X - CREATION
00001000                           105  ;            11-OCT-2020 - MINOR CHANGES
00001000                           106  ; =============================================================================
00001000                           107  
00001000                           108  ; -----------------------------------------------------------------------------
00001000                           109  SYSINIT
00001000                           110  ; INITIALIZES THE SYSTEM
00001000                           111  ; INPUT    - NONE
00001000                           112  ; OUTPUT   - NONE
00001000                           113  ; MODIFIES - NONE
00001000                           114  ; -----------------------------------------------------------------------------
00001000  205F                     115              MOVE.L  (A7)+,A0                ; GET RETURN ADDRESS
00001002  4EB9 000010B4            116              JSR     KBDINIT                 ; INIT KEYBOARD
00001008  4EB9 0000101C            117              JSR     SCRINIT                 ; INIT SCREEN
0000100E  4EB9 00001114            118              JSR     DMMINIT                 ; INIT DYNAMIC MEMORY
00001014  027C DFFF                119              ANDI.W  #$DFFF,SR               ; SWITCH TO USER
00001018  2F08                     120              MOVE.L  A0,-(A7)                ; PUT RETURN ADDRESS
0000101A  4E75                     121              RTS
0000101C                           122  
0000101C                           123  ; =============================================================================
0000101C                           124  ; SCREEN MANAGEMENT (SYSTEM CODE)
0000101C                           125  ; =============================================================================
0000101C                           126  
0000101C                           127  ; -----------------------------------------------------------------------------
0000101C                           128  SCRINIT
0000101C                           129  ; INITIALIZES THE SCREEN, SCREEN-RELATED INTERRUPT AND VARS.
0000101C                           130  ; INPUT    - NONE
0000101C                           131  ; OUTPUT   - NONE
0000101C                           132  ; MODIFIES - D0,D1,D2,D3
0000101C                           133  ; -----------------------------------------------------------------------------
0000101C  007C 0700                134              ORI.W   #$0700,SR               ; DISABLE ALL INT
00001020  21FC 0000109A 0084       135              MOVE.L  #SCRUPD,($80+SCRTRAP*4) ; INSTALL TRAP
00001028  223C 028001E0            136              MOVE.L  #SCRWIDTH<<16|SCRHEIGH,D1 ; SET RESOLUTION
0000102E  103C 0021                137              MOVE.B  #33,D0
00001032  4E4F                     138              TRAP    #15
00001034  7201                     139              MOVE.L  #1,D1                   ; SET WINDOWED MODE
00001036  4E4F                     140              TRAP    #15
00001038  323C FF00                141              MOVE.W  #$FF00,D1               ; CLEAR VISIBLE BUFFER
0000103C  103C 000B                142              MOVE.B  #11,D0
00001040  4E4F                     143              TRAP    #15
00001042  123C 0011                144              MOVE.B  #17,D1                  ; ENABLE DOUBLE BUFFER
00001046  103C 005C                145              MOVE.B  #92,D0
0000104A  4E4F                     146              TRAP    #15
0000104C  323C FF00                147              MOVE.W  #$FF00,D1               ; CLEAR HIDDEN BUFFER
00001050  103C 000B                148              MOVE.B  #11,D0
00001054  4E4F                     149              TRAP    #15
00001056  21FC 0000108C 0064       150              MOVE.L  #SCRISR,($60+SCRIRQ*4)  ; SET EXCEPTION VECTOR
0000105E  123C 0005                151              MOVE.B  #5,D1                   ; ENABLE EXCEPTION PROCESSING
00001062  103C 0020                152              MOVE.B  #32,D0
00001066  4E4F                     153              TRAP    #15
00001068  143C 0081                154              MOVE.B  #%10000000|SCRIRQ,D2    ; ENABLE AUTO-IRQ
0000106C  163C 0014                155              MOVE.B  #SCRTIM,D3
00001070  123C 0006                156              MOVE.B  #6,D1
00001074  103C 0020                157              MOVE.B  #32,D0
00001078  4E4F                     158              TRAP    #15
0000107A  4239 00001E2E            159              CLR.B   (SCRINTCT)              ; PREPARE INTERRUPT FLAG
00001080  4239 00001E2F            160              CLR.B   (SCRCYCCT)              ; PREPARE CYCLE COUNTER
00001086  027C F8FF                161              ANDI.W  #$F8FF,SR               ; ENABLE INTS
0000108A  4E75                     162              RTS
0000108C                           163  
0000108C                           164  ; -----------------------------------------------------------------------------
0000108C                           165  SCRISR
0000108C                           166  ; SCREEN TIMER ISR. INCREASES THE INTERRUPT COUNTER AND UPDATES DOUBLE BUFFER.
0000108C                           167  ; INPUT    - NONE
0000108C                           168  ; OUTPUT   - NONE
0000108C                           169  ; MODIFIES - NONE
0000108C                           170  ; -----------------------------------------------------------------------------
0000108C  5239 00001E2E            171              ADDQ.B  #1,(SCRINTCT)           ; UPDATE INT FLAG/COUNTER
00001092  5239 00001E2F            172              ADDQ.B  #1,(SCRCYCCT)           ; UPDATE CYCLE COUNTER
00001098  4E73                     173              RTE
0000109A                           174  
0000109A                           175  ; -----------------------------------------------------------------------------
0000109A                           176  SCRUPD
0000109A                           177  ; TRAP SERVICE ROUTINE IN CHARGE OF VISUALIZING CURRENT FRAME AND CLEARING
0000109A                           178  ; BUFFER FOR THE NEXT ONE.
0000109A                           179  ; INPUT    - NONE
0000109A                           180  ; OUTPUT   - NONE
0000109A                           181  ; MODIFIES - NONE
0000109A                           182  ; -----------------------------------------------------------------------------
0000109A  48A7 C000                183              MOVEM.W D0-D1,-(A7)
0000109E  103C 005E                184              MOVE.B  #94,D0                  ; UPDATE DOUBLE BUFFER
000010A2  4E4F                     185              TRAP    #15
000010A4  323C FF00                186              MOVE.W  #$FF00,D1               ; CLEAR HIDDEN BUFFER
000010A8  103C 000B                187              MOVE.B  #11,D0
000010AC  4E4F                     188              TRAP    #15
000010AE  4C9F 0003                189              MOVEM.W (A7)+,D0-D1
000010B2  4E73                     190              RTE
000010B4                           191  
000010B4                           192  ; =============================================================================
000010B4                           193  ; KEYBOARD MANAGEMENT (SYSTEM CODE)
000010B4                           194  ; =============================================================================
000010B4                           195  
000010B4                           196  ; -----------------------------------------------------------------------------
000010B4                           197  KBDINIT
000010B4                           198  ; INITIALIZES THE SYSTEM VARIABLES KBDSYS AND KBDVAL
000010B4                           199  ; INPUT    - NONE
000010B4                           200  ; OUTPUT   - NONE
000010B4                           201  ; MODIFIES - NONE
000010B4                           202  ; -----------------------------------------------------------------------------
000010B4  4239 00001E2C            203              CLR.B   (KBDVAL)                ; INIT VARS
000010BA  4239 00001E2D            204              CLR.B   (KBDEDGE)
000010C0  21FC 000010CA 0080       205              MOVE.L  #KBDREAD,($80+KBDTRAP*4) ; INSTALL
000010C8  4E75                     206              RTS
000010CA                           207  
000010CA                           208  ; -----------------------------------------------------------------------------
000010CA                           209  KBDREAD
000010CA                           210  ; TRAP SERVICE ROUTINE.
000010CA                           211  ; UPDATES THE SYSTEM VARIABLES KBDEDGE AND KBDVAL ACCORDING TO THE BITFIELD
000010CA                           212  ; DESCRIBED IN SYSCONST. KBDVAL HOLDS THE CURRENT VALUES AND KBDEFGE HOLDS
000010CA                           213  ; RISING EDGES FROM PREVIOUS CALL TO THE CURRENT ONE.
000010CA                           214  ; INPUT    - NONE
000010CA                           215  ; OUTPUT   - (KBDVAL) AND (KBDEDGE)
000010CA                           216  ; MODIFIES - NONE
000010CA                           217  ; -----------------------------------------------------------------------------
000010CA  48E7 F000                218              MOVEM.L D0-D3,-(A7)
000010CE  103C 0013                219              MOVE.B  #19,D0
000010D2  223C 50104D20            220              MOVE.L  #KBDPAUSE<<24+KBDFIRE3<<16+KBDFIRE2<<8+KBDFIRE1,D1
000010D8  4E4F                     221              TRAP    #15
000010DA  6100 002A                222              BSR     .STORE                  ; STORE FIRE1,FIRE2,FIRE3 AND PAUSE
000010DE  223C 28272625            223              MOVE.L  #KBDDOWN<<24+KBDRIGHT<<16+KBDUP<<8+KBDLEFT,D1
000010E4  4E4F                     224              TRAP    #15
000010E6  6100 001E                225              BSR     .STORE                  ; STORE KEY UP,DOWN,LEFT AND RIGTH.
000010EA  1039 00001E2C            226              MOVE.B  (KBDVAL),D0             ; COMPUTE EDGE.
000010F0  4600                     227              NOT.B   D0                      ; EDGE=NOT(PREVIOUS) AND CURRENT.
000010F2  C002                     228              AND.B   D2,D0
000010F4  13C2 00001E2C            229              MOVE.B  D2,(KBDVAL)             ; STORE VALUES (PRESS AND EDGE)
000010FA  13C0 00001E2D            230              MOVE.B  D0,(KBDEDGE)
00001100  4CDF 000F                231              MOVEM.L (A7)+,D0-D3
00001104  4E73                     232              RTE
00001106                           233  
00001106  363C 0003                234  .STORE      MOVE.W  #3,D3                   ; TRANSLATES THE 8-BIT ENCODING
0000110A  E189                     235  .LOOP       LSL.L   #8,D1                   ; OF TRAP #15 TASK 19 INTO A 1-BIT
0000110C  E312                     236              ROXL.B  #1,D2                   ; PER KEYPRESS ENCODING
0000110E  51CB FFFA                237              DBRA.W  D3,.LOOP
00001112  4E75                     238              RTS
00001114                           239  
00001114                           240  ; =============================================================================
00001114                           241  ; DYNAMIC MEMORY MANAGEMENT (SYSTEM CODE)
00001114                           242  ; DYNAMIC MEMORY IS A SET OF DMMBNUM SLOTS OF DMMBSIZE BYTES EACH ONE.
00001114                           243  ; DMMBSIZE MUST BE POWER OF TWO. A SLOT HAS:
00001114                           244  ; - HEADER - 1 WORD. SPECIFIES THE OWNER (0 MEANS OWNED BY SYSTEM)
00001114                           245  ; - DATA   - DMMBSIZE - 2 BYTES. MAY CONTAIN VARS AND ANY KIND OF DATA RELATED
00001114                           246  ;            THE THE OWNER. IF OWNER==0, DATA IS MEANINGLESS.
00001114                           247  ; =============================================================================
00001114                           248  
00001114                           249  ; -----------------------------------------------------------------------------
00001114                           250  DMMINIT
00001114                           251  ; INITIALIZES THE DYNAMIC MEMORY TO ALL OWNED BY SYSTEM.
00001114                           252  ; INPUT    - NONE
00001114                           253  ; OUTPUT   - NONE
00001114                           254  ; MODIFIES - NONE
00001114                           255  ; -----------------------------------------------------------------------------
00001114  48E7 8080                256              MOVEM.L D0/A0,-(A7)
00001118  41F9 00001E40            257              LEA     DMMDATA,A0
0000111E  303C 0031                258              MOVE.W  #DMMBNUM-1,D0
00001122  30BC 0000                259  .LOOP       MOVE.W  #DMMSYSID,(A0)
00001126  D1FC 00000040            260              ADD.L   #DMMBSIZE,A0
0000112C  51C8 FFF4                261              DBRA.W  D0,.LOOP
00001130  4CDF 0101                262              MOVEM.L (A7)+,D0/A0
00001134  4E75                     263              RTS
00001136                           264  
00001136                           265  ; -----------------------------------------------------------------------------
00001136                           266  DMMFIRST
00001136                           267  ; SEARCHES THE FIRST MEMORY SLOT NOT OWNED BY SYSTEM AND OUTPUTS A POINTER
00001136                           268  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00001136                           269  ; INPUT    - NONE
00001136                           270  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00001136                           271  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001136                           272  ; -----------------------------------------------------------------------------
00001136  41F9 00001E40            273              LEA     DMMDATA,A0
0000113C  4A58                     274  DMMFRLOP    TST.W   (A0)+
0000113E  6600 0016                275              BNE     DMMFRFND
00001142  D1FC 0000003E            276              ADD.L   #DMMBSIZE-2,A0
00001148  B1FC 00002ABF            277  DMMFRCOM    CMP.L   #DMMDATA+DMMBSIZE*DMMBNUM-1,A0
0000114E  6DEC                     278              BLT     DMMFRLOP
00001150  207C 00000000            279              MOVE.L  #0,A0
00001156  4E75                     280  DMMFRFND    RTS
00001158                           281  
00001158                           282  ; -----------------------------------------------------------------------------
00001158                           283  DMMNEXT
00001158                           284  ; SEARCHES THE NEXT MEMORY SLOT NOT OWNED BY SYSTEM AND OUTPUTS A POINTER
00001158                           285  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00001158                           286  ; INPUT    - A0   : POINTER WITHIN THE CURRENT SLOT
00001158                           287  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00001158                           288  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001158                           289  ; -----------------------------------------------------------------------------
00001158  2F00                     290              MOVE.L  D0,-(A7)
0000115A  2008                     291              MOVE.L  A0,D0
0000115C  C0BC FFFFFFC0            292              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
00001162  0680 00000040            293              ADD.L   #DMMBSIZE,D0
00001168  2040                     294              MOVE.L  D0,A0
0000116A  201F                     295              MOVE.L  (A7)+,D0
0000116C  60DA                     296              BRA     DMMFRCOM
0000116E                           297  
0000116E                           298  ; -----------------------------------------------------------------------------
0000116E                           299  DMMFRSTO
0000116E                           300  ; SEARCHES THE FIRST MEMORY SLOT WITH THE SPECIFIED ID AND OUTPUTS A POINTER
0000116E                           301  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
0000116E                           302  ; INPUT    - D0.W : ID TO SEARCH
0000116E                           303  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
0000116E                           304  ; MODIFIES - NONE (ASIDE OF OUTPUT)
0000116E                           305  ; -----------------------------------------------------------------------------
0000116E  41F9 00001E40            306              LEA     DMMDATA,A0
00001174  B058                     307  DMMFLOOP    CMP.W   (A0)+,D0
00001176  6700 0016                308              BEQ     DMMFFND
0000117A  D1FC 0000003E            309              ADD.L   #DMMBSIZE-2,A0
00001180  B1FC 00002ABF            310  DMMFCOM     CMP.L   #DMMDATA+DMMBSIZE*DMMBNUM-1,A0
00001186  6DEC                     311              BLT     DMMFLOOP
00001188  207C 00000000            312              MOVE.L  #0,A0
0000118E  4E75                     313  DMMFFND     RTS
00001190                           314  
00001190                           315  ; -----------------------------------------------------------------------------
00001190                           316  DMMNEXTO
00001190                           317  ; SEARCHES THE NEXT MEMORY SLOT WITH THE SPECIFIED ID AND OUTPUTS A POINTER
00001190                           318  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00001190                           319  ; INPUT    - D0.W : ID TO SEARCH
00001190                           320  ;            A0   : POINTER WITHIN THE CURRENT SLOT
00001190                           321  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00001190                           322  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001190                           323  ; -----------------------------------------------------------------------------
00001190  2F00                     324              MOVE.L  D0,-(A7)
00001192  2008                     325              MOVE.L  A0,D0
00001194  C0BC FFFFFFC0            326              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
0000119A  0680 00000040            327              ADD.L   #DMMBSIZE,D0
000011A0  2040                     328              MOVE.L  D0,A0
000011A2  201F                     329              MOVE.L  (A7)+,D0
000011A4  60DA                     330              BRA     DMMFCOM
000011A6                           331  
000011A6                           332  ; -----------------------------------------------------------------------------
000011A6                           333  DMMALLOC
000011A6                           334  ; SEARCHES THE FIRST FREE (SYS OWNED) SLOT, ASSIGNS TO THE SPECIFIED OWNER
000011A6                           335  ; AND RETURNS A POINTER TO THE CORRESPONDING DATA (SLOT ADDRESS + 2)
000011A6                           336  ; INPUT    - D0.W : ID TO ASSIGN
000011A6                           337  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FREE SPACE
000011A6                           338  ; MODIFIES - NONE (ASIDE OF OUTPUT)
000011A6                           339  ; -----------------------------------------------------------------------------
000011A6  3F00                     340              MOVE.W  D0,-(A7)
000011A8  4240                     341              CLR.W   D0
000011AA  4EB8 116E                342              JSR     DMMFRSTO
000011AE  301F                     343              MOVE.W  (A7)+,D0
000011B0  B1FC 00000000            344              CMP.L   #0,A0
000011B6  6700 0006                345              BEQ     .END
000011BA  3140 FFFE                346              MOVE.W  D0,-2(A0)
000011BE  4E75                     347  .END        RTS
000011C0                           348  
000011C0                           349  ; -----------------------------------------------------------------------------
000011C0                           350  DMMFREE
000011C0                           351  ; FREES THE SLOT TO WHICH THE PROVIDED POINTER BELONGS BY SETTING ITS OWNED TO
000011C0                           352  ; SYSTEM (0)
000011C0                           353  ; INPUT    - A0   : POINTER BELONGING TO THE SLOT TO FREE
000011C0                           354  ; OUTPUT   - NONE
000011C0                           355  ; MODIFIES - NONE
000011C0                           356  ; -----------------------------------------------------------------------------
000011C0  48E7 8080                357              MOVEM.L D0/A0,-(A7)
000011C4  2008                     358              MOVE.L  A0,D0
000011C6  C0BC FFFFFFC0            359              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
000011CC  2040                     360              MOVE.L  D0,A0
000011CE  4250                     361              CLR.W   (A0)
000011D0  4CDF 0101                362              MOVEM.L (A7)+,D0/A0
000011D4  4E75                     363              RTS
000011D4  4E75                     364  -------------------- end include --------------------
000011D6                           365              INCLUDE "CONST.X68"             ; GAME CONSTANTS
000011D6                           366  ; =============================================================================
000011D6                           367  ; TITLE    : GAME CONSTANTS
000011D6                           368  ; AUTHOR   :
000011D6                           369  ; HISTORY  :
000011D6                           370  ; =============================================================================
000011D6                           371  
000011D6                           372  ; TILE RELATED CONSTANTS 
000011D6  =00000020                373  TILEDIM     EQU     32         ; TILE SET DIMENSIONS && PLAYER SPEED
000011D6  =00745B6D                374  TILEDARK    EQU     $00745B6D  ; TILE SET DARK COLOR 
000011D6  =00CCE0EA                375  TILELIGH    EQU     $00CCE0EA  ; TILE SET LIGHT COLOR
000011D6  =00957EA0                376  TILEDETA    EQU     $00957ea0  ; TILE SET DETAIL COLOR
000011D6  =0030252D                377  TILEDDARK   EQU     $0030252d  ; TILE SET EXTRA DARK
000011D6                           378  
000011D6                           379  ; BUTTONS
000011D6  =00000050                380  BUTTONWIDTH EQU     80
000011D6  =0000002D                381  BUTTONHEIGH EQU     45
000011D6  =000000D5                382  BUTTONX1    EQU     213
000011D6  =000001AA                383  BUTTONX2    EQU     426
000011D6  =00000190                384  BUTTONY     EQU     400
000011D6                           385  
000011D6                           386  ; STRINGS 
000011D6= 59 4F 55 20 44 4F ...    387  NOKEYSTRING DC.B    'YOU DO NOT HAVE ANY KEYS', 0
000011EF= 53 4F 4D 45 20 50 ...    388  DEATHSTRING DC.B    'SOME PART OF YOUR SOUL  FADES AWAY', 0
00001212= 59 4F 55 20 48 41 ...    389  SUSSERTOD   DC.B    'YOU HAD SO MUCH TO LIVE FOR, YET YOU WENT DOWN THE DUNGEON', 0
0000124D= 20 4C 45 56 45 4C ...    390  LEVELSTRING DC.B    ' LEVEL: ', 0
00001256= 44 4F 57 4E 20 54 ...    391  TITLESTRING DC.B    'DOWN THE DUNGEON HOLE!!!', 0
0000126F= 57 48 59 20 44 49 ...    392  SUBTITLESTR DC.B    'WHY DID YOU COME HERE?', 0
00001286= 28 50 55 53 48 20 ...    393  NEXTSTR     DC.B    '(PUSH X TO CONTINUE)', 0
0000129B= 28 44 4F 20 4E 4F ...    394  BECARESTR   DC.B    '(DO NOT RUSH YOURSELF)', 0
000012B2= 52 45 54 52 59 00        395  RETRYSTR    DC.B    'RETRY', 0
000012B8= 45 58 49 54 00           396  EXITSTR     DC.B    'EXIT', 0
000012BD= 45 41 53 59 00           397  EASYSTR     DC.B    'EASY', 0
000012C2= 4E 4F 52 4D 41 4C 00     398  NORMALSTR   DC.B    'NORMAL', 0
000012CA                           399              DS.W    0
000012CA                           400  
000012CA  =0000000C                401  ENEMYMAXCNT EQU     12                      
000012CA                           402  
000012CA                           403  ; ID'S FOR AGENTS AND MATRIX IN CASE TORCH SHADER IS IMPLEMENTED
000012CA  =00000001                404  EMPTYID     EQU     1                       ; VOID IDENTIFIER
000012CA  =00000002                405  WALLID      EQU     2                       ; WALL IDENTIFIER
000012CA  =00000003                406  FLOORID     EQU     3                       ; FLOOR IDENTIFIER | ONLY USEFUL IF TILE SET IS IMPLEMENTED
000012CA  =00000004                407  STAIRID     EQU     4                       ; STAIR IDENTIFIER
000012CA  =00000005                408  KEYID       EQU     5                       ; KEY IDENTIFIER
000012CA  =00000006                409  PLYRID      EQU     6                       ; PLAYER IDENTIFIER
000012CA  =00000007                410  ENEMYID     EQU     7                       ; TRAP IDENTIFIER
000012CA                           411  
000012CA                           412  ; STATES
000012CA  =00000000                413  STAMM       EQU     0                       ; STATE MAIN MENU
000012CA  =00000001                414  STAGP       EQU     1                       ; STATE GAME PLAY
000012CA  =00000002                415  STADM       EQU     2                       ; STATE DEATH MENU
000012CA                           416  
000012CA                           417  ; AUDIO FILES
000012CA                           418  ;AUDIOLIST  DC.L    AUDIOMUS1, AUDIOMUS2, AUDIOMOVE, AUDIOKEY, AUDIOSTAR, AUDIOTALK, AUDIODIED, AUDIOCLK, 0
000012CA                           419  ;AUDIOIDS   DC.B    AUDIOMUS1ID, AUDIOMUS2ID, AUDIOMOVEID, AUDIOKEYID, AUDIOSTARID, AUDIOTALKID, AUDIODIEDID, AUDIOCLKID
000012CA                           420              DS.W    0
000012CA                           421  
000012CA                           422  ; AUDIO CONSTANTS 
000012CA                           423              
000012CA                           424              ; MASKS
000012CA  =000000FF                425  AUDIOACCY   EQU     $FF                     ; ACCEPT NEW SOUNDS 
000012CA  =00000000                426  AUDIOSCCN   EQU     $00                     ; DO NOT ACCEPT NEW SOUNDS 
000012CA  =00000080                427  AUDIOLOOP   EQU     $80                     ; LOOP ACTIVE SOUND
000012CA  =00000000                428  AUDIONLOP   EQU     $00                     ; DO NOT LOOP ACTIVE SOUND
000012CA  =000000FF                429  AUDIOSTOP   EQU     $FF                     ; STOP ALL SOUNDS 
000012CA                           430              
000012CA                           431              ; IDS
000012CA  =00000000                432  AUDIOMUS1ID EQU     0                       ; MUSIC ID 1 
000012CA  =00000001                433  AUDIOMUS2ID EQU     1                       ; MUSIC ID 2
000012CA                           434  
000012CA  =00000002                435  AUDIOMOVEID EQU     2                       ; MOVE 
000012CA  =00000003                436  AUDIOKEYID  EQU     3                       ; OBTAIN KEY 
000012CA  =00000004                437  AUDIOSTARID EQU     4                       ; GO DOWN STAIRS 
000012CA  =00000005                438  AUDIOTALKID EQU     5                       ; TALK
000012CA  =00000006                439  AUDIODIEDID EQU     6                       ; DEATH
000012CA  =00000007                440  AUDIOCLKID  EQU     7                       ; CLICK
000012CA                           441              
000012CA                           442              ; PATHS
000012CA                           443  ;AUDIOMUS1  DC.B    '',0
000012CA                           444  ;AUDIOMUS2  DC.B    '',0
000012CA                           445  ;           
000012CA                           446  ;AUDIOMOVE  DC.B    '',0
000012CA                           447  ;AUDIOKEY   DC.B    '',0
000012CA                           448  ;AUDIOSTAR  DC.B    '',0
000012CA                           449  ;AUDIOTALK  DC.B    '',0
000012CA                           450  ;AUDIODIED  DC.B    '',0
000012CA                           451  ;AUDIOCLK   DC.B    '',0
000012CA                           452  
000012CA                           453  ; PSEUDO-RANDOM GENERATOR VECTORS
000012CA= 0100 0220 0180 0...      454  XVALUES     DC.W    $100, $220, $180, $1C0, $80, $C0, $200, $E0, $160, $120
000012DE= 0060 01E0 00A0 0...      455              DC.W    $60, $1E0, $A0, $1A0, $140
000012E8                           456  
000012E8= 00D0 0090 00B0 0...      457  YVALUES     DC.W    $D0, $90, $B0, $F0, $B0, $90, $190, $110, $170, $190
000012FC= 00B0 01B0 00B0 0...      458              DC.W    $B0, $1B0, $B0, $130, $D0, $50, $170, $190, $130, $110
00001310= 01B0 0150 0090 0...      459              DC.W    $1B0, $150, $90, $90, $110, $30, $70, $150, $90, $10
00001324= 01B0 00F0 00D0 0...      460              DC.W    $1B0, $F0, $D0, $D0, $90, $1B0, $B0, $170, $130, $190
00001338= 00F0 0030 0150 0...      461              DC.W    $F0, $30, $150, $50, $170, $110, $1B0, $170, $150, $150
0000134C= 0070 01B0 0030 0...      462              DC.W    $70, $1B0, $30, $F0, $10, $90, $F0, $70, $D0, $170
00001360= 0050 00B0 00D0 0...      463              DC.W    $50, $B0, $D0, $190, $90, $170, $50, $50, $50, $90
00001374= 0090 01B0 0030 0...      464              DC.W    $90, $1B0, $30, $110, $130, $50, $B0, $110, $F0, $70
00001388= 0010 01B0 0110 0...      465              DC.W    $10, $1B0, $110, $50, $D0, $F0, $F0, $30, $30, $150
0000139C= 00B0 0030 0110 0...      466              DC.W    $B0, $30, $110, $110, $1B0, $190, $30, $30, $170, $170
000013B0= 0030 0190 0130 0...      467              DC.W    $30, $190, $130, $90, $50, $90, $110, $150, $190, $110
000013C4= 0050 0110 00F0 0...      468              DC.W    $50, $110, $F0, $190, $1B0, $170, $70, $1B0, $F0, $1B0
000013D8= 0050 0130 0150 0...      469              DC.W    $50, $130, $150, $130, $70, $30, $D0, $150, $50, $130
000013EC= 00B0 0010 0010 0...      470              DC.W    $B0, $10, $10, $30, $90, $F0, $B0, $70, $B0, $70
00001400= 0070 00B0 0010 0...      471              DC.W    $70, $B0, $10, $130, $70, $70, $150, $B0, $130, $1B0
00001414= 0030 0190 0130 0...      472              DC.W    $30, $190, $130, $D0, $10, $1D0, $150, $110, $F0, $10
00001428= 0190 0070 0130 0...      473              DC.W    $190, $70, $130, $F0, $10, $70, $10, $30, $190, $D0
0000143C= 0170 0150 0010 0...      474              DC.W    $170, $150, $10, $50, $170, $D0, $F0, $B0, $B0, $D0
00001450= 0190 0090 00B0 0...      475              DC.W    $190, $90, $B0, $90, $190, $10, $110, $90, $110, $130
00001464= 0010 0050 00D0 0...      476              DC.W    $10, $50, $D0, $50, $1B0, $170, $F0, $150, $F0, $10
00001478= 0150 0070 0170 0...      477              DC.W    $150, $70, $170, $110, $D0, $50, $1B0, $30, $150, $170
0000148C= 0130 0030 0070 0...      478              DC.W    $130, $30, $70, $190, $130, $30, $150, $130, $190, $10
000014A0= 0010 00D0 0070 0...      479              DC.W    $10, $D0, $70, $D0, $B0
000014A0= 0010 00D0 0070 0...      480  -------------------- end include --------------------
000014AA                           481              INCLUDE "UTIL.X68"              ; UTILITY MANAGER
000014AA                           482  UTILPEN     MACRO
000014AA                           483  ;   IN:  \1 AS THE COLOR, FORMATED AS #00BBGGRR
000014AA                           484  ;   OUT: NONE
000014AA                           485  ;   MOD: D0, D1    
000014AA                           486  ;   DES: MACRO TO SET PEN COLOR
000014AA                           487  
000014AA                           488          MOVE.B  #80, D0 
000014AA                           489          MOVE.L  \1, D1
000014AA                           490          TRAP    #15
000014AA                           491          ENDM
000014AA                           492  
000014AA                           493  UTILFILL    MACRO
000014AA                           494  ;   IN:  \1 AS THE COLOR, FORMATED AS #00BBGGRR
000014AA                           495  ;   OUT: NONE
000014AA                           496  ;   MOD: D0, D1
000014AA                           497  ;   DES: MACRO TO SET FILL COLOR
000014AA                           498  
000014AA                           499          MOVE.B  #81, D0
000014AA                           500          MOVE.L  \1, D1
000014AA                           501          TRAP    #15
000014AA                           502          ENDM
000014AA                           503  
000014AA                           504  UTILTEXT    MACRO
000014AA                           505  ;   IN:  \1 TEXT 
000014AA                           506  ;        \2 TEXT X
000014AA                           507  ;        \3 TEXT Y
000014AA                           508  ;   OUT: NONE
000014AA                           509  ;   MOD: D0-D2 / A1
000014AA                           510  ;   DES: PRINTS THE 0 TERINATED STRING IN \1 IN COORDINATES \2 \3
000014AA                           511  
000014AA                           512          LEA     \1, A1
000014AA                           513          MOVE.W  \2, D1
000014AA                           514          MOVE.W  \3, D2
000014AA                           515  
000014AA                           516          MOVE.W  #95, D0
000014AA                           517          TRAP    #15
000014AA                           518          ENDM
000014AA                           519  
000014AA                           520  UTILTILE    MACRO
000014AA                           521  ;   IN:  \1 PROCEDURE OF THE TRAP #15
000014AA                           522  ;        \2 X COORDINATE
000014AA                           523  ;        \3 Y COORDINATE
000014AA                           524  ;   OUT: NONE
000014AA                           525  ;   MOD: D1-D4
000014AA                           526  ;   DES: DRAWS A GRAPHIC AT \2 \3
000014AA                           527          MOVE.W  \2, D1               ; D1 = X CENTER
000014AA                           528          MOVE.W  \3, D2               ; D1 = Y CENTER
000014AA                           529          MOVE.W  D1, D3
000014AA                           530          MOVE.W  D2, D4
000014AA                           531          SUB.W   #TILEDIM/2, D1              ; SET TOP LEFT CORNER
000014AA                           532          SUB.W   #TILEDIM/2, D2              ; SET TOP LEFT CORNER 
000014AA                           533          ADD.W   #TILEDIM/2, D3              ; SET LOW RIGHT CORNER
000014AA                           534          ADD.W   #TILEDIM/2, D4              ; SET LOW RIGHT CORNER
000014AA                           535  
000014AA                           536          MOVE.W  \1, D0
000014AA                           537          TRAP    #15
000014AA                           538          ENDM
000014AA                           539  
000014AA                           540  UTILCOLL    
000014AA                           541  ;   IN:  D0 X0 COORDINATE
000014AA                           542  ;        D1 Y0 COORDINATE
000014AA                           543  ;   OUT: D2.B = FF IF COLLISION, 00 ELSEWISE
000014AA                           544  ;   MOD: D2
000014AA                           545  ;   DES: CHECKS IF ELEMENTS 0 AND 1 HAVE THE SAME POSITION 
000014AA                           546  
000014AA  4242                     547          CLR     D2
000014AC  B079 00002AC0            548          CMP.W   (PLAYERX), D0   ; COMPARE X COORDINATES
000014B2  6600 0010                549          BNE .NOCOL
000014B6  B279 00002AC2            550          CMP.W   (PLAYERY), D1   ; COMPARE Y COORDINATES
000014BC  6600 0006                551          BNE .NOCOL
000014C0  143C 00FF                552          MOVE.B  #$FF, D2
000014C4                           553  .NOCOL
000014C4  4E75                     554          RTS
000014C6                           555  
000014C6                           556  
000014C6                           557      
000014C6                           558  -------------------- end include --------------------
000014C6                           559              INCLUDE "RANDOM.X68"            ; PSEUDO - RANDOM GENERATOR
000014C6                           560  ; =============================================================================
000014C6                           561  ; TITLE    : PSEUDO-RANDOM NUMBER GENERATOR
000014C6                           562  ; AUTHOR   : ANTONI BURGUERA
000014C6                           563  ; COMMENTS : VERY LAZY AND STUPID "ALGORITHM" IMPLEMENTED.
000014C6                           564  ; HISTORY  : XX-XXX-201X - CREATION
000014C6                           565  ;            11-OCT-2020 - MINOR CHANGES
000014C6                           566  ; =============================================================================
000014C6                           567  
000014C6                           568  ; -----------------------------------------------------------------------------
000014C6                           569  RNDINIT
000014C6                           570  ; INITIALIZES RANDOM NUMBER GENERATOR
000014C6                           571  ; INPUT    - NONE
000014C6                           572  ; OUTPUT   - NONE
000014C6                           573  ; MODIFIES - NONE
000014C6                           574  ; -----------------------------------------------------------------------------
000014C6  4279 00002ADA            575              CLR     (RNGXINDEX)
000014CC  4279 00002ADC            576              CLR     (RNGYINDEX)
000014D2                           577  
000014D2  4E75                     578              RTS
000014D4                           579  ; -----------------------------------------------------------------------------
000014D4                           580  RNGX
000014D4                           581  ; PROVIDES A PSEUDO-RANDOM BYTE
000014D4                           582  ; INPUT    - NONE
000014D4                           583  ; OUTPUT   - D0.L RANDOM VALUE (ONLY BYTE)
000014D4                           584  ; MODIFIES - NONE (ASIDE OF OUTPUT)
000014D4                           585  ; -----------------------------------------------------------------------------
000014D4  2F08                     586              MOVE.L  A0,-(A7)
000014D6                           587  
000014D6  41F8 12CA                588              LEA     XVALUES, A0
000014DA  4280                     589              CLR.L   D0
000014DC                           590              
000014DC  1039 00002ADA            591              MOVE.B  (RNGXINDEX), D0
000014E2  E348                     592              LSL.W   #1, D0     
000014E4  D0C0                     593              ADD.W   D0, A0
000014E6  3010                     594              MOVE.W  (A0), D0
000014E8  5239 00002ADA            595              ADDQ.B  #1, (RNGXINDEX)
000014EE  0C79 0C00 00002ADA       596              CMP     #$0C00, (RNGXINDEX)
000014F6  6600 0008                597              BNE     .NOVERFLOW     
000014FA  4279 00002ADA            598              CLR     (RNGXINDEX)
00001500                           599  .NOVERFLOW            
00001500  205F                     600              MOVE.L  (A7)+, A0
00001502  4E75                     601              RTS
00001504                           602  
00001504                           603  RNGY
00001504                           604  ; PROVIDES A PSEUDO-RANDOM BYTE
00001504                           605  ; INPUT    - NONE
00001504                           606  ; OUTPUT   - D0.L RANDOM VALUE (ONLY BYTE)
00001504                           607  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001504                           608  ; -----------------------------------------------------------------------------
00001504  2F08                     609              MOVE.L  A0,-(A7)
00001506                           610  
00001506  41F8 12E8                611              LEA     YVALUES, A0
0000150A  4280                     612              CLR.L   D0
0000150C                           613              
0000150C  1039 00002ADC            614              MOVE.B  (RNGYINDEX), D0
00001512  E348                     615              LSL.W   #1, D0  
00001514  D0C0                     616              ADD.W   D0, A0
00001516  3010                     617              MOVE.W  (A0), D0
00001518  5239 00002ADC            618              ADDQ.B  #1, (RNGYINDEX)
0000151E  0C79 E100 00002ADC       619              CMP     #$E100, (RNGYINDEX)
00001526  6600 0008                620              BNE     .NOVERFLOW
0000152A  4279 00002ADC            621              CLR     (RNGYINDEX)
00001530                           622  .NOVERFLOW
00001530  205F                     623              MOVE.L  (A7)+, A0
00001532  4E75                     624              RTS
00001534                           625  
00001534                           626  ; UPDATE RANDOM VALUES TO HAVE ONLY CENTER VALUES OF THE "GRID"
00001534                           627  -------------------- end include --------------------
00001534                           628              INCLUDE "AGENTLST.X68"          ; AGENT MANAGER
00001534                           629  ; =============================================================================
00001534                           630  ; TITLE    : AGENT LIST
00001534                           631  ; AUTHOR   : ANTONI BURGUERA
00001534                           632  ; COMMENTS : EACH AGENT HAS A DATA BLOCK FROM DMM AS FOLLOWS:
00001534                           633  ;              +0 - LONG : UPDATE SUBROUTINE POINTER
00001534                           634  ;              +4 - LONG : PLOT SUBROUTINE POINTER
00001534                           635  ;              +8:END    : DATA (AGENT SPECIFIC)
00001534                           636  ; HISTORY  : XX-XXX-201X - CREATION
00001534                           637  ;            11-OCT-2020 - MINOR CHANGES
00001534                           638  ; =============================================================================
00001534                           639  
00001534                           640  ; -----------------------------------------------------------------------------
00001534                           641  AGLADD
00001534                           642  ; CREATES A NEW AGENT
00001534                           643  ; INPUT    - A1 - POINTER TO AGENT INIT FUNCTION
00001534                           644  ;            A2 - POINTER TO AGENT UPDATE FUNCTION
00001534                           645  ;            A3 - POINTER TO AGENT PLOT FUNCTION
00001534                           646  ;            D0 - AGENT TYPE (USED AS OWNED BY DMM)
00001534                           647  ;            D1 - AGENT INITIALIZATION PARAMETER 1
00001534                           648  ;            D2 - AGENT INITIALIZATION PARAMETER 2
00001534                           649  ;            D3 - AGENT INITIALIZATION PARAMETER 3
00001534                           650  ; OUTPUT   - NONE
00001534                           651  ; MODIFIES - NONE
00001534                           652  ; -----------------------------------------------------------------------------
00001534  2F08                     653              MOVE.L  A0,-(A7)
00001536  4EB8 11A6                654              JSR     DMMALLOC
0000153A  B1FC 00000000            655              CMP.L   #0,A0
00001540  6700 0008                656              BEQ     .END
00001544  20CA                     657              MOVE.L  A2,(A0)+
00001546  20CB                     658              MOVE.L  A3,(A0)+
00001548  4E91                     659              JSR     (A1)
0000154A  205F                     660  .END        MOVE.L  (A7)+,A0
0000154C  4E75                     661              RTS
0000154E                           662  
0000154E                           663  ; -----------------------------------------------------------------------------
0000154E                           664  AGLUPDT
0000154E                           665  ; UPDATES THE AGENT LIST. PRIOR TO CALLING THE UPDATE FUNCTIONS, A0 IS SET
0000154E                           666  ; TO THE DATA BLOCK OF THE CORRESPONDING SLOT.
0000154E                           667  ; INPUT    - NONE
0000154E                           668  ; OUTPUT   - NONE
0000154E                           669  ; MODIFIES - NONE
0000154E                           670  ; -----------------------------------------------------------------------------
0000154E  48E7 00C0                671              MOVEM.L A0-A1,-(A7)
00001552  4EB8 1136                672              JSR     DMMFIRST
00001556  B1FC 00000000            673  .LOOP       CMP.L   #0,A0
0000155C  6700 000E                674              BEQ     .END
00001560  2250                     675              MOVE.L  (A0),A1
00001562  5088                     676              ADD.L   #8,A0
00001564  4E91                     677              JSR     (A1)
00001566  4EB8 1158                678              JSR     DMMNEXT
0000156A  60EA                     679              BRA     .LOOP
0000156C  4CDF 0300                680  .END        MOVEM.L (A7)+,A0-A1
00001570  4E75                     681              RTS
00001572                           682  
00001572                           683  ; -----------------------------------------------------------------------------
00001572                           684  AGLPLOT
00001572                           685  ; PLOTS THE AGENT LIST. PRIOR TO CALLING THE UPDATE FUNCTIONS, A0 IS SET
00001572                           686  ; TO THE DATA BLOCK OF THE CORRESPONDING SLOT.
00001572                           687  ; INPUT    - NONE
00001572                           688  ; OUTPUT   - NONE
00001572                           689  ; MODIFIES - NONE
00001572                           690  ; -----------------------------------------------------------------------------
00001572  48E7 00C0                691              MOVEM.L A0-A1,-(A7)
00001576  4EB8 1136                692              JSR     DMMFIRST
0000157A  B1FC 00000000            693  .LOOP       CMP.L   #0,A0
00001580  6700 0010                694              BEQ     .END
00001584  2268 0004                695              MOVE.L  4(A0),A1
00001588  5088                     696              ADD.L   #8,A0
0000158A  4E91                     697              JSR     (A1)
0000158C  4EB8 1158                698              JSR     DMMNEXT
00001590  60E8                     699              BRA     .LOOP
00001592  4CDF 0300                700  .END        MOVEM.L (A7)+,A0-A1
00001596  4E75                     701              RTS
00001598                           702  
00001598                           703  ; -----------------------------------------------------------------------------
00001598  =000011C0                704  AGLKILL     EQU     DMMFREE
00001598                           705  ; KILLS THE AGENT BY RELEASING ITS MEMORY
00001598                           706  ; INPUT    - A0 POINTER WITHIN THE AGENT MEMORY
00001598                           707  ; OUTPUT   - NONE
00001598                           708  ; MODIFIES - NONE
00001598                           709  ; NOTE     - IT IS JUST A WRAPPER FOR DMMFREE
00001598                           710  ; -----------------------------------------------------------------------------
00001598                           711  
00001598                           712  AGLFKIL
00001598                           713  ; KILLS ALL AGENTS WITH ID 'X'
00001598                           714  ; INPUT    - D0 AGENT ID
00001598  48E7 00C0                715              MOVEM.L A0-A1,-(A7)
0000159C  4EB8 116E                716              JSR     DMMFRSTO
000015A0  B1FC 00000000            717  .LOOP       CMP.L   #0, A0
000015A6  6700 000C                718              BEQ     .END            ; AGENT LIST IS EMPTY
000015AA  4EB8 11C0                719              JSR     AGLKILL
000015AE  4EB8 116E                720              JSR     DMMFRSTO        ; SEARCH NEXT AGENT WITH ID D0
000015B2  60EC                     721              BRA     .LOOP
000015B4  4CDF 0300                722  .END        MOVEM.L (A7)+,A0-A1
000015B8  4E75                     723              RTS
000015B8  4E75                     724  -------------------- end include --------------------
000015BA                           725              INCLUDE "PLAYER.X68"            ; PLAYER MANAGER
000015BA                           726  ; =============================================================================
000015BA                           727  ; TITLE    : PLAYER MANAGER
000015BA                           728  ; AUTHOR   : 
000015BA                           729  ; COMMENTS : 
000015BA                           730  ; =============================================================================
000015BA                           731  
000015BA                           732  
000015BA                           733  PLAYERINIT
000015BA  33FC 0140 00002AC0       734              MOVE.W #SCRWIDTH/2, (PLAYERX)       ; SET PLAYER TO CENTER
000015C2  33FC 00F0 00002AC2       735              MOVE.W #SCRHEIGH/2, (PLAYERY)       ; SET PLAYER TO CENTER
000015CA  4E75                     736              RTS
000015CC                           737  
000015CC                           738  PLAYERUPDT  
000015CC                           739  
000015CC  0839 0000 00001E2F       740              BTST.B  #0, (SCRCYCCT)
000015D4  6600 0092                741              BNE     .END  
000015D8  0839 0000 00001E2C       742              BTST.B  #KBDBITLF, (KBDVAL)         ; LEFT KEY PRESSED
000015E0  6600 0028                743              BNE     .MOVEL
000015E4  0839 0002 00001E2C       744              BTST.B  #KBDBITRT, (KBDVAL)         ; RIGHT KEY PRESSED
000015EC  6600 0034                745              BNE     .MOVER
000015F0  0839 0001 00001E2C       746              BTST.B  #KBDBITUP, (KBDVAL)         ; UP KEY PRESSED
000015F8  6600 0040                747              BNE     .MOVEU
000015FC  0839 0003 00001E2C       748              BTST.B  #KBDBITDN, (KBDVAL)         ; DOWN KEY PRESSED
00001604  6600 004C                749              BNE     .MOVED
00001608  4E75                     750              RTS
0000160A                           751  .MOVEL
0000160A  0C79 0070 00002AC0       752              CMP.W   #TILEDIM/2+(SCRWIDTH-SCRHEIGH)-64, (PLAYERX)       ; LEFT BOUNDARY
00001612  6E00 0004                753              BGT     .RMVEL
00001616  4E75                     754              RTS
00001618                           755  .RMVEL
00001618  0479 0020 00002AC0       756              SUB.W   #TILEDIM, (PLAYERX)         ; MOVE LEFT
00001620  4E75                     757              RTS
00001622                           758  
00001622                           759  .MOVER
00001622  0C79 020F 00002AC0       760              CMP.W   #SCRHEIGH-1-TILEDIM/2+64, (PLAYERX)    ; RIGHT BOUNDARY
0000162A  6D00 0004                761              BLT     .RMVER
0000162E  4E75                     762              RTS
00001630                           763  .RMVER
00001630  0679 0020 00002AC0       764              ADD.W   #TILEDIM, (PLAYERX)         ; MOVE RIGHT
00001638  4E75                     765              RTS
0000163A                           766  
0000163A                           767  .MOVEU
0000163A  0C79 0010 00002AC2       768              CMP.W   #TILEDIM/2, (PLAYERY)       ; TOP BOUNDARY
00001642  6E00 0004                769              BGT     .RMVEU
00001646  4E75                     770              RTS
00001648                           771  .RMVEU
00001648  0479 0020 00002AC2       772              SUB.W   #TILEDIM, (PLAYERY)         ; MOVE UP
00001650  4E75                     773              RTS
00001652                           774  
00001652                           775  .MOVED
00001652  0C79 01CF 00002AC2       776              CMP.W   #SCRHEIGH-1-TILEDIM/2, (PLAYERY)    ; BOTTOM BOUNDARY
0000165A  6D00 0004                777              BLT     .RMVED
0000165E  4E75                     778              RTS
00001660                           779  .RMVED
00001660  0679 0020 00002AC2       780              ADD.W   #TILEDIM, (PLAYERY)         ; MOVE DOWN
00001668                           781  .END
00001668  4E75                     782              RTS
0000166A                           783  
0000166A                           784  PLAYERPLOT
0000166A  48E7 F800                785              MOVEM.L D0-D4, -(A7)
0000166E                           786m             UTILPEN #TILELIGH                         
0000166E                           787m ;   IN:  #TILELIGH AS THE COLOR, FORMATED AS #00BBGGRR
0000166E                           788m ;   OUT: NONE
0000166E                           789m ;   MOD: D0, D1    
0000166E                           790m ;   DES: MACRO TO SET PEN COLOR
0000166E                           791m 
0000166E  103C 0050                792m         MOVE.B  #80, D0 
00001672  223C 00CCE0EA            793m         MOVE.L  #TILELIGH, D1
00001678  4E4F                     794m         TRAP    #15
0000167A                           795m         ENDM
0000167A                           796  
0000167A                           797m             UTILFILL #TILELIGH
0000167A                           798m ;   IN:  #TILELIGH AS THE COLOR, FORMATED AS #00BBGGRR
0000167A                           799m ;   OUT: NONE
0000167A                           800m ;   MOD: D0, D1
0000167A                           801m ;   DES: MACRO TO SET FILL COLOR
0000167A                           802m 
0000167A  103C 0051                803m         MOVE.B  #81, D0
0000167E  223C 00CCE0EA            804m         MOVE.L  #TILELIGH, D1
00001684  4E4F                     805m         TRAP    #15
00001686                           806m         ENDM
00001686                           807              
00001686                           808m             UTILTILE #87, (PLAYERX), (PLAYERY)
00001686                           809m ;   IN:  #87 PROCEDURE OF THE TRAP #15
00001686                           810m ;        (PLAYERX) X COORDINATE
00001686                           811m ;        (PLAYERY) Y COORDINATE
00001686                           812m ;   OUT: NONE
00001686                           813m ;   MOD: D1-D4
00001686                           814m ;   DES: DRAWS A GRAPHIC AT (PLAYERX) (PLAYERY)
00001686  3239 00002AC0            815m         MOVE.W  (PLAYERX), D1               ; D1 = X CENTER
0000168C  3439 00002AC2            816m         MOVE.W  (PLAYERY), D2               ; D1 = Y CENTER
00001692  3601                     817m         MOVE.W  D1, D3
00001694  3802                     818m         MOVE.W  D2, D4
00001696  0441 0010                819m         SUB.W   #TILEDIM/2, D1              ; SET TOP LEFT CORNER
0000169A  0442 0010                820m         SUB.W   #TILEDIM/2, D2              ; SET TOP LEFT CORNER 
0000169E  0643 0010                821m         ADD.W   #TILEDIM/2, D3              ; SET LOW RIGHT CORNER
000016A2  0644 0010                822m         ADD.W   #TILEDIM/2, D4              ; SET LOW RIGHT CORNER
000016A6                           823m 
000016A6  303C 0057                824m         MOVE.W  #87, D0
000016AA  4E4F                     825m         TRAP    #15
000016AC                           826m         ENDM
000016AC  4CDF 001F                827              MOVEM.L (A7)+,D0-D4
000016B0  4E75                     828              RTS
000016B2                           829  
000016B2                           830  
000016B2                           831  -------------------- end include --------------------
000016B2                           832              INCLUDE "MAP.X68"               ; MAP MANAGER
000016B2                           833  MAPINIT
000016B2  4E75                     834          RTS      
000016B4                           835  MAPUPDT
000016B4  4E75                     836          RTS
000016B6                           837  MAPPLOT
000016B6  48E7 F800                838          MOVEM.L D0-D4, -(A7)
000016BA                           839          
000016BA                           840m         UTILPEN #TILEDARK
000016BA                           841m ;   IN:  #TILEDARK AS THE COLOR, FORMATED AS #00BBGGRR
000016BA                           842m ;   OUT: NONE
000016BA                           843m ;   MOD: D0, D1    
000016BA                           844m ;   DES: MACRO TO SET PEN COLOR
000016BA                           845m 
000016BA  103C 0050                846m         MOVE.B  #80, D0 
000016BE  223C 00745B6D            847m         MOVE.L  #TILEDARK, D1
000016C4  4E4F                     848m         TRAP    #15
000016C6                           849m         ENDM
000016C6                           850m         UTILFILL #TILEDARK
000016C6                           851m ;   IN:  #TILEDARK AS THE COLOR, FORMATED AS #00BBGGRR
000016C6                           852m ;   OUT: NONE
000016C6                           853m ;   MOD: D0, D1
000016C6                           854m ;   DES: MACRO TO SET FILL COLOR
000016C6                           855m 
000016C6  103C 0051                856m         MOVE.B  #81, D0
000016CA  223C 00745B6D            857m         MOVE.L  #TILEDARK, D1
000016D0  4E4F                     858m         TRAP    #15
000016D2                           859m         ENDM
000016D2                           860  
000016D2  4241                     861          CLR     D1                          ; LEFT BORDER
000016D4  4242                     862          CLR     D2                      
000016D6  363C 004F                863          MOVE.W  #79, D3
000016DA  383C 01E0                864          MOVE.W  #SCRHEIGH, D4
000016DE  303C 0057                865          MOVE.W  #87, D0
000016E2  4E4F                     866          TRAP    #15
000016E4                           867  
000016E4  323C 0231                868          MOVE.W  #561, D1                    ; RIGHT BORDER                                
000016E8  363C 0280                869          MOVE.W  #SCRWIDTH, D3
000016EC  4E4F                     870          TRAP    #15
000016EE                           871          
000016EE  4CDF 001F                872          MOVEM.L (A7)+,D0-D4
000016F2                           873  
000016F2  4E75                     874          RTS
000016F2  4E75                     875  -------------------- end include --------------------
000016F4                           876              INCLUDE "KEY.X68"               ; KEY MANAGER
000016F4                           877  KEYINIT             ; RANDOM POSITION
000016F4  2F00                     878              MOVE.L D0, -(A7)
000016F6  4EB8 14D4                879              JSR     RNGX
000016FA  33C0 00002AC4            880              MOVE.W  D0, (KEYX)
00001700  4EB8 1504                881              JSR     RNGY
00001704  33C0 00002AC6            882              MOVE.W  D0, (KEYY)
0000170A  201F                     883              MOVE.L  (A7)+, D0
0000170C  4E75                     884              RTS
0000170E                           885  KEYUPDT             ; NOTHING
0000170E  48E7 E000                886              MOVEM.L D0-D2, -(A7)
00001712                           887             
00001712  3039 00002AC4            888              MOVE.W  (KEYX), D0
00001718  3239 00002AC6            889              MOVE.W  (KEYY), D1
0000171E  4EB8 14AA                890              JSR     UTILCOLL
00001722  B43C 00FF                891              CMP.B   #$FF, D2
00001726  6600 000A                892              BNE     .END
0000172A  13FC 0001 00002AD0       893              MOVE.B  #1, (KEYOBTEINED)           ; THE PLAYER IS IN THE POSITION OF THE KEY
00001732                           894  .END
00001732  4CDF 0007                895              MOVEM.L (A7)+, D0-D2
00001736  4E75                     896              RTS
00001738                           897  
00001738                           898  KEYPLOT             ; LIGHT BORDERED CIRCLE
00001738  0C39 0001 00002AD0       899              CMP.B   #1, (KEYOBTEINED)
00001740  6700 003C                900              BEQ     .NOKEY
00001744  48E7 F800                901              MOVEM.L D0-D4, -(A7)
00001748                           902m             UTILPEN #TILELIGH
00001748                           903m ;   IN:  #TILELIGH AS THE COLOR, FORMATED AS #00BBGGRR
00001748                           904m ;   OUT: NONE
00001748                           905m ;   MOD: D0, D1    
00001748                           906m ;   DES: MACRO TO SET PEN COLOR
00001748                           907m 
00001748  103C 0050                908m         MOVE.B  #80, D0 
0000174C  223C 00CCE0EA            909m         MOVE.L  #TILELIGH, D1
00001752  4E4F                     910m         TRAP    #15
00001754                           911m         ENDM
00001754                           912  
00001754                           913m             UTILTILE #91, (KEYX), (KEYY)             
00001754                           914m ;   IN:  #91 PROCEDURE OF THE TRAP #15
00001754                           915m ;        (KEYX) X COORDINATE
00001754                           916m ;        (KEYY) Y COORDINATE
00001754                           917m ;   OUT: NONE
00001754                           918m ;   MOD: D1-D4
00001754                           919m ;   DES: DRAWS A GRAPHIC AT (KEYX) (KEYY)
00001754  3239 00002AC4            920m         MOVE.W  (KEYX), D1               ; D1 = X CENTER
0000175A  3439 00002AC6            921m         MOVE.W  (KEYY), D2               ; D1 = Y CENTER
00001760  3601                     922m         MOVE.W  D1, D3
00001762  3802                     923m         MOVE.W  D2, D4
00001764  0441 0010                924m         SUB.W   #TILEDIM/2, D1              ; SET TOP LEFT CORNER
00001768  0442 0010                925m         SUB.W   #TILEDIM/2, D2              ; SET TOP LEFT CORNER 
0000176C  0643 0010                926m         ADD.W   #TILEDIM/2, D3              ; SET LOW RIGHT CORNER
00001770  0644 0010                927m         ADD.W   #TILEDIM/2, D4              ; SET LOW RIGHT CORNER
00001774                           928m 
00001774  303C 005B                929m         MOVE.W  #91, D0
00001778  4E4F                     930m         TRAP    #15
0000177A                           931m         ENDM
0000177A                           932             
0000177A  4CDF 001F                933              MOVEM.L (A7)+,D0-D4
0000177E                           934  .NOKEY            
0000177E  4E75                     935              RTS
0000177E  4E75                     936  -------------------- end include --------------------
00001780                           937              INCLUDE "STAIRS.X68"            ; STAIR MANAGER 
00001780                           938  STAIRSINIT          ; RANDOM POSTION
00001780  2F00                     939              MOVE.L D0, -(A7)
00001782  4EB8 14D4                940              JSR     RNGX
00001786  33C0 00002AC8            941              MOVE.W  D0, (STAIRSX)
0000178C  4EB8 1504                942              JSR     RNGY
00001790  33C0 00002ACA            943              MOVE.W  D0, (STAIRSY)
00001796  201F                     944              MOVE.L  (A7)+, D0
00001798  4279 00002AD6            945              CLR     ONSTAIRS
0000179E  4E75                     946              RTS
000017A0                           947  STAIRSUPDT          
000017A0  48E7 E070                948              MOVEM.L D0-D2/A1-A3, -(A7)
000017A4  3039 00002AC8            949              MOVE.W  (STAIRSX), D0
000017AA  3239 00002ACA            950              MOVE.W  (STAIRSY), D1
000017B0  4EB8 14AA                951              JSR     UTILCOLL
000017B4  B43C 00FF                952              CMP.B   #$FF, D2
000017B8  6600 0062                953              BNE     .ENDD
000017BC                           954              
000017BC                           955              ; THE PLAYER IS IN THE POSITION OF THE STAIRS
000017BC  0C39 0001 00002AD0       956              CMP.B   #1, (KEYOBTEINED)
000017C4  6600 004A                957              BNE     .NOKEY
000017C8  4EB8 16F4                958              JSR     KEYINIT
000017CC  4EB8 1780                959              JSR     STAIRSINIT
000017D0                           960  
000017D0                           961  ; CREATE ENEMIES BASED ON LEVEL 
000017D0  4280                     962              CLR.L   D0
000017D2  303C 0007                963              MOVE.W  #ENEMYID, D0
000017D6  4EB8 1598                964              JSR     AGLFKIL     ; KILLS ALL AGENTS WITH ID       
000017DA  3239 00002ADE            965              MOVE.W (LEVEL), D1
000017E0                           966              
000017E0                           967  .ENEMYADD
000017E0  43F9 000018A6            968              LEA     ENEMYINIT, A1
000017E6  45F9 000018C2            969              LEA     ENEMYUPDT, A2
000017EC  47F9 000018E6            970              LEA     ENEMYPLOT, A3
000017F2  303C 0007                971              MOVE.W  #ENEMYID, D0
000017F6                           972              
000017F6  4EB8 1534                973              JSR     AGLADD
000017FA  51C9 FFE4                974              DBRA.W    D1, .ENEMYADD
000017FE                           975  
000017FE  13FC 0000 00002AD0       976              MOVE.B  #0, (KEYOBTEINED)
00001806  5279 00002ADE            977              ADDQ.W  #1, (LEVEL)
0000180C  6000 0014                978              BRA     .END
00001810                           979  .NOKEY      ; SAME POSITION NO KEY
00001810  33FC 0001 00002AD6       980              MOVE.W  #1, (ONSTAIRS)
00001818  6000 0008                981              BRA     .END
0000181C                           982              
0000181C                           983  .ENDD
0000181C  4279 00002AD6            984              CLR     ONSTAIRS
00001822                           985  .END
00001822                           986              
00001822  4CDF 0E07                987              MOVEM.L (A7)+, D0-D2/A1-A3
00001826  4E75                     988              RTS
00001828                           989              
00001828                           990  STAIRSPLOT          
00001828  48E7 F800                991              MOVEM.L D0-D4, -(A7)
0000182C                           992                      
0000182C                           993m             UTILPEN #TILELIGH
0000182C                           994m ;   IN:  #TILELIGH AS THE COLOR, FORMATED AS #00BBGGRR
0000182C                           995m ;   OUT: NONE
0000182C                           996m ;   MOD: D0, D1    
0000182C                           997m ;   DES: MACRO TO SET PEN COLOR
0000182C                           998m 
0000182C  103C 0050                999m         MOVE.B  #80, D0 
00001830  223C 00CCE0EA           1000m         MOVE.L  #TILELIGH, D1
00001836  4E4F                    1001m         TRAP    #15
00001838                          1002m         ENDM
00001838                          1003m             UTILFILL #TILELIGH 
00001838                          1004m ;   IN:  #TILELIGH AS THE COLOR, FORMATED AS #00BBGGRR
00001838                          1005m ;   OUT: NONE
00001838                          1006m ;   MOD: D0, D1
00001838                          1007m ;   DES: MACRO TO SET FILL COLOR
00001838                          1008m 
00001838  103C 0051               1009m         MOVE.B  #81, D0
0000183C  223C 00CCE0EA           1010m         MOVE.L  #TILELIGH, D1
00001842  4E4F                    1011m         TRAP    #15
00001844                          1012m         ENDM
00001844                          1013                              
00001844  0C39 0001 00002AD0      1014              CMP.B   #1, (KEYOBTEINED)
0000184C  6700 002C               1015              BEQ     .KEYOBTEINED
00001850                          1016m             UTILTILE #88, (STAIRSX), (STAIRSY)
00001850                          1017m ;   IN:  #88 PROCEDURE OF THE TRAP #15
00001850                          1018m ;        (STAIRSX) X COORDINATE
00001850                          1019m ;        (STAIRSY) Y COORDINATE
00001850                          1020m ;   OUT: NONE
00001850                          1021m ;   MOD: D1-D4
00001850                          1022m ;   DES: DRAWS A GRAPHIC AT (STAIRSX) (STAIRSY)
00001850  3239 00002AC8           1023m         MOVE.W  (STAIRSX), D1               ; D1 = X CENTER
00001856  3439 00002ACA           1024m         MOVE.W  (STAIRSY), D2               ; D1 = Y CENTER
0000185C  3601                    1025m         MOVE.W  D1, D3
0000185E  3802                    1026m         MOVE.W  D2, D4
00001860  0441 0010               1027m         SUB.W   #TILEDIM/2, D1              ; SET TOP LEFT CORNER
00001864  0442 0010               1028m         SUB.W   #TILEDIM/2, D2              ; SET TOP LEFT CORNER 
00001868  0643 0010               1029m         ADD.W   #TILEDIM/2, D3              ; SET LOW RIGHT CORNER
0000186C  0644 0010               1030m         ADD.W   #TILEDIM/2, D4              ; SET LOW RIGHT CORNER
00001870                          1031m 
00001870  303C 0058               1032m         MOVE.W  #88, D0
00001874  4E4F                    1033m         TRAP    #15
00001876                          1034m         ENDM
00001876  6000 0028               1035              BRA     .END
0000187A                          1036  .KEYOBTEINED
0000187A                          1037m             UTILTILE #91, (STAIRSX), (STAIRSY)
0000187A                          1038m ;   IN:  #91 PROCEDURE OF THE TRAP #15
0000187A                          1039m ;        (STAIRSX) X COORDINATE
0000187A                          1040m ;        (STAIRSY) Y COORDINATE
0000187A                          1041m ;   OUT: NONE
0000187A                          1042m ;   MOD: D1-D4
0000187A                          1043m ;   DES: DRAWS A GRAPHIC AT (STAIRSX) (STAIRSY)
0000187A  3239 00002AC8           1044m         MOVE.W  (STAIRSX), D1               ; D1 = X CENTER
00001880  3439 00002ACA           1045m         MOVE.W  (STAIRSY), D2               ; D1 = Y CENTER
00001886  3601                    1046m         MOVE.W  D1, D3
00001888  3802                    1047m         MOVE.W  D2, D4
0000188A  0441 0010               1048m         SUB.W   #TILEDIM/2, D1              ; SET TOP LEFT CORNER
0000188E  0442 0010               1049m         SUB.W   #TILEDIM/2, D2              ; SET TOP LEFT CORNER 
00001892  0643 0010               1050m         ADD.W   #TILEDIM/2, D3              ; SET LOW RIGHT CORNER
00001896  0644 0010               1051m         ADD.W   #TILEDIM/2, D4              ; SET LOW RIGHT CORNER
0000189A                          1052m 
0000189A  303C 005B               1053m         MOVE.W  #91, D0
0000189E  4E4F                    1054m         TRAP    #15
000018A0                          1055m         ENDM
000018A0                          1056  
000018A0                          1057  .END
000018A0  4CDF 001F               1058              MOVEM.L (A7)+,D0-D4
000018A4  4E75                    1059              RTS
000018A6                          1060  
000018A6                          1061  
000018A6                          1062  -------------------- end include --------------------
000018A6                          1063              INCLUDE "ENEMY.X68"             ; ENEMY MANAGER
000018A6                          1064  ;   LOCAL VARIABLES:
000018A6                          1065  ;       XCENTER -   (A0)    WORD
000018A6                          1066  ;       YCENTER -   2(A0)   WORD
000018A6                          1067  ;       ID      -   
000018A6                          1068  
000018A6                          1069  ENEMYINIT
000018A6                          1070                   
000018A6  48E7 C000               1071              MOVEM.L  D0-D1, -(A7)
000018AA  323C 0001               1072              MOVE.W  #1, D1
000018AE                          1073              
000018AE  4EB8 14D4               1074              JSR     RNGX
000018B2  3080                    1075              MOVE.W  D0, (A0)        ; MOVE X COORDINATE TO (A0) | AGENT CONTROL
000018B4  4EB8 1504               1076              JSR     RNGY 
000018B8  3140 0002               1077              MOVE.W  D0, 2(A0)       ; MOVE Y COORDIANTE TO 2(A0) | AGENT CONTROL
000018BC                          1078  
000018BC  4CDF 0003               1079              MOVEM.L  (A7)+, D0-D1
000018C0  4E75                    1080              RTS
000018C2                          1081  
000018C2                          1082  ENEMYUPDT
000018C2  48E7 E000               1083              MOVEM.L D0-D2, -(A7)
000018C6                          1084  
000018C6  3010                    1085              MOVE.W  (A0), D0
000018C8  3228 0002               1086              MOVE.W  2(A0), D1
000018CC  4EB8 14AA               1087              JSR     UTILCOLL
000018D0  B43C 00FF               1088              CMP.B   #$FF, D2
000018D4  6600 000A               1089              BNE     .END
000018D8                          1090              ; THE PLAYER IS IN THE POSITION OF THE STAIRS  
000018D8  33FC 0002 00002ACE      1091              MOVE.W  #STADM, (STANEXT)
000018E0                          1092  .END
000018E0  4CDF 0007               1093              MOVEM.L (A7)+, D0-D2
000018E4  4E75                    1094              RTS
000018E6                          1095  ENEMYPLOT
000018E6  48E7 F800               1096              MOVEM.L D0-D4, -(A7)
000018EA                          1097  
000018EA                          1098m             UTILPEN #TILEDETA                       
000018EA                          1099m ;   IN:  #TILEDETA AS THE COLOR, FORMATED AS #00BBGGRR
000018EA                          1100m ;   OUT: NONE
000018EA                          1101m ;   MOD: D0, D1    
000018EA                          1102m ;   DES: MACRO TO SET PEN COLOR
000018EA                          1103m 
000018EA  103C 0050               1104m         MOVE.B  #80, D0 
000018EE  223C 00957EA0           1105m         MOVE.L  #TILEDETA, D1
000018F4  4E4F                    1106m         TRAP    #15
000018F6                          1107m         ENDM
000018F6                          1108m             UTILFILL #TILEDETA
000018F6                          1109m ;   IN:  #TILEDETA AS THE COLOR, FORMATED AS #00BBGGRR
000018F6                          1110m ;   OUT: NONE
000018F6                          1111m ;   MOD: D0, D1
000018F6                          1112m ;   DES: MACRO TO SET FILL COLOR
000018F6                          1113m 
000018F6  103C 0051               1114m         MOVE.B  #81, D0
000018FA  223C 00957EA0           1115m         MOVE.L  #TILEDETA, D1
00001900  4E4F                    1116m         TRAP    #15
00001902                          1117m         ENDM
00001902                          1118m             UTILTILE #87, (A0), 2(A0)
00001902                          1119m ;   IN:  #87 PROCEDURE OF THE TRAP #15
00001902                          1120m ;        (A0) X COORDINATE
00001902                          1121m ;        2(A0) Y COORDINATE
00001902                          1122m ;   OUT: NONE
00001902                          1123m ;   MOD: D1-D4
00001902                          1124m ;   DES: DRAWS A GRAPHIC AT (A0) 2(A0)
00001902  3210                    1125m         MOVE.W  (A0), D1               ; D1 = X CENTER
00001904  3428 0002               1126m         MOVE.W  2(A0), D2               ; D1 = Y CENTER
00001908  3601                    1127m         MOVE.W  D1, D3
0000190A  3802                    1128m         MOVE.W  D2, D4
0000190C  0441 0010               1129m         SUB.W   #TILEDIM/2, D1              ; SET TOP LEFT CORNER
00001910  0442 0010               1130m         SUB.W   #TILEDIM/2, D2              ; SET TOP LEFT CORNER 
00001914  0643 0010               1131m         ADD.W   #TILEDIM/2, D3              ; SET LOW RIGHT CORNER
00001918  0644 0010               1132m         ADD.W   #TILEDIM/2, D4              ; SET LOW RIGHT CORNER
0000191C                          1133m 
0000191C  303C 0057               1134m         MOVE.W  #87, D0
00001920  4E4F                    1135m         TRAP    #15
00001922                          1136m         ENDM
00001922                          1137              
00001922  4CDF 001F               1138              MOVEM.L (A7)+,D0-D4
00001926  4E75                    1139              RTS
00001926  4E75                    1140  -------------------- end include --------------------
00001928                          1141              INCLUDE "MISC.X68"              ; MISCELLANEOUS MANAGER
00001928                          1142  MISCINIT
00001928  4E75                    1143          RTS
0000192A                          1144  MISCUPDT
0000192A  4E75                    1145          RTS
0000192C                          1146          
0000192C                          1147  MISCPLOT
0000192C  4EB9 0000193A           1148          JSR .LVLPLOT
00001932  4EB9 0000195E           1149          JSR .NOOKEYPLOT
00001938  4E75                    1150          RTS
0000193A                          1151  
0000193A                          1152  
0000193A                          1153  .LVLPLOT
0000193A  48E7 E040               1154          MOVEM.L D0-D2/A1, -(A7)
0000193E                          1155          
0000193E                          1156m         UTILFILL #00000000      
0000193E                          1157m ;   IN:  #00000000 AS THE COLOR, FORMATED AS #00BBGGRR
0000193E                          1158m ;   OUT: NONE
0000193E                          1159m ;   MOD: D0, D1
0000193E                          1160m ;   DES: MACRO TO SET FILL COLOR
0000193E                          1161m 
0000193E  103C 0051               1162m         MOVE.B  #81, D0
00001942  7200                    1163m         MOVE.L  #00000000, D1
00001944  4E4F                    1164m         TRAP    #15
00001946                          1165m         ENDM
00001946                          1166  
00001946  43F8 124D               1167          LEA     LEVELSTRING, A1
0000194A  4281                    1168          CLR.L   D1
0000194C  3239 00002ADE           1169          MOVE.W  (LEVEL), D1
00001952  103C 0011               1170          MOVE.B  #17,D0
00001956  4E4F                    1171          TRAP    #15
00001958                          1172          
00001958  4CDF 0207               1173          MOVEM.L (A7)+, D0-D2/A1
0000195C  4E75                    1174          RTS 
0000195E                          1175  
0000195E                          1176  .NOOKEYPLOT
0000195E  0C79 0001 00002AD6      1177          CMP     #1, (ONSTAIRS)
00001966  6600 001C               1178          BNE     .END     
0000196A  48E7 E040               1179          MOVEM.L D0-D2/A1, -(A7)
0000196E                          1180m         UTILTEXT NOKEYSTRING, #SCRWIDTH/2-100, #SCRHEIGH/8  
0000196E                          1181m ;   IN:  NOKEYSTRING TEXT 
0000196E                          1182m ;        #SCRWIDTH/2-100 TEXT X
0000196E                          1183m ;        #SCRHEIGH/8 TEXT Y
0000196E                          1184m ;   OUT: NONE
0000196E                          1185m ;   MOD: D0-D2 / A1
0000196E                          1186m ;   DES: PRINTS THE 0 TERINATED STRING IN NOKEYSTRING IN COORDINATES #SCRWIDTH/2-100 #SCRHEIGH/8
0000196E                          1187m 
0000196E  43F8 11D6               1188m         LEA     NOKEYSTRING, A1
00001972  323C 00DC               1189m         MOVE.W  #SCRWIDTH/2-100, D1
00001976  343C 003C               1190m         MOVE.W  #SCRHEIGH/8, D2
0000197A                          1191m 
0000197A  303C 005F               1192m         MOVE.W  #95, D0
0000197E  4E4F                    1193m         TRAP    #15
00001980                          1194m         ENDM
00001980  4CDF 0207               1195          MOVEM.L (A7)+, D0-D2/A1
00001984                          1196  .END        
00001984  4E75                    1197          RTS
00001984  4E75                    1198  -------------------- end include --------------------
00001986                          1199              INCLUDE "STATES.X68"            ; STATES MANAGER
00001986                          1200  ; =============================================================================
00001986                          1201  ; TITLE    : GAME STATE MANAGEMENT
00001986                          1202  ; AUTHOR   : ANTONI BURGUERA
00001986                          1203  ; HISTORY  : XX-XXX-201X - CREATION
00001986                          1204  ;            11-OCT-2020 - MINOR CHANGES
00001986                          1205  ; =============================================================================
00001986                          1206  
00001986                          1207  ; -----------------------------------------------------------------------------
00001986                          1208  STAINIT
00001986                          1209  ; INITALIZES THE STATE MANAGER
00001986                          1210  ; INPUT    - NONE
00001986                          1211  ; OUTPUT   - NONE
00001986                          1212  ; MODIFIES - NONE
00001986                          1213  ; -----------------------------------------------------------------------------
00001986  33FC FFFF 00002ACC      1214              MOVE.W  #-1,(STACUR)            ; INVALID STATE, JUST TO FORCE INIT
0000198E  33FC 0000 00002ACE      1215              MOVE.W  #0,(STANEXT)            ; INITIAL STATE
00001996  4E75                    1216              RTS
00001998                          1217  
00001998                          1218  ; -----------------------------------------------------------------------------
00001998                          1219  STAUPD
00001998                          1220  ; PERFORMS STATE UPDATE AND INIT IF NECESSARY
00001998                          1221  ; INPUT    - NONE
00001998                          1222  ; OUTPUT   - NONE
00001998                          1223  ; MODIFIES - NONE
00001998                          1224  ; -----------------------------------------------------------------------------
00001998  48E7 8080               1225              MOVEM.L D0/A0,-(A7)
0000199C  4280                    1226              CLR.L   D0
0000199E  3039 00002ACE           1227              MOVE.W  (STANEXT),D0
000019A4  B079 00002ACC           1228              CMP.W   (STACUR),D0
000019AA  6700 0012               1229              BEQ     .DOUPD
000019AE  33C0 00002ACC           1230              MOVE.W  D0,(STACUR)             ; IF STATE CHANGED, DO INIT
000019B4  E588                    1231              LSL.L   #2,D0
000019B6  2040                    1232              MOVE.L  D0,A0
000019B8  2068 19D6               1233              MOVE.L  .INITBL(A0),A0
000019BC  4E90                    1234              JSR     (A0)
000019BE  4280                    1235  .DOUPD      CLR.L   D0                      ; IN ANY CASE, DO UPDATE
000019C0  3039 00002ACC           1236              MOVE.W  (STACUR),D0
000019C6  E588                    1237              LSL.L   #2,D0
000019C8  2040                    1238              MOVE.L  D0,A0
000019CA  2068 19E2               1239              MOVE.L  .UPDTBL(A0),A0
000019CE  4E90                    1240              JSR     (A0)
000019D0  4CDF 0101               1241              MOVEM.L (A7)+,D0/A0
000019D4  4E75                    1242              RTS
000019D6= 00001A18 00001B8E ...   1243  .INITBL     DC.L    STAMMI,STAGPI,STADMI
000019E2= 00001A32 00001B9E ...   1244  .UPDTBL     DC.L    STAMMU,STAGPU,STADMU
000019EE                          1245  
000019EE                          1246  ; -----------------------------------------------------------------------------
000019EE                          1247  STAPLOT
000019EE                          1248  ; PERFORMS STATE PLOT
000019EE                          1249  ; INPUT    - NONE
000019EE                          1250  ; OUTPUT   - NONE
000019EE                          1251  ; MODIFIES - NONE
000019EE                          1252  ; -----------------------------------------------------------------------------
000019EE  48E7 8080               1253              MOVEM.L D0/A0,-(A7)
000019F2  4280                    1254              CLR.L   D0
000019F4  3039 00002ACC           1255              MOVE.W  (STACUR),D0
000019FA  E588                    1256              LSL.L   #2,D0
000019FC  2040                    1257              MOVE.L  D0,A0
000019FE  2068 1A0A               1258              MOVE.L  .PLTTBL(A0),A0
00001A02  4E90                    1259              JSR     (A0)
00001A04  4CDF 0101               1260              MOVEM.L (A7)+,D0/A0
00001A08  4E75                    1261              RTS
00001A0A= 00001AA8 00001BAE ...   1262  .PLTTBL     DC.L    STAMMP,STAGPP,STADMP
00001A16                          1263  
00001A16                          1264  ; -----------------------------------------------------------------------------
00001A16                          1265  STAEMPTY
00001A16                          1266  ; EMPTY SUBROUTINE FOR CASES WITH NOTHING TO DO
00001A16                          1267  ; INPUT    - NONE
00001A16                          1268  ; OUTPUT   - NONE
00001A16                          1269  ; MODIFIES - NONE
00001A16                          1270  ; NOTE     - JUST A PLACEHOLDER. NOTHING TO DO.
00001A16                          1271  ; -----------------------------------------------------------------------------
00001A16  4E75                    1272              RTS
00001A18                          1273  STAMMI
00001A18                          1274  ; STATE MAIN MENU INIT
00001A18  2F00                    1275              MOVE.L  D0, -(A7)
00001A1A  303C 0007               1276              MOVE.W  #7, D0
00001A1E  4EB8 1598               1277              JSR     AGLFKIL
00001A22  201F                    1278              MOVE.L  (A7)+, D0
00001A24  4279 00002ADE           1279              CLR     (LEVEL)
00001A2A  4279 00002AD2           1280              CLR     (TORCHSHADDER)
00001A30  4E75                    1281              RTS
00001A32                          1282  
00001A32                          1283  STAMMU
00001A32                          1284  ; STATE MAIN MENU UPDATE
00001A32  48E7 F000               1285              MOVEM.L D0-D3, -(A7)
00001A36                          1286  
00001A36  303C 003C               1287              MOVE.W  #60, D0
00001A3A  323C 0012               1288              MOVE.W  #%00010010, D1  ; ACTIVATE MOUSE IRQ TO MOUSE DOWN AND UP
00001A3E  4E4F                    1289              TRAP    #15
00001A40                          1290              
00001A40                          1291          
00001A40  303C 003D               1292              MOVE.W  #61, D0
00001A44  4241                    1293              CLR     D1
00001A46  4E4F                    1294              TRAP    #15             
00001A48                          1295          
00001A48  B03C 0000               1296              CMP.B   #0, D0          ; CHECK IF LEFT BUTTON OF MOUSE IS PRESSED
00001A4C  6700 0054               1297              BEQ     .END            ; NOT PRESSED
00001A50  2601                    1298              MOVE.L  D1, D3
00001A52  E08B                    1299              LSR.L   #8, D3
00001A54  E08B                    1300              LSR.L   #8, D3
00001A56                          1301  
00001A56  B67C 0163               1302              CMP.W    #(BUTTONY-BUTTONHEIGH), D3
00001A5A  6F00 0046               1303              BLE     .END
00001A5E  B67C 01BD               1304              CMP.W   #(BUTTONY+BUTTONHEIGH), D3 
00001A62  6C00 003E               1305              BGE     .END
00001A66                          1306              
00001A66                          1307              
00001A66                          1308              ; RIGHT X COORDINATE 
00001A66                          1309              
00001A66  B27C 0085               1310              CMP.W   #(BUTTONX1-BUTTONWIDTH), D1    ; X COORDINATE
00001A6A  6F00 0016               1311              BLE     .X2
00001A6E  B27C 0125               1312              CMP.W   #(BUTTONX1+BUTTONWIDTH), D1   
00001A72  6C00 000E               1313              BGE     .X2
00001A76                          1314              ; EASY
00001A76  33FC 0001 00002ACE      1315              MOVE.W  #STAGP, (STANEXT)
00001A7E  6000 0022               1316              BRA     .END
00001A82                          1317  
00001A82  B27C 015A               1318  .X2         CMP.W   #(BUTTONX2-BUTTONWIDTH), D1    ; X COORDINATE
00001A86  6F00 001A               1319              BLE     .END
00001A8A  B27C 01FA               1320              CMP.W   #(BUTTONX2+BUTTONWIDTH), D1   
00001A8E  6C00 0012               1321              BGE     .END
00001A92                          1322              ; NORMAL
00001A92  33FC 0001 00002AD2      1323              MOVE.W  #1, (TORCHSHADDER)
00001A9A  33FC 0001 00002ACE      1324              MOVE.W  #STAGP, (STANEXT)
00001AA2                          1325  .END        
00001AA2  4CDF 000F               1326              MOVEM.L (A7)+, D0-D3
00001AA6  4E75                    1327              RTS
00001AA8                          1328  
00001AA8                          1329  STAMMP
00001AA8                          1330  ; STATE MAIN MENU PLOT
00001AA8  48E7 C040               1331              MOVEM.L D0-D1/A1, -(A7)
00001AAC  323C 1C05               1332              MOVE.W  #((80-24)/2)<<8|5, D1
00001AB0  103C 000B               1333              MOVE.B  #11, D0
00001AB4  4E4F                    1334              TRAP    #15
00001AB6  43F8 1256               1335              LEA     TITLESTRING, A1
00001ABA  303C 000D               1336              MOVE.W  #13, D0
00001ABE  4E4F                    1337              TRAP    #15
00001AC0                          1338  
00001AC0  4281                    1339              CLR.L   D1
00001AC2  323C 1D07               1340              MOVE.W  #((80-22)/2)<<8|7, D1
00001AC6  103C 000B               1341              MOVE.B  #11, D0
00001ACA  4E4F                    1342              TRAP    #15
00001ACC  43F8 126F               1343              LEA     SUBTITLESTR, A1
00001AD0  303C 000D               1344              MOVE.W  #13, D0
00001AD4  4E4F                    1345              TRAP    #15
00001AD6                          1346  
00001AD6  4281                    1347              CLR.L   D1
00001AD8  323C 1D08               1348              MOVE.W  #((80-22)/2)<<8|8, D1
00001ADC  103C 000B               1349              MOVE.B  #11, D0
00001AE0  4E4F                    1350              TRAP    #15
00001AE2  43F8 129B               1351              LEA     BECARESTR, A1
00001AE6  303C 000D               1352              MOVE.W  #13, D0
00001AEA  4E4F                    1353              TRAP    #15
00001AEC                          1354  
00001AEC                          1355              
00001AEC                          1356  
00001AEC  0839 0004 00001E2F      1357              BTST.B  #4, (SCRCYCCT)  ; TIMER 
00001AF4  6700 0092               1358              BEQ     .END
00001AF8                          1359              
00001AF8                          1360              
00001AF8                          1361m             UTILFILL #$00000000
00001AF8                          1362m ;   IN:  #$00000000 AS THE COLOR, FORMATED AS #00BBGGRR
00001AF8                          1363m ;   OUT: NONE
00001AF8                          1364m ;   MOD: D0, D1
00001AF8                          1365m ;   DES: MACRO TO SET FILL COLOR
00001AF8                          1366m 
00001AF8  103C 0051               1367m         MOVE.B  #81, D0
00001AFC  7200                    1368m         MOVE.L  #$00000000, D1
00001AFE  4E4F                    1369m         TRAP    #15
00001B00                          1370m         ENDM
00001B00                          1371m             UTILPEN #$00FFFFFF
00001B00                          1372m ;   IN:  #$00FFFFFF AS THE COLOR, FORMATED AS #00BBGGRR
00001B00                          1373m ;   OUT: NONE
00001B00                          1374m ;   MOD: D0, D1    
00001B00                          1375m ;   DES: MACRO TO SET PEN COLOR
00001B00                          1376m 
00001B00  103C 0050               1377m         MOVE.B  #80, D0 
00001B04  223C 00FFFFFF           1378m         MOVE.L  #$00FFFFFF, D1
00001B0A  4E4F                    1379m         TRAP    #15
00001B0C                          1380m         ENDM
00001B0C  323C 00D5               1381              MOVE.W  #BUTTONX1, D1
00001B10  343C 0190               1382              MOVE.W  #BUTTONY, D2
00001B14  3601                    1383              MOVE.W  D1, D3
00001B16  3802                    1384              MOVE.W  D2, D4 
00001B18  0441 0028               1385              SUB.W   #BUTTONWIDTH/2, D1              ; SET TOP LEFT CORNER
00001B1C  0442 0016               1386              SUB.W   #BUTTONHEIGH/2, D2              ; SET TOP LEFT CORNER 
00001B20  0643 0028               1387              ADD.W   #BUTTONWIDTH/2, D3              ; SET LOW RIGHT CORNER
00001B24  0644 0016               1388              ADD.W   #BUTTONHEIGH/2, D4              ; SET LOW RIGHT CORNER
00001B28                          1389  
00001B28  303C 0057               1390              MOVE.W  #87, D0
00001B2C  4E4F                    1391              TRAP    #15                             ; DRAW RECTANGLE
00001B2E                          1392  
00001B2E  43F8 12BD               1393              LEA     EASYSTR, A1
00001B32  323C 00C5               1394              MOVE.W  #BUTTONX1-16, D1
00001B36  343C 0189               1395              MOVE.W  #BUTTONY-7, D2
00001B3A                          1396  
00001B3A  303C 005F               1397              MOVE.W  #95, D0
00001B3E  4E4F                    1398              TRAP    #15
00001B40                          1399  
00001B40                          1400              ; END
00001B40                          1401m             UTILFILL #$00000000
00001B40                          1402m ;   IN:  #$00000000 AS THE COLOR, FORMATED AS #00BBGGRR
00001B40                          1403m ;   OUT: NONE
00001B40                          1404m ;   MOD: D0, D1
00001B40                          1405m ;   DES: MACRO TO SET FILL COLOR
00001B40                          1406m 
00001B40  103C 0051               1407m         MOVE.B  #81, D0
00001B44  7200                    1408m         MOVE.L  #$00000000, D1
00001B46  4E4F                    1409m         TRAP    #15
00001B48                          1410m         ENDM
00001B48                          1411m             UTILPEN #$00FFFFFF
00001B48                          1412m ;   IN:  #$00FFFFFF AS THE COLOR, FORMATED AS #00BBGGRR
00001B48                          1413m ;   OUT: NONE
00001B48                          1414m ;   MOD: D0, D1    
00001B48                          1415m ;   DES: MACRO TO SET PEN COLOR
00001B48                          1416m 
00001B48  103C 0050               1417m         MOVE.B  #80, D0 
00001B4C  223C 00FFFFFF           1418m         MOVE.L  #$00FFFFFF, D1
00001B52  4E4F                    1419m         TRAP    #15
00001B54                          1420m         ENDM
00001B54  323C 01AA               1421              MOVE.W  #BUTTONX2, D1
00001B58  343C 0190               1422              MOVE.W  #BUTTONY, D2
00001B5C  3601                    1423              MOVE.W  D1, D3
00001B5E  3802                    1424              MOVE.W  D2, D4 
00001B60  0441 0028               1425              SUB.W   #BUTTONWIDTH/2, D1              ; SET TOP LEFT CORNER
00001B64  0442 0016               1426              SUB.W   #BUTTONHEIGH/2, D2              ; SET TOP LEFT CORNER 
00001B68  0643 0028               1427              ADD.W   #BUTTONWIDTH/2, D3              ; SET LOW RIGHT CORNER
00001B6C  0644 0016               1428              ADD.W   #BUTTONHEIGH/2, D4              ; SET LOW RIGHT CORNER
00001B70                          1429  
00001B70  303C 0057               1430              MOVE.W  #87, D0
00001B74  4E4F                    1431              TRAP    #15                             ; DRAW RECTANGLE
00001B76                          1432  
00001B76  43F8 12C2               1433              LEA     NORMALSTR, A1
00001B7A  323C 0194               1434              MOVE.W  #BUTTONX2-22, D1
00001B7E  343C 0189               1435              MOVE.W  #BUTTONY-7, D2
00001B82                          1436  
00001B82  303C 005F               1437              MOVE.W  #95, D0
00001B86  4E4F                    1438              TRAP    #15
00001B88                          1439  .END    
00001B88  4CDF 0203               1440              MOVEM.L (A7)+, D0-D1/A1
00001B8C                          1441             ;  UTILTEXT NEXTSTR, #SCRWIDTH/2, #SCRHEIGH-30
00001B8C  4E75                    1442              RTS
00001B8E                          1443  
00001B8E                          1444  STAGPI
00001B8E                          1445  ; STAGE INIT
00001B8E  4EB8 14C6               1446              JSR     RNDINIT
00001B92  4EB8 15BA               1447              JSR     PLAYERINIT
00001B96  4EB8 16F4               1448              JSR     KEYINIT
00001B9A  4EF8 1780               1449              JMP     STAIRSINIT
00001B9E                          1450             
00001B9E                          1451  
00001B9E                          1452  STAGPU
00001B9E                          1453  ; STAGE UPDATE
00001B9E  4EB8 15CC               1454              JSR     PLAYERUPDT
00001BA2  4EB8 170E               1455              JSR     KEYUPDT
00001BA6  4EB8 17A0               1456              JSR     STAIRSUPDT
00001BAA  4EF8 154E               1457              JMP     AGLUPDT
00001BAE                          1458  
00001BAE                          1459  STAGPP
00001BAE                          1460  ; STAGE PLOT
00001BAE  4EB8 16B6               1461              JSR     MAPPLOT
00001BB2  4EB8 166A               1462              JSR     PLAYERPLOT
00001BB6  4EB8 1738               1463              JSR     KEYPLOT
00001BBA  4EB8 1828               1464              JSR     STAIRSPLOT
00001BBE                          1465              
00001BBE  4EB8 1572               1466              JSR     AGLPLOT
00001BC2  0C79 0000 00002AD2      1467              CMP     #0, (TORCHSHADDER)
00001BCA  6700 0008               1468              BEQ     .END
00001BCE  4EB9 00001D52           1469              JSR     SHADDERPLOT
00001BD4                          1470              
00001BD4                          1471  .END        
00001BD4  4EB8 192C               1472              JSR     MISCPLOT
00001BD8  4E75                    1473              RTS
00001BDA                          1474  
00001BDA                          1475  STADMI
00001BDA                          1476  ; STATE DEATH MENU INIT
00001BDA                          1477  
00001BDA  4E75                    1478              RTS
00001BDC                          1479  
00001BDC                          1480  STADMU
00001BDC                          1481  ; STATE DEATH MENU UPDATE
00001BDC  48E7 F000               1482              MOVEM.L D0-D3, -(A7)
00001BE0                          1483  
00001BE0  303C 003C               1484              MOVE.W  #60, D0
00001BE4  323C 0012               1485              MOVE.W  #%00010010, D1  ; ACTIVATE MOUSE IRQ TO MOUSE DOWN AND UP
00001BE8  4E4F                    1486              TRAP    #15
00001BEA                          1487              
00001BEA                          1488          
00001BEA  303C 003D               1489              MOVE.W  #61, D0
00001BEE  4241                    1490              CLR     D1
00001BF0  4E4F                    1491              TRAP    #15             
00001BF2                          1492          
00001BF2  B03C 0000               1493              CMP.B   #0, D0          ; CHECK IF LEFT BUTTON OF MOUSE IS PRESSED
00001BF6  6700 004A               1494              BEQ     .END            ; NOT PRESSED
00001BFA  2601                    1495              MOVE.L  D1, D3
00001BFC  E08B                    1496              LSR.L   #8, D3
00001BFE  E08B                    1497              LSR.L   #8, D3
00001C00                          1498  
00001C00  B67C 0163               1499              CMP.W    #(BUTTONY-BUTTONHEIGH), D3
00001C04  6F00 003C               1500              BLE     .END
00001C08  B67C 01BD               1501              CMP.W   #(BUTTONY+BUTTONHEIGH), D3 
00001C0C  6C00 0034               1502              BGE     .END
00001C10                          1503              
00001C10                          1504              
00001C10                          1505              ; RIGHT X COORDINATE 
00001C10                          1506              
00001C10  B27C 0085               1507              CMP.W   #(BUTTONX1-BUTTONWIDTH), D1    ; X COORDINATE
00001C14  6F00 0016               1508              BLE     .X2
00001C18  B27C 0125               1509              CMP.W   #(BUTTONX1+BUTTONWIDTH), D1   
00001C1C  6C00 000E               1510              BGE     .X2
00001C20                          1511              ; RETRY
00001C20  33FC 0000 00002ACE      1512              MOVE.W  #STAMM, (STANEXT)
00001C28  6000 0018               1513              BRA     .END
00001C2C                          1514  
00001C2C  B27C 015A               1515  .X2         CMP.W   #(BUTTONX2-BUTTONWIDTH), D1    ; X COORDINATE
00001C30  6F00 0010               1516              BLE     .END
00001C34  B27C 01FA               1517              CMP.W   #(BUTTONX2+BUTTONWIDTH), D1   
00001C38  6C00 0008               1518              BGE     .END
00001C3C                          1519              ; EXIT
00001C3C                          1520  
00001C3C  4EB9 00001E28           1521              JSR     LOOSE
00001C42                          1522  .END        
00001C42  4CDF 000F               1523              MOVEM.L (A7)+, D0-D3
00001C46  4E75                    1524              RTS
00001C48                          1525  
00001C48                          1526  STADMP
00001C48                          1527  ; STATE DEATH MENU PLOT
00001C48  48E7 F840               1528          MOVEM.L D0-D4/A1, -(A7)
00001C4C                          1529              ; -- BLACK SQUARE ---
00001C4C                          1530m         UTILPEN #0                       
00001C4C                          1531m ;   IN:  #0 AS THE COLOR, FORMATED AS #00BBGGRR
00001C4C                          1532m ;   OUT: NONE
00001C4C                          1533m ;   MOD: D0, D1    
00001C4C                          1534m ;   DES: MACRO TO SET PEN COLOR
00001C4C                          1535m 
00001C4C  103C 0050               1536m         MOVE.B  #80, D0 
00001C50  7200                    1537m         MOVE.L  #0, D1
00001C52  4E4F                    1538m         TRAP    #15
00001C54                          1539m         ENDM
00001C54                          1540m         UTILFILL #0
00001C54                          1541m ;   IN:  #0 AS THE COLOR, FORMATED AS #00BBGGRR
00001C54                          1542m ;   OUT: NONE
00001C54                          1543m ;   MOD: D0, D1
00001C54                          1544m ;   DES: MACRO TO SET FILL COLOR
00001C54                          1545m 
00001C54  103C 0051               1546m         MOVE.B  #81, D0
00001C58  7200                    1547m         MOVE.L  #0, D1
00001C5A  4E4F                    1548m         TRAP    #15
00001C5C                          1549m         ENDM
00001C5C                          1550  
00001C5C  323C 0000               1551          MOVE.W  #0, D1               ; D1 = X CENTER
00001C60  343C 0000               1552          MOVE.W  #0, D2               ; D1 = Y CENTER
00001C64  363C 0280               1553          MOVE.W  #SCRWIDTH, D3
00001C68  383C 01E0               1554          MOVE.W  #SCRHEIGH, D4
00001C6C                          1555  
00001C6C  303C 0057               1556          MOVE.W  #87, D0
00001C70  4E4F                    1557          TRAP    #15
00001C72                          1558  
00001C72                          1559          ; --- TEXT ---
00001C72                          1560m         UTILFILL #0
00001C72                          1561m ;   IN:  #0 AS THE COLOR, FORMATED AS #00BBGGRR
00001C72                          1562m ;   OUT: NONE
00001C72                          1563m ;   MOD: D0, D1
00001C72                          1564m ;   DES: MACRO TO SET FILL COLOR
00001C72                          1565m 
00001C72  103C 0051               1566m         MOVE.B  #81, D0
00001C76  7200                    1567m         MOVE.L  #0, D1
00001C78  4E4F                    1568m         TRAP    #15
00001C7A                          1569m         ENDM
00001C7A  323C 1705               1570          MOVE.W  #((80-34)/2)<<8|5, D1
00001C7E  103C 000B               1571          MOVE.B  #11, D0
00001C82  4E4F                    1572          TRAP    #15
00001C84  43F8 11EF               1573          LEA     DEATHSTRING, A1
00001C88  303C 000D               1574          MOVE.W  #13, D0
00001C8C  4E4F                    1575          TRAP    #15
00001C8E                          1576  
00001C8E                          1577         
00001C8E  33FC 0001 00002AD4      1578          MOVE.W  #1, (DEATHTEXT2)    
00001C96  4281                    1579          CLR.L   D1
00001C98  323C 0B07               1580          MOVE.W  #((80-58)/2)<<8|7, D1
00001C9C  103C 000B               1581          MOVE.B  #11, D0
00001CA0  4E4F                    1582          TRAP    #15
00001CA2  43F8 1212               1583          LEA     SUSSERTOD, A1
00001CA6  303C 000D               1584          MOVE.W  #13, D0
00001CAA  4E4F                    1585          TRAP    #15
00001CAC                          1586  
00001CAC                          1587          ; BUTTONS
00001CAC  0839 0004 00001E2F      1588          BTST.B  #4, (SCRCYCCT)  ; TIMER 
00001CB4  6700 0092               1589          BEQ     .END
00001CB8                          1590          ; RETRY
00001CB8                          1591m         UTILFILL #$00000000
00001CB8                          1592m ;   IN:  #$00000000 AS THE COLOR, FORMATED AS #00BBGGRR
00001CB8                          1593m ;   OUT: NONE
00001CB8                          1594m ;   MOD: D0, D1
00001CB8                          1595m ;   DES: MACRO TO SET FILL COLOR
00001CB8                          1596m 
00001CB8  103C 0051               1597m         MOVE.B  #81, D0
00001CBC  7200                    1598m         MOVE.L  #$00000000, D1
00001CBE  4E4F                    1599m         TRAP    #15
00001CC0                          1600m         ENDM
00001CC0                          1601m         UTILPEN #$00FFFFFF
00001CC0                          1602m ;   IN:  #$00FFFFFF AS THE COLOR, FORMATED AS #00BBGGRR
00001CC0                          1603m ;   OUT: NONE
00001CC0                          1604m ;   MOD: D0, D1    
00001CC0                          1605m ;   DES: MACRO TO SET PEN COLOR
00001CC0                          1606m 
00001CC0  103C 0050               1607m         MOVE.B  #80, D0 
00001CC4  223C 00FFFFFF           1608m         MOVE.L  #$00FFFFFF, D1
00001CCA  4E4F                    1609m         TRAP    #15
00001CCC                          1610m         ENDM
00001CCC  323C 00D5               1611          MOVE.W  #BUTTONX1, D1
00001CD0  343C 0190               1612          MOVE.W  #BUTTONY, D2
00001CD4  3601                    1613          MOVE.W  D1, D3
00001CD6  3802                    1614          MOVE.W  D2, D4 
00001CD8  0441 0028               1615          SUB.W   #BUTTONWIDTH/2, D1              ; SET TOP LEFT CORNER
00001CDC  0442 0016               1616          SUB.W   #BUTTONHEIGH/2, D2              ; SET TOP LEFT CORNER 
00001CE0  0643 0028               1617          ADD.W   #BUTTONWIDTH/2, D3              ; SET LOW RIGHT CORNER
00001CE4  0644 0016               1618          ADD.W   #BUTTONHEIGH/2, D4              ; SET LOW RIGHT CORNER
00001CE8                          1619  
00001CE8  303C 0057               1620          MOVE.W  #87, D0
00001CEC  4E4F                    1621          TRAP    #15                             ; DRAW RECTANGLE
00001CEE                          1622  
00001CEE  43F8 12B2               1623          LEA     RETRYSTR, A1
00001CF2  323C 00C2               1624          MOVE.W  #BUTTONX1-19, D1
00001CF6  343C 0189               1625          MOVE.W  #BUTTONY-7, D2
00001CFA                          1626  
00001CFA  303C 005F               1627          MOVE.W  #95, D0
00001CFE  4E4F                    1628          TRAP    #15
00001D00                          1629          
00001D00                          1630          ; END
00001D00                          1631m         UTILFILL #$00000000
00001D00                          1632m ;   IN:  #$00000000 AS THE COLOR, FORMATED AS #00BBGGRR
00001D00                          1633m ;   OUT: NONE
00001D00                          1634m ;   MOD: D0, D1
00001D00                          1635m ;   DES: MACRO TO SET FILL COLOR
00001D00                          1636m 
00001D00  103C 0051               1637m         MOVE.B  #81, D0
00001D04  7200                    1638m         MOVE.L  #$00000000, D1
00001D06  4E4F                    1639m         TRAP    #15
00001D08                          1640m         ENDM
00001D08                          1641m         UTILPEN #$00FFFFFF
00001D08                          1642m ;   IN:  #$00FFFFFF AS THE COLOR, FORMATED AS #00BBGGRR
00001D08                          1643m ;   OUT: NONE
00001D08                          1644m ;   MOD: D0, D1    
00001D08                          1645m ;   DES: MACRO TO SET PEN COLOR
00001D08                          1646m 
00001D08  103C 0050               1647m         MOVE.B  #80, D0 
00001D0C  223C 00FFFFFF           1648m         MOVE.L  #$00FFFFFF, D1
00001D12  4E4F                    1649m         TRAP    #15
00001D14                          1650m         ENDM
00001D14  323C 01AA               1651          MOVE.W  #BUTTONX2, D1
00001D18  343C 0190               1652          MOVE.W  #BUTTONY, D2
00001D1C  3601                    1653          MOVE.W  D1, D3
00001D1E  3802                    1654          MOVE.W  D2, D4 
00001D20  0441 0028               1655          SUB.W   #BUTTONWIDTH/2, D1              ; SET TOP LEFT CORNER
00001D24  0442 0016               1656          SUB.W   #BUTTONHEIGH/2, D2              ; SET TOP LEFT CORNER 
00001D28  0643 0028               1657          ADD.W   #BUTTONWIDTH/2, D3              ; SET LOW RIGHT CORNER
00001D2C  0644 0016               1658          ADD.W   #BUTTONHEIGH/2, D4              ; SET LOW RIGHT CORNER
00001D30                          1659  
00001D30  303C 0057               1660          MOVE.W  #87, D0
00001D34  4E4F                    1661          TRAP    #15                             ; DRAW RECTANGLE
00001D36                          1662  
00001D36  43F8 12B8               1663          LEA     EXITSTR, A1
00001D3A  323C 019A               1664          MOVE.W  #BUTTONX2-16, D1
00001D3E  343C 0189               1665          MOVE.W  #BUTTONY-7, D2
00001D42                          1666  
00001D42  303C 005F               1667          MOVE.W  #95, D0
00001D46  4E4F                    1668          TRAP    #15
00001D48                          1669  .END  
00001D48  4CDF 021F               1670          MOVEM.L (A7)+,D0-D4/A1
00001D4C  4E75                    1671          RTS
00001D4E                          1672  
00001D4E                          1673  
00001D4E                          1674  
00001D4E                          1675  
00001D4E                          1676  -------------------- end include --------------------
00001D4E                          1677              INCLUDE "SHADDER.X68"           ; TORCH SHADDER
00001D4E                          1678  SHADDERINIT
00001D4E                          1679  
00001D4E  4E75                    1680              RTS
00001D50                          1681  SHADDERUPDT
00001D50                          1682  
00001D50  4E75                    1683              RTS
00001D52                          1684  SHADDERPLOT
00001D52  48E7 F800               1685              MOVEM.L D0-D4, -(A7)
00001D56                          1686  
00001D56                          1687m             UTILPEN #TILEDDARK
00001D56                          1688m ;   IN:  #TILEDDARK AS THE COLOR, FORMATED AS #00BBGGRR
00001D56                          1689m ;   OUT: NONE
00001D56                          1690m ;   MOD: D0, D1    
00001D56                          1691m ;   DES: MACRO TO SET PEN COLOR
00001D56                          1692m 
00001D56  103C 0050               1693m         MOVE.B  #80, D0 
00001D5A  223C 0030252D           1694m         MOVE.L  #TILEDDARK, D1
00001D60  4E4F                    1695m         TRAP    #15
00001D62                          1696m         ENDM
00001D62                          1697m             UTILFILL #TILEDDARK
00001D62                          1698m ;   IN:  #TILEDDARK AS THE COLOR, FORMATED AS #00BBGGRR
00001D62                          1699m ;   OUT: NONE
00001D62                          1700m ;   MOD: D0, D1
00001D62                          1701m ;   DES: MACRO TO SET FILL COLOR
00001D62                          1702m 
00001D62  103C 0051               1703m         MOVE.B  #81, D0
00001D66  223C 0030252D           1704m         MOVE.L  #TILEDDARK, D1
00001D6C  4E4F                    1705m         TRAP    #15
00001D6E                          1706m         ENDM
00001D6E                          1707  
00001D6E                          1708  
00001D6E  4241                    1709              CLR     D1                          ; LEFT BORDER
00001D70  4242                    1710              CLR     D2           
00001D72  3639 00002AC0           1711              MOVE.W  (PLAYERX), D3       
00001D78  3A39 00002AD8           1712              MOVE.W  (TORCHRANGE), D5
00001D7E  CAFC 0020               1713              MULU.W  #TILEDIM, D5
00001D82  0645 0010               1714              ADD.W   #(TILEDIM/2), D5      
00001D86  9645                    1715              SUB.W   D5, D3
00001D88  383C 01E0               1716              MOVE.W  #SCRHEIGH, D4
00001D8C  303C 0057               1717              MOVE.W  #87, D0
00001D90  4E4F                    1718              TRAP    #15
00001D92                          1719  
00001D92                          1720                                                  ; RIGHT BORDER
00001D92                          1721                
00001D92  3239 00002AC0           1722              MOVE.W  (PLAYERX), D1   
00001D98  3A39 00002AD8           1723              MOVE.W  (TORCHRANGE), D5
00001D9E  CAFC 0020               1724              MULU.W  #TILEDIM, D5
00001DA2  0645 0010               1725              ADD.W   #(TILEDIM/2), D5 
00001DA6  D245                    1726              ADD.W   D5, D1
00001DA8  363C 0280               1727              MOVE.W  #SCRWIDTH, D3
00001DAC  303C 0057               1728              MOVE.W  #87, D0
00001DB0  4E4F                    1729              TRAP    #15
00001DB2                          1730  
00001DB2                          1731                                                 ; TOP BORDER
00001DB2                          1732                
00001DB2  4241                    1733              CLR     D1
00001DB4  4242                    1734              CLR     D2
00001DB6  363C 0280               1735              MOVE.W  #SCRWIDTH, D3
00001DBA  3839 00002AC2           1736              MOVE.W  (PLAYERY), D4 
00001DC0  3A39 00002AD8           1737              MOVE.W  (TORCHRANGE), D5
00001DC6  CAFC 0020               1738              MULU.W  #TILEDIM, D5
00001DCA  0645 0010               1739              ADD.W   #(TILEDIM/2), D5          
00001DCE  9845                    1740              SUB.W   D5, D4     
00001DD0                          1741             
00001DD0  363C 0280               1742              MOVE.W  #SCRWIDTH, D3
00001DD4  303C 0057               1743              MOVE.W  #87, D0
00001DD8  4E4F                    1744              TRAP    #15
00001DDA                          1745  
00001DDA                          1746                                                 ; BOTTOM BORDER
00001DDA  3439 00002AC2           1747              MOVE.W  (PLAYERY), D2
00001DE0  3A39 00002AD8           1748              MOVE.W  (TORCHRANGE), D5
00001DE6  CAFC 0020               1749              MULU.W  #TILEDIM, D5
00001DEA  0645 0010               1750              ADD.W   #(TILEDIM/2), D5           
00001DEE  D445                    1751              ADD.W   D5, D2     
00001DF0  363C 0280               1752              MOVE.W  #SCRWIDTH, D3
00001DF4  383C 01E0               1753              MOVE.W  #SCRHEIGH, D4
00001DF8  303C 0057               1754              MOVE.W  #87, D0
00001DFC  4E4F                    1755              TRAP    #15
00001DFE                          1756  
00001DFE  4CDF 001F               1757              MOVEM.L (A7)+, D0-D4
00001E02  4E75                    1758              RTS
00001E02  4E75                    1759  -------------------- end include --------------------
00001E04                          1760              
00001E04                          1761  
00001E04                          1762  ; --- INITIALIZE --------------------------------------------------------------
00001E04                          1763  
00001E04                          1764  START                                       ; INITIALIZE SYSTEM-RELATED STUFF
00001E04  4EB8 1000               1765              JSR     SYSINIT 
00001E08  4EB8 1986               1766              JSR     STAINIT
00001E0C                          1767              
00001E0C                          1768  ; --- UPDATE ------------------------------------------------------------------
00001E0C                          1769  
00001E0C  4E40                    1770  .LOOP       TRAP    #KBDTRAP                ; READ KEYBOARD
00001E0E  4EB8 1998               1771              JSR     STAUPD
00001E12                          1772              
00001E12                          1773  ; --- WAIT SYNCH --------------------------------------------------------------
00001E12                          1774  
00001E12  4A39 00001E2E           1775  .WINT       TST.B   (SCRINTCT)              ; WAIT FOR INTERRUPT
00001E18  67F8                    1776              BEQ     .WINT
00001E1A  4239 00001E2E           1777              CLR.B   (SCRINTCT)
00001E20                          1778  
00001E20                          1779  ; --- PLOT --------------------------------------------------------------------
00001E20                          1780  
00001E20  4EB8 19EE               1781              JSR     STAPLOT
00001E24  4E41                    1782              TRAP    #SCRTRAP                ; SHOW GRAPHICS
00001E26  60E4                    1783              BRA     .LOOP                   ; MAIN LOOP
00001E28                          1784  
00001E28                          1785  ; --- DEATH -------------------------------------------------------------------
00001E28                          1786  LOOSE
00001E28  FFFF FFFF               1787              SIMHALT
00001E2C                          1788  
00001E2C                          1789  ; --- VARIABLES ---------------------------------------------------------------
00001E2C                          1790  
00001E2C                          1791              INCLUDE "SYSVAR.X68"
00001E2C                          1792  ; =============================================================================
00001E2C                          1793  ; TITLE    : SYSTEM VARIABLES
00001E2C                          1794  ; AUTHOR   : ANTONI BURGUERA
00001E2C                          1795  ; COMMENTS : NOTE THAT ALL THESE VARS ARE USED TO SHARE DATA FROM SYSTEM TO
00001E2C                          1796  ;            USER. THUS THEY MUST NOT BE IN PROTECTED MEMORY.
00001E2C                          1797  ;            NOTE THAT USING DMMDATA IN SUCH WAY IS A BAD IDEA, AS USER
00001E2C                          1798  ;            APPLICATIONS CAN ALSO FREE OR CHANGE OWNERSHIP. NONETHELESS, FOR
00001E2C                          1799  ;            THE SAKE OF THIS EXAMPLE THIS IS GOOD ENOUGH.
00001E2C                          1800  ; HISTORY  : XX-XXX-201X - CREATION
00001E2C                          1801  ;            11-OCT-2020 - MINOR CHANGES
00001E2C                          1802  ; =============================================================================
00001E2C                          1803  
00001E2C                          1804  ; --- KEYBOARD RELATED VARIABLES ----------------------------------------------
00001E2C                          1805  
00001E2C                          1806  KBDVAL      DS.B    1                       ; KEY PRESSED=1
00001E2D                          1807  KBDEDGE     DS.B    1                       ; KEY CHANGED=1
00001E2E                          1808  
00001E2E                          1809              DS.W    0
00001E2E                          1810  
00001E2E                          1811  ; --- SCREEN RELATED VARIABLES ------------------------------------------------
00001E2E                          1812  
00001E2E                          1813  SCRINTCT    DS.B    1                       ; INTERRUPT COUNTER/FLAG
00001E2F                          1814  SCRCYCCT    DS.B    1                       ; CYCLE COUNTER
00001E30                          1815              DS.W    0
00001E30                          1816  
00001E30                          1817  ; --- DYNAMIC MEMORY VARIABLES ------------------------------------------------
00001E30                          1818  
00001E40                          1819              ORG     (*+DMMBSIZE-1)&-DMMBSIZE ; ALIGN TO DMMBSIZE
00001E40                          1820  DMMDATA     DS.B    DMMBSIZE*DMMBNUM        ; DYNAMIC MEMORY ALLOCATION SPACE
00002AC0                          1821              DS.W    0                       ; JUST IN CASE (SIZE IS POW OF TWO)
00002AC0                          1822  -------------------- end include --------------------
00002AC0                          1823              INCLUDE "VAR.X68"
00002AC0                          1824  ; =============================================================================
00002AC0                          1825  ; TITLE    : GAME VARIABLES
00002AC0                          1826  ; AUTHOR   :
00002AC0                          1827  ; HISTORY  :
00002AC0                          1828  ; =============================================================================
00002AC0                          1829  
00002AC0                          1830  ; POSITION
00002AC0                          1831  PLAYERX     DS.W    1   ; PLAYER X COORDINATE
00002AC2                          1832  PLAYERY     DS.W    1   ; PLAYER Y COORDINATE
00002AC4                          1833  
00002AC4                          1834  KEYX        DS.W    1   ; KEY X COORDINATE
00002AC6                          1835  KEYY        DS.W    1   ; KEY Y COORDINATE
00002AC8                          1836  
00002AC8                          1837  STAIRSX     DS.W    1   ; STAIRS X COORDINATE
00002ACA                          1838  STAIRSY     DS.W    1   ; STAIRS Y COORDINATE
00002ACC                          1839  
00002ACC                          1840  STACUR      DS.W    1   ; CURRENT STATE
00002ACE                          1841  STANEXT     DS.W    1   ; NEXT STATE 
00002AD0                          1842  
00002AD0                          1843  ; BOOLEAN
00002AD0= 0000                    1844  KEYOBTEINED DC.W    0   ; "BOOLEAN" VALUE, SELF EXPLANATORY 
00002AD2= 0000                    1845  TORCHSHADDER DC.W   0   ; "BOOLEAN" VALUE TO SEEE IF SHADDER IS APPLIED OR NOT
00002AD4= 0000                    1846  DEATHTEXT2  DC.W    0   ; "BOOLEAN" DEATH STRING SHOW 
00002AD6= 0000                    1847  ONSTAIRS    DC.W    0   ; "BOOLEAN" VALUE TO TRACK IF PLAYER IS ON STAIRS
00002AD8                          1848  
00002AD8= 0001                    1849  TORCHRANGE  DC.W    1   ; 
00002ADA                          1850  ; ARRAY 
00002ADA                          1851  RNGXINDEX   DS.W    1   ; INDEX FOR THE X COORDINATE ON THE PSEUDO RANDOM GENERATOR
00002ADC                          1852  RNGYINDEX   DS.W    1   ; INDEX FOR THE Y COORDINATE ON THE PSEUDO RANDOM GENERATOR
00002ADE                          1853  
00002ADE= 0000                    1854  LEVEL       DC.W    0   ; LEVEL COUNTER
00002AE0= 0002                    1855  SHADDERRANGE DC.W   2   ; SHADDER RANGE
00002AE2                          1856  ; AUDIO
00002AE2                          1857  AUDIOACCSND DS.B    1   ; ACCEPT NEW SOUNDS 
00002AE4                          1858              DS.W    0
00002AE4                          1859  
00002AE4                          1860  
00002AE4                          1861  
00002AE4                          1862  
00002AE4                          1863  -------------------- end include --------------------
00002AE4                          1864              END    START

No errors detected
No warnings generated


SYMBOL TABLE INFORMATION
Symbol-name         Value
-------------------------
AGLADD              1534
AGLADD:END          154A
AGLFKIL             1598
AGLFKIL:END         15B4
AGLFKIL:LOOP        15A0
AGLKILL             11C0
AGLPLOT             1572
AGLPLOT:END         1592
AGLPLOT:LOOP        157A
AGLUPDT             154E
AGLUPDT:END         156C
AGLUPDT:LOOP        1556
AUDIOACCSND         2AE2
AUDIOACCY           FF
AUDIOCLKID          7
AUDIODIEDID         6
AUDIOKEYID          3
AUDIOLOOP           80
AUDIOMOVEID         2
AUDIOMUS1ID         0
AUDIOMUS2ID         1
AUDIONLOP           0
AUDIOSCCN           0
AUDIOSTARID         4
AUDIOSTOP           FF
AUDIOTALKID         5
BECARESTR           129B
BUTTONHEIGH         2D
BUTTONWIDTH         50
BUTTONX1            D5
BUTTONX2            1AA
BUTTONY             190
DEATHSTRING         11EF
DEATHTEXT2          2AD4
DMMALLOC            11A6
DMMALLOC:END        11BE
DMMBNUM             32
DMMBSIZE            40
DMMDATA             1E40
DMMFCOM             1180
DMMFFND             118E
DMMFIRST            1136
DMMFLOOP            1174
DMMFRCOM            1148
DMMFREE             11C0
DMMFRFND            1156
DMMFRLOP            113C
DMMFRSTO            116E
DMMINIT             1114
DMMINIT:LOOP        1122
DMMNEXT             1158
DMMNEXTO            1190
DMMSYSID            0
EASYSTR             12BD
EMPTYID             1
ENEMYID             7
ENEMYINIT           18A6
ENEMYMAXCNT         C
ENEMYPLOT           18E6
ENEMYUPDT           18C2
ENEMYUPDT:END       18E0
EXITSTR             12B8
FLOORID             3
KBDBITDN            3
KBDBITF1            4
KBDBITF2            5
KBDBITF3            6
KBDBITLF            0
KBDBITPS            7
KBDBITRT            2
KBDBITUP            1
KBDCHRDN            28
KBDCHRLF            25
KBDCHRMK            4D
KBDCHRPK            50
KBDCHRRT            27
KBDCHRSH            10
KBDCHRSP            20
KBDCHRUP            26
KBDDOWN             28
KBDEDGE             1E2D
KBDFIRE1            20
KBDFIRE2            4D
KBDFIRE3            10
KBDINIT             10B4
KBDLEFT             25
KBDMSKDN            8
KBDMSKF1            10
KBDMSKF2            20
KBDMSKF3            40
KBDMSKLF            1
KBDMSKPS            80
KBDMSKRT            4
KBDMSKUP            2
KBDPAUSE            50
KBDREAD             10CA
KBDREAD:LOOP        110A
KBDREAD:STORE       1106
KBDRIGHT            27
KBDTRAP             0
KBDUP               26
KBDVAL              1E2C
KEYID               5
KEYINIT             16F4
KEYOBTEINED         2AD0
KEYPLOT             1738
KEYPLOT:NOKEY       177E
KEYUPDT             170E
KEYUPDT:END         1732
KEYX                2AC4
KEYY                2AC6
LEVEL               2ADE
LEVELSTRING         124D
LOOSE               1E28
MAPINIT             16B2
MAPPLOT             16B6
MAPUPDT             16B4
MISCINIT            1928
MISCPLOT            192C
MISCPLOT:END        1984
MISCPLOT:LVLPLOT    193A
MISCPLOT:NOOKEYPLOT  195E
MISCUPDT            192A
NEXTSTR             1286
NOKEYSTRING         11D6
NORMALSTR           12C2
ONSTAIRS            2AD6
PLAYERINIT          15BA
PLAYERPLOT          166A
PLAYERUPDT          15CC
PLAYERUPDT:END      1668
PLAYERUPDT:MOVED    1652
PLAYERUPDT:MOVEL    160A
PLAYERUPDT:MOVER    1622
PLAYERUPDT:MOVEU    163A
PLAYERUPDT:RMVED    1660
PLAYERUPDT:RMVEL    1618
PLAYERUPDT:RMVER    1630
PLAYERUPDT:RMVEU    1648
PLAYERX             2AC0
PLAYERY             2AC2
PLYRID              6
RETRYSTR            12B2
RNDINIT             14C6
RNGX                14D4
RNGX:NOVERFLOW      1500
RNGXINDEX           2ADA
RNGY                1504
RNGY:NOVERFLOW      1530
RNGYINDEX           2ADC
SCRCYCCT            1E2F
SCRHEIGH            1E0
SCRINIT             101C
SCRINTCT            1E2E
SCRIRQ              1
SCRISR              108C
SCRTIM              14
SCRTRAP             1
SCRUPD              109A
SCRWIDTH            280
SHADDERINIT         1D4E
SHADDERPLOT         1D52
SHADDERRANGE        2AE0
SHADDERUPDT         1D50
STACUR              2ACC
STADM               2
STADMI              1BDA
STADMP              1C48
STADMP:END          1D48
STADMU              1BDC
STADMU:END          1C42
STADMU:X2           1C2C
STAEMPTY            1A16
STAGP               1
STAGPI              1B8E
STAGPP              1BAE
STAGPP:END          1BD4
STAGPU              1B9E
STAINIT             1986
STAIRID             4
STAIRSINIT          1780
STAIRSPLOT          1828
STAIRSPLOT:END      18A0
STAIRSPLOT:KEYOBTEINED  187A
STAIRSUPDT          17A0
STAIRSUPDT:END      1822
STAIRSUPDT:ENDD     181C
STAIRSUPDT:ENEMYADD  17E0
STAIRSUPDT:NOKEY    1810
STAIRSX             2AC8
STAIRSY             2ACA
STAMM               0
STAMMI              1A18
STAMMP              1AA8
STAMMP:END          1B88
STAMMU              1A32
STAMMU:END          1AA2
STAMMU:X2           1A82
STANEXT             2ACE
STAPLOT             19EE
STAPLOT:PLTTBL      1A0A
START               1E04
START:LOOP          1E0C
START:WINT          1E12
STAUPD              1998
STAUPD:DOUPD        19BE
STAUPD:INITBL       19D6
STAUPD:UPDTBL       19E2
SUBTITLESTR         126F
SUSSERTOD           1212
SYSINIT             1000
TILEDARK            745B6D
TILEDDARK           30252D
TILEDETA            957EA0
TILEDIM             20
TILELIGH            CCE0EA
TITLESTRING         1256
TORCHRANGE          2AD8
TORCHSHADDER        2AD2
UTILCOLL            14AA
UTILCOLL:NOCOL      14C4
UTILFILL            CD
UTILPEN             0
UTILTEXT            196
UTILTILE            2C0
WALLID              2
XVALUES             12CA
YVALUES             12E8
