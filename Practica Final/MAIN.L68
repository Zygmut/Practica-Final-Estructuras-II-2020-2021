00001E8E Starting Address
Assembler used: EASy68K Editor/Assembler v5.16.01
Created On: 1/11/2021 11:51:02 AM

00000000                             1  ; =============================================================================
00000000                             2  ; TITLE    : MAIN PROGRAM
00000000                             3  ; AUTHOR   : RUBEN PALMER PEREZ 
00000000                             4  ; HISTORY  : 
00000000                             5  ; =============================================================================
00000000                             6              OPT     MEX
00001000                             7              ORG     $1000
00001000                             8  
00001000                             9  ; --- CODE INCLUDES -----------------------------------------------------------
00001000                            10  
00001000                            11              INCLUDE "SYSCONST.X68"          ; SYSTEM CONSTANTS
00001000                            12  ; =============================================================================
00001000                            13  ; TITLE    : SYSTEM CONSTANTS
00001000                            14  ; AUTHOR   : ANTONI BURGUERA
00001000                            15  ; HISTORY  : XX-XXX-201X - CREATION
00001000                            16  ;            11-OCT-2020 - MINOR CHANGES
00001000                            17  ; =============================================================================
00001000                            18  
00001000                            19  ; --- TRAP RELATED CONSTANTS --------------------------------------------------
00001000                            20  
00001000  =00000000                 21  KBDTRAP     EQU     0                       ; KEYBOARD UPDATE TRAP
00001000  =00000001                 22  SCRTRAP     EQU     1                       ; SCREEN REFRESH TRAP
00001000                            23  
00001000                            24  ; --- KEY CODES (EASy68K)
00001000                            25  
00001000  =00000020                 26  KBDCHRSP    EQU     $20                     ; SPACE KEY
00001000  =0000004D                 27  KBDCHRMK    EQU     'M'                     ; M KEY
00001000  =00000010                 28  KBDCHRSH    EQU     $10                     ; SHIFT KEY
00001000  =00000050                 29  KBDCHRPK    EQU     'P'                     ; P KEY
00001000  =00000025                 30  KBDCHRLF    EQU     $25                     ; LEFT KEY
00001000  =00000026                 31  KBDCHRUP    EQU     $26                     ; UP KEY
00001000  =00000027                 32  KBDCHRRT    EQU     $27                     ; RIGHT KEY
00001000  =00000028                 33  KBDCHRDN    EQU     $28                     ; DOWN KEY
00001000                            34  
00001000                            35  ; --- KEYBOARD MAPPING --------------------------------------------------------
00001000                            36  
00001000  =00000025                 37  KBDLEFT     EQU     KBDCHRLF                ; LEFT BUTTON
00001000  =00000026                 38  KBDUP       EQU     KBDCHRUP                ; UP BUTTON
00001000  =00000027                 39  KBDRIGHT    EQU     KBDCHRRT                ; RIGHT BUTTON
00001000  =00000028                 40  KBDDOWN     EQU     KBDCHRDN                ; DOWN BUTTON
00001000  =00000020                 41  KBDFIRE1    EQU     KBDCHRSP                ; FIRE 1 BUTTON
00001000  =0000004D                 42  KBDFIRE2    EQU     KBDCHRMK                ; FIRE 2 BUTTON
00001000  =00000010                 43  KBDFIRE3    EQU     KBDCHRSH                ; FIRE 3 BUTTON
00001000  =00000050                 44  KBDPAUSE    EQU     KBDCHRPK                ; PAUSE BUTTON
00001000                            45  
00001000                            46  ; --- KEYBOARD BITFIELD MASKS -------------------------------------------------
00001000                            47  ; CONVENIENCE CONSTANTS TO ACCESS THE FOLLOWING BIT-FIELD.
00001000                            48  ; THIS BIT-FIELD IS USED BY SYSTEM VARS (KBDVAL) AND (KBDEDGE).
00001000                            49  ; +---+---+---+---+---+---+---+---+
00001000                            50  ; | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |
00001000                            51  ; +---+---+---+---+---+---+---+---+
00001000                            52  ;   |   |   |   |   |   |   |   |
00001000                            53  ;   |   |   |   |   |   |   |   +---------- LEFT BUTTON
00001000                            54  ;   |   |   |   |   |   |   +-------------- UP BUTTON
00001000                            55  ;   |   |   |   |   |   +------------------ RIGHT BUTTON
00001000                            56  ;   |   |   |   |   +---------------------- DOWN BUTTON
00001000                            57  ;   |   |   |   +-------------------------- FIRE 1 BUTTON
00001000                            58  ;   |   |   +------------------------------ FIRE 2 BUTTON
00001000                            59  ;   |   +---------------------------------- FIRE 3 BUTTON
00001000                            60  ;   +-------------------------------------- PAUSE BUTTON
00001000                            61  
00001000  =00000001                 62  KBDMSKLF    EQU     %00000001
00001000  =00000002                 63  KBDMSKUP    EQU     %00000010
00001000  =00000004                 64  KBDMSKRT    EQU     %00000100
00001000  =00000008                 65  KBDMSKDN    EQU     %00001000
00001000  =00000010                 66  KBDMSKF1    EQU     %00010000
00001000  =00000020                 67  KBDMSKF2    EQU     %00100000
00001000  =00000040                 68  KBDMSKF3    EQU     %01000000
00001000  =00000080                 69  KBDMSKPS    EQU     %10000000
00001000                            70  
00001000                            71  ; --- KEYBOARD BITFIELD POSITIONS ---------------------------------------------
00001000                            72  
00001000  =00000000                 73  KBDBITLF    EQU     0
00001000  =00000001                 74  KBDBITUP    EQU     1
00001000  =00000002                 75  KBDBITRT    EQU     2
00001000  =00000003                 76  KBDBITDN    EQU     3
00001000  =00000004                 77  KBDBITF1    EQU     4
00001000  =00000005                 78  KBDBITF2    EQU     5
00001000  =00000006                 79  KBDBITF3    EQU     6
00001000  =00000007                 80  KBDBITPS    EQU     7
00001000                            81  
00001000                            82  ; --- SCREEN RELATED CONSTANTS ------------------------------------------------
00001000                            83  
00001000  =00000280                 84  SCRWIDTH    EQU     640                     ; SCREEN WIDTH (PIXELS)
00001000  =000001E0                 85  SCRHEIGH    EQU     480                     ; SCREEN HEIGHT (PIXELS)
00001000  =00000001                 86  SCRIRQ      EQU     1                       ; SCREEN INTERRUPT NUMBER
00001000  =00000014                 87  SCRTIM      EQU     20                       ; SCREEN TIMER (MS)
00001000                            88  
00001000                            89  ; --- DYNAMIC MEMORY CONSTANTS ------------------------------------------------
00001000                            90  
00001000  =00000040                 91  DMMBSIZE    EQU     64                      ; BLOCK SIZE (BYTES). POWER OF TWO
00001000  =00000032                 92  DMMBNUM     EQU     50                      ; NUMBER OF BLOCKS
00001000  =00000000                 93  DMMSYSID    EQU     0                       ; SYSTEM OWNER ID (MUST BE 0)
00001000  =00000000                 94  -------------------- end include --------------------
00001000                            95              INCLUDE "SYSTEM.X68"            ; SYSTEM CODE
00001000                            96  ; =============================================================================
00001000                            97  ; TITLE    : SYSTEM MANAGEMENT (SYSTEM CODE)
00001000                            98  ; AUTHOR   : ANTONI BURGUERA
00001000                            99  ; COMMENTS : IT IS DIVIDED IN THREE BLOCKS:
00001000                           100  ;            - SYS : GENERIC.
00001000                           101  ;            - SCR : SCREEN MANAGEMENT.
00001000                           102  ;            - KBD : KEYBOARD MANAGEMENT.
00001000                           103  ; HISTORY  : XX-XXX-201X - CREATION
00001000                           104  ;            11-OCT-2020 - MINOR CHANGES
00001000                           105  ; =============================================================================
00001000                           106  
00001000                           107  ; -----------------------------------------------------------------------------
00001000                           108  SYSINIT
00001000                           109  ; INITIALIZES THE SYSTEM
00001000                           110  ; INPUT    - NONE
00001000                           111  ; OUTPUT   - NONE
00001000                           112  ; MODIFIES - NONE
00001000                           113  ; -----------------------------------------------------------------------------
00001000  205F                     114              MOVE.L  (A7)+,A0                ; GET RETURN ADDRESS
00001002  4EB9 000010B4            115              JSR     KBDINIT                 ; INIT KEYBOARD
00001008  4EB9 0000101C            116              JSR     SCRINIT                 ; INIT SCREEN
0000100E  4EB9 00001114            117              JSR     DMMINIT                 ; INIT DYNAMIC MEMORY
00001014  027C DFFF                118              ANDI.W  #$DFFF,SR               ; SWITCH TO USER
00001018  2F08                     119              MOVE.L  A0,-(A7)                ; PUT RETURN ADDRESS
0000101A  4E75                     120              RTS
0000101C                           121  
0000101C                           122  ; =============================================================================
0000101C                           123  ; SCREEN MANAGEMENT (SYSTEM CODE)
0000101C                           124  ; =============================================================================
0000101C                           125  
0000101C                           126  ; -----------------------------------------------------------------------------
0000101C                           127  SCRINIT
0000101C                           128  ; INITIALIZES THE SCREEN, SCREEN-RELATED INTERRUPT AND VARS.
0000101C                           129  ; INPUT    - NONE
0000101C                           130  ; OUTPUT   - NONE
0000101C                           131  ; MODIFIES - D0,D1,D2,D3
0000101C                           132  ; -----------------------------------------------------------------------------
0000101C  007C 0700                133              ORI.W   #$0700,SR               ; DISABLE ALL INT
00001020  21FC 0000109A 0084       134              MOVE.L  #SCRUPD,($80+SCRTRAP*4) ; INSTALL TRAP
00001028  223C 028001E0            135              MOVE.L  #SCRWIDTH<<16|SCRHEIGH,D1 ; SET RESOLUTION
0000102E  103C 0021                136              MOVE.B  #33,D0
00001032  4E4F                     137              TRAP    #15
00001034  7201                     138              MOVE.L  #1,D1                   ; SET WINDOWED MODE
00001036  4E4F                     139              TRAP    #15
00001038  323C FF00                140              MOVE.W  #$FF00,D1               ; CLEAR VISIBLE BUFFER
0000103C  103C 000B                141              MOVE.B  #11,D0
00001040  4E4F                     142              TRAP    #15
00001042  123C 0011                143              MOVE.B  #17,D1                  ; ENABLE DOUBLE BUFFER
00001046  103C 005C                144              MOVE.B  #92,D0
0000104A  4E4F                     145              TRAP    #15
0000104C  323C FF00                146              MOVE.W  #$FF00,D1               ; CLEAR HIDDEN BUFFER
00001050  103C 000B                147              MOVE.B  #11,D0
00001054  4E4F                     148              TRAP    #15
00001056  21FC 0000108C 0064       149              MOVE.L  #SCRISR,($60+SCRIRQ*4)  ; SET EXCEPTION VECTOR
0000105E  123C 0005                150              MOVE.B  #5,D1                   ; ENABLE EXCEPTION PROCESSING
00001062  103C 0020                151              MOVE.B  #32,D0
00001066  4E4F                     152              TRAP    #15
00001068  143C 0081                153              MOVE.B  #%10000000|SCRIRQ,D2    ; ENABLE AUTO-IRQ
0000106C  163C 0014                154              MOVE.B  #SCRTIM,D3
00001070  123C 0006                155              MOVE.B  #6,D1
00001074  103C 0020                156              MOVE.B  #32,D0
00001078  4E4F                     157              TRAP    #15
0000107A  4239 00001EB8            158              CLR.B   (SCRINTCT)              ; PREPARE INTERRUPT FLAG
00001080  4239 00001EB9            159              CLR.B   (SCRCYCCT)              ; PREPARE CYCLE COUNTER
00001086  027C F8FF                160              ANDI.W  #$F8FF,SR               ; ENABLE INTS
0000108A  4E75                     161              RTS
0000108C                           162  
0000108C                           163  ; -----------------------------------------------------------------------------
0000108C                           164  SCRISR
0000108C                           165  ; SCREEN TIMER ISR. INCREASES THE INTERRUPT COUNTER AND UPDATES DOUBLE BUFFER.
0000108C                           166  ; INPUT    - NONE
0000108C                           167  ; OUTPUT   - NONE
0000108C                           168  ; MODIFIES - NONE
0000108C                           169  ; -----------------------------------------------------------------------------
0000108C  5239 00001EB8            170              ADDQ.B  #1,(SCRINTCT)           ; UPDATE INT FLAG/COUNTER
00001092  5239 00001EB9            171              ADDQ.B  #1,(SCRCYCCT)           ; UPDATE CYCLE COUNTER
00001098  4E73                     172              RTE
0000109A                           173  
0000109A                           174  ; -----------------------------------------------------------------------------
0000109A                           175  SCRUPD
0000109A                           176  ; TRAP SERVICE ROUTINE IN CHARGE OF VISUALIZING CURRENT FRAME AND CLEARING
0000109A                           177  ; BUFFER FOR THE NEXT ONE.
0000109A                           178  ; INPUT    - NONE
0000109A                           179  ; OUTPUT   - NONE
0000109A                           180  ; MODIFIES - NONE
0000109A                           181  ; -----------------------------------------------------------------------------
0000109A  48A7 C000                182              MOVEM.W D0-D1,-(A7)
0000109E  103C 005E                183              MOVE.B  #94,D0                  ; UPDATE DOUBLE BUFFER
000010A2  4E4F                     184              TRAP    #15
000010A4  323C FF00                185              MOVE.W  #$FF00,D1               ; CLEAR HIDDEN BUFFER
000010A8  103C 000B                186              MOVE.B  #11,D0
000010AC  4E4F                     187              TRAP    #15
000010AE  4C9F 0003                188              MOVEM.W (A7)+,D0-D1
000010B2  4E73                     189              RTE
000010B4                           190  
000010B4                           191  ; =============================================================================
000010B4                           192  ; KEYBOARD MANAGEMENT (SYSTEM CODE)
000010B4                           193  ; =============================================================================
000010B4                           194  
000010B4                           195  ; -----------------------------------------------------------------------------
000010B4                           196  KBDINIT
000010B4                           197  ; INITIALIZES THE SYSTEM VARIABLES KBDSYS AND KBDVAL
000010B4                           198  ; INPUT    - NONE
000010B4                           199  ; OUTPUT   - NONE
000010B4                           200  ; MODIFIES - NONE
000010B4                           201  ; -----------------------------------------------------------------------------
000010B4  4239 00001EB6            202              CLR.B   (KBDVAL)                ; INIT VARS
000010BA  4239 00001EB7            203              CLR.B   (KBDEDGE)
000010C0  21FC 000010CA 0080       204              MOVE.L  #KBDREAD,($80+KBDTRAP*4) ; INSTALL
000010C8  4E75                     205              RTS
000010CA                           206  
000010CA                           207  ; -----------------------------------------------------------------------------
000010CA                           208  KBDREAD
000010CA                           209  ; TRAP SERVICE ROUTINE.
000010CA                           210  ; UPDATES THE SYSTEM VARIABLES KBDEDGE AND KBDVAL ACCORDING TO THE BITFIELD
000010CA                           211  ; DESCRIBED IN SYSCONST. KBDVAL HOLDS THE CURRENT VALUES AND KBDEFGE HOLDS
000010CA                           212  ; RISING EDGES FROM PREVIOUS CALL TO THE CURRENT ONE.
000010CA                           213  ; INPUT    - NONE
000010CA                           214  ; OUTPUT   - (KBDVAL) AND (KBDEDGE)
000010CA                           215  ; MODIFIES - NONE
000010CA                           216  ; -----------------------------------------------------------------------------
000010CA  48E7 F000                217              MOVEM.L D0-D3,-(A7)
000010CE  103C 0013                218              MOVE.B  #19,D0
000010D2  223C 50104D20            219              MOVE.L  #KBDPAUSE<<24+KBDFIRE3<<16+KBDFIRE2<<8+KBDFIRE1,D1
000010D8  4E4F                     220              TRAP    #15
000010DA  6100 002A                221              BSR     .STORE                  ; STORE FIRE1,FIRE2,FIRE3 AND PAUSE
000010DE  223C 28272625            222              MOVE.L  #KBDDOWN<<24+KBDRIGHT<<16+KBDUP<<8+KBDLEFT,D1
000010E4  4E4F                     223              TRAP    #15
000010E6  6100 001E                224              BSR     .STORE                  ; STORE KEY UP,DOWN,LEFT AND RIGTH.
000010EA  1039 00001EB6            225              MOVE.B  (KBDVAL),D0             ; COMPUTE EDGE.
000010F0  4600                     226              NOT.B   D0                      ; EDGE=NOT(PREVIOUS) AND CURRENT.
000010F2  C002                     227              AND.B   D2,D0
000010F4  13C2 00001EB6            228              MOVE.B  D2,(KBDVAL)             ; STORE VALUES (PRESS AND EDGE)
000010FA  13C0 00001EB7            229              MOVE.B  D0,(KBDEDGE)
00001100  4CDF 000F                230              MOVEM.L (A7)+,D0-D3
00001104  4E73                     231              RTE
00001106                           232  
00001106  363C 0003                233  .STORE      MOVE.W  #3,D3                   ; TRANSLATES THE 8-BIT ENCODING
0000110A  E189                     234  .LOOP       LSL.L   #8,D1                   ; OF TRAP #15 TASK 19 INTO A 1-BIT
0000110C  E312                     235              ROXL.B  #1,D2                   ; PER KEYPRESS ENCODING
0000110E  51CB FFFA                236              DBRA.W  D3,.LOOP
00001112  4E75                     237              RTS
00001114                           238  
00001114                           239  ; =============================================================================
00001114                           240  ; DYNAMIC MEMORY MANAGEMENT (SYSTEM CODE)
00001114                           241  ; DYNAMIC MEMORY IS A SET OF DMMBNUM SLOTS OF DMMBSIZE BYTES EACH ONE.
00001114                           242  ; DMMBSIZE MUST BE POWER OF TWO. A SLOT HAS:
00001114                           243  ; - HEADER - 1 WORD. SPECIFIES THE OWNER (0 MEANS OWNED BY SYSTEM)
00001114                           244  ; - DATA   - DMMBSIZE - 2 BYTES. MAY CONTAIN VARS AND ANY KIND OF DATA RELATED
00001114                           245  ;            THE THE OWNER. IF OWNER==0, DATA IS MEANINGLESS.
00001114                           246  ; =============================================================================
00001114                           247  
00001114                           248  ; -----------------------------------------------------------------------------
00001114                           249  DMMINIT
00001114                           250  ; INITIALIZES THE DYNAMIC MEMORY TO ALL OWNED BY SYSTEM.
00001114                           251  ; INPUT    - NONE
00001114                           252  ; OUTPUT   - NONE
00001114                           253  ; MODIFIES - NONE
00001114                           254  ; -----------------------------------------------------------------------------
00001114  48E7 8080                255              MOVEM.L D0/A0,-(A7)
00001118  41F9 00001EC0            256              LEA     DMMDATA,A0
0000111E  303C 0031                257              MOVE.W  #DMMBNUM-1,D0
00001122  30BC 0000                258  .LOOP       MOVE.W  #DMMSYSID,(A0)
00001126  D1FC 00000040            259              ADD.L   #DMMBSIZE,A0
0000112C  51C8 FFF4                260              DBRA.W  D0,.LOOP
00001130  4CDF 0101                261              MOVEM.L (A7)+,D0/A0
00001134  4E75                     262              RTS
00001136                           263  
00001136                           264  ; -----------------------------------------------------------------------------
00001136                           265  DMMFIRST
00001136                           266  ; SEARCHES THE FIRST MEMORY SLOT NOT OWNED BY SYSTEM AND OUTPUTS A POINTER
00001136                           267  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00001136                           268  ; INPUT    - NONE
00001136                           269  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00001136                           270  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001136                           271  ; -----------------------------------------------------------------------------
00001136  41F9 00001EC0            272              LEA     DMMDATA,A0
0000113C  4A58                     273  DMMFRLOP    TST.W   (A0)+
0000113E  6600 0016                274              BNE     DMMFRFND
00001142  D1FC 0000003E            275              ADD.L   #DMMBSIZE-2,A0
00001148  B1FC 00002B3F            276  DMMFRCOM    CMP.L   #DMMDATA+DMMBSIZE*DMMBNUM-1,A0
0000114E  6DEC                     277              BLT     DMMFRLOP
00001150  207C 00000000            278              MOVE.L  #0,A0
00001156  4E75                     279  DMMFRFND    RTS
00001158                           280  
00001158                           281  ; -----------------------------------------------------------------------------
00001158                           282  DMMNEXT
00001158                           283  ; SEARCHES THE NEXT MEMORY SLOT NOT OWNED BY SYSTEM AND OUTPUTS A POINTER
00001158                           284  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00001158                           285  ; INPUT    - A0   : POINTER WITHIN THE CURRENT SLOT
00001158                           286  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00001158                           287  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001158                           288  ; -----------------------------------------------------------------------------
00001158  2F00                     289              MOVE.L  D0,-(A7)
0000115A  2008                     290              MOVE.L  A0,D0
0000115C  C0BC FFFFFFC0            291              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
00001162  0680 00000040            292              ADD.L   #DMMBSIZE,D0
00001168  2040                     293              MOVE.L  D0,A0
0000116A  201F                     294              MOVE.L  (A7)+,D0
0000116C  60DA                     295              BRA     DMMFRCOM
0000116E                           296  
0000116E                           297  ; -----------------------------------------------------------------------------
0000116E                           298  DMMFRSTO
0000116E                           299  ; SEARCHES THE FIRST MEMORY SLOT WITH THE SPECIFIED ID AND OUTPUTS A POINTER
0000116E                           300  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
0000116E                           301  ; INPUT    - D0.W : ID TO SEARCH
0000116E                           302  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
0000116E                           303  ; MODIFIES - NONE (ASIDE OF OUTPUT)
0000116E                           304  ; -----------------------------------------------------------------------------
0000116E  41F9 00001EC0            305              LEA     DMMDATA,A0
00001174  B058                     306  DMMFLOOP    CMP.W   (A0)+,D0
00001176  6700 0016                307              BEQ     DMMFFND
0000117A  D1FC 0000003E            308              ADD.L   #DMMBSIZE-2,A0
00001180  B1FC 00002B3F            309  DMMFCOM     CMP.L   #DMMDATA+DMMBSIZE*DMMBNUM-1,A0
00001186  6DEC                     310              BLT     DMMFLOOP
00001188  207C 00000000            311              MOVE.L  #0,A0
0000118E  4E75                     312  DMMFFND     RTS
00001190                           313  
00001190                           314  ; -----------------------------------------------------------------------------
00001190                           315  DMMNEXTO
00001190                           316  ; SEARCHES THE NEXT MEMORY SLOT WITH THE SPECIFIED ID AND OUTPUTS A POINTER
00001190                           317  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00001190                           318  ; INPUT    - D0.W : ID TO SEARCH
00001190                           319  ;            A0   : POINTER WITHIN THE CURRENT SLOT
00001190                           320  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00001190                           321  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001190                           322  ; -----------------------------------------------------------------------------
00001190  2F00                     323              MOVE.L  D0,-(A7)
00001192  2008                     324              MOVE.L  A0,D0
00001194  C0BC FFFFFFC0            325              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
0000119A  0680 00000040            326              ADD.L   #DMMBSIZE,D0
000011A0  2040                     327              MOVE.L  D0,A0
000011A2  201F                     328              MOVE.L  (A7)+,D0
000011A4  60DA                     329              BRA     DMMFCOM
000011A6                           330  
000011A6                           331  ; -----------------------------------------------------------------------------
000011A6                           332  DMMALLOC
000011A6                           333  ; SEARCHES THE FIRST FREE (SYS OWNED) SLOT, ASSIGNS TO THE SPECIFIED OWNER
000011A6                           334  ; AND RETURNS A POINTER TO THE CORRESPONDING DATA (SLOT ADDRESS + 2)
000011A6                           335  ; INPUT    - D0.W : ID TO ASSIGN
000011A6                           336  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FREE SPACE
000011A6                           337  ; MODIFIES - NONE (ASIDE OF OUTPUT)
000011A6                           338  ; -----------------------------------------------------------------------------
000011A6  3F00                     339              MOVE.W  D0,-(A7)
000011A8  4240                     340              CLR.W   D0
000011AA  4EB8 116E                341              JSR     DMMFRSTO
000011AE  301F                     342              MOVE.W  (A7)+,D0
000011B0  B1FC 00000000            343              CMP.L   #0,A0
000011B6  6700 0006                344              BEQ     .END
000011BA  3140 FFFE                345              MOVE.W  D0,-2(A0)
000011BE  4E75                     346  .END        RTS
000011C0                           347  
000011C0                           348  ; -----------------------------------------------------------------------------
000011C0                           349  DMMFREE
000011C0                           350  ; FREES THE SLOT TO WHICH THE PROVIDED POINTER BELONGS BY SETTING ITS OWNED TO
000011C0                           351  ; SYSTEM (0)
000011C0                           352  ; INPUT    - A0   : POINTER BELONGING TO THE SLOT TO FREE
000011C0                           353  ; OUTPUT   - NONE
000011C0                           354  ; MODIFIES - NONE
000011C0                           355  ; -----------------------------------------------------------------------------
000011C0  48E7 8080                356              MOVEM.L D0/A0,-(A7)
000011C4  2008                     357              MOVE.L  A0,D0
000011C6  C0BC FFFFFFC0            358              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
000011CC  2040                     359              MOVE.L  D0,A0
000011CE  4250                     360              CLR.W   (A0)
000011D0  4CDF 0101                361              MOVEM.L (A7)+,D0/A0
000011D4  4E75                     362              RTS
000011D4  4E75                     363  -------------------- end include --------------------
000011D6                           364              INCLUDE "CONST.X68"             ; GAME CONSTANTS
000011D6                           365  ; =============================================================================
000011D6                           366  ; TITLE    : GAME CONSTANTS
000011D6                           367  ; AUTHOR   :
000011D6                           368  ; HISTORY  :
000011D6                           369  ; =============================================================================
000011D6                           370  
000011D6                           371  ; TILE RELATED CONSTANTS 
000011D6  =00000020                372  TILEDIM     EQU     32         ; TILE SET DIMENSIONS && PLAYER SPEED
000011D6  =00745B6D                373  TILEDARK    EQU     $00745B6D  ; TILE SET DARK COLOR 
000011D6  =00CCE0EA                374  TILELIGH    EQU     $00CCE0EA  ; TILE SET LIGHT COLOR
000011D6  =00957EA0                375  TILEDETA    EQU     $00957ea0  ; TILE SET DETAIL COLOR
000011D6  =0030252D                376  TILEDDARK   EQU     $0030252d  ; TILE SET EXTRA DARK
000011D6                           377  
000011D6                           378  ; BUTTONS
000011D6  =00000050                379  BUTTONWIDTH EQU     80
000011D6  =0000002D                380  BUTTONHEIGH EQU     45
000011D6  =000000D5                381  BUTTONX1    EQU     213
000011D6  =000001AA                382  BUTTONX2    EQU     426
000011D6  =00000190                383  BUTTONY     EQU     400
000011D6                           384  
000011D6                           385  ; STRINGS 
000011D6= 59 4F 55 20 44 4F ...    386  NOKEYSTRING DC.B    'YOU DO NOT HAVE ANY KEYS', 0
000011EF= 53 4F 4D 45 20 50 ...    387  DEATHSTRING DC.B    'SOME PART OF YOUR SOUL  FADES AWAY', 0
00001212= 59 4F 55 20 48 41 ...    388  SUSSERTOD   DC.B    'YOU HAD SO MUCH TO LIVE FOR, YET YOU WENT DOWN THE DUNGEON', 0
0000124D= 20 4C 45 56 45 4C ...    389  LEVELSTRING DC.B    ' LEVEL: ', 0
00001256= 44 4F 57 4E 20 54 ...    390  TITLESTRING DC.B    'DOWN THE DUNGEON HOLE!!!', 0
0000126F= 57 48 59 20 44 49 ...    391  SUBTITLESTR DC.B    'WHY DID YOU COME HERE?', 0
00001286= 28 50 55 53 48 20 ...    392  NEXTSTR     DC.B    '(PUSH SPACE TO CONTINUE)', 0  ; 24
0000129F= 28 44 4F 20 4E 4F ...    393  BECARESTR   DC.B    '(DO NOT RUSH YOURSELF)', 0
000012B6= 52 45 54 52 59 00        394  RETRYSTR    DC.B    'RETRY', 0
000012BC= 45 58 49 54 00           395  EXITSTR     DC.B    'EXIT', 0
000012C1= 45 41 53 59 00           396  EASYSTR     DC.B    'EASY', 0
000012C6= 4E 4F 52 4D 41 4C 00     397  NORMALSTR   DC.B    'NORMAL', 0
000012CD= 59 4F 55 52 20 54 ...    398  TORCHWEAK10 DC.B    'YOUR TORCH GROWS  WEAK ON EACH', 0  ; 30
000012EC= 53 54 45 50 20 20 ...    399  TORCHWEAK11 DC.B    'STEP  YOU TAKE', 0                       ; 14
000012FB= 54 48 45 20 45 43 ...    400  TORCHWEAK20 DC.B    'THE ECHO OF YOUR TORCH IS ALMOST', 0  ; 32
0000131C= 55 4E 4E 4F 54 49 ...    401  TORCHWEAK21 DC.B    'UNNOTICEABLE  TO YOU', 0                     ; 20
00001332                           402              DS.W    0
00001332                           403  
00001332  =0000000C                404  ENEMYMAXCNT EQU     12                      
00001332                           405  
00001332                           406  ; ID'S FOR AGENTS AND MATRIX IN CASE TORCH SHADER IS IMPLEMENTED
00001332  =00000001                407  EMPTYID     EQU     1                       ; VOID IDENTIFIER
00001332  =00000002                408  WALLID      EQU     2                       ; WALL IDENTIFIER
00001332  =00000003                409  FLOORID     EQU     3                       ; FLOOR IDENTIFIER | ONLY USEFUL IF TILE SET IS IMPLEMENTED
00001332  =00000004                410  STAIRID     EQU     4                       ; STAIR IDENTIFIER
00001332  =00000005                411  KEYID       EQU     5                       ; KEY IDENTIFIER
00001332  =00000006                412  PLYRID      EQU     6                       ; PLAYER IDENTIFIER
00001332  =00000007                413  ENEMYID     EQU     7                       ; TRAP IDENTIFIER
00001332                           414  
00001332                           415  ; STATES
00001332  =00000000                416  STAMM       EQU     0                       ; STATE MAIN MENU
00001332  =00000001                417  STAGP       EQU     1                       ; STATE GAME PLAY
00001332  =00000002                418  STADM       EQU     2                       ; STATE DEATH MENU
00001332                           419  
00001332                           420  ; AUDIO FILES
00001332                           421  ;AUDIOLIST  DC.L    AUDIOMUS1, AUDIOMUS2, AUDIOMOVE, AUDIOKEY, AUDIOSTAR, AUDIOTALK, AUDIODIED, AUDIOCLK, 0
00001332                           422  ;AUDIOIDS   DC.B    AUDIOMUS1ID, AUDIOMUS2ID, AUDIOMOVEID, AUDIOKEYID, AUDIOSTARID, AUDIOTALKID, AUDIODIEDID, AUDIOCLKID
00001332                           423              DS.W    0
00001332                           424  
00001332                           425  ; AUDIO CONSTANTS 
00001332                           426              
00001332                           427              ; MASKS
00001332  =000000FF                428  AUDIOACCY   EQU     $FF                     ; ACCEPT NEW SOUNDS 
00001332  =00000000                429  AUDIOSCCN   EQU     $00                     ; DO NOT ACCEPT NEW SOUNDS 
00001332  =00000080                430  AUDIOLOOP   EQU     $80                     ; LOOP ACTIVE SOUND
00001332  =00000000                431  AUDIONLOP   EQU     $00                     ; DO NOT LOOP ACTIVE SOUND
00001332  =000000FF                432  AUDIOSTOP   EQU     $FF                     ; STOP ALL SOUNDS 
00001332                           433              
00001332                           434              ; IDS
00001332  =00000000                435  AUDIOMUS1ID EQU     0                       ; MUSIC ID 1 
00001332  =00000001                436  AUDIOMUS2ID EQU     1                       ; MUSIC ID 2
00001332                           437  
00001332  =00000002                438  AUDIOMOVEID EQU     2                       ; MOVE 
00001332  =00000003                439  AUDIOKEYID  EQU     3                       ; OBTAIN KEY 
00001332  =00000004                440  AUDIOSTARID EQU     4                       ; GO DOWN STAIRS 
00001332  =00000005                441  AUDIOTALKID EQU     5                       ; TALK
00001332  =00000006                442  AUDIODIEDID EQU     6                       ; DEATH
00001332  =00000007                443  AUDIOCLKID  EQU     7                       ; CLICK
00001332                           444              
00001332                           445              ; PATHS
00001332                           446  ;AUDIOMUS1  DC.B    '',0
00001332                           447  ;AUDIOMUS2  DC.B    '',0
00001332                           448  ;           
00001332                           449  ;AUDIOMOVE  DC.B    '',0
00001332                           450  ;AUDIOKEY   DC.B    '',0
00001332                           451  ;AUDIOSTAR  DC.B    '',0
00001332                           452  ;AUDIOTALK  DC.B    '',0
00001332                           453  ;AUDIODIED  DC.B    '',0
00001332                           454  ;AUDIOCLK   DC.B    '',0
00001332                           455  
00001332                           456  ; PSEUDO-RANDOM GENERATOR VECTORS
00001332= 0100 0220 0180 0...      457  XVALUES     DC.W    $100, $220, $180, $1C0, $80, $C0, $200, $E0, $160, $120
00001346= 0060 01E0 00A0 0...      458              DC.W    $60, $1E0, $A0, $1A0, $140
00001350                           459  
00001350= 00D0 0090 00B0 0...      460  YVALUES     DC.W    $D0, $90, $B0, $F0, $B0, $90, $190, $110, $170, $190
00001364= 00B0 01B0 00B0 0...      461              DC.W    $B0, $1B0, $B0, $130, $D0, $50, $170, $190, $130, $110
00001378= 01B0 0150 0090 0...      462              DC.W    $1B0, $150, $90, $90, $110, $30, $70, $150, $90, $10
0000138C= 01B0 00F0 00D0 0...      463              DC.W    $1B0, $F0, $D0, $D0, $90, $1B0, $B0, $170, $130, $190
000013A0= 00F0 0030 0150 0...      464              DC.W    $F0, $30, $150, $50, $170, $110, $1B0, $170, $150, $150
000013B4= 0070 01B0 0030 0...      465              DC.W    $70, $1B0, $30, $F0, $10, $90, $F0, $70, $D0, $170
000013C8= 0050 00B0 00D0 0...      466              DC.W    $50, $B0, $D0, $190, $90, $170, $50, $50, $50, $90
000013DC= 0090 01B0 0030 0...      467              DC.W    $90, $1B0, $30, $110, $130, $50, $B0, $110, $F0, $70
000013F0= 0010 01B0 0110 0...      468              DC.W    $10, $1B0, $110, $50, $D0, $F0, $F0, $30, $30, $150
00001404= 00B0 0030 0110 0...      469              DC.W    $B0, $30, $110, $110, $1B0, $190, $30, $30, $170, $170
00001418= 0030 0190 0130 0...      470              DC.W    $30, $190, $130, $90, $50, $90, $110, $150, $190, $110
0000142C= 0050 0110 00F0 0...      471              DC.W    $50, $110, $F0, $190, $1B0, $170, $70, $1B0, $F0, $1B0
00001440= 0050 0130 0150 0...      472              DC.W    $50, $130, $150, $130, $70, $30, $D0, $150, $50, $130
00001454= 00B0 0010 0010 0...      473              DC.W    $B0, $10, $10, $30, $90, $F0, $B0, $70, $B0, $70
00001468= 0070 00B0 0010 0...      474              DC.W    $70, $B0, $10, $130, $70, $70, $150, $B0, $130, $1B0
0000147C= 0030 0190 0130 0...      475              DC.W    $30, $190, $130, $D0, $10, $1D0, $150, $110, $F0, $10
00001490= 0190 0070 0130 0...      476              DC.W    $190, $70, $130, $F0, $10, $70, $10, $30, $190, $D0
000014A4= 0170 0150 0010 0...      477              DC.W    $170, $150, $10, $50, $170, $D0, $F0, $B0, $B0, $D0
000014B8= 0190 0090 00B0 0...      478              DC.W    $190, $90, $B0, $90, $190, $10, $110, $90, $110, $130
000014CC= 0010 0050 00D0 0...      479              DC.W    $10, $50, $D0, $50, $1B0, $170, $F0, $150, $F0, $10
000014E0= 0150 0070 0170 0...      480              DC.W    $150, $70, $170, $110, $D0, $50, $1B0, $30, $150, $170
000014F4= 0130 0030 0070 0...      481              DC.W    $130, $30, $70, $190, $130, $30, $150, $130, $190, $10
00001508= 0010 00D0 0070 0...      482              DC.W    $10, $D0, $70, $D0, $B0
00001508= 0010 00D0 0070 0...      483  -------------------- end include --------------------
00001512                           484              INCLUDE "UTIL.X68"              ; UTILITY MANAGER
00001512                           485  UTILPEN     MACRO
00001512                           486  ;   IN:  \1 AS THE COLOR, FORMATED AS #00BBGGRR
00001512                           487  ;   OUT: NONE
00001512                           488  ;   MOD: D0, D1    
00001512                           489  ;   DES: MACRO TO SET PEN COLOR
00001512                           490  
00001512                           491          MOVE.B  #80, D0 
00001512                           492          MOVE.L  \1, D1
00001512                           493          TRAP    #15
00001512                           494          ENDM
00001512                           495  
00001512                           496  UTILFILL    MACRO
00001512                           497  ;   IN:  \1 AS THE COLOR, FORMATED AS #00BBGGRR
00001512                           498  ;   OUT: NONE
00001512                           499  ;   MOD: D0, D1
00001512                           500  ;   DES: MACRO TO SET FILL COLOR
00001512                           501  
00001512                           502          MOVE.B  #81, D0
00001512                           503          MOVE.L  \1, D1
00001512                           504          TRAP    #15
00001512                           505          ENDM
00001512                           506  
00001512                           507  UTILTEXT    MACRO
00001512                           508  ;   IN:  \1 TEXT 
00001512                           509  ;        \2 TEXT X
00001512                           510  ;        \3 TEXT Y
00001512                           511  ;   OUT: NONE
00001512                           512  ;   MOD: D0-D2 / A1
00001512                           513  ;   DES: PRINTS THE 0 TERINATED STRING IN \1 IN COORDINATES \2 \3
00001512                           514  
00001512                           515          LEA     \1, A1
00001512                           516          MOVE.W  \2, D1
00001512                           517          MOVE.W  \3, D2
00001512                           518  
00001512                           519          MOVE.W  #95, D0
00001512                           520          TRAP    #15
00001512                           521          ENDM
00001512                           522  
00001512                           523  UTILTILE    MACRO
00001512                           524  ;   IN:  \1 PROCEDURE OF THE TRAP #15
00001512                           525  ;        \2 X COORDINATE
00001512                           526  ;        \3 Y COORDINATE
00001512                           527  ;   OUT: NONE
00001512                           528  ;   MOD: D1-D4
00001512                           529  ;   DES: DRAWS A GRAPHIC AT \2 \3
00001512                           530          MOVE.W  \2, D1               ; D1 = X CENTER
00001512                           531          MOVE.W  \3, D2               ; D1 = Y CENTER
00001512                           532          MOVE.W  D1, D3
00001512                           533          MOVE.W  D2, D4
00001512                           534          SUB.W   #TILEDIM/2, D1              ; SET TOP LEFT CORNER
00001512                           535          SUB.W   #TILEDIM/2, D2              ; SET TOP LEFT CORNER 
00001512                           536          ADD.W   #TILEDIM/2, D3              ; SET LOW RIGHT CORNER
00001512                           537          ADD.W   #TILEDIM/2, D4              ; SET LOW RIGHT CORNER
00001512                           538  
00001512                           539          MOVE.W  \1, D0
00001512                           540          TRAP    #15
00001512                           541          ENDM
00001512                           542  
00001512                           543  UTILCOLL    
00001512                           544  ;   IN:  D0 X0 COORDINATE
00001512                           545  ;        D1 Y0 COORDINATE
00001512                           546  ;   OUT: D2.B = FF IF COLLISION, 00 ELSEWISE
00001512                           547  ;   MOD: D2
00001512                           548  ;   DES: CHECKS IF ELEMENTS 0 AND 1 HAVE THE SAME POSITION 
00001512                           549  
00001512  4242                     550          CLR     D2
00001514  B079 00002B40            551          CMP.W   (PLAYERX), D0   ; COMPARE X COORDINATES
0000151A  6600 0010                552          BNE .NOCOL
0000151E  B279 00002B42            553          CMP.W   (PLAYERY), D1   ; COMPARE Y COORDINATES
00001524  6600 0006                554          BNE .NOCOL
00001528  143C 00FF                555          MOVE.B  #$FF, D2
0000152C                           556  .NOCOL
0000152C  4E75                     557          RTS
0000152E                           558  
0000152E                           559  
0000152E                           560      
0000152E                           561  -------------------- end include --------------------
0000152E                           562              INCLUDE "RANDOM.X68"            ; PSEUDO - RANDOM GENERATOR
0000152E                           563  ; =============================================================================
0000152E                           564  ; TITLE    : PSEUDO-RANDOM NUMBER GENERATOR
0000152E                           565  ; AUTHOR   : RUBEN PALMER PEREZ 
0000152E                           566  ; COMMENTS : VERY LAZY AND STUPID "ALGORITHM" IMPLEMENTED.
0000152E                           567  ; HISTORY  : 
0000152E                           568  ; =============================================================================
0000152E                           569  
0000152E                           570  ; -----------------------------------------------------------------------------
0000152E                           571  RNDINIT
0000152E                           572  ; INITIALIZES RANDOM NUMBER GENERATOR
0000152E                           573  ; INPUT    - NONE
0000152E                           574  ; OUTPUT   - NONE
0000152E                           575  ; MODIFIES - NONE
0000152E                           576  ; -----------------------------------------------------------------------------
0000152E  4279 00002B5A            577              CLR     (RNGXINDEX)
00001534  4279 00002B5C            578              CLR     (RNGYINDEX)
0000153A                           579  
0000153A  4E75                     580              RTS
0000153C                           581  ; -----------------------------------------------------------------------------
0000153C                           582  RNGX
0000153C                           583  ; PROVIDES A PSEUDO-RANDOM BYTE
0000153C                           584  ; INPUT    - NONE
0000153C                           585  ; OUTPUT   - D0.L RANDOM VALUE (ONLY BYTE)
0000153C                           586  ; MODIFIES - NONE (ASIDE OF OUTPUT)
0000153C                           587  ; -----------------------------------------------------------------------------
0000153C  2F08                     588              MOVE.L  A0,-(A7)
0000153E                           589  
0000153E  41F8 1332                590              LEA     XVALUES, A0
00001542  4280                     591              CLR.L   D0
00001544                           592              
00001544  1039 00002B5A            593              MOVE.B  (RNGXINDEX), D0
0000154A  E348                     594              LSL.W   #1, D0     
0000154C  D0C0                     595              ADD.W   D0, A0
0000154E  3010                     596              MOVE.W  (A0), D0
00001550  5239 00002B5A            597              ADDQ.B  #1, (RNGXINDEX)
00001556  0C79 0C00 00002B5A       598              CMP     #$0C00, (RNGXINDEX)
0000155E  6600 0008                599              BNE     .NOVERFLOW     
00001562  4279 00002B5A            600              CLR     (RNGXINDEX)
00001568                           601  .NOVERFLOW            
00001568  205F                     602              MOVE.L  (A7)+, A0
0000156A  4E75                     603              RTS
0000156C                           604  ; -----------------------------------------------------------------------------
0000156C                           605  RNGY
0000156C                           606  ; PROVIDES A PSEUDO-RANDOM BYTE
0000156C                           607  ; INPUT    - NONE
0000156C                           608  ; OUTPUT   - D0.L RANDOM VALUE (ONLY BYTE)
0000156C                           609  ; MODIFIES - NONE (ASIDE OF OUTPUT)
0000156C                           610  ; -----------------------------------------------------------------------------
0000156C  2F08                     611              MOVE.L  A0,-(A7)
0000156E                           612  
0000156E  41F8 1350                613              LEA     YVALUES, A0
00001572  4280                     614              CLR.L   D0
00001574                           615              
00001574  1039 00002B5C            616              MOVE.B  (RNGYINDEX), D0
0000157A  E348                     617              LSL.W   #1, D0  
0000157C  D0C0                     618              ADD.W   D0, A0
0000157E  3010                     619              MOVE.W  (A0), D0
00001580  5239 00002B5C            620              ADDQ.B  #1, (RNGYINDEX)
00001586  0C79 E100 00002B5C       621              CMP     #$E100, (RNGYINDEX)
0000158E  6600 0008                622              BNE     .NOVERFLOW
00001592  4279 00002B5C            623              CLR     (RNGYINDEX)
00001598                           624  .NOVERFLOW
00001598  205F                     625              MOVE.L  (A7)+, A0
0000159A  4E75                     626              RTS
0000159C                           627  
0000159C                           628  ; UPDATE RANDOM VALUES TO HAVE ONLY CENTER VALUES OF THE "GRID"
0000159C                           629  -------------------- end include --------------------
0000159C                           630              INCLUDE "AGENTLST.X68"          ; AGENT MANAGER
0000159C                           631  ; =============================================================================
0000159C                           632  ; TITLE    : AGENT LIST
0000159C                           633  ; AUTHOR   : ANTONI BURGUERA
0000159C                           634  ; COMMENTS : EACH AGENT HAS A DATA BLOCK FROM DMM AS FOLLOWS:
0000159C                           635  ;              +0 - LONG : UPDATE SUBROUTINE POINTER
0000159C                           636  ;              +4 - LONG : PLOT SUBROUTINE POINTER
0000159C                           637  ;              +8:END    : DATA (AGENT SPECIFIC)
0000159C                           638  ; HISTORY  : XX-XXX-201X - CREATION
0000159C                           639  ;            11-OCT-2020 - MINOR CHANGES
0000159C                           640  ; =============================================================================
0000159C                           641  
0000159C                           642  ; -----------------------------------------------------------------------------
0000159C                           643  AGLADD
0000159C                           644  ; CREATES A NEW AGENT
0000159C                           645  ; INPUT    - A1 - POINTER TO AGENT INIT FUNCTION
0000159C                           646  ;            A2 - POINTER TO AGENT UPDATE FUNCTION
0000159C                           647  ;            A3 - POINTER TO AGENT PLOT FUNCTION
0000159C                           648  ;            D0 - AGENT TYPE (USED AS OWNED BY DMM)
0000159C                           649  ;            D1 - AGENT INITIALIZATION PARAMETER 1
0000159C                           650  ;            D2 - AGENT INITIALIZATION PARAMETER 2
0000159C                           651  ;            D3 - AGENT INITIALIZATION PARAMETER 3
0000159C                           652  ; OUTPUT   - NONE
0000159C                           653  ; MODIFIES - NONE
0000159C                           654  ; -----------------------------------------------------------------------------
0000159C  2F08                     655              MOVE.L  A0,-(A7)
0000159E  4EB8 11A6                656              JSR     DMMALLOC
000015A2  B1FC 00000000            657              CMP.L   #0,A0
000015A8  6700 0008                658              BEQ     .END
000015AC  20CA                     659              MOVE.L  A2,(A0)+
000015AE  20CB                     660              MOVE.L  A3,(A0)+
000015B0  4E91                     661              JSR     (A1)
000015B2  205F                     662  .END        MOVE.L  (A7)+,A0
000015B4  4E75                     663              RTS
000015B6                           664  
000015B6                           665  ; -----------------------------------------------------------------------------
000015B6                           666  AGLUPDT
000015B6                           667  ; UPDATES THE AGENT LIST. PRIOR TO CALLING THE UPDATE FUNCTIONS, A0 IS SET
000015B6                           668  ; TO THE DATA BLOCK OF THE CORRESPONDING SLOT.
000015B6                           669  ; INPUT    - NONE
000015B6                           670  ; OUTPUT   - NONE
000015B6                           671  ; MODIFIES - NONE
000015B6                           672  ; -----------------------------------------------------------------------------
000015B6  48E7 00C0                673              MOVEM.L A0-A1,-(A7)
000015BA  4EB8 1136                674              JSR     DMMFIRST
000015BE  B1FC 00000000            675  .LOOP       CMP.L   #0,A0
000015C4  6700 000E                676              BEQ     .END
000015C8  2250                     677              MOVE.L  (A0),A1
000015CA  5088                     678              ADD.L   #8,A0
000015CC  4E91                     679              JSR     (A1)
000015CE  4EB8 1158                680              JSR     DMMNEXT
000015D2  60EA                     681              BRA     .LOOP
000015D4  4CDF 0300                682  .END        MOVEM.L (A7)+,A0-A1
000015D8  4E75                     683              RTS
000015DA                           684  
000015DA                           685  ; -----------------------------------------------------------------------------
000015DA                           686  AGLPLOT
000015DA                           687  ; PLOTS THE AGENT LIST. PRIOR TO CALLING THE UPDATE FUNCTIONS, A0 IS SET
000015DA                           688  ; TO THE DATA BLOCK OF THE CORRESPONDING SLOT.
000015DA                           689  ; INPUT    - NONE
000015DA                           690  ; OUTPUT   - NONE
000015DA                           691  ; MODIFIES - NONE
000015DA                           692  ; -----------------------------------------------------------------------------
000015DA  48E7 00C0                693              MOVEM.L A0-A1,-(A7)
000015DE  4EB8 1136                694              JSR     DMMFIRST
000015E2  B1FC 00000000            695  .LOOP       CMP.L   #0,A0
000015E8  6700 0010                696              BEQ     .END
000015EC  2268 0004                697              MOVE.L  4(A0),A1
000015F0  5088                     698              ADD.L   #8,A0
000015F2  4E91                     699              JSR     (A1)
000015F4  4EB8 1158                700              JSR     DMMNEXT
000015F8  60E8                     701              BRA     .LOOP
000015FA  4CDF 0300                702  .END        MOVEM.L (A7)+,A0-A1
000015FE  4E75                     703              RTS
00001600                           704  
00001600                           705  ; -----------------------------------------------------------------------------
00001600  =000011C0                706  AGLKILL     EQU     DMMFREE
00001600                           707  ; KILLS THE AGENT BY RELEASING ITS MEMORY
00001600                           708  ; INPUT    - A0 POINTER WITHIN THE AGENT MEMORY
00001600                           709  ; OUTPUT   - NONE
00001600                           710  ; MODIFIES - NONE
00001600                           711  ; NOTE     - IT IS JUST A WRAPPER FOR DMMFREE
00001600                           712  ; -----------------------------------------------------------------------------
00001600                           713  
00001600                           714  ;------------------------------------------------------------------------------
00001600                           715  AGLFKIL
00001600                           716  ; DES       :       KILLS ALL AGENTS WITH ID 'X'
00001600                           717  ; IN        :       D0 AGENT ID
00001600                           718  ; OUT   :   NONE
00001600                           719  ; MOD       :       REMOVES ALL AGENTS WITH ID D0. MEMORY
00001600                           720  ;------------------------------------------------------------------------------
00001600  48E7 00C0                721              MOVEM.L A0-A1,-(A7)
00001604  4EB8 116E                722              JSR     DMMFRSTO
00001608  B1FC 00000000            723  .LOOP       CMP.L   #0, A0
0000160E  6700 000C                724              BEQ     .END            ; AGENT LIST IS EMPTY
00001612  4EB8 11C0                725              JSR     AGLKILL
00001616  4EB8 116E                726              JSR     DMMFRSTO        ; SEARCH NEXT AGENT WITH ID D0
0000161A  60EC                     727              BRA     .LOOP
0000161C  4CDF 0300                728  .END        MOVEM.L (A7)+,A0-A1
00001620  4E75                     729              RTS
00001620  4E75                     730  -------------------- end include --------------------
00001622                           731              INCLUDE "PLAYER.X68"            ; PLAYER MANAGER
00001622                           732  ; =============================================================================
00001622                           733  ; TITLE    : PLAYER MANAGER
00001622                           734  ; AUTHOR   : RUBEN PALMER PEREZ 
00001622                           735  ; COMMENTS : 
00001622                           736  ; =============================================================================
00001622                           737  
00001622                           738  ;---------------------------------------------------------------------
00001622                           739  PLAYERINIT
00001622                           740  ; DES       :       INIT METHOD FOR THE PLAYER. SET PLAYER TO CENTER
00001622                           741  ; IN        :       NONE
00001622                           742  ; OUT       :       NONE
00001622                           743  ; MOD       :       (PLAYERX) WITH X COORDINATE
00001622                           744  ;           (PLAYERY) WITH Y COORDINATE
00001622                           745  ;---------------------------------------------------------------------
00001622  33FC 0140 00002B40       746              MOVE.W #SCRWIDTH/2, (PLAYERX)       ; SET PLAYER TO CENTER
0000162A  33FC 00F0 00002B42       747              MOVE.W #SCRHEIGH/2, (PLAYERY)       ; SET PLAYER TO CENTER
00001632  4E75                     748              RTS
00001634                           749  
00001634                           750  ;---------------------------------------------------------------------
00001634                           751  PLAYERUPDT  
00001634                           752  ; DES       :       CHECKS IF PLAYER HAS TO MOVE SOMEWHERE
00001634                           753  ; IN        :       NONE
00001634                           754  ; OUT       :       NONE
00001634                           755  ; MOD       :       (PLAYERX)||(PLAYERY) DEPENDS ON MOVEMENT
00001634                           756  ;---------------------------------------------------------------------
00001634                           757  
00001634  0839 0000 00001EB9       758              BTST.B  #0, (SCRCYCCT)
0000163C  6600 0092                759              BNE     .END  
00001640  0839 0000 00001EB6       760              BTST.B  #KBDBITLF, (KBDVAL)         ; LEFT KEY PRESSED
00001648  6600 0028                761              BNE     .MOVEL
0000164C  0839 0002 00001EB6       762              BTST.B  #KBDBITRT, (KBDVAL)         ; RIGHT KEY PRESSED
00001654  6600 0034                763              BNE     .MOVER
00001658  0839 0001 00001EB6       764              BTST.B  #KBDBITUP, (KBDVAL)         ; UP KEY PRESSED
00001660  6600 0040                765              BNE     .MOVEU
00001664  0839 0003 00001EB6       766              BTST.B  #KBDBITDN, (KBDVAL)         ; DOWN KEY PRESSED
0000166C  6600 004C                767              BNE     .MOVED
00001670  4E75                     768              RTS
00001672                           769  .MOVEL
00001672  0C79 0070 00002B40       770              CMP.W   #TILEDIM/2+(SCRWIDTH-SCRHEIGH)-64, (PLAYERX)       ; LEFT BOUNDARY
0000167A  6E00 0004                771              BGT     .RMVEL
0000167E  4E75                     772              RTS
00001680                           773  .RMVEL
00001680  0479 0020 00002B40       774              SUB.W   #TILEDIM, (PLAYERX)         ; MOVE LEFT
00001688  4E75                     775              RTS
0000168A                           776  
0000168A                           777  .MOVER
0000168A  0C79 020F 00002B40       778              CMP.W   #SCRHEIGH-1-TILEDIM/2+64, (PLAYERX)    ; RIGHT BOUNDARY
00001692  6D00 0004                779              BLT     .RMVER
00001696  4E75                     780              RTS
00001698                           781  .RMVER
00001698  0679 0020 00002B40       782              ADD.W   #TILEDIM, (PLAYERX)         ; MOVE RIGHT
000016A0  4E75                     783              RTS
000016A2                           784  
000016A2                           785  .MOVEU
000016A2  0C79 0010 00002B42       786              CMP.W   #TILEDIM/2, (PLAYERY)       ; TOP BOUNDARY
000016AA  6E00 0004                787              BGT     .RMVEU
000016AE  4E75                     788              RTS
000016B0                           789  .RMVEU
000016B0  0479 0020 00002B42       790              SUB.W   #TILEDIM, (PLAYERY)         ; MOVE UP
000016B8  4E75                     791              RTS
000016BA                           792  
000016BA                           793  .MOVED
000016BA  0C79 01CF 00002B42       794              CMP.W   #SCRHEIGH-1-TILEDIM/2, (PLAYERY)    ; BOTTOM BOUNDARY
000016C2  6D00 0004                795              BLT     .RMVED
000016C6  4E75                     796              RTS
000016C8                           797  .RMVED
000016C8  0679 0020 00002B42       798              ADD.W   #TILEDIM, (PLAYERY)         ; MOVE DOWN
000016D0                           799  .END
000016D0  4E75                     800              RTS
000016D2                           801  
000016D2                           802  ;-------------------------------------------------------------------
000016D2                           803  PLAYERPLOT
000016D2                           804  ; DES       :       PLOTS THE PLAYER GRAPHICS
000016D2                           805  ; IN        :       NONE
000016D2                           806  ; OUT       :       NONE
000016D2                           807  ; MOD       :       NONE
000016D2                           808  ;-------------------------------------------------------------------
000016D2  48E7 F800                809              MOVEM.L D0-D4, -(A7)
000016D6                           810m             UTILPEN #TILELIGH                         
000016D6                           811m ;   IN:  #TILELIGH AS THE COLOR, FORMATED AS #00BBGGRR
000016D6                           812m ;   OUT: NONE
000016D6                           813m ;   MOD: D0, D1    
000016D6                           814m ;   DES: MACRO TO SET PEN COLOR
000016D6                           815m 
000016D6  103C 0050                816m         MOVE.B  #80, D0 
000016DA  223C 00CCE0EA            817m         MOVE.L  #TILELIGH, D1
000016E0  4E4F                     818m         TRAP    #15
000016E2                           819m         ENDM
000016E2                           820  
000016E2                           821m             UTILFILL #TILELIGH
000016E2                           822m ;   IN:  #TILELIGH AS THE COLOR, FORMATED AS #00BBGGRR
000016E2                           823m ;   OUT: NONE
000016E2                           824m ;   MOD: D0, D1
000016E2                           825m ;   DES: MACRO TO SET FILL COLOR
000016E2                           826m 
000016E2  103C 0051                827m         MOVE.B  #81, D0
000016E6  223C 00CCE0EA            828m         MOVE.L  #TILELIGH, D1
000016EC  4E4F                     829m         TRAP    #15
000016EE                           830m         ENDM
000016EE                           831              
000016EE                           832m             UTILTILE #87, (PLAYERX), (PLAYERY)
000016EE                           833m ;   IN:  #87 PROCEDURE OF THE TRAP #15
000016EE                           834m ;        (PLAYERX) X COORDINATE
000016EE                           835m ;        (PLAYERY) Y COORDINATE
000016EE                           836m ;   OUT: NONE
000016EE                           837m ;   MOD: D1-D4
000016EE                           838m ;   DES: DRAWS A GRAPHIC AT (PLAYERX) (PLAYERY)
000016EE  3239 00002B40            839m         MOVE.W  (PLAYERX), D1               ; D1 = X CENTER
000016F4  3439 00002B42            840m         MOVE.W  (PLAYERY), D2               ; D1 = Y CENTER
000016FA  3601                     841m         MOVE.W  D1, D3
000016FC  3802                     842m         MOVE.W  D2, D4
000016FE  0441 0010                843m         SUB.W   #TILEDIM/2, D1              ; SET TOP LEFT CORNER
00001702  0442 0010                844m         SUB.W   #TILEDIM/2, D2              ; SET TOP LEFT CORNER 
00001706  0643 0010                845m         ADD.W   #TILEDIM/2, D3              ; SET LOW RIGHT CORNER
0000170A  0644 0010                846m         ADD.W   #TILEDIM/2, D4              ; SET LOW RIGHT CORNER
0000170E                           847m 
0000170E  303C 0057                848m         MOVE.W  #87, D0
00001712  4E4F                     849m         TRAP    #15
00001714                           850m         ENDM
00001714  4CDF 001F                851              MOVEM.L (A7)+,D0-D4
00001718  4E75                     852              RTS
0000171A                           853  
0000171A                           854  
0000171A                           855  -------------------- end include --------------------
0000171A                           856              INCLUDE "MAP.X68"               ; MAP MANAGER
0000171A                           857  ;-------------------------------------------------------
0000171A                           858  MAPPLOT
0000171A                           859  ; DES       :       PLOTS MAP BORDERS
0000171A                           860  ; IN        :       NONE
0000171A                           861  ; OUT       :       NONE
0000171A                           862  ; MOD       :       NONE
0000171A                           863  ;-------------------------------------------------------
0000171A  48E7 F800                864          MOVEM.L D0-D4, -(A7)
0000171E                           865          
0000171E                           866m         UTILPEN #TILEDARK
0000171E                           867m ;   IN:  #TILEDARK AS THE COLOR, FORMATED AS #00BBGGRR
0000171E                           868m ;   OUT: NONE
0000171E                           869m ;   MOD: D0, D1    
0000171E                           870m ;   DES: MACRO TO SET PEN COLOR
0000171E                           871m 
0000171E  103C 0050                872m         MOVE.B  #80, D0 
00001722  223C 00745B6D            873m         MOVE.L  #TILEDARK, D1
00001728  4E4F                     874m         TRAP    #15
0000172A                           875m         ENDM
0000172A                           876m         UTILFILL #TILEDARK
0000172A                           877m ;   IN:  #TILEDARK AS THE COLOR, FORMATED AS #00BBGGRR
0000172A                           878m ;   OUT: NONE
0000172A                           879m ;   MOD: D0, D1
0000172A                           880m ;   DES: MACRO TO SET FILL COLOR
0000172A                           881m 
0000172A  103C 0051                882m         MOVE.B  #81, D0
0000172E  223C 00745B6D            883m         MOVE.L  #TILEDARK, D1
00001734  4E4F                     884m         TRAP    #15
00001736                           885m         ENDM
00001736                           886  
00001736  4241                     887          CLR     D1                          ; LEFT BORDER
00001738  4242                     888          CLR     D2                      
0000173A  363C 004F                889          MOVE.W  #79, D3
0000173E  383C 01E0                890          MOVE.W  #SCRHEIGH, D4
00001742  303C 0057                891          MOVE.W  #87, D0
00001746  4E4F                     892          TRAP    #15
00001748                           893  
00001748  323C 0231                894          MOVE.W  #561, D1                    ; RIGHT BORDER                                
0000174C  363C 0280                895          MOVE.W  #SCRWIDTH, D3
00001750  4E4F                     896          TRAP    #15
00001752                           897          
00001752  4CDF 001F                898          MOVEM.L (A7)+,D0-D4
00001756                           899  
00001756  4E75                     900          RTS
00001756  4E75                     901  -------------------- end include --------------------
00001758                           902              INCLUDE "KEY.X68"               ; KEY MANAGER
00001758                           903  ;---------------------------------------------------------------
00001758                           904  KEYINIT             
00001758                           905  ; DES       :       INIT METHOD TO KEY OBJECT
00001758                           906  ; IN        :       NONE
00001758                           907  ; OUT       :       NONE
00001758                           908  ; MOD       :       (KEYX) WITH X POSITION 
00001758                           909  ;           (KEYY) WITH Y POSITION
00001758                           910  ;---------------------------------------------------------------
00001758  2F00                     911              MOVE.L D0, -(A7)
0000175A  4EB8 153C                912              JSR     RNGX
0000175E  33C0 00002B44            913              MOVE.W  D0, (KEYX)
00001764  4EB8 156C                914              JSR     RNGY
00001768  33C0 00002B46            915              MOVE.W  D0, (KEYY)
0000176E  201F                     916              MOVE.L  (A7)+, D0
00001770  4E75                     917              RTS
00001772                           918  
00001772                           919  ;---------------------------------------------------------------
00001772                           920  KEYUPDT
00001772                           921  ; DES       :       SEES IF PLAYER IS ON THE SAME BLOCK AS HIMSELF
00001772                           922  ; IN        :       NONE
00001772                           923  ; OUT       :       NONE
00001772                           924  ; MOD       :       (KEYOBTAINED) IF PLAYER IS IN THE SAME POSITION AS HIMSELF             
00001772                           925  ;---------------------------------------------------------------
00001772                           926              
00001772  48E7 E000                927                  MOVEM.L D0-D2, -(A7)
00001776                           928             
00001776  3039 00002B44            929              MOVE.W  (KEYX), D0
0000177C  3239 00002B46            930              MOVE.W  (KEYY), D1
00001782  4EB8 1512                931              JSR     UTILCOLL
00001786  B43C 00FF                932              CMP.B   #$FF, D2
0000178A  6600 000A                933              BNE     .END
0000178E  13FC 0001 00002B50       934              MOVE.B  #1, (KEYOBTEINED)           ; THE PLAYER IS IN THE POSITION OF THE KEY
00001796                           935  .END
00001796  4CDF 0007                936              MOVEM.L (A7)+, D0-D2
0000179A  4E75                     937              RTS
0000179C                           938  ;--------------------------------------------------------------
0000179C                           939  KEYPLOT             
0000179C                           940  ; DES       :       PLOTS THE KEY GRAPHIC
0000179C                           941  ; IN        :       NONE
0000179C                           942  ; OUT       :       NONE
0000179C                           943  ; MOD       :       NONE
0000179C                           944  ;--------------------------------------------------------------
0000179C  0C39 0001 00002B50       945              CMP.B   #1, (KEYOBTEINED)
000017A4  6700 003C                946              BEQ     .NOKEY
000017A8  48E7 F800                947              MOVEM.L D0-D4, -(A7)
000017AC                           948m             UTILPEN #TILELIGH
000017AC                           949m ;   IN:  #TILELIGH AS THE COLOR, FORMATED AS #00BBGGRR
000017AC                           950m ;   OUT: NONE
000017AC                           951m ;   MOD: D0, D1    
000017AC                           952m ;   DES: MACRO TO SET PEN COLOR
000017AC                           953m 
000017AC  103C 0050                954m         MOVE.B  #80, D0 
000017B0  223C 00CCE0EA            955m         MOVE.L  #TILELIGH, D1
000017B6  4E4F                     956m         TRAP    #15
000017B8                           957m         ENDM
000017B8                           958  
000017B8                           959m             UTILTILE #91, (KEYX), (KEYY)             
000017B8                           960m ;   IN:  #91 PROCEDURE OF THE TRAP #15
000017B8                           961m ;        (KEYX) X COORDINATE
000017B8                           962m ;        (KEYY) Y COORDINATE
000017B8                           963m ;   OUT: NONE
000017B8                           964m ;   MOD: D1-D4
000017B8                           965m ;   DES: DRAWS A GRAPHIC AT (KEYX) (KEYY)
000017B8  3239 00002B44            966m         MOVE.W  (KEYX), D1               ; D1 = X CENTER
000017BE  3439 00002B46            967m         MOVE.W  (KEYY), D2               ; D1 = Y CENTER
000017C4  3601                     968m         MOVE.W  D1, D3
000017C6  3802                     969m         MOVE.W  D2, D4
000017C8  0441 0010                970m         SUB.W   #TILEDIM/2, D1              ; SET TOP LEFT CORNER
000017CC  0442 0010                971m         SUB.W   #TILEDIM/2, D2              ; SET TOP LEFT CORNER 
000017D0  0643 0010                972m         ADD.W   #TILEDIM/2, D3              ; SET LOW RIGHT CORNER
000017D4  0644 0010                973m         ADD.W   #TILEDIM/2, D4              ; SET LOW RIGHT CORNER
000017D8                           974m 
000017D8  303C 005B                975m         MOVE.W  #91, D0
000017DC  4E4F                     976m         TRAP    #15
000017DE                           977m         ENDM
000017DE                           978             
000017DE  4CDF 001F                979              MOVEM.L (A7)+,D0-D4
000017E2                           980  .NOKEY            
000017E2  4E75                     981              RTS
000017E2  4E75                     982  -------------------- end include --------------------
000017E4                           983              INCLUDE "STAIRS.X68"            ; STAIR MANAGER 
000017E4                           984  STAIRSINIT          ; RANDOM POSTION
000017E4  2F00                     985              MOVE.L D0, -(A7)
000017E6  4EB8 153C                986              JSR     RNGX
000017EA  33C0 00002B48            987              MOVE.W  D0, (STAIRSX)
000017F0  4EB8 156C                988              JSR     RNGY
000017F4  33C0 00002B4A            989              MOVE.W  D0, (STAIRSY)
000017FA  201F                     990              MOVE.L  (A7)+, D0
000017FC  4279 00002B56            991              CLR     ONSTAIRS
00001802  4E75                     992              RTS
00001804                           993  STAIRSUPDT          
00001804  48E7 E070                994              MOVEM.L D0-D2/A1-A3, -(A7)
00001808  3039 00002B48            995              MOVE.W  (STAIRSX), D0
0000180E  3239 00002B4A            996              MOVE.W  (STAIRSY), D1
00001814  4EB8 1512                997              JSR     UTILCOLL
00001818  B43C 00FF                998              CMP.B   #$FF, D2
0000181C  6600 0062                999              BNE     .ENDD
00001820                          1000              
00001820                          1001              ; THE PLAYER IS IN THE POSITION OF THE STAIRS
00001820  0C39 0001 00002B50      1002              CMP.B   #1, (KEYOBTEINED)
00001828  6600 004A               1003              BNE     .NOKEY
0000182C  4EB8 1758               1004              JSR     KEYINIT
00001830  4EB8 17E4               1005              JSR     STAIRSINIT
00001834                          1006  
00001834                          1007  ; CREATE ENEMIES BASED ON LEVEL 
00001834  4280                    1008              CLR.L   D0
00001836  303C 0007               1009              MOVE.W  #ENEMYID, D0
0000183A  4EB8 1600               1010              JSR     AGLFKIL     ; KILLS ALL AGENTS WITH ID       
0000183E  3239 00002B5E           1011              MOVE.W (LEVEL), D1
00001844                          1012              
00001844                          1013  .ENEMYADD
00001844  43F9 0000190A           1014              LEA     ENEMYINIT, A1
0000184A  45F9 00001922           1015              LEA     ENEMYUPDT, A2
00001850  47F9 00001946           1016              LEA     ENEMYPLOT, A3
00001856  303C 0007               1017              MOVE.W  #ENEMYID, D0
0000185A                          1018              
0000185A  4EB8 159C               1019              JSR     AGLADD
0000185E  51C9 FFE4               1020              DBRA.W    D1, .ENEMYADD
00001862                          1021  
00001862  13FC 0000 00002B50      1022              MOVE.B  #0, (KEYOBTEINED)
0000186A  5279 00002B5E           1023              ADDQ.W  #1, (LEVEL)
00001870  6000 0014               1024              BRA     .END
00001874                          1025  .NOKEY      ; SAME POSITION NO KEY
00001874  33FC 0001 00002B56      1026              MOVE.W  #1, (ONSTAIRS)
0000187C  6000 0008               1027              BRA     .END
00001880                          1028              
00001880                          1029  .ENDD
00001880  4279 00002B56           1030              CLR     ONSTAIRS
00001886                          1031  .END
00001886                          1032              
00001886  4CDF 0E07               1033              MOVEM.L (A7)+, D0-D2/A1-A3
0000188A  4E75                    1034              RTS
0000188C                          1035              
0000188C                          1036  STAIRSPLOT          
0000188C  48E7 F800               1037              MOVEM.L D0-D4, -(A7)
00001890                          1038                      
00001890                          1039m             UTILPEN #TILELIGH
00001890                          1040m ;   IN:  #TILELIGH AS THE COLOR, FORMATED AS #00BBGGRR
00001890                          1041m ;   OUT: NONE
00001890                          1042m ;   MOD: D0, D1    
00001890                          1043m ;   DES: MACRO TO SET PEN COLOR
00001890                          1044m 
00001890  103C 0050               1045m         MOVE.B  #80, D0 
00001894  223C 00CCE0EA           1046m         MOVE.L  #TILELIGH, D1
0000189A  4E4F                    1047m         TRAP    #15
0000189C                          1048m         ENDM
0000189C                          1049m             UTILFILL #TILELIGH 
0000189C                          1050m ;   IN:  #TILELIGH AS THE COLOR, FORMATED AS #00BBGGRR
0000189C                          1051m ;   OUT: NONE
0000189C                          1052m ;   MOD: D0, D1
0000189C                          1053m ;   DES: MACRO TO SET FILL COLOR
0000189C                          1054m 
0000189C  103C 0051               1055m         MOVE.B  #81, D0
000018A0  223C 00CCE0EA           1056m         MOVE.L  #TILELIGH, D1
000018A6  4E4F                    1057m         TRAP    #15
000018A8                          1058m         ENDM
000018A8                          1059                              
000018A8  0C39 0001 00002B50      1060              CMP.B   #1, (KEYOBTEINED)
000018B0  6700 002C               1061              BEQ     .KEYOBTEINED
000018B4                          1062m             UTILTILE #88, (STAIRSX), (STAIRSY)
000018B4                          1063m ;   IN:  #88 PROCEDURE OF THE TRAP #15
000018B4                          1064m ;        (STAIRSX) X COORDINATE
000018B4                          1065m ;        (STAIRSY) Y COORDINATE
000018B4                          1066m ;   OUT: NONE
000018B4                          1067m ;   MOD: D1-D4
000018B4                          1068m ;   DES: DRAWS A GRAPHIC AT (STAIRSX) (STAIRSY)
000018B4  3239 00002B48           1069m         MOVE.W  (STAIRSX), D1               ; D1 = X CENTER
000018BA  3439 00002B4A           1070m         MOVE.W  (STAIRSY), D2               ; D1 = Y CENTER
000018C0  3601                    1071m         MOVE.W  D1, D3
000018C2  3802                    1072m         MOVE.W  D2, D4
000018C4  0441 0010               1073m         SUB.W   #TILEDIM/2, D1              ; SET TOP LEFT CORNER
000018C8  0442 0010               1074m         SUB.W   #TILEDIM/2, D2              ; SET TOP LEFT CORNER 
000018CC  0643 0010               1075m         ADD.W   #TILEDIM/2, D3              ; SET LOW RIGHT CORNER
000018D0  0644 0010               1076m         ADD.W   #TILEDIM/2, D4              ; SET LOW RIGHT CORNER
000018D4                          1077m 
000018D4  303C 0058               1078m         MOVE.W  #88, D0
000018D8  4E4F                    1079m         TRAP    #15
000018DA                          1080m         ENDM
000018DA  6000 0028               1081              BRA     .END
000018DE                          1082  .KEYOBTEINED
000018DE                          1083m             UTILTILE #91, (STAIRSX), (STAIRSY)
000018DE                          1084m ;   IN:  #91 PROCEDURE OF THE TRAP #15
000018DE                          1085m ;        (STAIRSX) X COORDINATE
000018DE                          1086m ;        (STAIRSY) Y COORDINATE
000018DE                          1087m ;   OUT: NONE
000018DE                          1088m ;   MOD: D1-D4
000018DE                          1089m ;   DES: DRAWS A GRAPHIC AT (STAIRSX) (STAIRSY)
000018DE  3239 00002B48           1090m         MOVE.W  (STAIRSX), D1               ; D1 = X CENTER
000018E4  3439 00002B4A           1091m         MOVE.W  (STAIRSY), D2               ; D1 = Y CENTER
000018EA  3601                    1092m         MOVE.W  D1, D3
000018EC  3802                    1093m         MOVE.W  D2, D4
000018EE  0441 0010               1094m         SUB.W   #TILEDIM/2, D1              ; SET TOP LEFT CORNER
000018F2  0442 0010               1095m         SUB.W   #TILEDIM/2, D2              ; SET TOP LEFT CORNER 
000018F6  0643 0010               1096m         ADD.W   #TILEDIM/2, D3              ; SET LOW RIGHT CORNER
000018FA  0644 0010               1097m         ADD.W   #TILEDIM/2, D4              ; SET LOW RIGHT CORNER
000018FE                          1098m 
000018FE  303C 005B               1099m         MOVE.W  #91, D0
00001902  4E4F                    1100m         TRAP    #15
00001904                          1101m         ENDM
00001904                          1102  
00001904                          1103  .END
00001904  4CDF 001F               1104              MOVEM.L (A7)+,D0-D4
00001908  4E75                    1105              RTS
0000190A                          1106  
0000190A                          1107  
0000190A                          1108  -------------------- end include --------------------
0000190A                          1109              INCLUDE "ENEMY.X68"             ; ENEMY MANAGER
0000190A                          1110  ;   LOCAL VARIABLES:
0000190A                          1111  ;       XCENTER -   (A0)    WORD
0000190A                          1112  ;       YCENTER -   2(A0)   WORD
0000190A                          1113  ;       ID      -   
0000190A                          1114  ;------------------------------------------------------------------------------
0000190A                          1115  ENEMYINIT
0000190A                          1116  ; DES       :       ENEMY INIT
0000190A                          1117  ; IN        :       NONE
0000190A                          1118  ; OUT       :       NONE
0000190A                          1119  ; MOD       :       (A0) WITH X COORDINATE
0000190A                          1120  ;           2(A0) WITH Y COORDINATE
0000190A                          1121  ;------------------------------------------------------------------------------
0000190A                          1122                   
0000190A  48E7 8000               1123              MOVEM.L  D0, -(A7)
0000190E                          1124              ; move.w #1, d1 ????            
0000190E  4EB8 153C               1125              JSR     RNGX
00001912  3080                    1126              MOVE.W  D0, (A0)        ; MOVE X COORDINATE TO (A0) | AGENT CONTROL
00001914  4EB8 156C               1127              JSR     RNGY 
00001918  3140 0002               1128              MOVE.W  D0, 2(A0)       ; MOVE Y COORDIANTE TO 2(A0) | AGENT CONTROL
0000191C                          1129  
0000191C  4CDF 0001               1130              MOVEM.L  (A7)+, D0
00001920  4E75                    1131              RTS
00001922                          1132  
00001922                          1133  ;------------------------------------------------------------------------------
00001922                          1134  ENEMYUPDT
00001922                          1135  ; DES       :       ENEMY UPDATE. SEES IF PLAYER IS IN THE SAME BLOCK AS HIMSELF
00001922                          1136  ; IN        :       NONE
00001922                          1137  ; OUT       :       NONE
00001922                          1138  ; MOD       :       (STANEXT) IN CASE PLAYER IS IN THE SAME BLOCK AS HIMSELF
00001922                          1139  ;------------------------------------------------------------------------------
00001922                          1140  
00001922  48E7 E000               1141              MOVEM.L D0-D2, -(A7)
00001926                          1142  
00001926  3010                    1143              MOVE.W  (A0), D0
00001928  3228 0002               1144              MOVE.W  2(A0), D1
0000192C  4EB8 1512               1145              JSR     UTILCOLL
00001930  B43C 00FF               1146              CMP.B   #$FF, D2
00001934  6600 000A               1147              BNE     .END
00001938                          1148              ; THE PLAYER IS IN THE POSITION OF THE STAIRS  
00001938  33FC 0002 00002B4E      1149              MOVE.W  #STADM, (STANEXT)
00001940                          1150  .END
00001940  4CDF 0007               1151              MOVEM.L (A7)+, D0-D2
00001944  4E75                    1152              RTS
00001946                          1153  ;------------------------------------------------------------------------------
00001946                          1154  ENEMYPLOT
00001946                          1155  ; DES       :       ENEMY PLOT
00001946                          1156  ; IN        :       NONE
00001946                          1157  ; OUT       :       NONE
00001946                          1158  ; MOD       :       NONE
00001946                          1159  ;------------------------------------------------------------------------------
00001946  48E7 F800               1160              MOVEM.L D0-D4, -(A7)
0000194A                          1161  
0000194A                          1162m             UTILPEN #TILEDETA                       
0000194A                          1163m ;   IN:  #TILEDETA AS THE COLOR, FORMATED AS #00BBGGRR
0000194A                          1164m ;   OUT: NONE
0000194A                          1165m ;   MOD: D0, D1    
0000194A                          1166m ;   DES: MACRO TO SET PEN COLOR
0000194A                          1167m 
0000194A  103C 0050               1168m         MOVE.B  #80, D0 
0000194E  223C 00957EA0           1169m         MOVE.L  #TILEDETA, D1
00001954  4E4F                    1170m         TRAP    #15
00001956                          1171m         ENDM
00001956                          1172m             UTILFILL #TILEDETA
00001956                          1173m ;   IN:  #TILEDETA AS THE COLOR, FORMATED AS #00BBGGRR
00001956                          1174m ;   OUT: NONE
00001956                          1175m ;   MOD: D0, D1
00001956                          1176m ;   DES: MACRO TO SET FILL COLOR
00001956                          1177m 
00001956  103C 0051               1178m         MOVE.B  #81, D0
0000195A  223C 00957EA0           1179m         MOVE.L  #TILEDETA, D1
00001960  4E4F                    1180m         TRAP    #15
00001962                          1181m         ENDM
00001962                          1182m             UTILTILE #87, (A0), 2(A0)
00001962                          1183m ;   IN:  #87 PROCEDURE OF THE TRAP #15
00001962                          1184m ;        (A0) X COORDINATE
00001962                          1185m ;        2(A0) Y COORDINATE
00001962                          1186m ;   OUT: NONE
00001962                          1187m ;   MOD: D1-D4
00001962                          1188m ;   DES: DRAWS A GRAPHIC AT (A0) 2(A0)
00001962  3210                    1189m         MOVE.W  (A0), D1               ; D1 = X CENTER
00001964  3428 0002               1190m         MOVE.W  2(A0), D2               ; D1 = Y CENTER
00001968  3601                    1191m         MOVE.W  D1, D3
0000196A  3802                    1192m         MOVE.W  D2, D4
0000196C  0441 0010               1193m         SUB.W   #TILEDIM/2, D1              ; SET TOP LEFT CORNER
00001970  0442 0010               1194m         SUB.W   #TILEDIM/2, D2              ; SET TOP LEFT CORNER 
00001974  0643 0010               1195m         ADD.W   #TILEDIM/2, D3              ; SET LOW RIGHT CORNER
00001978  0644 0010               1196m         ADD.W   #TILEDIM/2, D4              ; SET LOW RIGHT CORNER
0000197C                          1197m 
0000197C  303C 0057               1198m         MOVE.W  #87, D0
00001980  4E4F                    1199m         TRAP    #15
00001982                          1200m         ENDM
00001982                          1201              
00001982  4CDF 001F               1202              MOVEM.L (A7)+,D0-D4
00001986  4E75                    1203              RTS
00001988                          1204  
00001988                          1205  -------------------- end include --------------------
00001988                          1206              INCLUDE "MISC.X68"              ; MISCELLANEOUS MANAGER
00001988                          1207  ; ----------------------------------------------------------------------------- 
00001988                          1208  MISCPLOT
00001988                          1209  ; DES       :       PLOTS ALL MISC PROCEDURES
00001988                          1210  ; IN        :       NONE
00001988                          1211  ; OUT       :       NONE
00001988                          1212  ; MOD       :       NONE
00001988                          1213  ;------------------------------------------------------------------------------
00001988  4EB9 00001996           1214          JSR .LVLPLOT
0000198E  4EB9 000019BA           1215          JSR .NOOKEYPLOT
00001994  4E75                    1216          RTS
00001996                          1217  
00001996                          1218  ;------------------------------------------------------------------------------
00001996                          1219  .LVLPLOT
00001996                          1220  ; DES       :       PLOTS LEVEL COUNTER ON THE TOP LEFT CORNER
00001996                          1221  ; IN        :       NONE
00001996                          1222  ; OUT       :       NONE
00001996                          1223  ; MOD       :       NONE
00001996                          1224  ;------------------------------------------------------------------------------
00001996  48E7 E040               1225          MOVEM.L D0-D2/A1, -(A7)
0000199A                          1226          
0000199A                          1227m         UTILFILL #00000000      
0000199A                          1228m ;   IN:  #00000000 AS THE COLOR, FORMATED AS #00BBGGRR
0000199A                          1229m ;   OUT: NONE
0000199A                          1230m ;   MOD: D0, D1
0000199A                          1231m ;   DES: MACRO TO SET FILL COLOR
0000199A                          1232m 
0000199A  103C 0051               1233m         MOVE.B  #81, D0
0000199E  7200                    1234m         MOVE.L  #00000000, D1
000019A0  4E4F                    1235m         TRAP    #15
000019A2                          1236m         ENDM
000019A2                          1237  
000019A2  43F8 124D               1238          LEA     LEVELSTRING, A1
000019A6  4281                    1239          CLR.L   D1
000019A8  3239 00002B5E           1240          MOVE.W  (LEVEL), D1
000019AE  103C 0011               1241          MOVE.B  #17,D0
000019B2  4E4F                    1242          TRAP    #15
000019B4                          1243          
000019B4  4CDF 0207               1244          MOVEM.L (A7)+, D0-D2/A1
000019B8  4E75                    1245          RTS 
000019BA                          1246  ;------------------------------------------------------------------------------
000019BA                          1247  .NOOKEYPLOT
000019BA                          1248  ; DES       :       PLOTS A TEXT IF PLAYER IS ON STAIRS AND HAS NO KEY
000019BA                          1249  ; IN        :       NONE
000019BA                          1250  ; OUT       :       NONE
000019BA                          1251  ; MOD       :       NONE
000019BA                          1252  ;------------------------------------------------------------------------------
000019BA  0C79 0001 00002B56      1253          CMP     #1, (ONSTAIRS)
000019C2  6600 001C               1254          BNE     .END     
000019C6  48E7 E040               1255          MOVEM.L D0-D2/A1, -(A7)
000019CA                          1256m         UTILTEXT NOKEYSTRING, #SCRWIDTH/2-100, #SCRHEIGH/8  
000019CA                          1257m ;   IN:  NOKEYSTRING TEXT 
000019CA                          1258m ;        #SCRWIDTH/2-100 TEXT X
000019CA                          1259m ;        #SCRHEIGH/8 TEXT Y
000019CA                          1260m ;   OUT: NONE
000019CA                          1261m ;   MOD: D0-D2 / A1
000019CA                          1262m ;   DES: PRINTS THE 0 TERINATED STRING IN NOKEYSTRING IN COORDINATES #SCRWIDTH/2-100 #SCRHEIGH/8
000019CA                          1263m 
000019CA  43F8 11D6               1264m         LEA     NOKEYSTRING, A1
000019CE  323C 00DC               1265m         MOVE.W  #SCRWIDTH/2-100, D1
000019D2  343C 003C               1266m         MOVE.W  #SCRHEIGH/8, D2
000019D6                          1267m 
000019D6  303C 005F               1268m         MOVE.W  #95, D0
000019DA  4E4F                    1269m         TRAP    #15
000019DC                          1270m         ENDM
000019DC  4CDF 0207               1271          MOVEM.L (A7)+, D0-D2/A1
000019E0                          1272  .END        
000019E0  4E75                    1273          RTS
000019E0  4E75                    1274  -------------------- end include --------------------
000019E2                          1275              INCLUDE "STATES.X68"            ; STATES MANAGER
000019E2                          1276  ; =============================================================================
000019E2                          1277  ; TITLE    : GAME STATE MANAGEMENT
000019E2                          1278  ; AUTHOR   : RUBEN PALMER PEREZ
000019E2                          1279  ; HISTORY  : 
000019E2                          1280  ; =============================================================================
000019E2                          1281  
000019E2                          1282  ; -----------------------------------------------------------------------------
000019E2                          1283  STAINIT
000019E2                          1284  ; INITALIZES THE STATE MANAGER
000019E2                          1285  ; INPUT    - NONE
000019E2                          1286  ; OUTPUT   - NONE
000019E2                          1287  ; MODIFIES - NONE
000019E2                          1288  ; -----------------------------------------------------------------------------
000019E2  33FC FFFF 00002B4C      1289              MOVE.W  #-1,(STACUR)            ; INVALID STATE, JUST TO FORCE INIT
000019EA  33FC 0000 00002B4E      1290              MOVE.W  #0,(STANEXT)            ; INITIAL STATE
000019F2  4E75                    1291              RTS
000019F4                          1292  
000019F4                          1293  ; -----------------------------------------------------------------------------
000019F4                          1294  STAUPD
000019F4                          1295  ; PERFORMS STATE UPDATE AND INIT IF NECESSARY
000019F4                          1296  ; INPUT    - NONE
000019F4                          1297  ; OUTPUT   - NONE
000019F4                          1298  ; MODIFIES - NONE
000019F4                          1299  ; -----------------------------------------------------------------------------
000019F4  48E7 8080               1300              MOVEM.L D0/A0,-(A7)
000019F8  4280                    1301              CLR.L   D0
000019FA  3039 00002B4E           1302              MOVE.W  (STANEXT),D0
00001A00  B079 00002B4C           1303              CMP.W   (STACUR),D0
00001A06  6700 0012               1304              BEQ     .DOUPD
00001A0A  33C0 00002B4C           1305              MOVE.W  D0,(STACUR)             ; IF STATE CHANGED, DO INIT
00001A10  E588                    1306              LSL.L   #2,D0
00001A12  2040                    1307              MOVE.L  D0,A0
00001A14  2068 1A32               1308              MOVE.L  .INITBL(A0),A0
00001A18  4E90                    1309              JSR     (A0)
00001A1A  4280                    1310  .DOUPD      CLR.L   D0                      ; IN ANY CASE, DO UPDATE
00001A1C  3039 00002B4C           1311              MOVE.W  (STACUR),D0
00001A22  E588                    1312              LSL.L   #2,D0
00001A24  2040                    1313              MOVE.L  D0,A0
00001A26  2068 1A3E               1314              MOVE.L  .UPDTBL(A0),A0
00001A2A  4E90                    1315              JSR     (A0)
00001A2C  4CDF 0101               1316              MOVEM.L (A7)+,D0/A0
00001A30  4E75                    1317              RTS
00001A32= 00001A74 00001BF2 ...   1318  .INITBL     DC.L    STAMMI,STAGPI,STAEMPTY
00001A3E= 00001A96 00001C02 ...   1319  .UPDTBL     DC.L    STAMMU,STAGPU,STADMU
00001A4A                          1320  
00001A4A                          1321  ; -----------------------------------------------------------------------------
00001A4A                          1322  STAPLOT
00001A4A                          1323  ; PERFORMS STATE PLOT
00001A4A                          1324  ; INPUT    - NONE
00001A4A                          1325  ; OUTPUT   - NONE
00001A4A                          1326  ; MODIFIES - NONE
00001A4A                          1327  ; -----------------------------------------------------------------------------
00001A4A  48E7 8080               1328              MOVEM.L D0/A0,-(A7)
00001A4E  4280                    1329              CLR.L   D0
00001A50  3039 00002B4C           1330              MOVE.W  (STACUR),D0
00001A56  E588                    1331              LSL.L   #2,D0
00001A58  2040                    1332              MOVE.L  D0,A0
00001A5A  2068 1A66               1333              MOVE.L  .PLTTBL(A0),A0
00001A5E  4E90                    1334              JSR     (A0)
00001A60  4CDF 0101               1335              MOVEM.L (A7)+,D0/A0
00001A64  4E75                    1336              RTS
00001A66= 00001B0C 00001C3E ...   1337  .PLTTBL     DC.L    STAMMP,STAGPP,STADMP
00001A72                          1338  
00001A72                          1339  ; -----------------------------------------------------------------------------
00001A72                          1340  STAEMPTY
00001A72                          1341  ; EMPTY SUBROUTINE FOR CASES WITH NOTHING TO DO
00001A72                          1342  ; INPUT    - NONE
00001A72                          1343  ; OUTPUT   - NONE
00001A72                          1344  ; MODIFIES - NONE
00001A72                          1345  ; NOTE     - JUST A PLACEHOLDER. NOTHING TO DO.
00001A72                          1346  ; -----------------------------------------------------------------------------
00001A72  4E75                    1347              RTS
00001A74                          1348  ;------------------------------------------------------------------------------
00001A74                          1349  STAMMI
00001A74                          1350  ; DES       :       MAIN MENU STATE INIT
00001A74                          1351  ; IN        :       NONE
00001A74                          1352  ; OUT       :       NONE
00001A74                          1353  ; MOD       :       NONE
00001A74                          1354  ;------------------------------------------------------------------------------
00001A74  2F00                    1355              MOVE.L  D0, -(A7)
00001A76  303C 0007               1356              MOVE.W  #7, D0
00001A7A  4EB8 1600               1357              JSR     AGLFKIL
00001A7E  201F                    1358              MOVE.L  (A7)+, D0
00001A80  4279 00002B5E           1359              CLR     (LEVEL)
00001A86  4279 00002B52           1360              CLR     (TORCHSHADDER)
00001A8C  33FC 0003 00002B58      1361              MOVE.W  #3, TORCHRANGE
00001A94  4E75                    1362              RTS
00001A96                          1363  
00001A96                          1364  ;------------------------------------------------------------------------------
00001A96                          1365  STAMMU
00001A96                          1366  ; DES       :       MAIN MENU STATE UPDATE. CHECKS IF THE PLAYER HAS CLICKED ANY BUTTON ON SCREEN
00001A96                          1367  ; IN        :       NONE
00001A96                          1368  ; OUT       :       NONE
00001A96                          1369  ; MOD       :       NONE
00001A96                          1370  ;------------------------------------------------------------------------------
00001A96  48E7 F000               1371              MOVEM.L D0-D3, -(A7)
00001A9A                          1372  
00001A9A  303C 003C               1373              MOVE.W  #60, D0
00001A9E  323C 0012               1374              MOVE.W  #%00010010, D1  ; ACTIVATE MOUSE IRQ TO MOUSE DOWN AND UP
00001AA2  4E4F                    1375              TRAP    #15
00001AA4                          1376              
00001AA4                          1377          
00001AA4  303C 003D               1378              MOVE.W  #61, D0
00001AA8  4241                    1379              CLR     D1
00001AAA  4E4F                    1380              TRAP    #15             
00001AAC                          1381          
00001AAC  B03C 0000               1382              CMP.B   #0, D0          ; CHECK IF LEFT BUTTON OF MOUSE IS PRESSED
00001AB0  6700 0054               1383              BEQ     .END            ; NOT PRESSED
00001AB4  2601                    1384              MOVE.L  D1, D3
00001AB6  E08B                    1385              LSR.L   #8, D3
00001AB8  E08B                    1386              LSR.L   #8, D3
00001ABA                          1387  
00001ABA  B67C 0163               1388              CMP.W    #(BUTTONY-BUTTONHEIGH), D3
00001ABE  6F00 0046               1389              BLE     .END
00001AC2  B67C 01BD               1390              CMP.W   #(BUTTONY+BUTTONHEIGH), D3 
00001AC6  6C00 003E               1391              BGE     .END
00001ACA                          1392              
00001ACA                          1393              
00001ACA                          1394              ; RIGHT X COORDINATE 
00001ACA                          1395              
00001ACA  B27C 0085               1396              CMP.W   #(BUTTONX1-BUTTONWIDTH), D1    ; X COORDINATE
00001ACE  6F00 0016               1397              BLE     .X2
00001AD2  B27C 0125               1398              CMP.W   #(BUTTONX1+BUTTONWIDTH), D1   
00001AD6  6C00 000E               1399              BGE     .X2
00001ADA                          1400              ; EASY
00001ADA  33FC 0001 00002B4E      1401              MOVE.W  #STAGP, (STANEXT)
00001AE2  6000 0022               1402              BRA     .END
00001AE6                          1403  
00001AE6  B27C 015A               1404  .X2         CMP.W   #(BUTTONX2-BUTTONWIDTH), D1    ; X COORDINATE
00001AEA  6F00 001A               1405              BLE     .END
00001AEE  B27C 01FA               1406              CMP.W   #(BUTTONX2+BUTTONWIDTH), D1   
00001AF2  6C00 0012               1407              BGE     .END
00001AF6                          1408              ; NORMAL
00001AF6  33FC 0001 00002B52      1409              MOVE.W  #1, (TORCHSHADDER)
00001AFE  33FC 0001 00002B4E      1410              MOVE.W  #STAGP, (STANEXT)
00001B06                          1411  .END        
00001B06  4CDF 000F               1412              MOVEM.L (A7)+, D0-D3
00001B0A  4E75                    1413              RTS
00001B0C                          1414  
00001B0C                          1415  ;------------------------------------------------------------------------------
00001B0C                          1416  STAMMP
00001B0C                          1417  ; DES       :       MAIN MENU STATE PLOT
00001B0C                          1418  ; IN        :       NONE
00001B0C                          1419  ; OUT       :       NONE
00001B0C                          1420  ; MOD       :       NONE
00001B0C                          1421  ;------------------------------------------------------------------------------
00001B0C  48E7 C040               1422              MOVEM.L D0-D1/A1, -(A7)
00001B10  323C 1C05               1423              MOVE.W  #((80-24)/2)<<8|5, D1
00001B14  103C 000B               1424              MOVE.B  #11, D0
00001B18  4E4F                    1425              TRAP    #15
00001B1A  43F8 1256               1426              LEA     TITLESTRING, A1
00001B1E  303C 000D               1427              MOVE.W  #13, D0
00001B22  4E4F                    1428              TRAP    #15
00001B24                          1429  
00001B24  4281                    1430              CLR.L   D1
00001B26  323C 1D07               1431              MOVE.W  #((80-22)/2)<<8|7, D1
00001B2A  103C 000B               1432              MOVE.B  #11, D0
00001B2E  4E4F                    1433              TRAP    #15
00001B30  43F8 126F               1434              LEA     SUBTITLESTR, A1
00001B34  303C 000D               1435              MOVE.W  #13, D0
00001B38  4E4F                    1436              TRAP    #15
00001B3A                          1437  
00001B3A  4281                    1438              CLR.L   D1
00001B3C  323C 1D08               1439              MOVE.W  #((80-22)/2)<<8|8, D1
00001B40  103C 000B               1440              MOVE.B  #11, D0
00001B44  4E4F                    1441              TRAP    #15
00001B46  43F8 129F               1442              LEA     BECARESTR, A1
00001B4A  303C 000D               1443              MOVE.W  #13, D0
00001B4E  4E4F                    1444              TRAP    #15
00001B50                          1445  
00001B50  0839 0004 00001EB9      1446              BTST.B  #4, (SCRCYCCT)  ; TIMER 
00001B58  6700 0092               1447              BEQ     .END
00001B5C                          1448              
00001B5C                          1449m             UTILFILL #$00000000
00001B5C                          1450m ;   IN:  #$00000000 AS THE COLOR, FORMATED AS #00BBGGRR
00001B5C                          1451m ;   OUT: NONE
00001B5C                          1452m ;   MOD: D0, D1
00001B5C                          1453m ;   DES: MACRO TO SET FILL COLOR
00001B5C                          1454m 
00001B5C  103C 0051               1455m         MOVE.B  #81, D0
00001B60  7200                    1456m         MOVE.L  #$00000000, D1
00001B62  4E4F                    1457m         TRAP    #15
00001B64                          1458m         ENDM
00001B64                          1459m             UTILPEN #$00FFFFFF
00001B64                          1460m ;   IN:  #$00FFFFFF AS THE COLOR, FORMATED AS #00BBGGRR
00001B64                          1461m ;   OUT: NONE
00001B64                          1462m ;   MOD: D0, D1    
00001B64                          1463m ;   DES: MACRO TO SET PEN COLOR
00001B64                          1464m 
00001B64  103C 0050               1465m         MOVE.B  #80, D0 
00001B68  223C 00FFFFFF           1466m         MOVE.L  #$00FFFFFF, D1
00001B6E  4E4F                    1467m         TRAP    #15
00001B70                          1468m         ENDM
00001B70  323C 00D5               1469              MOVE.W  #BUTTONX1, D1
00001B74  343C 0190               1470              MOVE.W  #BUTTONY, D2
00001B78  3601                    1471              MOVE.W  D1, D3
00001B7A  3802                    1472              MOVE.W  D2, D4 
00001B7C  0441 0028               1473              SUB.W   #BUTTONWIDTH/2, D1              ; SET TOP LEFT CORNER
00001B80  0442 0016               1474              SUB.W   #BUTTONHEIGH/2, D2              ; SET TOP LEFT CORNER 
00001B84  0643 0028               1475              ADD.W   #BUTTONWIDTH/2, D3              ; SET LOW RIGHT CORNER
00001B88  0644 0016               1476              ADD.W   #BUTTONHEIGH/2, D4              ; SET LOW RIGHT CORNER
00001B8C                          1477  
00001B8C  303C 0057               1478              MOVE.W  #87, D0
00001B90  4E4F                    1479              TRAP    #15                             ; DRAW RECTANGLE
00001B92                          1480  
00001B92  43F8 12C1               1481              LEA     EASYSTR, A1
00001B96  323C 00C5               1482              MOVE.W  #BUTTONX1-16, D1
00001B9A  343C 0189               1483              MOVE.W  #BUTTONY-7, D2
00001B9E                          1484  
00001B9E  303C 005F               1485              MOVE.W  #95, D0
00001BA2  4E4F                    1486              TRAP    #15
00001BA4                          1487  
00001BA4                          1488              ; END
00001BA4                          1489m             UTILFILL #$00000000
00001BA4                          1490m ;   IN:  #$00000000 AS THE COLOR, FORMATED AS #00BBGGRR
00001BA4                          1491m ;   OUT: NONE
00001BA4                          1492m ;   MOD: D0, D1
00001BA4                          1493m ;   DES: MACRO TO SET FILL COLOR
00001BA4                          1494m 
00001BA4  103C 0051               1495m         MOVE.B  #81, D0
00001BA8  7200                    1496m         MOVE.L  #$00000000, D1
00001BAA  4E4F                    1497m         TRAP    #15
00001BAC                          1498m         ENDM
00001BAC                          1499m             UTILPEN #$00FFFFFF
00001BAC                          1500m ;   IN:  #$00FFFFFF AS THE COLOR, FORMATED AS #00BBGGRR
00001BAC                          1501m ;   OUT: NONE
00001BAC                          1502m ;   MOD: D0, D1    
00001BAC                          1503m ;   DES: MACRO TO SET PEN COLOR
00001BAC                          1504m 
00001BAC  103C 0050               1505m         MOVE.B  #80, D0 
00001BB0  223C 00FFFFFF           1506m         MOVE.L  #$00FFFFFF, D1
00001BB6  4E4F                    1507m         TRAP    #15
00001BB8                          1508m         ENDM
00001BB8  323C 01AA               1509              MOVE.W  #BUTTONX2, D1
00001BBC  343C 0190               1510              MOVE.W  #BUTTONY, D2
00001BC0  3601                    1511              MOVE.W  D1, D3
00001BC2  3802                    1512              MOVE.W  D2, D4 
00001BC4  0441 0028               1513              SUB.W   #BUTTONWIDTH/2, D1              ; SET TOP LEFT CORNER
00001BC8  0442 0016               1514              SUB.W   #BUTTONHEIGH/2, D2              ; SET TOP LEFT CORNER 
00001BCC  0643 0028               1515              ADD.W   #BUTTONWIDTH/2, D3              ; SET LOW RIGHT CORNER
00001BD0  0644 0016               1516              ADD.W   #BUTTONHEIGH/2, D4              ; SET LOW RIGHT CORNER
00001BD4                          1517  
00001BD4  303C 0057               1518              MOVE.W  #87, D0
00001BD8  4E4F                    1519              TRAP    #15                             ; DRAW RECTANGLE
00001BDA                          1520  
00001BDA  43F8 12C6               1521              LEA     NORMALSTR, A1
00001BDE  323C 0194               1522              MOVE.W  #BUTTONX2-22, D1
00001BE2  343C 0189               1523              MOVE.W  #BUTTONY-7, D2
00001BE6                          1524  
00001BE6  303C 005F               1525              MOVE.W  #95, D0
00001BEA  4E4F                    1526              TRAP    #15
00001BEC                          1527  .END    
00001BEC  4CDF 0203               1528              MOVEM.L (A7)+, D0-D1/A1
00001BF0                          1529             ;  UTILTEXT NEXTSTR, #SCRWIDTH/2, #SCRHEIGH-30
00001BF0  4E75                    1530              RTS
00001BF2                          1531  ;------------------------------------------------------------------------------
00001BF2                          1532  STAGPI
00001BF2                          1533  ; DES       :       GAME PLAY STATE INIT
00001BF2                          1534  ; IN        :       NONE
00001BF2                          1535  ; OUT       :       NONE
00001BF2                          1536  ; MOD       :       NONE
00001BF2                          1537  ;------------------------------------------------------------------------------
00001BF2                          1538  
00001BF2  4EB8 152E               1539                  JSR     RNDINIT
00001BF6  4EB8 1622               1540              JSR     PLAYERINIT
00001BFA  4EB8 1758               1541              JSR     KEYINIT
00001BFE  4EF8 17E4               1542              JMP     STAIRSINIT
00001C02                          1543             
00001C02                          1544  ;------------------------------------------------------------------------------
00001C02                          1545  STAGPU
00001C02                          1546  ; DES       :       GAME PLAY STATE UPDATE. 
00001C02                          1547  ; IN        :       NONE
00001C02                          1548  ; OUT       :       NONE
00001C02                          1549  ; MOD       :       (TORCHRANGE) WHENEVER IT NEEDS TO BE MODIFIED "DIFFICULTY"
00001C02                          1550  ;------------------------------------------------------------------------------
00001C02                          1551              
00001C02  0C79 0008 00002B5E      1552              CMP.W   #8, (LEVEL)
00001C0A  6700 001E               1553              BEQ     .CP1
00001C0E  0C79 000F 00002B5E      1554              CMP.W   #15, (LEVEL)
00001C16  6700 001C               1555              BEQ     .CP2
00001C1A                          1556  
00001C1A  4EB8 1634               1557  .CLASS      JSR     PLAYERUPDT
00001C1E  4EB8 1772               1558              JSR     KEYUPDT
00001C22  4EB8 1804               1559              JSR     STAIRSUPDT
00001C26  4EF8 15B6               1560              JMP     AGLUPDT
00001C2A                          1561  .CP1
00001C2A  33FC 0002 00002B58      1562              MOVE.W #2, (TORCHRANGE)
00001C32  60E6                    1563              BRA    .CLASS
00001C34                          1564  .CP2
00001C34  33FC 0001 00002B58      1565              MOVE.W #1, (TORCHRANGE)
00001C3C  60DC                    1566              BRA     .CLASS
00001C3E                          1567  
00001C3E                          1568  ;------------------------------------------------------------------------------
00001C3E                          1569  STAGPP
00001C3E                          1570  ; DES       :       GAME PLAY STATE PLOT
00001C3E                          1571  ; IN        :       NONE
00001C3E                          1572  ; OUT       :       NONE
00001C3E                          1573  ; MOD       :       NONE
00001C3E                          1574  ;------------------------------------------------------------------------------
00001C3E  4EB8 171A               1575              JSR     MAPPLOT
00001C42  4EB8 16D2               1576              JSR     PLAYERPLOT
00001C46  4EB8 179C               1577              JSR     KEYPLOT
00001C4A  4EB8 188C               1578              JSR     STAIRSPLOT
00001C4E                          1579              
00001C4E  4EB8 15DA               1580              JSR     AGLPLOT
00001C52  0C79 0000 00002B52      1581              CMP     #0, (TORCHSHADDER)
00001C5A  6700 0008               1582              BEQ     .END
00001C5E  4EB9 00001DDC           1583              JSR     SHADDERPLOT
00001C64                          1584              
00001C64                          1585  .END        
00001C64  4EB8 1988               1586              JSR     MISCPLOT
00001C68  4E75                    1587              RTS
00001C6A                          1588  
00001C6A                          1589  
00001C6A                          1590  ;------------------------------------------------------------------------------
00001C6A                          1591  STADMU
00001C6A                          1592  ; DES       :       DEATH MENU STATE UPDATE. CHECKS IF PLAYER HAS CLICKED ANY BUTTON
00001C6A                          1593  ; IN        :       NONE
00001C6A                          1594  ; OUT       :       NONE
00001C6A                          1595  ;MOD        :       NONE
00001C6A                          1596  ;------------------------------------------------------------------------------
00001C6A                          1597  ; STATE DEATH MENU UPDATE
00001C6A  48E7 F000               1598              MOVEM.L D0-D3, -(A7)
00001C6E                          1599  
00001C6E  303C 003C               1600              MOVE.W  #60, D0
00001C72  323C 0012               1601              MOVE.W  #%00010010, D1  ; ACTIVATE MOUSE IRQ TO MOUSE DOWN AND UP
00001C76  4E4F                    1602              TRAP    #15
00001C78                          1603              
00001C78                          1604          
00001C78  303C 003D               1605              MOVE.W  #61, D0
00001C7C  4241                    1606              CLR     D1
00001C7E  4E4F                    1607              TRAP    #15             
00001C80                          1608          
00001C80  B03C 0000               1609              CMP.B   #0, D0          ; CHECK IF LEFT BUTTON OF MOUSE IS PRESSED
00001C84  6700 004A               1610              BEQ     .END            ; NOT PRESSED
00001C88  2601                    1611              MOVE.L  D1, D3
00001C8A  E08B                    1612              LSR.L   #8, D3
00001C8C  E08B                    1613              LSR.L   #8, D3
00001C8E                          1614  
00001C8E  B67C 0163               1615              CMP.W    #(BUTTONY-BUTTONHEIGH), D3
00001C92  6F00 003C               1616              BLE     .END
00001C96  B67C 01BD               1617              CMP.W   #(BUTTONY+BUTTONHEIGH), D3 
00001C9A  6C00 0034               1618              BGE     .END
00001C9E                          1619              
00001C9E                          1620              
00001C9E                          1621              ; RIGHT X COORDINATE 
00001C9E                          1622              
00001C9E  B27C 0085               1623              CMP.W   #(BUTTONX1-BUTTONWIDTH), D1    ; X COORDINATE
00001CA2  6F00 0016               1624              BLE     .X2
00001CA6  B27C 0125               1625              CMP.W   #(BUTTONX1+BUTTONWIDTH), D1   
00001CAA  6C00 000E               1626              BGE     .X2
00001CAE                          1627              ; RETRY
00001CAE  33FC 0000 00002B4E      1628              MOVE.W  #STAMM, (STANEXT)
00001CB6  6000 0018               1629              BRA     .END
00001CBA                          1630  
00001CBA  B27C 015A               1631  .X2         CMP.W   #(BUTTONX2-BUTTONWIDTH), D1    ; X COORDINATE
00001CBE  6F00 0010               1632              BLE     .END
00001CC2  B27C 01FA               1633              CMP.W   #(BUTTONX2+BUTTONWIDTH), D1   
00001CC6  6C00 0008               1634              BGE     .END
00001CCA                          1635              ; EXIT
00001CCA                          1636  
00001CCA  4EB9 00001EB2           1637              JSR     LOOSE
00001CD0                          1638  .END        
00001CD0  4CDF 000F               1639              MOVEM.L (A7)+, D0-D3
00001CD4  4E75                    1640              RTS
00001CD6                          1641  
00001CD6                          1642  ;------------------------------------------------------------------------------
00001CD6                          1643  STADMP
00001CD6                          1644  ; DES       :       DEATH MENU STATE PLOT
00001CD6                          1645  ; IN        :       NONE
00001CD6                          1646  ; OUT       :       NONE
00001CD6                          1647  ; MOD       :       NONE
00001CD6                          1648  ;------------------------------------------------------------------------------
00001CD6  48E7 F840               1649          MOVEM.L D0-D4/A1, -(A7)
00001CDA                          1650              ; -- BLACK SQUARE ---
00001CDA                          1651m         UTILPEN #0                       
00001CDA                          1652m ;   IN:  #0 AS THE COLOR, FORMATED AS #00BBGGRR
00001CDA                          1653m ;   OUT: NONE
00001CDA                          1654m ;   MOD: D0, D1    
00001CDA                          1655m ;   DES: MACRO TO SET PEN COLOR
00001CDA                          1656m 
00001CDA  103C 0050               1657m         MOVE.B  #80, D0 
00001CDE  7200                    1658m         MOVE.L  #0, D1
00001CE0  4E4F                    1659m         TRAP    #15
00001CE2                          1660m         ENDM
00001CE2                          1661m         UTILFILL #0
00001CE2                          1662m ;   IN:  #0 AS THE COLOR, FORMATED AS #00BBGGRR
00001CE2                          1663m ;   OUT: NONE
00001CE2                          1664m ;   MOD: D0, D1
00001CE2                          1665m ;   DES: MACRO TO SET FILL COLOR
00001CE2                          1666m 
00001CE2  103C 0051               1667m         MOVE.B  #81, D0
00001CE6  7200                    1668m         MOVE.L  #0, D1
00001CE8  4E4F                    1669m         TRAP    #15
00001CEA                          1670m         ENDM
00001CEA                          1671  
00001CEA  323C 0000               1672          MOVE.W  #0, D1               ; D1 = X CENTER
00001CEE  343C 0000               1673          MOVE.W  #0, D2               ; D1 = Y CENTER
00001CF2  363C 0280               1674          MOVE.W  #SCRWIDTH, D3
00001CF6  383C 01E0               1675          MOVE.W  #SCRHEIGH, D4
00001CFA                          1676  
00001CFA  303C 0057               1677          MOVE.W  #87, D0
00001CFE  4E4F                    1678          TRAP    #15
00001D00                          1679  
00001D00                          1680          ; --- TEXT ---
00001D00                          1681m         UTILFILL #0
00001D00                          1682m ;   IN:  #0 AS THE COLOR, FORMATED AS #00BBGGRR
00001D00                          1683m ;   OUT: NONE
00001D00                          1684m ;   MOD: D0, D1
00001D00                          1685m ;   DES: MACRO TO SET FILL COLOR
00001D00                          1686m 
00001D00  103C 0051               1687m         MOVE.B  #81, D0
00001D04  7200                    1688m         MOVE.L  #0, D1
00001D06  4E4F                    1689m         TRAP    #15
00001D08                          1690m         ENDM
00001D08  323C 1705               1691          MOVE.W  #((80-34)/2)<<8|5, D1
00001D0C  103C 000B               1692          MOVE.B  #11, D0
00001D10  4E4F                    1693          TRAP    #15
00001D12  43F8 11EF               1694          LEA     DEATHSTRING, A1
00001D16  303C 000D               1695          MOVE.W  #13, D0
00001D1A  4E4F                    1696          TRAP    #15
00001D1C                          1697  
00001D1C                          1698         
00001D1C  33FC 0001 00002B54      1699          MOVE.W  #1, (DEATHTEXT2)    
00001D24  4281                    1700          CLR.L   D1
00001D26  323C 0B07               1701          MOVE.W  #((80-58)/2)<<8|7, D1
00001D2A  103C 000B               1702          MOVE.B  #11, D0
00001D2E  4E4F                    1703          TRAP    #15
00001D30  43F8 1212               1704          LEA     SUSSERTOD, A1
00001D34  303C 000D               1705          MOVE.W  #13, D0
00001D38  4E4F                    1706          TRAP    #15
00001D3A                          1707  
00001D3A                          1708          ; BUTTONS
00001D3A  0839 0004 00001EB9      1709          BTST.B  #4, (SCRCYCCT)  ; TIMER 
00001D42  6700 0092               1710          BEQ     .END
00001D46                          1711          ; RETRY
00001D46                          1712m         UTILFILL #$00000000
00001D46                          1713m ;   IN:  #$00000000 AS THE COLOR, FORMATED AS #00BBGGRR
00001D46                          1714m ;   OUT: NONE
00001D46                          1715m ;   MOD: D0, D1
00001D46                          1716m ;   DES: MACRO TO SET FILL COLOR
00001D46                          1717m 
00001D46  103C 0051               1718m         MOVE.B  #81, D0
00001D4A  7200                    1719m         MOVE.L  #$00000000, D1
00001D4C  4E4F                    1720m         TRAP    #15
00001D4E                          1721m         ENDM
00001D4E                          1722m         UTILPEN #$00FFFFFF
00001D4E                          1723m ;   IN:  #$00FFFFFF AS THE COLOR, FORMATED AS #00BBGGRR
00001D4E                          1724m ;   OUT: NONE
00001D4E                          1725m ;   MOD: D0, D1    
00001D4E                          1726m ;   DES: MACRO TO SET PEN COLOR
00001D4E                          1727m 
00001D4E  103C 0050               1728m         MOVE.B  #80, D0 
00001D52  223C 00FFFFFF           1729m         MOVE.L  #$00FFFFFF, D1
00001D58  4E4F                    1730m         TRAP    #15
00001D5A                          1731m         ENDM
00001D5A  323C 00D5               1732          MOVE.W  #BUTTONX1, D1
00001D5E  343C 0190               1733          MOVE.W  #BUTTONY, D2
00001D62  3601                    1734          MOVE.W  D1, D3
00001D64  3802                    1735          MOVE.W  D2, D4 
00001D66  0441 0028               1736          SUB.W   #BUTTONWIDTH/2, D1              ; SET TOP LEFT CORNER
00001D6A  0442 0016               1737          SUB.W   #BUTTONHEIGH/2, D2              ; SET TOP LEFT CORNER 
00001D6E  0643 0028               1738          ADD.W   #BUTTONWIDTH/2, D3              ; SET LOW RIGHT CORNER
00001D72  0644 0016               1739          ADD.W   #BUTTONHEIGH/2, D4              ; SET LOW RIGHT CORNER
00001D76                          1740  
00001D76  303C 0057               1741          MOVE.W  #87, D0
00001D7A  4E4F                    1742          TRAP    #15                             ; DRAW RECTANGLE
00001D7C                          1743  
00001D7C  43F8 12B6               1744          LEA     RETRYSTR, A1
00001D80  323C 00C2               1745          MOVE.W  #BUTTONX1-19, D1
00001D84  343C 0189               1746          MOVE.W  #BUTTONY-7, D2
00001D88                          1747  
00001D88  303C 005F               1748          MOVE.W  #95, D0
00001D8C  4E4F                    1749          TRAP    #15
00001D8E                          1750          
00001D8E                          1751          ; END
00001D8E                          1752m         UTILFILL #$00000000
00001D8E                          1753m ;   IN:  #$00000000 AS THE COLOR, FORMATED AS #00BBGGRR
00001D8E                          1754m ;   OUT: NONE
00001D8E                          1755m ;   MOD: D0, D1
00001D8E                          1756m ;   DES: MACRO TO SET FILL COLOR
00001D8E                          1757m 
00001D8E  103C 0051               1758m         MOVE.B  #81, D0
00001D92  7200                    1759m         MOVE.L  #$00000000, D1
00001D94  4E4F                    1760m         TRAP    #15
00001D96                          1761m         ENDM
00001D96                          1762m         UTILPEN #$00FFFFFF
00001D96                          1763m ;   IN:  #$00FFFFFF AS THE COLOR, FORMATED AS #00BBGGRR
00001D96                          1764m ;   OUT: NONE
00001D96                          1765m ;   MOD: D0, D1    
00001D96                          1766m ;   DES: MACRO TO SET PEN COLOR
00001D96                          1767m 
00001D96  103C 0050               1768m         MOVE.B  #80, D0 
00001D9A  223C 00FFFFFF           1769m         MOVE.L  #$00FFFFFF, D1
00001DA0  4E4F                    1770m         TRAP    #15
00001DA2                          1771m         ENDM
00001DA2  323C 01AA               1772          MOVE.W  #BUTTONX2, D1
00001DA6  343C 0190               1773          MOVE.W  #BUTTONY, D2
00001DAA  3601                    1774          MOVE.W  D1, D3
00001DAC  3802                    1775          MOVE.W  D2, D4 
00001DAE  0441 0028               1776          SUB.W   #BUTTONWIDTH/2, D1              ; SET TOP LEFT CORNER
00001DB2  0442 0016               1777          SUB.W   #BUTTONHEIGH/2, D2              ; SET TOP LEFT CORNER 
00001DB6  0643 0028               1778          ADD.W   #BUTTONWIDTH/2, D3              ; SET LOW RIGHT CORNER
00001DBA  0644 0016               1779          ADD.W   #BUTTONHEIGH/2, D4              ; SET LOW RIGHT CORNER
00001DBE                          1780  
00001DBE  303C 0057               1781          MOVE.W  #87, D0
00001DC2  4E4F                    1782          TRAP    #15                             ; DRAW RECTANGLE
00001DC4                          1783  
00001DC4  43F8 12BC               1784          LEA     EXITSTR, A1
00001DC8  323C 019A               1785          MOVE.W  #BUTTONX2-16, D1
00001DCC  343C 0189               1786          MOVE.W  #BUTTONY-7, D2
00001DD0                          1787  
00001DD0  303C 005F               1788          MOVE.W  #95, D0
00001DD4  4E4F                    1789          TRAP    #15
00001DD6                          1790  .END  
00001DD6  4CDF 021F               1791          MOVEM.L (A7)+,D0-D4/A1
00001DDA  4E75                    1792          RTS
00001DDC                          1793  
00001DDC                          1794  
00001DDC                          1795  -------------------- end include --------------------
00001DDC                          1796              INCLUDE "SHADDER.X68"           ; TORCH SHADDER
00001DDC                          1797  ;-----------------------------------------------------------
00001DDC                          1798  SHADDERPLOT
00001DDC                          1799  ; DES       :       PLOTS THE TORCH SHADDER ON CENTERED ON THE PLAYER
00001DDC                          1800  ; IN        :       NONE
00001DDC                          1801  ; OUT       :       NONE
00001DDC                          1802  ; MOD       :       NONE
00001DDC                          1803  ;-----------------------------------------------------------
00001DDC  48E7 F800               1804              MOVEM.L D0-D4, -(A7)
00001DE0                          1805  
00001DE0                          1806m             UTILPEN #TILEDDARK
00001DE0                          1807m ;   IN:  #TILEDDARK AS THE COLOR, FORMATED AS #00BBGGRR
00001DE0                          1808m ;   OUT: NONE
00001DE0                          1809m ;   MOD: D0, D1    
00001DE0                          1810m ;   DES: MACRO TO SET PEN COLOR
00001DE0                          1811m 
00001DE0  103C 0050               1812m         MOVE.B  #80, D0 
00001DE4  223C 0030252D           1813m         MOVE.L  #TILEDDARK, D1
00001DEA  4E4F                    1814m         TRAP    #15
00001DEC                          1815m         ENDM
00001DEC                          1816m             UTILFILL #TILEDDARK
00001DEC                          1817m ;   IN:  #TILEDDARK AS THE COLOR, FORMATED AS #00BBGGRR
00001DEC                          1818m ;   OUT: NONE
00001DEC                          1819m ;   MOD: D0, D1
00001DEC                          1820m ;   DES: MACRO TO SET FILL COLOR
00001DEC                          1821m 
00001DEC  103C 0051               1822m         MOVE.B  #81, D0
00001DF0  223C 0030252D           1823m         MOVE.L  #TILEDDARK, D1
00001DF6  4E4F                    1824m         TRAP    #15
00001DF8                          1825m         ENDM
00001DF8                          1826  
00001DF8                          1827  
00001DF8  4241                    1828              CLR     D1                          ; LEFT BORDER
00001DFA  4242                    1829              CLR     D2           
00001DFC  3639 00002B40           1830              MOVE.W  (PLAYERX), D3       
00001E02  3A39 00002B58           1831              MOVE.W  (TORCHRANGE), D5
00001E08  CAFC 0020               1832              MULU.W  #TILEDIM, D5
00001E0C  0645 0010               1833              ADD.W   #(TILEDIM/2), D5      
00001E10  9645                    1834              SUB.W   D5, D3
00001E12  383C 01E0               1835              MOVE.W  #SCRHEIGH, D4
00001E16  303C 0057               1836              MOVE.W  #87, D0
00001E1A  4E4F                    1837              TRAP    #15
00001E1C                          1838  
00001E1C                          1839                                                  ; RIGHT BORDER
00001E1C                          1840                
00001E1C  3239 00002B40           1841              MOVE.W  (PLAYERX), D1   
00001E22  3A39 00002B58           1842              MOVE.W  (TORCHRANGE), D5
00001E28  CAFC 0020               1843              MULU.W  #TILEDIM, D5
00001E2C  0645 0010               1844              ADD.W   #(TILEDIM/2), D5 
00001E30  D245                    1845              ADD.W   D5, D1
00001E32  363C 0280               1846              MOVE.W  #SCRWIDTH, D3
00001E36  303C 0057               1847              MOVE.W  #87, D0
00001E3A  4E4F                    1848              TRAP    #15
00001E3C                          1849  
00001E3C                          1850                                                 ; TOP BORDER
00001E3C                          1851                
00001E3C  4241                    1852              CLR     D1
00001E3E  4242                    1853              CLR     D2
00001E40  363C 0280               1854              MOVE.W  #SCRWIDTH, D3
00001E44  3839 00002B42           1855              MOVE.W  (PLAYERY), D4 
00001E4A  3A39 00002B58           1856              MOVE.W  (TORCHRANGE), D5
00001E50  CAFC 0020               1857              MULU.W  #TILEDIM, D5
00001E54  0645 0010               1858              ADD.W   #(TILEDIM/2), D5          
00001E58  9845                    1859              SUB.W   D5, D4     
00001E5A                          1860             
00001E5A  363C 0280               1861              MOVE.W  #SCRWIDTH, D3
00001E5E  303C 0057               1862              MOVE.W  #87, D0
00001E62  4E4F                    1863              TRAP    #15
00001E64                          1864  
00001E64                          1865                                                 ; BOTTOM BORDER
00001E64  3439 00002B42           1866              MOVE.W  (PLAYERY), D2
00001E6A  3A39 00002B58           1867              MOVE.W  (TORCHRANGE), D5
00001E70  CAFC 0020               1868              MULU.W  #TILEDIM, D5
00001E74  0645 0010               1869              ADD.W   #(TILEDIM/2), D5           
00001E78  D445                    1870              ADD.W   D5, D2     
00001E7A  363C 0280               1871              MOVE.W  #SCRWIDTH, D3
00001E7E  383C 01E0               1872              MOVE.W  #SCRHEIGH, D4
00001E82  303C 0057               1873              MOVE.W  #87, D0
00001E86  4E4F                    1874              TRAP    #15
00001E88                          1875  
00001E88  4CDF 001F               1876              MOVEM.L (A7)+, D0-D4
00001E8C  4E75                    1877              RTS
00001E8C  4E75                    1878  -------------------- end include --------------------
00001E8E                          1879              
00001E8E                          1880  
00001E8E                          1881  ; --- INITIALIZE --------------------------------------------------------------
00001E8E                          1882  
00001E8E                          1883  START                                       ; INITIALIZE SYSTEM-RELATED STUFF
00001E8E  4EB8 1000               1884              JSR     SYSINIT 
00001E92  4EB8 19E2               1885              JSR     STAINIT
00001E96                          1886              
00001E96                          1887  ; --- UPDATE ------------------------------------------------------------------
00001E96                          1888  
00001E96  4E40                    1889  .LOOP       TRAP    #KBDTRAP                ; READ KEYBOARD
00001E98  4EB8 19F4               1890              JSR     STAUPD
00001E9C                          1891              
00001E9C                          1892  ; --- WAIT SYNCH --------------------------------------------------------------
00001E9C                          1893  
00001E9C  4A39 00001EB8           1894  .WINT       TST.B   (SCRINTCT)              ; WAIT FOR INTERRUPT
00001EA2  67F8                    1895              BEQ     .WINT
00001EA4  4239 00001EB8           1896              CLR.B   (SCRINTCT)
00001EAA                          1897  
00001EAA                          1898  ; --- PLOT --------------------------------------------------------------------
00001EAA                          1899  
00001EAA  4EB8 1A4A               1900              JSR     STAPLOT
00001EAE  4E41                    1901              TRAP    #SCRTRAP                ; SHOW GRAPHICS
00001EB0  60E4                    1902              BRA     .LOOP                   ; MAIN LOOP
00001EB2                          1903  
00001EB2                          1904  ; --- DEATH -------------------------------------------------------------------
00001EB2                          1905  LOOSE
00001EB2  FFFF FFFF               1906              SIMHALT
00001EB6                          1907  
00001EB6                          1908  ; --- VARIABLES ---------------------------------------------------------------
00001EB6                          1909  
00001EB6                          1910              INCLUDE "SYSVAR.X68"
00001EB6                          1911  ; =============================================================================
00001EB6                          1912  ; TITLE    : SYSTEM VARIABLES
00001EB6                          1913  ; AUTHOR   : ANTONI BURGUERA
00001EB6                          1914  ; COMMENTS : NOTE THAT ALL THESE VARS ARE USED TO SHARE DATA FROM SYSTEM TO
00001EB6                          1915  ;            USER. THUS THEY MUST NOT BE IN PROTECTED MEMORY.
00001EB6                          1916  ;            NOTE THAT USING DMMDATA IN SUCH WAY IS A BAD IDEA, AS USER
00001EB6                          1917  ;            APPLICATIONS CAN ALSO FREE OR CHANGE OWNERSHIP. NONETHELESS, FOR
00001EB6                          1918  ;            THE SAKE OF THIS EXAMPLE THIS IS GOOD ENOUGH.
00001EB6                          1919  ; HISTORY  : XX-XXX-201X - CREATION
00001EB6                          1920  ;            11-OCT-2020 - MINOR CHANGES
00001EB6                          1921  ; =============================================================================
00001EB6                          1922  
00001EB6                          1923  ; --- KEYBOARD RELATED VARIABLES ----------------------------------------------
00001EB6                          1924  
00001EB6                          1925  KBDVAL      DS.B    1                       ; KEY PRESSED=1
00001EB7                          1926  KBDEDGE     DS.B    1                       ; KEY CHANGED=1
00001EB8                          1927  
00001EB8                          1928              DS.W    0
00001EB8                          1929  
00001EB8                          1930  ; --- SCREEN RELATED VARIABLES ------------------------------------------------
00001EB8                          1931  
00001EB8                          1932  SCRINTCT    DS.B    1                       ; INTERRUPT COUNTER/FLAG
00001EB9                          1933  SCRCYCCT    DS.B    1                       ; CYCLE COUNTER
00001EBA                          1934              DS.W    0
00001EBA                          1935  
00001EBA                          1936  ; --- DYNAMIC MEMORY VARIABLES ------------------------------------------------
00001EBA                          1937  
00001EC0                          1938              ORG     (*+DMMBSIZE-1)&-DMMBSIZE ; ALIGN TO DMMBSIZE
00001EC0                          1939  DMMDATA     DS.B    DMMBSIZE*DMMBNUM        ; DYNAMIC MEMORY ALLOCATION SPACE
00002B40                          1940              DS.W    0                       ; JUST IN CASE (SIZE IS POW OF TWO)
00002B40                          1941  -------------------- end include --------------------
00002B40                          1942              INCLUDE "VAR.X68"
00002B40                          1943  ; =============================================================================
00002B40                          1944  ; TITLE    : GAME VARIABLES
00002B40                          1945  ; AUTHOR   :
00002B40                          1946  ; HISTORY  :
00002B40                          1947  ; =============================================================================
00002B40                          1948  
00002B40                          1949  ; POSITION
00002B40                          1950  PLAYERX     DS.W    1   ; PLAYER X COORDINATE
00002B42                          1951  PLAYERY     DS.W    1   ; PLAYER Y COORDINATE
00002B44                          1952  
00002B44                          1953  KEYX        DS.W    1   ; KEY X COORDINATE
00002B46                          1954  KEYY        DS.W    1   ; KEY Y COORDINATE
00002B48                          1955  
00002B48                          1956  STAIRSX     DS.W    1   ; STAIRS X COORDINATE
00002B4A                          1957  STAIRSY     DS.W    1   ; STAIRS Y COORDINATE
00002B4C                          1958  
00002B4C                          1959  STACUR      DS.W    1   ; CURRENT STATE
00002B4E                          1960  STANEXT     DS.W    1   ; NEXT STATE 
00002B50                          1961  
00002B50                          1962  ; BOOLEAN
00002B50= 0000                    1963  KEYOBTEINED DC.W    0   ; "BOOLEAN" VALUE, SELF EXPLANATORY 
00002B52= 0000                    1964  TORCHSHADDER DC.W   0   ; "BOOLEAN" VALUE TO SEEE IF SHADDER IS APPLIED OR NOT
00002B54= 0000                    1965  DEATHTEXT2  DC.W    0   ; "BOOLEAN" DEATH STRING SHOW 
00002B56= 0000                    1966  ONSTAIRS    DC.W    0   ; "BOOLEAN" VALUE TO TRACK IF PLAYER IS ON STAIRS
00002B58                          1967  
00002B58= 0005                    1968  TORCHRANGE  DC.W    5   ; TORCH RANGE FOR THE SHADDER 
00002B5A                          1969  ; ARRAY 
00002B5A                          1970  RNGXINDEX   DS.W    1   ; INDEX FOR THE X COORDINATE ON THE PSEUDO RANDOM GENERATOR
00002B5C                          1971  RNGYINDEX   DS.W    1   ; INDEX FOR THE Y COORDINATE ON THE PSEUDO RANDOM GENERATOR
00002B5E                          1972  
00002B5E= 0000                    1973  LEVEL       DC.W    0   ; LEVEL COUNTER
00002B60= 0002                    1974  SHADDERRANGE DC.W   2   ; SHADDER RANGE
00002B62                          1975  ; AUDIO
00002B62                          1976  AUDIOACCSND DS.B    1   ; ACCEPT NEW SOUNDS 
00002B64                          1977              DS.W    0
00002B64                          1978  
00002B64                          1979  
00002B64                          1980  
00002B64                          1981  
00002B64                          1982  -------------------- end include --------------------
00002B64                          1983              END    START

No errors detected
No warnings generated


SYMBOL TABLE INFORMATION
Symbol-name         Value
-------------------------
AGLADD              159C
AGLADD:END          15B2
AGLFKIL             1600
AGLFKIL:END         161C
AGLFKIL:LOOP        1608
AGLKILL             11C0
AGLPLOT             15DA
AGLPLOT:END         15FA
AGLPLOT:LOOP        15E2
AGLUPDT             15B6
AGLUPDT:END         15D4
AGLUPDT:LOOP        15BE
AUDIOACCSND         2B62
AUDIOACCY           FF
AUDIOCLKID          7
AUDIODIEDID         6
AUDIOKEYID          3
AUDIOLOOP           80
AUDIOMOVEID         2
AUDIOMUS1ID         0
AUDIOMUS2ID         1
AUDIONLOP           0
AUDIOSCCN           0
AUDIOSTARID         4
AUDIOSTOP           FF
AUDIOTALKID         5
BECARESTR           129F
BUTTONHEIGH         2D
BUTTONWIDTH         50
BUTTONX1            D5
BUTTONX2            1AA
BUTTONY             190
DEATHSTRING         11EF
DEATHTEXT2          2B54
DMMALLOC            11A6
DMMALLOC:END        11BE
DMMBNUM             32
DMMBSIZE            40
DMMDATA             1EC0
DMMFCOM             1180
DMMFFND             118E
DMMFIRST            1136
DMMFLOOP            1174
DMMFRCOM            1148
DMMFREE             11C0
DMMFRFND            1156
DMMFRLOP            113C
DMMFRSTO            116E
DMMINIT             1114
DMMINIT:LOOP        1122
DMMNEXT             1158
DMMNEXTO            1190
DMMSYSID            0
EASYSTR             12C1
EMPTYID             1
ENEMYID             7
ENEMYINIT           190A
ENEMYMAXCNT         C
ENEMYPLOT           1946
ENEMYUPDT           1922
ENEMYUPDT:END       1940
EXITSTR             12BC
FLOORID             3
KBDBITDN            3
KBDBITF1            4
KBDBITF2            5
KBDBITF3            6
KBDBITLF            0
KBDBITPS            7
KBDBITRT            2
KBDBITUP            1
KBDCHRDN            28
KBDCHRLF            25
KBDCHRMK            4D
KBDCHRPK            50
KBDCHRRT            27
KBDCHRSH            10
KBDCHRSP            20
KBDCHRUP            26
KBDDOWN             28
KBDEDGE             1EB7
KBDFIRE1            20
KBDFIRE2            4D
KBDFIRE3            10
KBDINIT             10B4
KBDLEFT             25
KBDMSKDN            8
KBDMSKF1            10
KBDMSKF2            20
KBDMSKF3            40
KBDMSKLF            1
KBDMSKPS            80
KBDMSKRT            4
KBDMSKUP            2
KBDPAUSE            50
KBDREAD             10CA
KBDREAD:LOOP        110A
KBDREAD:STORE       1106
KBDRIGHT            27
KBDTRAP             0
KBDUP               26
KBDVAL              1EB6
KEYID               5
KEYINIT             1758
KEYOBTEINED         2B50
KEYPLOT             179C
KEYPLOT:NOKEY       17E2
KEYUPDT             1772
KEYUPDT:END         1796
KEYX                2B44
KEYY                2B46
LEVEL               2B5E
LEVELSTRING         124D
LOOSE               1EB2
MAPPLOT             171A
MISCPLOT            1988
MISCPLOT:END        19E0
MISCPLOT:LVLPLOT    1996
MISCPLOT:NOOKEYPLOT  19BA
NEXTSTR             1286
NOKEYSTRING         11D6
NORMALSTR           12C6
ONSTAIRS            2B56
PLAYERINIT          1622
PLAYERPLOT          16D2
PLAYERUPDT          1634
PLAYERUPDT:END      16D0
PLAYERUPDT:MOVED    16BA
PLAYERUPDT:MOVEL    1672
PLAYERUPDT:MOVER    168A
PLAYERUPDT:MOVEU    16A2
PLAYERUPDT:RMVED    16C8
PLAYERUPDT:RMVEL    1680
PLAYERUPDT:RMVER    1698
PLAYERUPDT:RMVEU    16B0
PLAYERX             2B40
PLAYERY             2B42
PLYRID              6
RETRYSTR            12B6
RNDINIT             152E
RNGX                153C
RNGX:NOVERFLOW      1568
RNGXINDEX           2B5A
RNGY                156C
RNGY:NOVERFLOW      1598
RNGYINDEX           2B5C
SCRCYCCT            1EB9
SCRHEIGH            1E0
SCRINIT             101C
SCRINTCT            1EB8
SCRIRQ              1
SCRISR              108C
SCRTIM              14
SCRTRAP             1
SCRUPD              109A
SCRWIDTH            280
SHADDERPLOT         1DDC
SHADDERRANGE        2B60
STACUR              2B4C
STADM               2
STADMP              1CD6
STADMP:END          1DD6
STADMU              1C6A
STADMU:END          1CD0
STADMU:X2           1CBA
STAEMPTY            1A72
STAGP               1
STAGPI              1BF2
STAGPP              1C3E
STAGPP:END          1C64
STAGPU              1C02
STAGPU:CLASS        1C1A
STAGPU:CP1          1C2A
STAGPU:CP2          1C34
STAINIT             19E2
STAIRID             4
STAIRSINIT          17E4
STAIRSPLOT          188C
STAIRSPLOT:END      1904
STAIRSPLOT:KEYOBTEINED  18DE
STAIRSUPDT          1804
STAIRSUPDT:END      1886
STAIRSUPDT:ENDD     1880
STAIRSUPDT:ENEMYADD  1844
STAIRSUPDT:NOKEY    1874
STAIRSX             2B48
STAIRSY             2B4A
STAMM               0
STAMMI              1A74
STAMMP              1B0C
STAMMP:END          1BEC
STAMMU              1A96
STAMMU:END          1B06
STAMMU:X2           1AE6
STANEXT             2B4E
STAPLOT             1A4A
STAPLOT:PLTTBL      1A66
START               1E8E
START:LOOP          1E96
START:WINT          1E9C
STAUPD              19F4
STAUPD:DOUPD        1A1A
STAUPD:INITBL       1A32
STAUPD:UPDTBL       1A3E
SUBTITLESTR         126F
SUSSERTOD           1212
SYSINIT             1000
TILEDARK            745B6D
TILEDDARK           30252D
TILEDETA            957EA0
TILEDIM             20
TILELIGH            CCE0EA
TITLESTRING         1256
TORCHRANGE          2B58
TORCHSHADDER        2B52
TORCHWEAK10         12CD
TORCHWEAK11         12EC
TORCHWEAK20         12FB
TORCHWEAK21         131C
UTILCOLL            1512
UTILCOLL:NOCOL      152C
UTILFILL            CD
UTILPEN             0
UTILTEXT            196
UTILTILE            2C0
WALLID              2
XVALUES             1332
YVALUES             1350
