00001EA0 Starting Address
Assembler used: EASy68K Editor/Assembler v5.16.01
Created On: 1/9/2021 11:30:03 PM

00000000                             1  ; =============================================================================
00000000                             2  ; TITLE    : EXAMPLE GAME (MAIN PROGRAM)
00000000                             3  ; AUTHOR   : ANTONI BURGUERA
00000000                             4  ; HISTORY  : 10-OCT-2020 - CREATION
00000000                             5  ;            11-OCT-2020 - MINOR CHANGES
00000000                             6  ; =============================================================================
00000000                             7              OPT     MEX
00001000                             8              ORG     $1000
00001000                             9  
00001000                            10  ; --- CODE INCLUDES -----------------------------------------------------------
00001000                            11  
00001000                            12              INCLUDE "SYSCONST.X68"          ; SYSTEM CONSTANTS
00001000                            13  ; =============================================================================
00001000                            14  ; TITLE    : SYSTEM CONSTANTS
00001000                            15  ; AUTHOR   : ANTONI BURGUERA
00001000                            16  ; HISTORY  : XX-XXX-201X - CREATION
00001000                            17  ;            11-OCT-2020 - MINOR CHANGES
00001000                            18  ; =============================================================================
00001000                            19  
00001000                            20  ; --- TRAP RELATED CONSTANTS --------------------------------------------------
00001000                            21  
00001000  =00000000                 22  KBDTRAP     EQU     0                       ; KEYBOARD UPDATE TRAP
00001000  =00000001                 23  SCRTRAP     EQU     1                       ; SCREEN REFRESH TRAP
00001000                            24  
00001000                            25  ; --- KEY CODES (EASy68K)
00001000                            26  
00001000  =00000020                 27  KBDCHRSP    EQU     $20                     ; SPACE KEY
00001000  =0000004D                 28  KBDCHRMK    EQU     'M'                     ; M KEY
00001000  =00000010                 29  KBDCHRSH    EQU     $10                     ; SHIFT KEY
00001000  =00000050                 30  KBDCHRPK    EQU     'P'                     ; P KEY
00001000  =00000025                 31  KBDCHRLF    EQU     $25                     ; LEFT KEY
00001000  =00000026                 32  KBDCHRUP    EQU     $26                     ; UP KEY
00001000  =00000027                 33  KBDCHRRT    EQU     $27                     ; RIGHT KEY
00001000  =00000028                 34  KBDCHRDN    EQU     $28                     ; DOWN KEY
00001000                            35  
00001000                            36  ; --- KEYBOARD MAPPING --------------------------------------------------------
00001000                            37  
00001000  =00000025                 38  KBDLEFT     EQU     KBDCHRLF                ; LEFT BUTTON
00001000  =00000026                 39  KBDUP       EQU     KBDCHRUP                ; UP BUTTON
00001000  =00000027                 40  KBDRIGHT    EQU     KBDCHRRT                ; RIGHT BUTTON
00001000  =00000028                 41  KBDDOWN     EQU     KBDCHRDN                ; DOWN BUTTON
00001000  =00000020                 42  KBDFIRE1    EQU     KBDCHRSP                ; FIRE 1 BUTTON
00001000  =0000004D                 43  KBDFIRE2    EQU     KBDCHRMK                ; FIRE 2 BUTTON
00001000  =00000010                 44  KBDFIRE3    EQU     KBDCHRSH                ; FIRE 3 BUTTON
00001000  =00000050                 45  KBDPAUSE    EQU     KBDCHRPK                ; PAUSE BUTTON
00001000                            46  
00001000                            47  ; --- KEYBOARD BITFIELD MASKS -------------------------------------------------
00001000                            48  ; CONVENIENCE CONSTANTS TO ACCESS THE FOLLOWING BIT-FIELD.
00001000                            49  ; THIS BIT-FIELD IS USED BY SYSTEM VARS (KBDVAL) AND (KBDEDGE).
00001000                            50  ; +---+---+---+---+---+---+---+---+
00001000                            51  ; | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |
00001000                            52  ; +---+---+---+---+---+---+---+---+
00001000                            53  ;   |   |   |   |   |   |   |   |
00001000                            54  ;   |   |   |   |   |   |   |   +---------- LEFT BUTTON
00001000                            55  ;   |   |   |   |   |   |   +-------------- UP BUTTON
00001000                            56  ;   |   |   |   |   |   +------------------ RIGHT BUTTON
00001000                            57  ;   |   |   |   |   +---------------------- DOWN BUTTON
00001000                            58  ;   |   |   |   +-------------------------- FIRE 1 BUTTON
00001000                            59  ;   |   |   +------------------------------ FIRE 2 BUTTON
00001000                            60  ;   |   +---------------------------------- FIRE 3 BUTTON
00001000                            61  ;   +-------------------------------------- PAUSE BUTTON
00001000                            62  
00001000  =00000001                 63  KBDMSKLF    EQU     %00000001
00001000  =00000002                 64  KBDMSKUP    EQU     %00000010
00001000  =00000004                 65  KBDMSKRT    EQU     %00000100
00001000  =00000008                 66  KBDMSKDN    EQU     %00001000
00001000  =00000010                 67  KBDMSKF1    EQU     %00010000
00001000  =00000020                 68  KBDMSKF2    EQU     %00100000
00001000  =00000040                 69  KBDMSKF3    EQU     %01000000
00001000  =00000080                 70  KBDMSKPS    EQU     %10000000
00001000                            71  
00001000                            72  ; --- KEYBOARD BITFIELD POSITIONS ---------------------------------------------
00001000                            73  
00001000  =00000000                 74  KBDBITLF    EQU     0
00001000  =00000001                 75  KBDBITUP    EQU     1
00001000  =00000002                 76  KBDBITRT    EQU     2
00001000  =00000003                 77  KBDBITDN    EQU     3
00001000  =00000004                 78  KBDBITF1    EQU     4
00001000  =00000005                 79  KBDBITF2    EQU     5
00001000  =00000006                 80  KBDBITF3    EQU     6
00001000  =00000007                 81  KBDBITPS    EQU     7
00001000                            82  
00001000                            83  ; --- SCREEN RELATED CONSTANTS ------------------------------------------------
00001000                            84  
00001000  =00000280                 85  SCRWIDTH    EQU     640                     ; SCREEN WIDTH (PIXELS)
00001000  =000001E0                 86  SCRHEIGH    EQU     480                     ; SCREEN HEIGHT (PIXELS)
00001000  =00000001                 87  SCRIRQ      EQU     1                       ; SCREEN INTERRUPT NUMBER
00001000  =00000014                 88  SCRTIM      EQU     20                       ; SCREEN TIMER (MS)
00001000                            89  
00001000                            90  ; --- DYNAMIC MEMORY CONSTANTS ------------------------------------------------
00001000                            91  
00001000  =00000040                 92  DMMBSIZE    EQU     64                      ; BLOCK SIZE (BYTES). POWER OF TWO
00001000  =00000032                 93  DMMBNUM     EQU     50                      ; NUMBER OF BLOCKS
00001000  =00000000                 94  DMMSYSID    EQU     0                       ; SYSTEM OWNER ID (MUST BE 0)
00001000  =00000000                 95  -------------------- end include --------------------
00001000                            96              INCLUDE "SYSTEM.X68"            ; SYSTEM CODE
00001000                            97  ; =============================================================================
00001000                            98  ; TITLE    : SYSTEM MANAGEMENT (SYSTEM CODE)
00001000                            99  ; AUTHOR   : ANTONI BURGUERA
00001000                           100  ; COMMENTS : IT IS DIVIDED IN THREE BLOCKS:
00001000                           101  ;            - SYS : GENERIC.
00001000                           102  ;            - SCR : SCREEN MANAGEMENT.
00001000                           103  ;            - KBD : KEYBOARD MANAGEMENT.
00001000                           104  ; HISTORY  : XX-XXX-201X - CREATION
00001000                           105  ;            11-OCT-2020 - MINOR CHANGES
00001000                           106  ; =============================================================================
00001000                           107  
00001000                           108  ; -----------------------------------------------------------------------------
00001000                           109  SYSINIT
00001000                           110  ; INITIALIZES THE SYSTEM
00001000                           111  ; INPUT    - NONE
00001000                           112  ; OUTPUT   - NONE
00001000                           113  ; MODIFIES - NONE
00001000                           114  ; -----------------------------------------------------------------------------
00001000  205F                     115              MOVE.L  (A7)+,A0                ; GET RETURN ADDRESS
00001002  4EB9 000010B4            116              JSR     KBDINIT                 ; INIT KEYBOARD
00001008  4EB9 0000101C            117              JSR     SCRINIT                 ; INIT SCREEN
0000100E  4EB9 00001114            118              JSR     DMMINIT                 ; INIT DYNAMIC MEMORY
00001014  027C DFFF                119              ANDI.W  #$DFFF,SR               ; SWITCH TO USER
00001018  2F08                     120              MOVE.L  A0,-(A7)                ; PUT RETURN ADDRESS
0000101A  4E75                     121              RTS
0000101C                           122  
0000101C                           123  ; =============================================================================
0000101C                           124  ; SCREEN MANAGEMENT (SYSTEM CODE)
0000101C                           125  ; =============================================================================
0000101C                           126  
0000101C                           127  ; -----------------------------------------------------------------------------
0000101C                           128  SCRINIT
0000101C                           129  ; INITIALIZES THE SCREEN, SCREEN-RELATED INTERRUPT AND VARS.
0000101C                           130  ; INPUT    - NONE
0000101C                           131  ; OUTPUT   - NONE
0000101C                           132  ; MODIFIES - D0,D1,D2,D3
0000101C                           133  ; -----------------------------------------------------------------------------
0000101C  007C 0700                134              ORI.W   #$0700,SR               ; DISABLE ALL INT
00001020  21FC 0000109A 0084       135              MOVE.L  #SCRUPD,($80+SCRTRAP*4) ; INSTALL TRAP
00001028  223C 028001E0            136              MOVE.L  #SCRWIDTH<<16|SCRHEIGH,D1 ; SET RESOLUTION
0000102E  103C 0021                137              MOVE.B  #33,D0
00001032  4E4F                     138              TRAP    #15
00001034  7201                     139              MOVE.L  #1,D1                   ; SET WINDOWED MODE
00001036  4E4F                     140              TRAP    #15
00001038  323C FF00                141              MOVE.W  #$FF00,D1               ; CLEAR VISIBLE BUFFER
0000103C  103C 000B                142              MOVE.B  #11,D0
00001040  4E4F                     143              TRAP    #15
00001042  123C 0011                144              MOVE.B  #17,D1                  ; ENABLE DOUBLE BUFFER
00001046  103C 005C                145              MOVE.B  #92,D0
0000104A  4E4F                     146              TRAP    #15
0000104C  323C FF00                147              MOVE.W  #$FF00,D1               ; CLEAR HIDDEN BUFFER
00001050  103C 000B                148              MOVE.B  #11,D0
00001054  4E4F                     149              TRAP    #15
00001056  21FC 0000108C 0064       150              MOVE.L  #SCRISR,($60+SCRIRQ*4)  ; SET EXCEPTION VECTOR
0000105E  123C 0005                151              MOVE.B  #5,D1                   ; ENABLE EXCEPTION PROCESSING
00001062  103C 0020                152              MOVE.B  #32,D0
00001066  4E4F                     153              TRAP    #15
00001068  143C 0081                154              MOVE.B  #%10000000|SCRIRQ,D2    ; ENABLE AUTO-IRQ
0000106C  163C 0014                155              MOVE.B  #SCRTIM,D3
00001070  123C 0006                156              MOVE.B  #6,D1
00001074  103C 0020                157              MOVE.B  #32,D0
00001078  4E4F                     158              TRAP    #15
0000107A  4239 00001ECA            159              CLR.B   (SCRINTCT)              ; PREPARE INTERRUPT FLAG
00001080  4239 00001ECB            160              CLR.B   (SCRCYCCT)              ; PREPARE CYCLE COUNTER
00001086  027C F8FF                161              ANDI.W  #$F8FF,SR               ; ENABLE INTS
0000108A  4E75                     162              RTS
0000108C                           163  
0000108C                           164  ; -----------------------------------------------------------------------------
0000108C                           165  SCRISR
0000108C                           166  ; SCREEN TIMER ISR. INCREASES THE INTERRUPT COUNTER AND UPDATES DOUBLE BUFFER.
0000108C                           167  ; INPUT    - NONE
0000108C                           168  ; OUTPUT   - NONE
0000108C                           169  ; MODIFIES - NONE
0000108C                           170  ; -----------------------------------------------------------------------------
0000108C  5239 00001ECA            171              ADDQ.B  #1,(SCRINTCT)           ; UPDATE INT FLAG/COUNTER
00001092  5239 00001ECB            172              ADDQ.B  #1,(SCRCYCCT)           ; UPDATE CYCLE COUNTER
00001098  4E73                     173              RTE
0000109A                           174  
0000109A                           175  ; -----------------------------------------------------------------------------
0000109A                           176  SCRUPD
0000109A                           177  ; TRAP SERVICE ROUTINE IN CHARGE OF VISUALIZING CURRENT FRAME AND CLEARING
0000109A                           178  ; BUFFER FOR THE NEXT ONE.
0000109A                           179  ; INPUT    - NONE
0000109A                           180  ; OUTPUT   - NONE
0000109A                           181  ; MODIFIES - NONE
0000109A                           182  ; -----------------------------------------------------------------------------
0000109A  48A7 C000                183              MOVEM.W D0-D1,-(A7)
0000109E  103C 005E                184              MOVE.B  #94,D0                  ; UPDATE DOUBLE BUFFER
000010A2  4E4F                     185              TRAP    #15
000010A4  323C FF00                186              MOVE.W  #$FF00,D1               ; CLEAR HIDDEN BUFFER
000010A8  103C 000B                187              MOVE.B  #11,D0
000010AC  4E4F                     188              TRAP    #15
000010AE  4C9F 0003                189              MOVEM.W (A7)+,D0-D1
000010B2  4E73                     190              RTE
000010B4                           191  
000010B4                           192  ; =============================================================================
000010B4                           193  ; KEYBOARD MANAGEMENT (SYSTEM CODE)
000010B4                           194  ; =============================================================================
000010B4                           195  
000010B4                           196  ; -----------------------------------------------------------------------------
000010B4                           197  KBDINIT
000010B4                           198  ; INITIALIZES THE SYSTEM VARIABLES KBDSYS AND KBDVAL
000010B4                           199  ; INPUT    - NONE
000010B4                           200  ; OUTPUT   - NONE
000010B4                           201  ; MODIFIES - NONE
000010B4                           202  ; -----------------------------------------------------------------------------
000010B4  4239 00001EC8            203              CLR.B   (KBDVAL)                ; INIT VARS
000010BA  4239 00001EC9            204              CLR.B   (KBDEDGE)
000010C0  21FC 000010CA 0080       205              MOVE.L  #KBDREAD,($80+KBDTRAP*4) ; INSTALL
000010C8  4E75                     206              RTS
000010CA                           207  
000010CA                           208  ; -----------------------------------------------------------------------------
000010CA                           209  KBDREAD
000010CA                           210  ; TRAP SERVICE ROUTINE.
000010CA                           211  ; UPDATES THE SYSTEM VARIABLES KBDEDGE AND KBDVAL ACCORDING TO THE BITFIELD
000010CA                           212  ; DESCRIBED IN SYSCONST. KBDVAL HOLDS THE CURRENT VALUES AND KBDEFGE HOLDS
000010CA                           213  ; RISING EDGES FROM PREVIOUS CALL TO THE CURRENT ONE.
000010CA                           214  ; INPUT    - NONE
000010CA                           215  ; OUTPUT   - (KBDVAL) AND (KBDEDGE)
000010CA                           216  ; MODIFIES - NONE
000010CA                           217  ; -----------------------------------------------------------------------------
000010CA  48E7 F000                218              MOVEM.L D0-D3,-(A7)
000010CE  103C 0013                219              MOVE.B  #19,D0
000010D2  223C 50104D20            220              MOVE.L  #KBDPAUSE<<24+KBDFIRE3<<16+KBDFIRE2<<8+KBDFIRE1,D1
000010D8  4E4F                     221              TRAP    #15
000010DA  6100 002A                222              BSR     .STORE                  ; STORE FIRE1,FIRE2,FIRE3 AND PAUSE
000010DE  223C 28272625            223              MOVE.L  #KBDDOWN<<24+KBDRIGHT<<16+KBDUP<<8+KBDLEFT,D1
000010E4  4E4F                     224              TRAP    #15
000010E6  6100 001E                225              BSR     .STORE                  ; STORE KEY UP,DOWN,LEFT AND RIGTH.
000010EA  1039 00001EC8            226              MOVE.B  (KBDVAL),D0             ; COMPUTE EDGE.
000010F0  4600                     227              NOT.B   D0                      ; EDGE=NOT(PREVIOUS) AND CURRENT.
000010F2  C002                     228              AND.B   D2,D0
000010F4  13C2 00001EC8            229              MOVE.B  D2,(KBDVAL)             ; STORE VALUES (PRESS AND EDGE)
000010FA  13C0 00001EC9            230              MOVE.B  D0,(KBDEDGE)
00001100  4CDF 000F                231              MOVEM.L (A7)+,D0-D3
00001104  4E73                     232              RTE
00001106                           233  
00001106  363C 0003                234  .STORE      MOVE.W  #3,D3                   ; TRANSLATES THE 8-BIT ENCODING
0000110A  E189                     235  .LOOP       LSL.L   #8,D1                   ; OF TRAP #15 TASK 19 INTO A 1-BIT
0000110C  E312                     236              ROXL.B  #1,D2                   ; PER KEYPRESS ENCODING
0000110E  51CB FFFA                237              DBRA.W  D3,.LOOP
00001112  4E75                     238              RTS
00001114                           239  
00001114                           240  ; =============================================================================
00001114                           241  ; DYNAMIC MEMORY MANAGEMENT (SYSTEM CODE)
00001114                           242  ; DYNAMIC MEMORY IS A SET OF DMMBNUM SLOTS OF DMMBSIZE BYTES EACH ONE.
00001114                           243  ; DMMBSIZE MUST BE POWER OF TWO. A SLOT HAS:
00001114                           244  ; - HEADER - 1 WORD. SPECIFIES THE OWNER (0 MEANS OWNED BY SYSTEM)
00001114                           245  ; - DATA   - DMMBSIZE - 2 BYTES. MAY CONTAIN VARS AND ANY KIND OF DATA RELATED
00001114                           246  ;            THE THE OWNER. IF OWNER==0, DATA IS MEANINGLESS.
00001114                           247  ; =============================================================================
00001114                           248  
00001114                           249  ; -----------------------------------------------------------------------------
00001114                           250  DMMINIT
00001114                           251  ; INITIALIZES THE DYNAMIC MEMORY TO ALL OWNED BY SYSTEM.
00001114                           252  ; INPUT    - NONE
00001114                           253  ; OUTPUT   - NONE
00001114                           254  ; MODIFIES - NONE
00001114                           255  ; -----------------------------------------------------------------------------
00001114  48E7 8080                256              MOVEM.L D0/A0,-(A7)
00001118  41F9 00001F00            257              LEA     DMMDATA,A0
0000111E  303C 0031                258              MOVE.W  #DMMBNUM-1,D0
00001122  30BC 0000                259  .LOOP       MOVE.W  #DMMSYSID,(A0)
00001126  D1FC 00000040            260              ADD.L   #DMMBSIZE,A0
0000112C  51C8 FFF4                261              DBRA.W  D0,.LOOP
00001130  4CDF 0101                262              MOVEM.L (A7)+,D0/A0
00001134  4E75                     263              RTS
00001136                           264  
00001136                           265  ; -----------------------------------------------------------------------------
00001136                           266  DMMFIRST
00001136                           267  ; SEARCHES THE FIRST MEMORY SLOT NOT OWNED BY SYSTEM AND OUTPUTS A POINTER
00001136                           268  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00001136                           269  ; INPUT    - NONE
00001136                           270  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00001136                           271  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001136                           272  ; -----------------------------------------------------------------------------
00001136  41F9 00001F00            273              LEA     DMMDATA,A0
0000113C  4A58                     274  DMMFRLOP    TST.W   (A0)+
0000113E  6600 0016                275              BNE     DMMFRFND
00001142  D1FC 0000003E            276              ADD.L   #DMMBSIZE-2,A0
00001148  B1FC 00002B7F            277  DMMFRCOM    CMP.L   #DMMDATA+DMMBSIZE*DMMBNUM-1,A0
0000114E  6DEC                     278              BLT     DMMFRLOP
00001150  207C 00000000            279              MOVE.L  #0,A0
00001156  4E75                     280  DMMFRFND    RTS
00001158                           281  
00001158                           282  ; -----------------------------------------------------------------------------
00001158                           283  DMMNEXT
00001158                           284  ; SEARCHES THE NEXT MEMORY SLOT NOT OWNED BY SYSTEM AND OUTPUTS A POINTER
00001158                           285  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00001158                           286  ; INPUT    - A0   : POINTER WITHIN THE CURRENT SLOT
00001158                           287  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00001158                           288  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001158                           289  ; -----------------------------------------------------------------------------
00001158  2F00                     290              MOVE.L  D0,-(A7)
0000115A  2008                     291              MOVE.L  A0,D0
0000115C  C0BC FFFFFFC0            292              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
00001162  0680 00000040            293              ADD.L   #DMMBSIZE,D0
00001168  2040                     294              MOVE.L  D0,A0
0000116A  201F                     295              MOVE.L  (A7)+,D0
0000116C  60DA                     296              BRA     DMMFRCOM
0000116E                           297  
0000116E                           298  ; -----------------------------------------------------------------------------
0000116E                           299  DMMFRSTO
0000116E                           300  ; SEARCHES THE FIRST MEMORY SLOT WITH THE SPECIFIED ID AND OUTPUTS A POINTER
0000116E                           301  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
0000116E                           302  ; INPUT    - D0.W : ID TO SEARCH
0000116E                           303  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
0000116E                           304  ; MODIFIES - NONE (ASIDE OF OUTPUT)
0000116E                           305  ; -----------------------------------------------------------------------------
0000116E  41F9 00001F00            306              LEA     DMMDATA,A0
00001174  B058                     307  DMMFLOOP    CMP.W   (A0)+,D0
00001176  6700 0016                308              BEQ     DMMFFND
0000117A  D1FC 0000003E            309              ADD.L   #DMMBSIZE-2,A0
00001180  B1FC 00002B7F            310  DMMFCOM     CMP.L   #DMMDATA+DMMBSIZE*DMMBNUM-1,A0
00001186  6DEC                     311              BLT     DMMFLOOP
00001188  207C 00000000            312              MOVE.L  #0,A0
0000118E  4E75                     313  DMMFFND     RTS
00001190                           314  
00001190                           315  ; -----------------------------------------------------------------------------
00001190                           316  DMMNEXTO
00001190                           317  ; SEARCHES THE NEXT MEMORY SLOT WITH THE SPECIFIED ID AND OUTPUTS A POINTER
00001190                           318  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00001190                           319  ; INPUT    - D0.W : ID TO SEARCH
00001190                           320  ;            A0   : POINTER WITHIN THE CURRENT SLOT
00001190                           321  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00001190                           322  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001190                           323  ; -----------------------------------------------------------------------------
00001190  2F00                     324              MOVE.L  D0,-(A7)
00001192  2008                     325              MOVE.L  A0,D0
00001194  C0BC FFFFFFC0            326              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
0000119A  0680 00000040            327              ADD.L   #DMMBSIZE,D0
000011A0  2040                     328              MOVE.L  D0,A0
000011A2  201F                     329              MOVE.L  (A7)+,D0
000011A4  60DA                     330              BRA     DMMFCOM
000011A6                           331  
000011A6                           332  ; -----------------------------------------------------------------------------
000011A6                           333  DMMALLOC
000011A6                           334  ; SEARCHES THE FIRST FREE (SYS OWNED) SLOT, ASSIGNS TO THE SPECIFIED OWNER
000011A6                           335  ; AND RETURNS A POINTER TO THE CORRESPONDING DATA (SLOT ADDRESS + 2)
000011A6                           336  ; INPUT    - D0.W : ID TO ASSIGN
000011A6                           337  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FREE SPACE
000011A6                           338  ; MODIFIES - NONE (ASIDE OF OUTPUT)
000011A6                           339  ; -----------------------------------------------------------------------------
000011A6  3F00                     340              MOVE.W  D0,-(A7)
000011A8  4240                     341              CLR.W   D0
000011AA  4EB8 116E                342              JSR     DMMFRSTO
000011AE  301F                     343              MOVE.W  (A7)+,D0
000011B0  B1FC 00000000            344              CMP.L   #0,A0
000011B6  6700 0006                345              BEQ     .END
000011BA  3140 FFFE                346              MOVE.W  D0,-2(A0)
000011BE  4E75                     347  .END        RTS
000011C0                           348  
000011C0                           349  ; -----------------------------------------------------------------------------
000011C0                           350  DMMFREE
000011C0                           351  ; FREES THE SLOT TO WHICH THE PROVIDED POINTER BELONGS BY SETTING ITS OWNED TO
000011C0                           352  ; SYSTEM (0)
000011C0                           353  ; INPUT    - A0   : POINTER BELONGING TO THE SLOT TO FREE
000011C0                           354  ; OUTPUT   - NONE
000011C0                           355  ; MODIFIES - NONE
000011C0                           356  ; -----------------------------------------------------------------------------
000011C0  48E7 8080                357              MOVEM.L D0/A0,-(A7)
000011C4  2008                     358              MOVE.L  A0,D0
000011C6  C0BC FFFFFFC0            359              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
000011CC  2040                     360              MOVE.L  D0,A0
000011CE  4250                     361              CLR.W   (A0)
000011D0  4CDF 0101                362              MOVEM.L (A7)+,D0/A0
000011D4  4E75                     363              RTS
000011D4  4E75                     364  -------------------- end include --------------------
000011D6                           365              INCLUDE "CONST.X68"             ; GAME CONSTANTS
000011D6                           366  ; =============================================================================
000011D6                           367  ; TITLE    : GAME CONSTANTS
000011D6                           368  ; AUTHOR   :
000011D6                           369  ; HISTORY  :
000011D6                           370  ; =============================================================================
000011D6                           371  
000011D6                           372  ; TILE RELATED CONSTANTS 
000011D6  =00000020                373  TILEDIM     EQU     32         ; TILE SET DIMENSIONS && PLAYER SPEED
000011D6  =00745B6D                374  TILEDARK    EQU     $00745B6D  ; TILE SET DARK COLOR 
000011D6  =00CCE0EA                375  TILELIGH    EQU     $00CCE0EA  ; TILE SET LIGHT COLOR
000011D6  =00957EA0                376  TILEDETA    EQU     $00957ea0  ; TILE SET DETAIL COLOR
000011D6  =0030252D                377  TILEDDARK   EQU     $0030252d  ; TILE SET EXTRA DARK
000011D6                           378  
000011D6                           379  ; BUTTONS
000011D6  =00000050                380  BUTTONWIDTH EQU     80
000011D6  =0000002D                381  BUTTONHEIGH EQU     45
000011D6  =000000D5                382  BUTTONX1    EQU     213
000011D6  =000001AA                383  BUTTONX2    EQU     426
000011D6  =00000190                384  BUTTONY     EQU     400
000011D6                           385  
000011D6                           386  ; STRINGS 
000011D6= 59 4F 55 20 44 4F ...    387  NOKEYSTRING DC.B    'YOU DO NOT HAVE ANY KEYS', 0
000011EF= 53 4F 4D 45 20 50 ...    388  DEATHSTRING DC.B    'SOME PART OF YOUR SOUL  FADES AWAY', 0
00001212= 59 4F 55 20 48 41 ...    389  SUSSERTOD   DC.B    'YOU HAD SO MUCH TO LIVE FOR, YET YOU WENT DOWN THE DUNGEON', 0
0000124D= 20 4C 45 56 45 4C ...    390  LEVELSTRING DC.B    ' LEVEL: ', 0
00001256= 44 4F 57 4E 20 54 ...    391  TITLESTRING DC.B    'DOWN THE DUNGEON HOLE!!!', 0
0000126F= 57 48 59 20 44 49 ...    392  SUBTITLESTR DC.B    'WHY DID YOU COME HERE?', 0
00001286= 28 50 55 53 48 20 ...    393  NEXTSTR     DC.B    '(PUSH SPACE TO CONTINUE)', 0  ; 24
0000129F= 28 44 4F 20 4E 4F ...    394  BECARESTR   DC.B    '(DO NOT RUSH YOURSELF)', 0
000012B6= 52 45 54 52 59 00        395  RETRYSTR    DC.B    'RETRY', 0
000012BC= 45 58 49 54 00           396  EXITSTR     DC.B    'EXIT', 0
000012C1= 45 41 53 59 00           397  EASYSTR     DC.B    'EASY', 0
000012C6= 4E 4F 52 4D 41 4C 00     398  NORMALSTR   DC.B    'NORMAL', 0
000012CD= 59 4F 55 52 20 54 ...    399  TORCHWEAK10 DC.B    'YOUR TORCH GROWS  WEAK ON EACH', 0  ; 30
000012EC= 53 54 45 50 20 20 ...    400  TORCHWEAK11 DC.B    'STEP  YOU TAKE', 0                       ; 14
000012FB= 54 48 45 20 45 43 ...    401  TORCHWEAK20 DC.B    'THE ECHO OF YOUR TORCH IS ALMOST', 0  ; 32
0000131C= 55 4E 4E 4F 54 49 ...    402  TORCHWEAK21 DC.B    'UNNOTICEABLE  TO YOU', 0                     ; 20
00001332                           403              DS.W    0
00001332                           404  
00001332  =0000000C                405  ENEMYMAXCNT EQU     12                      
00001332                           406  
00001332                           407  ; ID'S FOR AGENTS AND MATRIX IN CASE TORCH SHADER IS IMPLEMENTED
00001332  =00000001                408  EMPTYID     EQU     1                       ; VOID IDENTIFIER
00001332  =00000002                409  WALLID      EQU     2                       ; WALL IDENTIFIER
00001332  =00000003                410  FLOORID     EQU     3                       ; FLOOR IDENTIFIER | ONLY USEFUL IF TILE SET IS IMPLEMENTED
00001332  =00000004                411  STAIRID     EQU     4                       ; STAIR IDENTIFIER
00001332  =00000005                412  KEYID       EQU     5                       ; KEY IDENTIFIER
00001332  =00000006                413  PLYRID      EQU     6                       ; PLAYER IDENTIFIER
00001332  =00000007                414  ENEMYID     EQU     7                       ; TRAP IDENTIFIER
00001332                           415  
00001332                           416  ; STATES
00001332  =00000000                417  STAMM       EQU     0                       ; STATE MAIN MENU
00001332  =00000001                418  STAGP       EQU     1                       ; STATE GAME PLAY
00001332  =00000002                419  STADM       EQU     2                       ; STATE DEATH MENU
00001332                           420  
00001332                           421  ; AUDIO FILES
00001332                           422  ;AUDIOLIST  DC.L    AUDIOMUS1, AUDIOMUS2, AUDIOMOVE, AUDIOKEY, AUDIOSTAR, AUDIOTALK, AUDIODIED, AUDIOCLK, 0
00001332                           423  ;AUDIOIDS   DC.B    AUDIOMUS1ID, AUDIOMUS2ID, AUDIOMOVEID, AUDIOKEYID, AUDIOSTARID, AUDIOTALKID, AUDIODIEDID, AUDIOCLKID
00001332                           424              DS.W    0
00001332                           425  
00001332                           426  ; AUDIO CONSTANTS 
00001332                           427              
00001332                           428              ; MASKS
00001332  =000000FF                429  AUDIOACCY   EQU     $FF                     ; ACCEPT NEW SOUNDS 
00001332  =00000000                430  AUDIOSCCN   EQU     $00                     ; DO NOT ACCEPT NEW SOUNDS 
00001332  =00000080                431  AUDIOLOOP   EQU     $80                     ; LOOP ACTIVE SOUND
00001332  =00000000                432  AUDIONLOP   EQU     $00                     ; DO NOT LOOP ACTIVE SOUND
00001332  =000000FF                433  AUDIOSTOP   EQU     $FF                     ; STOP ALL SOUNDS 
00001332                           434              
00001332                           435              ; IDS
00001332  =00000000                436  AUDIOMUS1ID EQU     0                       ; MUSIC ID 1 
00001332  =00000001                437  AUDIOMUS2ID EQU     1                       ; MUSIC ID 2
00001332                           438  
00001332  =00000002                439  AUDIOMOVEID EQU     2                       ; MOVE 
00001332  =00000003                440  AUDIOKEYID  EQU     3                       ; OBTAIN KEY 
00001332  =00000004                441  AUDIOSTARID EQU     4                       ; GO DOWN STAIRS 
00001332  =00000005                442  AUDIOTALKID EQU     5                       ; TALK
00001332  =00000006                443  AUDIODIEDID EQU     6                       ; DEATH
00001332  =00000007                444  AUDIOCLKID  EQU     7                       ; CLICK
00001332                           445              
00001332                           446              ; PATHS
00001332                           447  ;AUDIOMUS1  DC.B    '',0
00001332                           448  ;AUDIOMUS2  DC.B    '',0
00001332                           449  ;           
00001332                           450  ;AUDIOMOVE  DC.B    '',0
00001332                           451  ;AUDIOKEY   DC.B    '',0
00001332                           452  ;AUDIOSTAR  DC.B    '',0
00001332                           453  ;AUDIOTALK  DC.B    '',0
00001332                           454  ;AUDIODIED  DC.B    '',0
00001332                           455  ;AUDIOCLK   DC.B    '',0
00001332                           456  
00001332                           457  ; PSEUDO-RANDOM GENERATOR VECTORS
00001332= 0100 0220 0180 0...      458  XVALUES     DC.W    $100, $220, $180, $1C0, $80, $C0, $200, $E0, $160, $120
00001346= 0060 01E0 00A0 0...      459              DC.W    $60, $1E0, $A0, $1A0, $140
00001350                           460  
00001350= 00D0 0090 00B0 0...      461  YVALUES     DC.W    $D0, $90, $B0, $F0, $B0, $90, $190, $110, $170, $190
00001364= 00B0 01B0 00B0 0...      462              DC.W    $B0, $1B0, $B0, $130, $D0, $50, $170, $190, $130, $110
00001378= 01B0 0150 0090 0...      463              DC.W    $1B0, $150, $90, $90, $110, $30, $70, $150, $90, $10
0000138C= 01B0 00F0 00D0 0...      464              DC.W    $1B0, $F0, $D0, $D0, $90, $1B0, $B0, $170, $130, $190
000013A0= 00F0 0030 0150 0...      465              DC.W    $F0, $30, $150, $50, $170, $110, $1B0, $170, $150, $150
000013B4= 0070 01B0 0030 0...      466              DC.W    $70, $1B0, $30, $F0, $10, $90, $F0, $70, $D0, $170
000013C8= 0050 00B0 00D0 0...      467              DC.W    $50, $B0, $D0, $190, $90, $170, $50, $50, $50, $90
000013DC= 0090 01B0 0030 0...      468              DC.W    $90, $1B0, $30, $110, $130, $50, $B0, $110, $F0, $70
000013F0= 0010 01B0 0110 0...      469              DC.W    $10, $1B0, $110, $50, $D0, $F0, $F0, $30, $30, $150
00001404= 00B0 0030 0110 0...      470              DC.W    $B0, $30, $110, $110, $1B0, $190, $30, $30, $170, $170
00001418= 0030 0190 0130 0...      471              DC.W    $30, $190, $130, $90, $50, $90, $110, $150, $190, $110
0000142C= 0050 0110 00F0 0...      472              DC.W    $50, $110, $F0, $190, $1B0, $170, $70, $1B0, $F0, $1B0
00001440= 0050 0130 0150 0...      473              DC.W    $50, $130, $150, $130, $70, $30, $D0, $150, $50, $130
00001454= 00B0 0010 0010 0...      474              DC.W    $B0, $10, $10, $30, $90, $F0, $B0, $70, $B0, $70
00001468= 0070 00B0 0010 0...      475              DC.W    $70, $B0, $10, $130, $70, $70, $150, $B0, $130, $1B0
0000147C= 0030 0190 0130 0...      476              DC.W    $30, $190, $130, $D0, $10, $1D0, $150, $110, $F0, $10
00001490= 0190 0070 0130 0...      477              DC.W    $190, $70, $130, $F0, $10, $70, $10, $30, $190, $D0
000014A4= 0170 0150 0010 0...      478              DC.W    $170, $150, $10, $50, $170, $D0, $F0, $B0, $B0, $D0
000014B8= 0190 0090 00B0 0...      479              DC.W    $190, $90, $B0, $90, $190, $10, $110, $90, $110, $130
000014CC= 0010 0050 00D0 0...      480              DC.W    $10, $50, $D0, $50, $1B0, $170, $F0, $150, $F0, $10
000014E0= 0150 0070 0170 0...      481              DC.W    $150, $70, $170, $110, $D0, $50, $1B0, $30, $150, $170
000014F4= 0130 0030 0070 0...      482              DC.W    $130, $30, $70, $190, $130, $30, $150, $130, $190, $10
00001508= 0010 00D0 0070 0...      483              DC.W    $10, $D0, $70, $D0, $B0
00001508= 0010 00D0 0070 0...      484  -------------------- end include --------------------
00001512                           485              INCLUDE "UTIL.X68"              ; UTILITY MANAGER
00001512                           486  UTILPEN     MACRO
00001512                           487  ;   IN:  \1 AS THE COLOR, FORMATED AS #00BBGGRR
00001512                           488  ;   OUT: NONE
00001512                           489  ;   MOD: D0, D1    
00001512                           490  ;   DES: MACRO TO SET PEN COLOR
00001512                           491  
00001512                           492          MOVE.B  #80, D0 
00001512                           493          MOVE.L  \1, D1
00001512                           494          TRAP    #15
00001512                           495          ENDM
00001512                           496  
00001512                           497  UTILFILL    MACRO
00001512                           498  ;   IN:  \1 AS THE COLOR, FORMATED AS #00BBGGRR
00001512                           499  ;   OUT: NONE
00001512                           500  ;   MOD: D0, D1
00001512                           501  ;   DES: MACRO TO SET FILL COLOR
00001512                           502  
00001512                           503          MOVE.B  #81, D0
00001512                           504          MOVE.L  \1, D1
00001512                           505          TRAP    #15
00001512                           506          ENDM
00001512                           507  
00001512                           508  UTILTEXT    MACRO
00001512                           509  ;   IN:  \1 TEXT 
00001512                           510  ;        \2 TEXT X
00001512                           511  ;        \3 TEXT Y
00001512                           512  ;   OUT: NONE
00001512                           513  ;   MOD: D0-D2 / A1
00001512                           514  ;   DES: PRINTS THE 0 TERINATED STRING IN \1 IN COORDINATES \2 \3
00001512                           515  
00001512                           516          LEA     \1, A1
00001512                           517          MOVE.W  \2, D1
00001512                           518          MOVE.W  \3, D2
00001512                           519  
00001512                           520          MOVE.W  #95, D0
00001512                           521          TRAP    #15
00001512                           522          ENDM
00001512                           523  
00001512                           524  UTILTILE    MACRO
00001512                           525  ;   IN:  \1 PROCEDURE OF THE TRAP #15
00001512                           526  ;        \2 X COORDINATE
00001512                           527  ;        \3 Y COORDINATE
00001512                           528  ;   OUT: NONE
00001512                           529  ;   MOD: D1-D4
00001512                           530  ;   DES: DRAWS A GRAPHIC AT \2 \3
00001512                           531          MOVE.W  \2, D1               ; D1 = X CENTER
00001512                           532          MOVE.W  \3, D2               ; D1 = Y CENTER
00001512                           533          MOVE.W  D1, D3
00001512                           534          MOVE.W  D2, D4
00001512                           535          SUB.W   #TILEDIM/2, D1              ; SET TOP LEFT CORNER
00001512                           536          SUB.W   #TILEDIM/2, D2              ; SET TOP LEFT CORNER 
00001512                           537          ADD.W   #TILEDIM/2, D3              ; SET LOW RIGHT CORNER
00001512                           538          ADD.W   #TILEDIM/2, D4              ; SET LOW RIGHT CORNER
00001512                           539  
00001512                           540          MOVE.W  \1, D0
00001512                           541          TRAP    #15
00001512                           542          ENDM
00001512                           543  
00001512                           544  UTILCOLL    
00001512                           545  ;   IN:  D0 X0 COORDINATE
00001512                           546  ;        D1 Y0 COORDINATE
00001512                           547  ;   OUT: D2.B = FF IF COLLISION, 00 ELSEWISE
00001512                           548  ;   MOD: D2
00001512                           549  ;   DES: CHECKS IF ELEMENTS 0 AND 1 HAVE THE SAME POSITION 
00001512                           550  
00001512  4242                     551          CLR     D2
00001514  B079 00002B80            552          CMP.W   (PLAYERX), D0   ; COMPARE X COORDINATES
0000151A  6600 0010                553          BNE .NOCOL
0000151E  B279 00002B82            554          CMP.W   (PLAYERY), D1   ; COMPARE Y COORDINATES
00001524  6600 0006                555          BNE .NOCOL
00001528  143C 00FF                556          MOVE.B  #$FF, D2
0000152C                           557  .NOCOL
0000152C  4E75                     558          RTS
0000152E                           559  
0000152E                           560  
0000152E                           561      
0000152E                           562  -------------------- end include --------------------
0000152E                           563              INCLUDE "RANDOM.X68"            ; PSEUDO - RANDOM GENERATOR
0000152E                           564  ; =============================================================================
0000152E                           565  ; TITLE    : PSEUDO-RANDOM NUMBER GENERATOR
0000152E                           566  ; AUTHOR   : ANTONI BURGUERA
0000152E                           567  ; COMMENTS : VERY LAZY AND STUPID "ALGORITHM" IMPLEMENTED.
0000152E                           568  ; HISTORY  : XX-XXX-201X - CREATION
0000152E                           569  ;            11-OCT-2020 - MINOR CHANGES
0000152E                           570  ; =============================================================================
0000152E                           571  
0000152E                           572  ; -----------------------------------------------------------------------------
0000152E                           573  RNDINIT
0000152E                           574  ; INITIALIZES RANDOM NUMBER GENERATOR
0000152E                           575  ; INPUT    - NONE
0000152E                           576  ; OUTPUT   - NONE
0000152E                           577  ; MODIFIES - NONE
0000152E                           578  ; -----------------------------------------------------------------------------
0000152E  4279 00002B9A            579              CLR     (RNGXINDEX)
00001534  4279 00002B9C            580              CLR     (RNGYINDEX)
0000153A                           581  
0000153A  4E75                     582              RTS
0000153C                           583  ; -----------------------------------------------------------------------------
0000153C                           584  RNGX
0000153C                           585  ; PROVIDES A PSEUDO-RANDOM BYTE
0000153C                           586  ; INPUT    - NONE
0000153C                           587  ; OUTPUT   - D0.L RANDOM VALUE (ONLY BYTE)
0000153C                           588  ; MODIFIES - NONE (ASIDE OF OUTPUT)
0000153C                           589  ; -----------------------------------------------------------------------------
0000153C  2F08                     590              MOVE.L  A0,-(A7)
0000153E                           591  
0000153E  41F8 1332                592              LEA     XVALUES, A0
00001542  4280                     593              CLR.L   D0
00001544                           594              
00001544  1039 00002B9A            595              MOVE.B  (RNGXINDEX), D0
0000154A  E348                     596              LSL.W   #1, D0     
0000154C  D0C0                     597              ADD.W   D0, A0
0000154E  3010                     598              MOVE.W  (A0), D0
00001550  5239 00002B9A            599              ADDQ.B  #1, (RNGXINDEX)
00001556  0C79 0C00 00002B9A       600              CMP     #$0C00, (RNGXINDEX)
0000155E  6600 0008                601              BNE     .NOVERFLOW     
00001562  4279 00002B9A            602              CLR     (RNGXINDEX)
00001568                           603  .NOVERFLOW            
00001568  205F                     604              MOVE.L  (A7)+, A0
0000156A  4E75                     605              RTS
0000156C                           606  
0000156C                           607  RNGY
0000156C                           608  ; PROVIDES A PSEUDO-RANDOM BYTE
0000156C                           609  ; INPUT    - NONE
0000156C                           610  ; OUTPUT   - D0.L RANDOM VALUE (ONLY BYTE)
0000156C                           611  ; MODIFIES - NONE (ASIDE OF OUTPUT)
0000156C                           612  ; -----------------------------------------------------------------------------
0000156C  2F08                     613              MOVE.L  A0,-(A7)
0000156E                           614  
0000156E  41F8 1350                615              LEA     YVALUES, A0
00001572  4280                     616              CLR.L   D0
00001574                           617              
00001574  1039 00002B9C            618              MOVE.B  (RNGYINDEX), D0
0000157A  E348                     619              LSL.W   #1, D0  
0000157C  D0C0                     620              ADD.W   D0, A0
0000157E  3010                     621              MOVE.W  (A0), D0
00001580  5239 00002B9C            622              ADDQ.B  #1, (RNGYINDEX)
00001586  0C79 E100 00002B9C       623              CMP     #$E100, (RNGYINDEX)
0000158E  6600 0008                624              BNE     .NOVERFLOW
00001592  4279 00002B9C            625              CLR     (RNGYINDEX)
00001598                           626  .NOVERFLOW
00001598  205F                     627              MOVE.L  (A7)+, A0
0000159A  4E75                     628              RTS
0000159C                           629  
0000159C                           630  ; UPDATE RANDOM VALUES TO HAVE ONLY CENTER VALUES OF THE "GRID"
0000159C                           631  -------------------- end include --------------------
0000159C                           632              INCLUDE "AGENTLST.X68"          ; AGENT MANAGER
0000159C                           633  ; =============================================================================
0000159C                           634  ; TITLE    : AGENT LIST
0000159C                           635  ; AUTHOR   : ANTONI BURGUERA
0000159C                           636  ; COMMENTS : EACH AGENT HAS A DATA BLOCK FROM DMM AS FOLLOWS:
0000159C                           637  ;              +0 - LONG : UPDATE SUBROUTINE POINTER
0000159C                           638  ;              +4 - LONG : PLOT SUBROUTINE POINTER
0000159C                           639  ;              +8:END    : DATA (AGENT SPECIFIC)
0000159C                           640  ; HISTORY  : XX-XXX-201X - CREATION
0000159C                           641  ;            11-OCT-2020 - MINOR CHANGES
0000159C                           642  ; =============================================================================
0000159C                           643  
0000159C                           644  ; -----------------------------------------------------------------------------
0000159C                           645  AGLADD
0000159C                           646  ; CREATES A NEW AGENT
0000159C                           647  ; INPUT    - A1 - POINTER TO AGENT INIT FUNCTION
0000159C                           648  ;            A2 - POINTER TO AGENT UPDATE FUNCTION
0000159C                           649  ;            A3 - POINTER TO AGENT PLOT FUNCTION
0000159C                           650  ;            D0 - AGENT TYPE (USED AS OWNED BY DMM)
0000159C                           651  ;            D1 - AGENT INITIALIZATION PARAMETER 1
0000159C                           652  ;            D2 - AGENT INITIALIZATION PARAMETER 2
0000159C                           653  ;            D3 - AGENT INITIALIZATION PARAMETER 3
0000159C                           654  ; OUTPUT   - NONE
0000159C                           655  ; MODIFIES - NONE
0000159C                           656  ; -----------------------------------------------------------------------------
0000159C  2F08                     657              MOVE.L  A0,-(A7)
0000159E  4EB8 11A6                658              JSR     DMMALLOC
000015A2  B1FC 00000000            659              CMP.L   #0,A0
000015A8  6700 0008                660              BEQ     .END
000015AC  20CA                     661              MOVE.L  A2,(A0)+
000015AE  20CB                     662              MOVE.L  A3,(A0)+
000015B0  4E91                     663              JSR     (A1)
000015B2  205F                     664  .END        MOVE.L  (A7)+,A0
000015B4  4E75                     665              RTS
000015B6                           666  
000015B6                           667  ; -----------------------------------------------------------------------------
000015B6                           668  AGLUPDT
000015B6                           669  ; UPDATES THE AGENT LIST. PRIOR TO CALLING THE UPDATE FUNCTIONS, A0 IS SET
000015B6                           670  ; TO THE DATA BLOCK OF THE CORRESPONDING SLOT.
000015B6                           671  ; INPUT    - NONE
000015B6                           672  ; OUTPUT   - NONE
000015B6                           673  ; MODIFIES - NONE
000015B6                           674  ; -----------------------------------------------------------------------------
000015B6  48E7 00C0                675              MOVEM.L A0-A1,-(A7)
000015BA  4EB8 1136                676              JSR     DMMFIRST
000015BE  B1FC 00000000            677  .LOOP       CMP.L   #0,A0
000015C4  6700 000E                678              BEQ     .END
000015C8  2250                     679              MOVE.L  (A0),A1
000015CA  5088                     680              ADD.L   #8,A0
000015CC  4E91                     681              JSR     (A1)
000015CE  4EB8 1158                682              JSR     DMMNEXT
000015D2  60EA                     683              BRA     .LOOP
000015D4  4CDF 0300                684  .END        MOVEM.L (A7)+,A0-A1
000015D8  4E75                     685              RTS
000015DA                           686  
000015DA                           687  ; -----------------------------------------------------------------------------
000015DA                           688  AGLPLOT
000015DA                           689  ; PLOTS THE AGENT LIST. PRIOR TO CALLING THE UPDATE FUNCTIONS, A0 IS SET
000015DA                           690  ; TO THE DATA BLOCK OF THE CORRESPONDING SLOT.
000015DA                           691  ; INPUT    - NONE
000015DA                           692  ; OUTPUT   - NONE
000015DA                           693  ; MODIFIES - NONE
000015DA                           694  ; -----------------------------------------------------------------------------
000015DA  48E7 00C0                695              MOVEM.L A0-A1,-(A7)
000015DE  4EB8 1136                696              JSR     DMMFIRST
000015E2  B1FC 00000000            697  .LOOP       CMP.L   #0,A0
000015E8  6700 0010                698              BEQ     .END
000015EC  2268 0004                699              MOVE.L  4(A0),A1
000015F0  5088                     700              ADD.L   #8,A0
000015F2  4E91                     701              JSR     (A1)
000015F4  4EB8 1158                702              JSR     DMMNEXT
000015F8  60E8                     703              BRA     .LOOP
000015FA  4CDF 0300                704  .END        MOVEM.L (A7)+,A0-A1
000015FE  4E75                     705              RTS
00001600                           706  
00001600                           707  ; -----------------------------------------------------------------------------
00001600  =000011C0                708  AGLKILL     EQU     DMMFREE
00001600                           709  ; KILLS THE AGENT BY RELEASING ITS MEMORY
00001600                           710  ; INPUT    - A0 POINTER WITHIN THE AGENT MEMORY
00001600                           711  ; OUTPUT   - NONE
00001600                           712  ; MODIFIES - NONE
00001600                           713  ; NOTE     - IT IS JUST A WRAPPER FOR DMMFREE
00001600                           714  ; -----------------------------------------------------------------------------
00001600                           715  
00001600                           716  AGLFKIL
00001600                           717  ; KILLS ALL AGENTS WITH ID 'X'
00001600                           718  ; INPUT    - D0 AGENT ID
00001600  48E7 00C0                719              MOVEM.L A0-A1,-(A7)
00001604  4EB8 116E                720              JSR     DMMFRSTO
00001608  B1FC 00000000            721  .LOOP       CMP.L   #0, A0
0000160E  6700 000C                722              BEQ     .END            ; AGENT LIST IS EMPTY
00001612  4EB8 11C0                723              JSR     AGLKILL
00001616  4EB8 116E                724              JSR     DMMFRSTO        ; SEARCH NEXT AGENT WITH ID D0
0000161A  60EC                     725              BRA     .LOOP
0000161C  4CDF 0300                726  .END        MOVEM.L (A7)+,A0-A1
00001620  4E75                     727              RTS
00001620  4E75                     728  -------------------- end include --------------------
00001622                           729              INCLUDE "PLAYER.X68"            ; PLAYER MANAGER
00001622                           730  ; =============================================================================
00001622                           731  ; TITLE    : PLAYER MANAGER
00001622                           732  ; AUTHOR   : 
00001622                           733  ; COMMENTS : 
00001622                           734  ; =============================================================================
00001622                           735  
00001622                           736  
00001622                           737  PLAYERINIT
00001622  33FC 0140 00002B80       738              MOVE.W #SCRWIDTH/2, (PLAYERX)       ; SET PLAYER TO CENTER
0000162A  33FC 00F0 00002B82       739              MOVE.W #SCRHEIGH/2, (PLAYERY)       ; SET PLAYER TO CENTER
00001632  4E75                     740              RTS
00001634                           741  
00001634                           742  PLAYERUPDT  
00001634                           743  
00001634  0839 0000 00001ECB       744              BTST.B  #0, (SCRCYCCT)
0000163C  6600 0092                745              BNE     .END  
00001640  0839 0000 00001EC8       746              BTST.B  #KBDBITLF, (KBDVAL)         ; LEFT KEY PRESSED
00001648  6600 0028                747              BNE     .MOVEL
0000164C  0839 0002 00001EC8       748              BTST.B  #KBDBITRT, (KBDVAL)         ; RIGHT KEY PRESSED
00001654  6600 0034                749              BNE     .MOVER
00001658  0839 0001 00001EC8       750              BTST.B  #KBDBITUP, (KBDVAL)         ; UP KEY PRESSED
00001660  6600 0040                751              BNE     .MOVEU
00001664  0839 0003 00001EC8       752              BTST.B  #KBDBITDN, (KBDVAL)         ; DOWN KEY PRESSED
0000166C  6600 004C                753              BNE     .MOVED
00001670  4E75                     754              RTS
00001672                           755  .MOVEL
00001672  0C79 0070 00002B80       756              CMP.W   #TILEDIM/2+(SCRWIDTH-SCRHEIGH)-64, (PLAYERX)       ; LEFT BOUNDARY
0000167A  6E00 0004                757              BGT     .RMVEL
0000167E  4E75                     758              RTS
00001680                           759  .RMVEL
00001680  0479 0020 00002B80       760              SUB.W   #TILEDIM, (PLAYERX)         ; MOVE LEFT
00001688  4E75                     761              RTS
0000168A                           762  
0000168A                           763  .MOVER
0000168A  0C79 020F 00002B80       764              CMP.W   #SCRHEIGH-1-TILEDIM/2+64, (PLAYERX)    ; RIGHT BOUNDARY
00001692  6D00 0004                765              BLT     .RMVER
00001696  4E75                     766              RTS
00001698                           767  .RMVER
00001698  0679 0020 00002B80       768              ADD.W   #TILEDIM, (PLAYERX)         ; MOVE RIGHT
000016A0  4E75                     769              RTS
000016A2                           770  
000016A2                           771  .MOVEU
000016A2  0C79 0010 00002B82       772              CMP.W   #TILEDIM/2, (PLAYERY)       ; TOP BOUNDARY
000016AA  6E00 0004                773              BGT     .RMVEU
000016AE  4E75                     774              RTS
000016B0                           775  .RMVEU
000016B0  0479 0020 00002B82       776              SUB.W   #TILEDIM, (PLAYERY)         ; MOVE UP
000016B8  4E75                     777              RTS
000016BA                           778  
000016BA                           779  .MOVED
000016BA  0C79 01CF 00002B82       780              CMP.W   #SCRHEIGH-1-TILEDIM/2, (PLAYERY)    ; BOTTOM BOUNDARY
000016C2  6D00 0004                781              BLT     .RMVED
000016C6  4E75                     782              RTS
000016C8                           783  .RMVED
000016C8  0679 0020 00002B82       784              ADD.W   #TILEDIM, (PLAYERY)         ; MOVE DOWN
000016D0                           785  .END
000016D0  4E75                     786              RTS
000016D2                           787  
000016D2                           788  PLAYERPLOT
000016D2  48E7 F800                789              MOVEM.L D0-D4, -(A7)
000016D6                           790m             UTILPEN #TILELIGH                         
000016D6                           791m ;   IN:  #TILELIGH AS THE COLOR, FORMATED AS #00BBGGRR
000016D6                           792m ;   OUT: NONE
000016D6                           793m ;   MOD: D0, D1    
000016D6                           794m ;   DES: MACRO TO SET PEN COLOR
000016D6                           795m 
000016D6  103C 0050                796m         MOVE.B  #80, D0 
000016DA  223C 00CCE0EA            797m         MOVE.L  #TILELIGH, D1
000016E0  4E4F                     798m         TRAP    #15
000016E2                           799m         ENDM
000016E2                           800  
000016E2                           801m             UTILFILL #TILELIGH
000016E2                           802m ;   IN:  #TILELIGH AS THE COLOR, FORMATED AS #00BBGGRR
000016E2                           803m ;   OUT: NONE
000016E2                           804m ;   MOD: D0, D1
000016E2                           805m ;   DES: MACRO TO SET FILL COLOR
000016E2                           806m 
000016E2  103C 0051                807m         MOVE.B  #81, D0
000016E6  223C 00CCE0EA            808m         MOVE.L  #TILELIGH, D1
000016EC  4E4F                     809m         TRAP    #15
000016EE                           810m         ENDM
000016EE                           811              
000016EE                           812m             UTILTILE #87, (PLAYERX), (PLAYERY)
000016EE                           813m ;   IN:  #87 PROCEDURE OF THE TRAP #15
000016EE                           814m ;        (PLAYERX) X COORDINATE
000016EE                           815m ;        (PLAYERY) Y COORDINATE
000016EE                           816m ;   OUT: NONE
000016EE                           817m ;   MOD: D1-D4
000016EE                           818m ;   DES: DRAWS A GRAPHIC AT (PLAYERX) (PLAYERY)
000016EE  3239 00002B80            819m         MOVE.W  (PLAYERX), D1               ; D1 = X CENTER
000016F4  3439 00002B82            820m         MOVE.W  (PLAYERY), D2               ; D1 = Y CENTER
000016FA  3601                     821m         MOVE.W  D1, D3
000016FC  3802                     822m         MOVE.W  D2, D4
000016FE  0441 0010                823m         SUB.W   #TILEDIM/2, D1              ; SET TOP LEFT CORNER
00001702  0442 0010                824m         SUB.W   #TILEDIM/2, D2              ; SET TOP LEFT CORNER 
00001706  0643 0010                825m         ADD.W   #TILEDIM/2, D3              ; SET LOW RIGHT CORNER
0000170A  0644 0010                826m         ADD.W   #TILEDIM/2, D4              ; SET LOW RIGHT CORNER
0000170E                           827m 
0000170E  303C 0057                828m         MOVE.W  #87, D0
00001712  4E4F                     829m         TRAP    #15
00001714                           830m         ENDM
00001714  4CDF 001F                831              MOVEM.L (A7)+,D0-D4
00001718  4E75                     832              RTS
0000171A                           833  
0000171A                           834  
0000171A                           835  -------------------- end include --------------------
0000171A                           836              INCLUDE "MAP.X68"               ; MAP MANAGER
0000171A                           837  MAPINIT
0000171A  4E75                     838          RTS      
0000171C                           839  MAPUPDT
0000171C  4E75                     840          RTS
0000171E                           841  MAPPLOT
0000171E  48E7 F800                842          MOVEM.L D0-D4, -(A7)
00001722                           843          
00001722                           844m         UTILPEN #TILEDARK
00001722                           845m ;   IN:  #TILEDARK AS THE COLOR, FORMATED AS #00BBGGRR
00001722                           846m ;   OUT: NONE
00001722                           847m ;   MOD: D0, D1    
00001722                           848m ;   DES: MACRO TO SET PEN COLOR
00001722                           849m 
00001722  103C 0050                850m         MOVE.B  #80, D0 
00001726  223C 00745B6D            851m         MOVE.L  #TILEDARK, D1
0000172C  4E4F                     852m         TRAP    #15
0000172E                           853m         ENDM
0000172E                           854m         UTILFILL #TILEDARK
0000172E                           855m ;   IN:  #TILEDARK AS THE COLOR, FORMATED AS #00BBGGRR
0000172E                           856m ;   OUT: NONE
0000172E                           857m ;   MOD: D0, D1
0000172E                           858m ;   DES: MACRO TO SET FILL COLOR
0000172E                           859m 
0000172E  103C 0051                860m         MOVE.B  #81, D0
00001732  223C 00745B6D            861m         MOVE.L  #TILEDARK, D1
00001738  4E4F                     862m         TRAP    #15
0000173A                           863m         ENDM
0000173A                           864  
0000173A  4241                     865          CLR     D1                          ; LEFT BORDER
0000173C  4242                     866          CLR     D2                      
0000173E  363C 004F                867          MOVE.W  #79, D3
00001742  383C 01E0                868          MOVE.W  #SCRHEIGH, D4
00001746  303C 0057                869          MOVE.W  #87, D0
0000174A  4E4F                     870          TRAP    #15
0000174C                           871  
0000174C  323C 0231                872          MOVE.W  #561, D1                    ; RIGHT BORDER                                
00001750  363C 0280                873          MOVE.W  #SCRWIDTH, D3
00001754  4E4F                     874          TRAP    #15
00001756                           875          
00001756  4CDF 001F                876          MOVEM.L (A7)+,D0-D4
0000175A                           877  
0000175A  4E75                     878          RTS
0000175A  4E75                     879  -------------------- end include --------------------
0000175C                           880              INCLUDE "KEY.X68"               ; KEY MANAGER
0000175C                           881  KEYINIT             ; RANDOM POSITION
0000175C  2F00                     882              MOVE.L D0, -(A7)
0000175E  4EB8 153C                883              JSR     RNGX
00001762  33C0 00002B84            884              MOVE.W  D0, (KEYX)
00001768  4EB8 156C                885              JSR     RNGY
0000176C  33C0 00002B86            886              MOVE.W  D0, (KEYY)
00001772  201F                     887              MOVE.L  (A7)+, D0
00001774  4E75                     888              RTS
00001776                           889  KEYUPDT             ; NOTHING
00001776  48E7 E000                890              MOVEM.L D0-D2, -(A7)
0000177A                           891             
0000177A  3039 00002B84            892              MOVE.W  (KEYX), D0
00001780  3239 00002B86            893              MOVE.W  (KEYY), D1
00001786  4EB8 1512                894              JSR     UTILCOLL
0000178A  B43C 00FF                895              CMP.B   #$FF, D2
0000178E  6600 000A                896              BNE     .END
00001792  13FC 0001 00002B90       897              MOVE.B  #1, (KEYOBTEINED)           ; THE PLAYER IS IN THE POSITION OF THE KEY
0000179A                           898  .END
0000179A  4CDF 0007                899              MOVEM.L (A7)+, D0-D2
0000179E  4E75                     900              RTS
000017A0                           901  
000017A0                           902  KEYPLOT             ; LIGHT BORDERED CIRCLE
000017A0  0C39 0001 00002B90       903              CMP.B   #1, (KEYOBTEINED)
000017A8  6700 003C                904              BEQ     .NOKEY
000017AC  48E7 F800                905              MOVEM.L D0-D4, -(A7)
000017B0                           906m             UTILPEN #TILELIGH
000017B0                           907m ;   IN:  #TILELIGH AS THE COLOR, FORMATED AS #00BBGGRR
000017B0                           908m ;   OUT: NONE
000017B0                           909m ;   MOD: D0, D1    
000017B0                           910m ;   DES: MACRO TO SET PEN COLOR
000017B0                           911m 
000017B0  103C 0050                912m         MOVE.B  #80, D0 
000017B4  223C 00CCE0EA            913m         MOVE.L  #TILELIGH, D1
000017BA  4E4F                     914m         TRAP    #15
000017BC                           915m         ENDM
000017BC                           916  
000017BC                           917m             UTILTILE #91, (KEYX), (KEYY)             
000017BC                           918m ;   IN:  #91 PROCEDURE OF THE TRAP #15
000017BC                           919m ;        (KEYX) X COORDINATE
000017BC                           920m ;        (KEYY) Y COORDINATE
000017BC                           921m ;   OUT: NONE
000017BC                           922m ;   MOD: D1-D4
000017BC                           923m ;   DES: DRAWS A GRAPHIC AT (KEYX) (KEYY)
000017BC  3239 00002B84            924m         MOVE.W  (KEYX), D1               ; D1 = X CENTER
000017C2  3439 00002B86            925m         MOVE.W  (KEYY), D2               ; D1 = Y CENTER
000017C8  3601                     926m         MOVE.W  D1, D3
000017CA  3802                     927m         MOVE.W  D2, D4
000017CC  0441 0010                928m         SUB.W   #TILEDIM/2, D1              ; SET TOP LEFT CORNER
000017D0  0442 0010                929m         SUB.W   #TILEDIM/2, D2              ; SET TOP LEFT CORNER 
000017D4  0643 0010                930m         ADD.W   #TILEDIM/2, D3              ; SET LOW RIGHT CORNER
000017D8  0644 0010                931m         ADD.W   #TILEDIM/2, D4              ; SET LOW RIGHT CORNER
000017DC                           932m 
000017DC  303C 005B                933m         MOVE.W  #91, D0
000017E0  4E4F                     934m         TRAP    #15
000017E2                           935m         ENDM
000017E2                           936             
000017E2  4CDF 001F                937              MOVEM.L (A7)+,D0-D4
000017E6                           938  .NOKEY            
000017E6  4E75                     939              RTS
000017E6  4E75                     940  -------------------- end include --------------------
000017E8                           941              INCLUDE "STAIRS.X68"            ; STAIR MANAGER 
000017E8                           942  STAIRSINIT          ; RANDOM POSTION
000017E8  2F00                     943              MOVE.L D0, -(A7)
000017EA  4EB8 153C                944              JSR     RNGX
000017EE  33C0 00002B88            945              MOVE.W  D0, (STAIRSX)
000017F4  4EB8 156C                946              JSR     RNGY
000017F8  33C0 00002B8A            947              MOVE.W  D0, (STAIRSY)
000017FE  201F                     948              MOVE.L  (A7)+, D0
00001800  4279 00002B96            949              CLR     ONSTAIRS
00001806  4E75                     950              RTS
00001808                           951  STAIRSUPDT          
00001808  48E7 E070                952              MOVEM.L D0-D2/A1-A3, -(A7)
0000180C  3039 00002B88            953              MOVE.W  (STAIRSX), D0
00001812  3239 00002B8A            954              MOVE.W  (STAIRSY), D1
00001818  4EB8 1512                955              JSR     UTILCOLL
0000181C  B43C 00FF                956              CMP.B   #$FF, D2
00001820  6600 0062                957              BNE     .ENDD
00001824                           958              
00001824                           959              ; THE PLAYER IS IN THE POSITION OF THE STAIRS
00001824  0C39 0001 00002B90       960              CMP.B   #1, (KEYOBTEINED)
0000182C  6600 004A                961              BNE     .NOKEY
00001830  4EB8 175C                962              JSR     KEYINIT
00001834  4EB8 17E8                963              JSR     STAIRSINIT
00001838                           964  
00001838                           965  ; CREATE ENEMIES BASED ON LEVEL 
00001838  4280                     966              CLR.L   D0
0000183A  303C 0007                967              MOVE.W  #ENEMYID, D0
0000183E  4EB8 1600                968              JSR     AGLFKIL     ; KILLS ALL AGENTS WITH ID       
00001842  3239 00002B9E            969              MOVE.W (LEVEL), D1
00001848                           970              
00001848                           971  .ENEMYADD
00001848  43F9 0000190E            972              LEA     ENEMYINIT, A1
0000184E  45F9 0000192A            973              LEA     ENEMYUPDT, A2
00001854  47F9 0000194E            974              LEA     ENEMYPLOT, A3
0000185A  303C 0007                975              MOVE.W  #ENEMYID, D0
0000185E                           976              
0000185E  4EB8 159C                977              JSR     AGLADD
00001862  51C9 FFE4                978              DBRA.W    D1, .ENEMYADD
00001866                           979  
00001866  13FC 0000 00002B90       980              MOVE.B  #0, (KEYOBTEINED)
0000186E  5279 00002B9E            981              ADDQ.W  #1, (LEVEL)
00001874  6000 0014                982              BRA     .END
00001878                           983  .NOKEY      ; SAME POSITION NO KEY
00001878  33FC 0001 00002B96       984              MOVE.W  #1, (ONSTAIRS)
00001880  6000 0008                985              BRA     .END
00001884                           986              
00001884                           987  .ENDD
00001884  4279 00002B96            988              CLR     ONSTAIRS
0000188A                           989  .END
0000188A                           990              
0000188A  4CDF 0E07                991              MOVEM.L (A7)+, D0-D2/A1-A3
0000188E  4E75                     992              RTS
00001890                           993              
00001890                           994  STAIRSPLOT          
00001890  48E7 F800                995              MOVEM.L D0-D4, -(A7)
00001894                           996                      
00001894                           997m             UTILPEN #TILELIGH
00001894                           998m ;   IN:  #TILELIGH AS THE COLOR, FORMATED AS #00BBGGRR
00001894                           999m ;   OUT: NONE
00001894                          1000m ;   MOD: D0, D1    
00001894                          1001m ;   DES: MACRO TO SET PEN COLOR
00001894                          1002m 
00001894  103C 0050               1003m         MOVE.B  #80, D0 
00001898  223C 00CCE0EA           1004m         MOVE.L  #TILELIGH, D1
0000189E  4E4F                    1005m         TRAP    #15
000018A0                          1006m         ENDM
000018A0                          1007m             UTILFILL #TILELIGH 
000018A0                          1008m ;   IN:  #TILELIGH AS THE COLOR, FORMATED AS #00BBGGRR
000018A0                          1009m ;   OUT: NONE
000018A0                          1010m ;   MOD: D0, D1
000018A0                          1011m ;   DES: MACRO TO SET FILL COLOR
000018A0                          1012m 
000018A0  103C 0051               1013m         MOVE.B  #81, D0
000018A4  223C 00CCE0EA           1014m         MOVE.L  #TILELIGH, D1
000018AA  4E4F                    1015m         TRAP    #15
000018AC                          1016m         ENDM
000018AC                          1017                              
000018AC  0C39 0001 00002B90      1018              CMP.B   #1, (KEYOBTEINED)
000018B4  6700 002C               1019              BEQ     .KEYOBTEINED
000018B8                          1020m             UTILTILE #88, (STAIRSX), (STAIRSY)
000018B8                          1021m ;   IN:  #88 PROCEDURE OF THE TRAP #15
000018B8                          1022m ;        (STAIRSX) X COORDINATE
000018B8                          1023m ;        (STAIRSY) Y COORDINATE
000018B8                          1024m ;   OUT: NONE
000018B8                          1025m ;   MOD: D1-D4
000018B8                          1026m ;   DES: DRAWS A GRAPHIC AT (STAIRSX) (STAIRSY)
000018B8  3239 00002B88           1027m         MOVE.W  (STAIRSX), D1               ; D1 = X CENTER
000018BE  3439 00002B8A           1028m         MOVE.W  (STAIRSY), D2               ; D1 = Y CENTER
000018C4  3601                    1029m         MOVE.W  D1, D3
000018C6  3802                    1030m         MOVE.W  D2, D4
000018C8  0441 0010               1031m         SUB.W   #TILEDIM/2, D1              ; SET TOP LEFT CORNER
000018CC  0442 0010               1032m         SUB.W   #TILEDIM/2, D2              ; SET TOP LEFT CORNER 
000018D0  0643 0010               1033m         ADD.W   #TILEDIM/2, D3              ; SET LOW RIGHT CORNER
000018D4  0644 0010               1034m         ADD.W   #TILEDIM/2, D4              ; SET LOW RIGHT CORNER
000018D8                          1035m 
000018D8  303C 0058               1036m         MOVE.W  #88, D0
000018DC  4E4F                    1037m         TRAP    #15
000018DE                          1038m         ENDM
000018DE  6000 0028               1039              BRA     .END
000018E2                          1040  .KEYOBTEINED
000018E2                          1041m             UTILTILE #91, (STAIRSX), (STAIRSY)
000018E2                          1042m ;   IN:  #91 PROCEDURE OF THE TRAP #15
000018E2                          1043m ;        (STAIRSX) X COORDINATE
000018E2                          1044m ;        (STAIRSY) Y COORDINATE
000018E2                          1045m ;   OUT: NONE
000018E2                          1046m ;   MOD: D1-D4
000018E2                          1047m ;   DES: DRAWS A GRAPHIC AT (STAIRSX) (STAIRSY)
000018E2  3239 00002B88           1048m         MOVE.W  (STAIRSX), D1               ; D1 = X CENTER
000018E8  3439 00002B8A           1049m         MOVE.W  (STAIRSY), D2               ; D1 = Y CENTER
000018EE  3601                    1050m         MOVE.W  D1, D3
000018F0  3802                    1051m         MOVE.W  D2, D4
000018F2  0441 0010               1052m         SUB.W   #TILEDIM/2, D1              ; SET TOP LEFT CORNER
000018F6  0442 0010               1053m         SUB.W   #TILEDIM/2, D2              ; SET TOP LEFT CORNER 
000018FA  0643 0010               1054m         ADD.W   #TILEDIM/2, D3              ; SET LOW RIGHT CORNER
000018FE  0644 0010               1055m         ADD.W   #TILEDIM/2, D4              ; SET LOW RIGHT CORNER
00001902                          1056m 
00001902  303C 005B               1057m         MOVE.W  #91, D0
00001906  4E4F                    1058m         TRAP    #15
00001908                          1059m         ENDM
00001908                          1060  
00001908                          1061  .END
00001908  4CDF 001F               1062              MOVEM.L (A7)+,D0-D4
0000190C  4E75                    1063              RTS
0000190E                          1064  
0000190E                          1065  
0000190E                          1066  -------------------- end include --------------------
0000190E                          1067              INCLUDE "ENEMY.X68"             ; ENEMY MANAGER
0000190E                          1068  ;   LOCAL VARIABLES:
0000190E                          1069  ;       XCENTER -   (A0)    WORD
0000190E                          1070  ;       YCENTER -   2(A0)   WORD
0000190E                          1071  ;       ID      -   
0000190E                          1072  
0000190E                          1073  ENEMYINIT
0000190E                          1074                   
0000190E  48E7 C000               1075              MOVEM.L  D0-D1, -(A7)
00001912  323C 0001               1076              MOVE.W  #1, D1
00001916                          1077              
00001916  4EB8 153C               1078              JSR     RNGX
0000191A  3080                    1079              MOVE.W  D0, (A0)        ; MOVE X COORDINATE TO (A0) | AGENT CONTROL
0000191C  4EB8 156C               1080              JSR     RNGY 
00001920  3140 0002               1081              MOVE.W  D0, 2(A0)       ; MOVE Y COORDIANTE TO 2(A0) | AGENT CONTROL
00001924                          1082  
00001924  4CDF 0003               1083              MOVEM.L  (A7)+, D0-D1
00001928  4E75                    1084              RTS
0000192A                          1085  
0000192A                          1086  ENEMYUPDT
0000192A  48E7 E000               1087              MOVEM.L D0-D2, -(A7)
0000192E                          1088  
0000192E  3010                    1089              MOVE.W  (A0), D0
00001930  3228 0002               1090              MOVE.W  2(A0), D1
00001934  4EB8 1512               1091              JSR     UTILCOLL
00001938  B43C 00FF               1092              CMP.B   #$FF, D2
0000193C  6600 000A               1093              BNE     .END
00001940                          1094              ; THE PLAYER IS IN THE POSITION OF THE STAIRS  
00001940  33FC 0002 00002B8E      1095              MOVE.W  #STADM, (STANEXT)
00001948                          1096  .END
00001948  4CDF 0007               1097              MOVEM.L (A7)+, D0-D2
0000194C  4E75                    1098              RTS
0000194E                          1099  ENEMYPLOT
0000194E  48E7 F800               1100              MOVEM.L D0-D4, -(A7)
00001952                          1101  
00001952                          1102m             UTILPEN #TILEDETA                       
00001952                          1103m ;   IN:  #TILEDETA AS THE COLOR, FORMATED AS #00BBGGRR
00001952                          1104m ;   OUT: NONE
00001952                          1105m ;   MOD: D0, D1    
00001952                          1106m ;   DES: MACRO TO SET PEN COLOR
00001952                          1107m 
00001952  103C 0050               1108m         MOVE.B  #80, D0 
00001956  223C 00957EA0           1109m         MOVE.L  #TILEDETA, D1
0000195C  4E4F                    1110m         TRAP    #15
0000195E                          1111m         ENDM
0000195E                          1112m             UTILFILL #TILEDETA
0000195E                          1113m ;   IN:  #TILEDETA AS THE COLOR, FORMATED AS #00BBGGRR
0000195E                          1114m ;   OUT: NONE
0000195E                          1115m ;   MOD: D0, D1
0000195E                          1116m ;   DES: MACRO TO SET FILL COLOR
0000195E                          1117m 
0000195E  103C 0051               1118m         MOVE.B  #81, D0
00001962  223C 00957EA0           1119m         MOVE.L  #TILEDETA, D1
00001968  4E4F                    1120m         TRAP    #15
0000196A                          1121m         ENDM
0000196A                          1122m             UTILTILE #87, (A0), 2(A0)
0000196A                          1123m ;   IN:  #87 PROCEDURE OF THE TRAP #15
0000196A                          1124m ;        (A0) X COORDINATE
0000196A                          1125m ;        2(A0) Y COORDINATE
0000196A                          1126m ;   OUT: NONE
0000196A                          1127m ;   MOD: D1-D4
0000196A                          1128m ;   DES: DRAWS A GRAPHIC AT (A0) 2(A0)
0000196A  3210                    1129m         MOVE.W  (A0), D1               ; D1 = X CENTER
0000196C  3428 0002               1130m         MOVE.W  2(A0), D2               ; D1 = Y CENTER
00001970  3601                    1131m         MOVE.W  D1, D3
00001972  3802                    1132m         MOVE.W  D2, D4
00001974  0441 0010               1133m         SUB.W   #TILEDIM/2, D1              ; SET TOP LEFT CORNER
00001978  0442 0010               1134m         SUB.W   #TILEDIM/2, D2              ; SET TOP LEFT CORNER 
0000197C  0643 0010               1135m         ADD.W   #TILEDIM/2, D3              ; SET LOW RIGHT CORNER
00001980  0644 0010               1136m         ADD.W   #TILEDIM/2, D4              ; SET LOW RIGHT CORNER
00001984                          1137m 
00001984  303C 0057               1138m         MOVE.W  #87, D0
00001988  4E4F                    1139m         TRAP    #15
0000198A                          1140m         ENDM
0000198A                          1141              
0000198A  4CDF 001F               1142              MOVEM.L (A7)+,D0-D4
0000198E  4E75                    1143              RTS
0000198E  4E75                    1144  -------------------- end include --------------------
00001990                          1145              INCLUDE "MISC.X68"              ; MISCELLANEOUS MANAGER
00001990                          1146  MISCINIT
00001990  4E75                    1147          RTS
00001992                          1148  MISCUPDT
00001992  4E75                    1149          RTS
00001994                          1150          
00001994                          1151  MISCPLOT
00001994  4EB9 000019A2           1152          JSR .LVLPLOT
0000199A  4EB9 000019C6           1153          JSR .NOOKEYPLOT
000019A0  4E75                    1154          RTS
000019A2                          1155  
000019A2                          1156  
000019A2                          1157  .LVLPLOT
000019A2  48E7 E040               1158          MOVEM.L D0-D2/A1, -(A7)
000019A6                          1159          
000019A6                          1160m         UTILFILL #00000000      
000019A6                          1161m ;   IN:  #00000000 AS THE COLOR, FORMATED AS #00BBGGRR
000019A6                          1162m ;   OUT: NONE
000019A6                          1163m ;   MOD: D0, D1
000019A6                          1164m ;   DES: MACRO TO SET FILL COLOR
000019A6                          1165m 
000019A6  103C 0051               1166m         MOVE.B  #81, D0
000019AA  7200                    1167m         MOVE.L  #00000000, D1
000019AC  4E4F                    1168m         TRAP    #15
000019AE                          1169m         ENDM
000019AE                          1170  
000019AE  43F8 124D               1171          LEA     LEVELSTRING, A1
000019B2  4281                    1172          CLR.L   D1
000019B4  3239 00002B9E           1173          MOVE.W  (LEVEL), D1
000019BA  103C 0011               1174          MOVE.B  #17,D0
000019BE  4E4F                    1175          TRAP    #15
000019C0                          1176          
000019C0  4CDF 0207               1177          MOVEM.L (A7)+, D0-D2/A1
000019C4  4E75                    1178          RTS 
000019C6                          1179  
000019C6                          1180  .NOOKEYPLOT
000019C6  0C79 0001 00002B96      1181          CMP     #1, (ONSTAIRS)
000019CE  6600 001C               1182          BNE     .END     
000019D2  48E7 E040               1183          MOVEM.L D0-D2/A1, -(A7)
000019D6                          1184m         UTILTEXT NOKEYSTRING, #SCRWIDTH/2-100, #SCRHEIGH/8  
000019D6                          1185m ;   IN:  NOKEYSTRING TEXT 
000019D6                          1186m ;        #SCRWIDTH/2-100 TEXT X
000019D6                          1187m ;        #SCRHEIGH/8 TEXT Y
000019D6                          1188m ;   OUT: NONE
000019D6                          1189m ;   MOD: D0-D2 / A1
000019D6                          1190m ;   DES: PRINTS THE 0 TERINATED STRING IN NOKEYSTRING IN COORDINATES #SCRWIDTH/2-100 #SCRHEIGH/8
000019D6                          1191m 
000019D6  43F8 11D6               1192m         LEA     NOKEYSTRING, A1
000019DA  323C 00DC               1193m         MOVE.W  #SCRWIDTH/2-100, D1
000019DE  343C 003C               1194m         MOVE.W  #SCRHEIGH/8, D2
000019E2                          1195m 
000019E2  303C 005F               1196m         MOVE.W  #95, D0
000019E6  4E4F                    1197m         TRAP    #15
000019E8                          1198m         ENDM
000019E8  4CDF 0207               1199          MOVEM.L (A7)+, D0-D2/A1
000019EC                          1200  .END        
000019EC  4E75                    1201          RTS
000019EC  4E75                    1202  -------------------- end include --------------------
000019EE                          1203              INCLUDE "STATES.X68"            ; STATES MANAGER
000019EE                          1204  ; =============================================================================
000019EE                          1205  ; TITLE    : GAME STATE MANAGEMENT
000019EE                          1206  ; AUTHOR   : ANTONI BURGUERA
000019EE                          1207  ; HISTORY  : XX-XXX-201X - CREATION
000019EE                          1208  ;            11-OCT-2020 - MINOR CHANGES
000019EE                          1209  ; =============================================================================
000019EE                          1210  
000019EE                          1211  ; -----------------------------------------------------------------------------
000019EE                          1212  STAINIT
000019EE                          1213  ; INITALIZES THE STATE MANAGER
000019EE                          1214  ; INPUT    - NONE
000019EE                          1215  ; OUTPUT   - NONE
000019EE                          1216  ; MODIFIES - NONE
000019EE                          1217  ; -----------------------------------------------------------------------------
000019EE  33FC FFFF 00002B8C      1218              MOVE.W  #-1,(STACUR)            ; INVALID STATE, JUST TO FORCE INIT
000019F6  33FC 0000 00002B8E      1219              MOVE.W  #0,(STANEXT)            ; INITIAL STATE
000019FE  4E75                    1220              RTS
00001A00                          1221  
00001A00                          1222  ; -----------------------------------------------------------------------------
00001A00                          1223  STAUPD
00001A00                          1224  ; PERFORMS STATE UPDATE AND INIT IF NECESSARY
00001A00                          1225  ; INPUT    - NONE
00001A00                          1226  ; OUTPUT   - NONE
00001A00                          1227  ; MODIFIES - NONE
00001A00                          1228  ; -----------------------------------------------------------------------------
00001A00  48E7 8080               1229              MOVEM.L D0/A0,-(A7)
00001A04  4280                    1230              CLR.L   D0
00001A06  3039 00002B8E           1231              MOVE.W  (STANEXT),D0
00001A0C  B079 00002B8C           1232              CMP.W   (STACUR),D0
00001A12  6700 0012               1233              BEQ     .DOUPD
00001A16  33C0 00002B8C           1234              MOVE.W  D0,(STACUR)             ; IF STATE CHANGED, DO INIT
00001A1C  E588                    1235              LSL.L   #2,D0
00001A1E  2040                    1236              MOVE.L  D0,A0
00001A20  2068 1A3E               1237              MOVE.L  .INITBL(A0),A0
00001A24  4E90                    1238              JSR     (A0)
00001A26  4280                    1239  .DOUPD      CLR.L   D0                      ; IN ANY CASE, DO UPDATE
00001A28  3039 00002B8C           1240              MOVE.W  (STACUR),D0
00001A2E  E588                    1241              LSL.L   #2,D0
00001A30  2040                    1242              MOVE.L  D0,A0
00001A32  2068 1A4A               1243              MOVE.L  .UPDTBL(A0),A0
00001A36  4E90                    1244              JSR     (A0)
00001A38  4CDF 0101               1245              MOVEM.L (A7)+,D0/A0
00001A3C  4E75                    1246              RTS
00001A3E= 00001A80 00001BFE ...   1247  .INITBL     DC.L    STAMMI,STAGPI,STADMI
00001A4A= 00001AA2 00001C0E ...   1248  .UPDTBL     DC.L    STAMMU,STAGPU,STADMU
00001A56                          1249  
00001A56                          1250  ; -----------------------------------------------------------------------------
00001A56                          1251  STAPLOT
00001A56                          1252  ; PERFORMS STATE PLOT
00001A56                          1253  ; INPUT    - NONE
00001A56                          1254  ; OUTPUT   - NONE
00001A56                          1255  ; MODIFIES - NONE
00001A56                          1256  ; -----------------------------------------------------------------------------
00001A56  48E7 8080               1257              MOVEM.L D0/A0,-(A7)
00001A5A  4280                    1258              CLR.L   D0
00001A5C  3039 00002B8C           1259              MOVE.W  (STACUR),D0
00001A62  E588                    1260              LSL.L   #2,D0
00001A64  2040                    1261              MOVE.L  D0,A0
00001A66  2068 1A72               1262              MOVE.L  .PLTTBL(A0),A0
00001A6A  4E90                    1263              JSR     (A0)
00001A6C  4CDF 0101               1264              MOVEM.L (A7)+,D0/A0
00001A70  4E75                    1265              RTS
00001A72= 00001B18 00001C4A ...   1266  .PLTTBL     DC.L    STAMMP,STAGPP,STADMP
00001A7E                          1267  
00001A7E                          1268  ; -----------------------------------------------------------------------------
00001A7E                          1269  STAEMPTY
00001A7E                          1270  ; EMPTY SUBROUTINE FOR CASES WITH NOTHING TO DO
00001A7E                          1271  ; INPUT    - NONE
00001A7E                          1272  ; OUTPUT   - NONE
00001A7E                          1273  ; MODIFIES - NONE
00001A7E                          1274  ; NOTE     - JUST A PLACEHOLDER. NOTHING TO DO.
00001A7E                          1275  ; -----------------------------------------------------------------------------
00001A7E  4E75                    1276              RTS
00001A80                          1277  STAMMI
00001A80                          1278  ; STATE MAIN MENU INIT
00001A80  2F00                    1279              MOVE.L  D0, -(A7)
00001A82  303C 0007               1280              MOVE.W  #7, D0
00001A86  4EB8 1600               1281              JSR     AGLFKIL
00001A8A  201F                    1282              MOVE.L  (A7)+, D0
00001A8C  4279 00002B9E           1283              CLR     (LEVEL)
00001A92  4279 00002B92           1284              CLR     (TORCHSHADDER)
00001A98  33FC 0003 00002B98      1285              MOVE.W  #3, TORCHRANGE
00001AA0  4E75                    1286              RTS
00001AA2                          1287  
00001AA2                          1288  STAMMU
00001AA2                          1289  ; STATE MAIN MENU UPDATE
00001AA2  48E7 F000               1290              MOVEM.L D0-D3, -(A7)
00001AA6                          1291  
00001AA6  303C 003C               1292              MOVE.W  #60, D0
00001AAA  323C 0012               1293              MOVE.W  #%00010010, D1  ; ACTIVATE MOUSE IRQ TO MOUSE DOWN AND UP
00001AAE  4E4F                    1294              TRAP    #15
00001AB0                          1295              
00001AB0                          1296          
00001AB0  303C 003D               1297              MOVE.W  #61, D0
00001AB4  4241                    1298              CLR     D1
00001AB6  4E4F                    1299              TRAP    #15             
00001AB8                          1300          
00001AB8  B03C 0000               1301              CMP.B   #0, D0          ; CHECK IF LEFT BUTTON OF MOUSE IS PRESSED
00001ABC  6700 0054               1302              BEQ     .END            ; NOT PRESSED
00001AC0  2601                    1303              MOVE.L  D1, D3
00001AC2  E08B                    1304              LSR.L   #8, D3
00001AC4  E08B                    1305              LSR.L   #8, D3
00001AC6                          1306  
00001AC6  B67C 0163               1307              CMP.W    #(BUTTONY-BUTTONHEIGH), D3
00001ACA  6F00 0046               1308              BLE     .END
00001ACE  B67C 01BD               1309              CMP.W   #(BUTTONY+BUTTONHEIGH), D3 
00001AD2  6C00 003E               1310              BGE     .END
00001AD6                          1311              
00001AD6                          1312              
00001AD6                          1313              ; RIGHT X COORDINATE 
00001AD6                          1314              
00001AD6  B27C 0085               1315              CMP.W   #(BUTTONX1-BUTTONWIDTH), D1    ; X COORDINATE
00001ADA  6F00 0016               1316              BLE     .X2
00001ADE  B27C 0125               1317              CMP.W   #(BUTTONX1+BUTTONWIDTH), D1   
00001AE2  6C00 000E               1318              BGE     .X2
00001AE6                          1319              ; EASY
00001AE6  33FC 0001 00002B8E      1320              MOVE.W  #STAGP, (STANEXT)
00001AEE  6000 0022               1321              BRA     .END
00001AF2                          1322  
00001AF2  B27C 015A               1323  .X2         CMP.W   #(BUTTONX2-BUTTONWIDTH), D1    ; X COORDINATE
00001AF6  6F00 001A               1324              BLE     .END
00001AFA  B27C 01FA               1325              CMP.W   #(BUTTONX2+BUTTONWIDTH), D1   
00001AFE  6C00 0012               1326              BGE     .END
00001B02                          1327              ; NORMAL
00001B02  33FC 0001 00002B92      1328              MOVE.W  #1, (TORCHSHADDER)
00001B0A  33FC 0001 00002B8E      1329              MOVE.W  #STAGP, (STANEXT)
00001B12                          1330  .END        
00001B12  4CDF 000F               1331              MOVEM.L (A7)+, D0-D3
00001B16  4E75                    1332              RTS
00001B18                          1333  
00001B18                          1334  STAMMP
00001B18                          1335  ; STATE MAIN MENU PLOT
00001B18  48E7 C040               1336              MOVEM.L D0-D1/A1, -(A7)
00001B1C  323C 1C05               1337              MOVE.W  #((80-24)/2)<<8|5, D1
00001B20  103C 000B               1338              MOVE.B  #11, D0
00001B24  4E4F                    1339              TRAP    #15
00001B26  43F8 1256               1340              LEA     TITLESTRING, A1
00001B2A  303C 000D               1341              MOVE.W  #13, D0
00001B2E  4E4F                    1342              TRAP    #15
00001B30                          1343  
00001B30  4281                    1344              CLR.L   D1
00001B32  323C 1D07               1345              MOVE.W  #((80-22)/2)<<8|7, D1
00001B36  103C 000B               1346              MOVE.B  #11, D0
00001B3A  4E4F                    1347              TRAP    #15
00001B3C  43F8 126F               1348              LEA     SUBTITLESTR, A1
00001B40  303C 000D               1349              MOVE.W  #13, D0
00001B44  4E4F                    1350              TRAP    #15
00001B46                          1351  
00001B46  4281                    1352              CLR.L   D1
00001B48  323C 1D08               1353              MOVE.W  #((80-22)/2)<<8|8, D1
00001B4C  103C 000B               1354              MOVE.B  #11, D0
00001B50  4E4F                    1355              TRAP    #15
00001B52  43F8 129F               1356              LEA     BECARESTR, A1
00001B56  303C 000D               1357              MOVE.W  #13, D0
00001B5A  4E4F                    1358              TRAP    #15
00001B5C                          1359  
00001B5C                          1360              
00001B5C                          1361  
00001B5C  0839 0004 00001ECB      1362              BTST.B  #4, (SCRCYCCT)  ; TIMER 
00001B64  6700 0092               1363              BEQ     .END
00001B68                          1364              
00001B68                          1365              
00001B68                          1366m             UTILFILL #$00000000
00001B68                          1367m ;   IN:  #$00000000 AS THE COLOR, FORMATED AS #00BBGGRR
00001B68                          1368m ;   OUT: NONE
00001B68                          1369m ;   MOD: D0, D1
00001B68                          1370m ;   DES: MACRO TO SET FILL COLOR
00001B68                          1371m 
00001B68  103C 0051               1372m         MOVE.B  #81, D0
00001B6C  7200                    1373m         MOVE.L  #$00000000, D1
00001B6E  4E4F                    1374m         TRAP    #15
00001B70                          1375m         ENDM
00001B70                          1376m             UTILPEN #$00FFFFFF
00001B70                          1377m ;   IN:  #$00FFFFFF AS THE COLOR, FORMATED AS #00BBGGRR
00001B70                          1378m ;   OUT: NONE
00001B70                          1379m ;   MOD: D0, D1    
00001B70                          1380m ;   DES: MACRO TO SET PEN COLOR
00001B70                          1381m 
00001B70  103C 0050               1382m         MOVE.B  #80, D0 
00001B74  223C 00FFFFFF           1383m         MOVE.L  #$00FFFFFF, D1
00001B7A  4E4F                    1384m         TRAP    #15
00001B7C                          1385m         ENDM
00001B7C  323C 00D5               1386              MOVE.W  #BUTTONX1, D1
00001B80  343C 0190               1387              MOVE.W  #BUTTONY, D2
00001B84  3601                    1388              MOVE.W  D1, D3
00001B86  3802                    1389              MOVE.W  D2, D4 
00001B88  0441 0028               1390              SUB.W   #BUTTONWIDTH/2, D1              ; SET TOP LEFT CORNER
00001B8C  0442 0016               1391              SUB.W   #BUTTONHEIGH/2, D2              ; SET TOP LEFT CORNER 
00001B90  0643 0028               1392              ADD.W   #BUTTONWIDTH/2, D3              ; SET LOW RIGHT CORNER
00001B94  0644 0016               1393              ADD.W   #BUTTONHEIGH/2, D4              ; SET LOW RIGHT CORNER
00001B98                          1394  
00001B98  303C 0057               1395              MOVE.W  #87, D0
00001B9C  4E4F                    1396              TRAP    #15                             ; DRAW RECTANGLE
00001B9E                          1397  
00001B9E  43F8 12C1               1398              LEA     EASYSTR, A1
00001BA2  323C 00C5               1399              MOVE.W  #BUTTONX1-16, D1
00001BA6  343C 0189               1400              MOVE.W  #BUTTONY-7, D2
00001BAA                          1401  
00001BAA  303C 005F               1402              MOVE.W  #95, D0
00001BAE  4E4F                    1403              TRAP    #15
00001BB0                          1404  
00001BB0                          1405              ; END
00001BB0                          1406m             UTILFILL #$00000000
00001BB0                          1407m ;   IN:  #$00000000 AS THE COLOR, FORMATED AS #00BBGGRR
00001BB0                          1408m ;   OUT: NONE
00001BB0                          1409m ;   MOD: D0, D1
00001BB0                          1410m ;   DES: MACRO TO SET FILL COLOR
00001BB0                          1411m 
00001BB0  103C 0051               1412m         MOVE.B  #81, D0
00001BB4  7200                    1413m         MOVE.L  #$00000000, D1
00001BB6  4E4F                    1414m         TRAP    #15
00001BB8                          1415m         ENDM
00001BB8                          1416m             UTILPEN #$00FFFFFF
00001BB8                          1417m ;   IN:  #$00FFFFFF AS THE COLOR, FORMATED AS #00BBGGRR
00001BB8                          1418m ;   OUT: NONE
00001BB8                          1419m ;   MOD: D0, D1    
00001BB8                          1420m ;   DES: MACRO TO SET PEN COLOR
00001BB8                          1421m 
00001BB8  103C 0050               1422m         MOVE.B  #80, D0 
00001BBC  223C 00FFFFFF           1423m         MOVE.L  #$00FFFFFF, D1
00001BC2  4E4F                    1424m         TRAP    #15
00001BC4                          1425m         ENDM
00001BC4  323C 01AA               1426              MOVE.W  #BUTTONX2, D1
00001BC8  343C 0190               1427              MOVE.W  #BUTTONY, D2
00001BCC  3601                    1428              MOVE.W  D1, D3
00001BCE  3802                    1429              MOVE.W  D2, D4 
00001BD0  0441 0028               1430              SUB.W   #BUTTONWIDTH/2, D1              ; SET TOP LEFT CORNER
00001BD4  0442 0016               1431              SUB.W   #BUTTONHEIGH/2, D2              ; SET TOP LEFT CORNER 
00001BD8  0643 0028               1432              ADD.W   #BUTTONWIDTH/2, D3              ; SET LOW RIGHT CORNER
00001BDC  0644 0016               1433              ADD.W   #BUTTONHEIGH/2, D4              ; SET LOW RIGHT CORNER
00001BE0                          1434  
00001BE0  303C 0057               1435              MOVE.W  #87, D0
00001BE4  4E4F                    1436              TRAP    #15                             ; DRAW RECTANGLE
00001BE6                          1437  
00001BE6  43F8 12C6               1438              LEA     NORMALSTR, A1
00001BEA  323C 0194               1439              MOVE.W  #BUTTONX2-22, D1
00001BEE  343C 0189               1440              MOVE.W  #BUTTONY-7, D2
00001BF2                          1441  
00001BF2  303C 005F               1442              MOVE.W  #95, D0
00001BF6  4E4F                    1443              TRAP    #15
00001BF8                          1444  .END    
00001BF8  4CDF 0203               1445              MOVEM.L (A7)+, D0-D1/A1
00001BFC                          1446             ;  UTILTEXT NEXTSTR, #SCRWIDTH/2, #SCRHEIGH-30
00001BFC  4E75                    1447              RTS
00001BFE                          1448  
00001BFE                          1449  STAGPI
00001BFE                          1450  ; STAGE INIT
00001BFE  4EB8 152E               1451              JSR     RNDINIT
00001C02  4EB8 1622               1452              JSR     PLAYERINIT
00001C06  4EB8 175C               1453              JSR     KEYINIT
00001C0A  4EF8 17E8               1454              JMP     STAIRSINIT
00001C0E                          1455             
00001C0E                          1456  
00001C0E                          1457  STAGPU
00001C0E                          1458  ; STAGE UPDATE
00001C0E                          1459              
00001C0E  0C79 0002 00002B9E      1460              CMP.W   #2, (LEVEL)
00001C16  6700 001E               1461              BEQ     .CP1
00001C1A  0C79 0003 00002B9E      1462              CMP.W   #3, (LEVEL)
00001C22  6700 001C               1463              BEQ     .CP2
00001C26                          1464  
00001C26  4EB8 1634               1465  .CLASS      JSR     PLAYERUPDT
00001C2A  4EB8 1776               1466              JSR     KEYUPDT
00001C2E  4EB8 1808               1467              JSR     STAIRSUPDT
00001C32  4EF8 15B6               1468              JMP     AGLUPDT
00001C36                          1469  .CP1
00001C36  33FC 0002 00002B98      1470              MOVE.W #2, (TORCHRANGE)
00001C3E  60E6                    1471              BRA    .CLASS
00001C40                          1472  .CP2
00001C40  33FC 0001 00002B98      1473              MOVE.W #1, (TORCHRANGE)
00001C48  60DC                    1474              BRA     .CLASS
00001C4A                          1475  STAGPP
00001C4A                          1476  ; STAGE PLOT
00001C4A  4EB8 171E               1477              JSR     MAPPLOT
00001C4E  4EB8 16D2               1478              JSR     PLAYERPLOT
00001C52  4EB8 17A0               1479              JSR     KEYPLOT
00001C56  4EB8 1890               1480              JSR     STAIRSPLOT
00001C5A                          1481              
00001C5A  4EB8 15DA               1482              JSR     AGLPLOT
00001C5E  0C79 0000 00002B92      1483              CMP     #0, (TORCHSHADDER)
00001C66  6700 0008               1484              BEQ     .END
00001C6A  4EB9 00001DEE           1485              JSR     SHADDERPLOT
00001C70                          1486              
00001C70                          1487  .END        
00001C70  4EB8 1994               1488              JSR     MISCPLOT
00001C74  4E75                    1489              RTS
00001C76                          1490  
00001C76                          1491  STADMI
00001C76                          1492  ; STATE DEATH MENU INIT
00001C76                          1493  
00001C76  4E75                    1494              RTS
00001C78                          1495  
00001C78                          1496  STADMU
00001C78                          1497  ; STATE DEATH MENU UPDATE
00001C78  48E7 F000               1498              MOVEM.L D0-D3, -(A7)
00001C7C                          1499  
00001C7C  303C 003C               1500              MOVE.W  #60, D0
00001C80  323C 0012               1501              MOVE.W  #%00010010, D1  ; ACTIVATE MOUSE IRQ TO MOUSE DOWN AND UP
00001C84  4E4F                    1502              TRAP    #15
00001C86                          1503              
00001C86                          1504          
00001C86  303C 003D               1505              MOVE.W  #61, D0
00001C8A  4241                    1506              CLR     D1
00001C8C  4E4F                    1507              TRAP    #15             
00001C8E                          1508          
00001C8E  B03C 0000               1509              CMP.B   #0, D0          ; CHECK IF LEFT BUTTON OF MOUSE IS PRESSED
00001C92  6700 004A               1510              BEQ     .END            ; NOT PRESSED
00001C96  2601                    1511              MOVE.L  D1, D3
00001C98  E08B                    1512              LSR.L   #8, D3
00001C9A  E08B                    1513              LSR.L   #8, D3
00001C9C                          1514  
00001C9C  B67C 0163               1515              CMP.W    #(BUTTONY-BUTTONHEIGH), D3
00001CA0  6F00 003C               1516              BLE     .END
00001CA4  B67C 01BD               1517              CMP.W   #(BUTTONY+BUTTONHEIGH), D3 
00001CA8  6C00 0034               1518              BGE     .END
00001CAC                          1519              
00001CAC                          1520              
00001CAC                          1521              ; RIGHT X COORDINATE 
00001CAC                          1522              
00001CAC  B27C 0085               1523              CMP.W   #(BUTTONX1-BUTTONWIDTH), D1    ; X COORDINATE
00001CB0  6F00 0016               1524              BLE     .X2
00001CB4  B27C 0125               1525              CMP.W   #(BUTTONX1+BUTTONWIDTH), D1   
00001CB8  6C00 000E               1526              BGE     .X2
00001CBC                          1527              ; RETRY
00001CBC  33FC 0000 00002B8E      1528              MOVE.W  #STAMM, (STANEXT)
00001CC4  6000 0018               1529              BRA     .END
00001CC8                          1530  
00001CC8  B27C 015A               1531  .X2         CMP.W   #(BUTTONX2-BUTTONWIDTH), D1    ; X COORDINATE
00001CCC  6F00 0010               1532              BLE     .END
00001CD0  B27C 01FA               1533              CMP.W   #(BUTTONX2+BUTTONWIDTH), D1   
00001CD4  6C00 0008               1534              BGE     .END
00001CD8                          1535              ; EXIT
00001CD8                          1536  
00001CD8  4EB9 00001EC4           1537              JSR     LOOSE
00001CDE                          1538  .END        
00001CDE  4CDF 000F               1539              MOVEM.L (A7)+, D0-D3
00001CE2  4E75                    1540              RTS
00001CE4                          1541  
00001CE4                          1542  STADMP
00001CE4                          1543  ; STATE DEATH MENU PLOT
00001CE4  48E7 F840               1544          MOVEM.L D0-D4/A1, -(A7)
00001CE8                          1545              ; -- BLACK SQUARE ---
00001CE8                          1546m         UTILPEN #0                       
00001CE8                          1547m ;   IN:  #0 AS THE COLOR, FORMATED AS #00BBGGRR
00001CE8                          1548m ;   OUT: NONE
00001CE8                          1549m ;   MOD: D0, D1    
00001CE8                          1550m ;   DES: MACRO TO SET PEN COLOR
00001CE8                          1551m 
00001CE8  103C 0050               1552m         MOVE.B  #80, D0 
00001CEC  7200                    1553m         MOVE.L  #0, D1
00001CEE  4E4F                    1554m         TRAP    #15
00001CF0                          1555m         ENDM
00001CF0                          1556m         UTILFILL #0
00001CF0                          1557m ;   IN:  #0 AS THE COLOR, FORMATED AS #00BBGGRR
00001CF0                          1558m ;   OUT: NONE
00001CF0                          1559m ;   MOD: D0, D1
00001CF0                          1560m ;   DES: MACRO TO SET FILL COLOR
00001CF0                          1561m 
00001CF0  103C 0051               1562m         MOVE.B  #81, D0
00001CF4  7200                    1563m         MOVE.L  #0, D1
00001CF6  4E4F                    1564m         TRAP    #15
00001CF8                          1565m         ENDM
00001CF8                          1566  
00001CF8  323C 0000               1567          MOVE.W  #0, D1               ; D1 = X CENTER
00001CFC  343C 0000               1568          MOVE.W  #0, D2               ; D1 = Y CENTER
00001D00  363C 0280               1569          MOVE.W  #SCRWIDTH, D3
00001D04  383C 01E0               1570          MOVE.W  #SCRHEIGH, D4
00001D08                          1571  
00001D08  303C 0057               1572          MOVE.W  #87, D0
00001D0C  4E4F                    1573          TRAP    #15
00001D0E                          1574  
00001D0E                          1575          ; --- TEXT ---
00001D0E                          1576m         UTILFILL #0
00001D0E                          1577m ;   IN:  #0 AS THE COLOR, FORMATED AS #00BBGGRR
00001D0E                          1578m ;   OUT: NONE
00001D0E                          1579m ;   MOD: D0, D1
00001D0E                          1580m ;   DES: MACRO TO SET FILL COLOR
00001D0E                          1581m 
00001D0E  103C 0051               1582m         MOVE.B  #81, D0
00001D12  7200                    1583m         MOVE.L  #0, D1
00001D14  4E4F                    1584m         TRAP    #15
00001D16                          1585m         ENDM
00001D16  323C 1705               1586          MOVE.W  #((80-34)/2)<<8|5, D1
00001D1A  103C 000B               1587          MOVE.B  #11, D0
00001D1E  4E4F                    1588          TRAP    #15
00001D20  43F8 11EF               1589          LEA     DEATHSTRING, A1
00001D24  303C 000D               1590          MOVE.W  #13, D0
00001D28  4E4F                    1591          TRAP    #15
00001D2A                          1592  
00001D2A                          1593         
00001D2A  33FC 0001 00002B94      1594          MOVE.W  #1, (DEATHTEXT2)    
00001D32  4281                    1595          CLR.L   D1
00001D34  323C 0B07               1596          MOVE.W  #((80-58)/2)<<8|7, D1
00001D38  103C 000B               1597          MOVE.B  #11, D0
00001D3C  4E4F                    1598          TRAP    #15
00001D3E  43F8 1212               1599          LEA     SUSSERTOD, A1
00001D42  303C 000D               1600          MOVE.W  #13, D0
00001D46  4E4F                    1601          TRAP    #15
00001D48                          1602  
00001D48                          1603          ; BUTTONS
00001D48  0839 0004 00001ECB      1604          BTST.B  #4, (SCRCYCCT)  ; TIMER 
00001D50  6700 0092               1605          BEQ     .END
00001D54                          1606          ; RETRY
00001D54                          1607m         UTILFILL #$00000000
00001D54                          1608m ;   IN:  #$00000000 AS THE COLOR, FORMATED AS #00BBGGRR
00001D54                          1609m ;   OUT: NONE
00001D54                          1610m ;   MOD: D0, D1
00001D54                          1611m ;   DES: MACRO TO SET FILL COLOR
00001D54                          1612m 
00001D54  103C 0051               1613m         MOVE.B  #81, D0
00001D58  7200                    1614m         MOVE.L  #$00000000, D1
00001D5A  4E4F                    1615m         TRAP    #15
00001D5C                          1616m         ENDM
00001D5C                          1617m         UTILPEN #$00FFFFFF
00001D5C                          1618m ;   IN:  #$00FFFFFF AS THE COLOR, FORMATED AS #00BBGGRR
00001D5C                          1619m ;   OUT: NONE
00001D5C                          1620m ;   MOD: D0, D1    
00001D5C                          1621m ;   DES: MACRO TO SET PEN COLOR
00001D5C                          1622m 
00001D5C  103C 0050               1623m         MOVE.B  #80, D0 
00001D60  223C 00FFFFFF           1624m         MOVE.L  #$00FFFFFF, D1
00001D66  4E4F                    1625m         TRAP    #15
00001D68                          1626m         ENDM
00001D68  323C 00D5               1627          MOVE.W  #BUTTONX1, D1
00001D6C  343C 0190               1628          MOVE.W  #BUTTONY, D2
00001D70  3601                    1629          MOVE.W  D1, D3
00001D72  3802                    1630          MOVE.W  D2, D4 
00001D74  0441 0028               1631          SUB.W   #BUTTONWIDTH/2, D1              ; SET TOP LEFT CORNER
00001D78  0442 0016               1632          SUB.W   #BUTTONHEIGH/2, D2              ; SET TOP LEFT CORNER 
00001D7C  0643 0028               1633          ADD.W   #BUTTONWIDTH/2, D3              ; SET LOW RIGHT CORNER
00001D80  0644 0016               1634          ADD.W   #BUTTONHEIGH/2, D4              ; SET LOW RIGHT CORNER
00001D84                          1635  
00001D84  303C 0057               1636          MOVE.W  #87, D0
00001D88  4E4F                    1637          TRAP    #15                             ; DRAW RECTANGLE
00001D8A                          1638  
00001D8A  43F8 12B6               1639          LEA     RETRYSTR, A1
00001D8E  323C 00C2               1640          MOVE.W  #BUTTONX1-19, D1
00001D92  343C 0189               1641          MOVE.W  #BUTTONY-7, D2
00001D96                          1642  
00001D96  303C 005F               1643          MOVE.W  #95, D0
00001D9A  4E4F                    1644          TRAP    #15
00001D9C                          1645          
00001D9C                          1646          ; END
00001D9C                          1647m         UTILFILL #$00000000
00001D9C                          1648m ;   IN:  #$00000000 AS THE COLOR, FORMATED AS #00BBGGRR
00001D9C                          1649m ;   OUT: NONE
00001D9C                          1650m ;   MOD: D0, D1
00001D9C                          1651m ;   DES: MACRO TO SET FILL COLOR
00001D9C                          1652m 
00001D9C  103C 0051               1653m         MOVE.B  #81, D0
00001DA0  7200                    1654m         MOVE.L  #$00000000, D1
00001DA2  4E4F                    1655m         TRAP    #15
00001DA4                          1656m         ENDM
00001DA4                          1657m         UTILPEN #$00FFFFFF
00001DA4                          1658m ;   IN:  #$00FFFFFF AS THE COLOR, FORMATED AS #00BBGGRR
00001DA4                          1659m ;   OUT: NONE
00001DA4                          1660m ;   MOD: D0, D1    
00001DA4                          1661m ;   DES: MACRO TO SET PEN COLOR
00001DA4                          1662m 
00001DA4  103C 0050               1663m         MOVE.B  #80, D0 
00001DA8  223C 00FFFFFF           1664m         MOVE.L  #$00FFFFFF, D1
00001DAE  4E4F                    1665m         TRAP    #15
00001DB0                          1666m         ENDM
00001DB0  323C 01AA               1667          MOVE.W  #BUTTONX2, D1
00001DB4  343C 0190               1668          MOVE.W  #BUTTONY, D2
00001DB8  3601                    1669          MOVE.W  D1, D3
00001DBA  3802                    1670          MOVE.W  D2, D4 
00001DBC  0441 0028               1671          SUB.W   #BUTTONWIDTH/2, D1              ; SET TOP LEFT CORNER
00001DC0  0442 0016               1672          SUB.W   #BUTTONHEIGH/2, D2              ; SET TOP LEFT CORNER 
00001DC4  0643 0028               1673          ADD.W   #BUTTONWIDTH/2, D3              ; SET LOW RIGHT CORNER
00001DC8  0644 0016               1674          ADD.W   #BUTTONHEIGH/2, D4              ; SET LOW RIGHT CORNER
00001DCC                          1675  
00001DCC  303C 0057               1676          MOVE.W  #87, D0
00001DD0  4E4F                    1677          TRAP    #15                             ; DRAW RECTANGLE
00001DD2                          1678  
00001DD2  43F8 12BC               1679          LEA     EXITSTR, A1
00001DD6  323C 019A               1680          MOVE.W  #BUTTONX2-16, D1
00001DDA  343C 0189               1681          MOVE.W  #BUTTONY-7, D2
00001DDE                          1682  
00001DDE  303C 005F               1683          MOVE.W  #95, D0
00001DE2  4E4F                    1684          TRAP    #15
00001DE4                          1685  .END  
00001DE4  4CDF 021F               1686          MOVEM.L (A7)+,D0-D4/A1
00001DE8  4E75                    1687          RTS
00001DEA                          1688  
00001DEA                          1689  
00001DEA                          1690  -------------------- end include --------------------
00001DEA                          1691              INCLUDE "SHADDER.X68"           ; TORCH SHADDER
00001DEA                          1692  SHADDERINIT
00001DEA                          1693  
00001DEA  4E75                    1694              RTS
00001DEC                          1695  SHADDERUPDT
00001DEC                          1696  
00001DEC  4E75                    1697              RTS
00001DEE                          1698  SHADDERPLOT
00001DEE  48E7 F800               1699              MOVEM.L D0-D4, -(A7)
00001DF2                          1700  
00001DF2                          1701m             UTILPEN #TILEDDARK
00001DF2                          1702m ;   IN:  #TILEDDARK AS THE COLOR, FORMATED AS #00BBGGRR
00001DF2                          1703m ;   OUT: NONE
00001DF2                          1704m ;   MOD: D0, D1    
00001DF2                          1705m ;   DES: MACRO TO SET PEN COLOR
00001DF2                          1706m 
00001DF2  103C 0050               1707m         MOVE.B  #80, D0 
00001DF6  223C 0030252D           1708m         MOVE.L  #TILEDDARK, D1
00001DFC  4E4F                    1709m         TRAP    #15
00001DFE                          1710m         ENDM
00001DFE                          1711m             UTILFILL #TILEDDARK
00001DFE                          1712m ;   IN:  #TILEDDARK AS THE COLOR, FORMATED AS #00BBGGRR
00001DFE                          1713m ;   OUT: NONE
00001DFE                          1714m ;   MOD: D0, D1
00001DFE                          1715m ;   DES: MACRO TO SET FILL COLOR
00001DFE                          1716m 
00001DFE  103C 0051               1717m         MOVE.B  #81, D0
00001E02  223C 0030252D           1718m         MOVE.L  #TILEDDARK, D1
00001E08  4E4F                    1719m         TRAP    #15
00001E0A                          1720m         ENDM
00001E0A                          1721  
00001E0A                          1722  
00001E0A  4241                    1723              CLR     D1                          ; LEFT BORDER
00001E0C  4242                    1724              CLR     D2           
00001E0E  3639 00002B80           1725              MOVE.W  (PLAYERX), D3       
00001E14  3A39 00002B98           1726              MOVE.W  (TORCHRANGE), D5
00001E1A  CAFC 0020               1727              MULU.W  #TILEDIM, D5
00001E1E  0645 0010               1728              ADD.W   #(TILEDIM/2), D5      
00001E22  9645                    1729              SUB.W   D5, D3
00001E24  383C 01E0               1730              MOVE.W  #SCRHEIGH, D4
00001E28  303C 0057               1731              MOVE.W  #87, D0
00001E2C  4E4F                    1732              TRAP    #15
00001E2E                          1733  
00001E2E                          1734                                                  ; RIGHT BORDER
00001E2E                          1735                
00001E2E  3239 00002B80           1736              MOVE.W  (PLAYERX), D1   
00001E34  3A39 00002B98           1737              MOVE.W  (TORCHRANGE), D5
00001E3A  CAFC 0020               1738              MULU.W  #TILEDIM, D5
00001E3E  0645 0010               1739              ADD.W   #(TILEDIM/2), D5 
00001E42  D245                    1740              ADD.W   D5, D1
00001E44  363C 0280               1741              MOVE.W  #SCRWIDTH, D3
00001E48  303C 0057               1742              MOVE.W  #87, D0
00001E4C  4E4F                    1743              TRAP    #15
00001E4E                          1744  
00001E4E                          1745                                                 ; TOP BORDER
00001E4E                          1746                
00001E4E  4241                    1747              CLR     D1
00001E50  4242                    1748              CLR     D2
00001E52  363C 0280               1749              MOVE.W  #SCRWIDTH, D3
00001E56  3839 00002B82           1750              MOVE.W  (PLAYERY), D4 
00001E5C  3A39 00002B98           1751              MOVE.W  (TORCHRANGE), D5
00001E62  CAFC 0020               1752              MULU.W  #TILEDIM, D5
00001E66  0645 0010               1753              ADD.W   #(TILEDIM/2), D5          
00001E6A  9845                    1754              SUB.W   D5, D4     
00001E6C                          1755             
00001E6C  363C 0280               1756              MOVE.W  #SCRWIDTH, D3
00001E70  303C 0057               1757              MOVE.W  #87, D0
00001E74  4E4F                    1758              TRAP    #15
00001E76                          1759  
00001E76                          1760                                                 ; BOTTOM BORDER
00001E76  3439 00002B82           1761              MOVE.W  (PLAYERY), D2
00001E7C  3A39 00002B98           1762              MOVE.W  (TORCHRANGE), D5
00001E82  CAFC 0020               1763              MULU.W  #TILEDIM, D5
00001E86  0645 0010               1764              ADD.W   #(TILEDIM/2), D5           
00001E8A  D445                    1765              ADD.W   D5, D2     
00001E8C  363C 0280               1766              MOVE.W  #SCRWIDTH, D3
00001E90  383C 01E0               1767              MOVE.W  #SCRHEIGH, D4
00001E94  303C 0057               1768              MOVE.W  #87, D0
00001E98  4E4F                    1769              TRAP    #15
00001E9A                          1770  
00001E9A  4CDF 001F               1771              MOVEM.L (A7)+, D0-D4
00001E9E  4E75                    1772              RTS
00001E9E  4E75                    1773  -------------------- end include --------------------
00001EA0                          1774              
00001EA0                          1775  
00001EA0                          1776  ; --- INITIALIZE --------------------------------------------------------------
00001EA0                          1777  
00001EA0                          1778  START                                       ; INITIALIZE SYSTEM-RELATED STUFF
00001EA0  4EB8 1000               1779              JSR     SYSINIT 
00001EA4  4EB8 19EE               1780              JSR     STAINIT
00001EA8                          1781              
00001EA8                          1782  ; --- UPDATE ------------------------------------------------------------------
00001EA8                          1783  
00001EA8  4E40                    1784  .LOOP       TRAP    #KBDTRAP                ; READ KEYBOARD
00001EAA  4EB8 1A00               1785              JSR     STAUPD
00001EAE                          1786              
00001EAE                          1787  ; --- WAIT SYNCH --------------------------------------------------------------
00001EAE                          1788  
00001EAE  4A39 00001ECA           1789  .WINT       TST.B   (SCRINTCT)              ; WAIT FOR INTERRUPT
00001EB4  67F8                    1790              BEQ     .WINT
00001EB6  4239 00001ECA           1791              CLR.B   (SCRINTCT)
00001EBC                          1792  
00001EBC                          1793  ; --- PLOT --------------------------------------------------------------------
00001EBC                          1794  
00001EBC  4EB8 1A56               1795              JSR     STAPLOT
00001EC0  4E41                    1796              TRAP    #SCRTRAP                ; SHOW GRAPHICS
00001EC2  60E4                    1797              BRA     .LOOP                   ; MAIN LOOP
00001EC4                          1798  
00001EC4                          1799  ; --- DEATH -------------------------------------------------------------------
00001EC4                          1800  LOOSE
00001EC4  FFFF FFFF               1801              SIMHALT
00001EC8                          1802  
00001EC8                          1803  ; --- VARIABLES ---------------------------------------------------------------
00001EC8                          1804  
00001EC8                          1805              INCLUDE "SYSVAR.X68"
00001EC8                          1806  ; =============================================================================
00001EC8                          1807  ; TITLE    : SYSTEM VARIABLES
00001EC8                          1808  ; AUTHOR   : ANTONI BURGUERA
00001EC8                          1809  ; COMMENTS : NOTE THAT ALL THESE VARS ARE USED TO SHARE DATA FROM SYSTEM TO
00001EC8                          1810  ;            USER. THUS THEY MUST NOT BE IN PROTECTED MEMORY.
00001EC8                          1811  ;            NOTE THAT USING DMMDATA IN SUCH WAY IS A BAD IDEA, AS USER
00001EC8                          1812  ;            APPLICATIONS CAN ALSO FREE OR CHANGE OWNERSHIP. NONETHELESS, FOR
00001EC8                          1813  ;            THE SAKE OF THIS EXAMPLE THIS IS GOOD ENOUGH.
00001EC8                          1814  ; HISTORY  : XX-XXX-201X - CREATION
00001EC8                          1815  ;            11-OCT-2020 - MINOR CHANGES
00001EC8                          1816  ; =============================================================================
00001EC8                          1817  
00001EC8                          1818  ; --- KEYBOARD RELATED VARIABLES ----------------------------------------------
00001EC8                          1819  
00001EC8                          1820  KBDVAL      DS.B    1                       ; KEY PRESSED=1
00001EC9                          1821  KBDEDGE     DS.B    1                       ; KEY CHANGED=1
00001ECA                          1822  
00001ECA                          1823              DS.W    0
00001ECA                          1824  
00001ECA                          1825  ; --- SCREEN RELATED VARIABLES ------------------------------------------------
00001ECA                          1826  
00001ECA                          1827  SCRINTCT    DS.B    1                       ; INTERRUPT COUNTER/FLAG
00001ECB                          1828  SCRCYCCT    DS.B    1                       ; CYCLE COUNTER
00001ECC                          1829              DS.W    0
00001ECC                          1830  
00001ECC                          1831  ; --- DYNAMIC MEMORY VARIABLES ------------------------------------------------
00001ECC                          1832  
00001F00                          1833              ORG     (*+DMMBSIZE-1)&-DMMBSIZE ; ALIGN TO DMMBSIZE
00001F00                          1834  DMMDATA     DS.B    DMMBSIZE*DMMBNUM        ; DYNAMIC MEMORY ALLOCATION SPACE
00002B80                          1835              DS.W    0                       ; JUST IN CASE (SIZE IS POW OF TWO)
00002B80                          1836  -------------------- end include --------------------
00002B80                          1837              INCLUDE "VAR.X68"
00002B80                          1838  ; =============================================================================
00002B80                          1839  ; TITLE    : GAME VARIABLES
00002B80                          1840  ; AUTHOR   :
00002B80                          1841  ; HISTORY  :
00002B80                          1842  ; =============================================================================
00002B80                          1843  
00002B80                          1844  ; POSITION
00002B80                          1845  PLAYERX     DS.W    1   ; PLAYER X COORDINATE
00002B82                          1846  PLAYERY     DS.W    1   ; PLAYER Y COORDINATE
00002B84                          1847  
00002B84                          1848  KEYX        DS.W    1   ; KEY X COORDINATE
00002B86                          1849  KEYY        DS.W    1   ; KEY Y COORDINATE
00002B88                          1850  
00002B88                          1851  STAIRSX     DS.W    1   ; STAIRS X COORDINATE
00002B8A                          1852  STAIRSY     DS.W    1   ; STAIRS Y COORDINATE
00002B8C                          1853  
00002B8C                          1854  STACUR      DS.W    1   ; CURRENT STATE
00002B8E                          1855  STANEXT     DS.W    1   ; NEXT STATE 
00002B90                          1856  
00002B90                          1857  ; BOOLEAN
00002B90= 0000                    1858  KEYOBTEINED DC.W    0   ; "BOOLEAN" VALUE, SELF EXPLANATORY 
00002B92= 0000                    1859  TORCHSHADDER DC.W   0   ; "BOOLEAN" VALUE TO SEEE IF SHADDER IS APPLIED OR NOT
00002B94= 0000                    1860  DEATHTEXT2  DC.W    0   ; "BOOLEAN" DEATH STRING SHOW 
00002B96= 0000                    1861  ONSTAIRS    DC.W    0   ; "BOOLEAN" VALUE TO TRACK IF PLAYER IS ON STAIRS
00002B98                          1862  
00002B98= 0005                    1863  TORCHRANGE  DC.W    5   ; TORCH RANGE FOR THE SHADDER 
00002B9A                          1864  ; ARRAY 
00002B9A                          1865  RNGXINDEX   DS.W    1   ; INDEX FOR THE X COORDINATE ON THE PSEUDO RANDOM GENERATOR
00002B9C                          1866  RNGYINDEX   DS.W    1   ; INDEX FOR THE Y COORDINATE ON THE PSEUDO RANDOM GENERATOR
00002B9E                          1867  
00002B9E= 0000                    1868  LEVEL       DC.W    0   ; LEVEL COUNTER
00002BA0= 0002                    1869  SHADDERRANGE DC.W   2   ; SHADDER RANGE
00002BA2                          1870  ; AUDIO
00002BA2                          1871  AUDIOACCSND DS.B    1   ; ACCEPT NEW SOUNDS 
00002BA4                          1872              DS.W    0
00002BA4                          1873  
00002BA4                          1874  
00002BA4                          1875  
00002BA4                          1876  
00002BA4                          1877  -------------------- end include --------------------
00002BA4                          1878              END    START

No errors detected
No warnings generated


SYMBOL TABLE INFORMATION
Symbol-name         Value
-------------------------
AGLADD              159C
AGLADD:END          15B2
AGLFKIL             1600
AGLFKIL:END         161C
AGLFKIL:LOOP        1608
AGLKILL             11C0
AGLPLOT             15DA
AGLPLOT:END         15FA
AGLPLOT:LOOP        15E2
AGLUPDT             15B6
AGLUPDT:END         15D4
AGLUPDT:LOOP        15BE
AUDIOACCSND         2BA2
AUDIOACCY           FF
AUDIOCLKID          7
AUDIODIEDID         6
AUDIOKEYID          3
AUDIOLOOP           80
AUDIOMOVEID         2
AUDIOMUS1ID         0
AUDIOMUS2ID         1
AUDIONLOP           0
AUDIOSCCN           0
AUDIOSTARID         4
AUDIOSTOP           FF
AUDIOTALKID         5
BECARESTR           129F
BUTTONHEIGH         2D
BUTTONWIDTH         50
BUTTONX1            D5
BUTTONX2            1AA
BUTTONY             190
DEATHSTRING         11EF
DEATHTEXT2          2B94
DMMALLOC            11A6
DMMALLOC:END        11BE
DMMBNUM             32
DMMBSIZE            40
DMMDATA             1F00
DMMFCOM             1180
DMMFFND             118E
DMMFIRST            1136
DMMFLOOP            1174
DMMFRCOM            1148
DMMFREE             11C0
DMMFRFND            1156
DMMFRLOP            113C
DMMFRSTO            116E
DMMINIT             1114
DMMINIT:LOOP        1122
DMMNEXT             1158
DMMNEXTO            1190
DMMSYSID            0
EASYSTR             12C1
EMPTYID             1
ENEMYID             7
ENEMYINIT           190E
ENEMYMAXCNT         C
ENEMYPLOT           194E
ENEMYUPDT           192A
ENEMYUPDT:END       1948
EXITSTR             12BC
FLOORID             3
KBDBITDN            3
KBDBITF1            4
KBDBITF2            5
KBDBITF3            6
KBDBITLF            0
KBDBITPS            7
KBDBITRT            2
KBDBITUP            1
KBDCHRDN            28
KBDCHRLF            25
KBDCHRMK            4D
KBDCHRPK            50
KBDCHRRT            27
KBDCHRSH            10
KBDCHRSP            20
KBDCHRUP            26
KBDDOWN             28
KBDEDGE             1EC9
KBDFIRE1            20
KBDFIRE2            4D
KBDFIRE3            10
KBDINIT             10B4
KBDLEFT             25
KBDMSKDN            8
KBDMSKF1            10
KBDMSKF2            20
KBDMSKF3            40
KBDMSKLF            1
KBDMSKPS            80
KBDMSKRT            4
KBDMSKUP            2
KBDPAUSE            50
KBDREAD             10CA
KBDREAD:LOOP        110A
KBDREAD:STORE       1106
KBDRIGHT            27
KBDTRAP             0
KBDUP               26
KBDVAL              1EC8
KEYID               5
KEYINIT             175C
KEYOBTEINED         2B90
KEYPLOT             17A0
KEYPLOT:NOKEY       17E6
KEYUPDT             1776
KEYUPDT:END         179A
KEYX                2B84
KEYY                2B86
LEVEL               2B9E
LEVELSTRING         124D
LOOSE               1EC4
MAPINIT             171A
MAPPLOT             171E
MAPUPDT             171C
MISCINIT            1990
MISCPLOT            1994
MISCPLOT:END        19EC
MISCPLOT:LVLPLOT    19A2
MISCPLOT:NOOKEYPLOT  19C6
MISCUPDT            1992
NEXTSTR             1286
NOKEYSTRING         11D6
NORMALSTR           12C6
ONSTAIRS            2B96
PLAYERINIT          1622
PLAYERPLOT          16D2
PLAYERUPDT          1634
PLAYERUPDT:END      16D0
PLAYERUPDT:MOVED    16BA
PLAYERUPDT:MOVEL    1672
PLAYERUPDT:MOVER    168A
PLAYERUPDT:MOVEU    16A2
PLAYERUPDT:RMVED    16C8
PLAYERUPDT:RMVEL    1680
PLAYERUPDT:RMVER    1698
PLAYERUPDT:RMVEU    16B0
PLAYERX             2B80
PLAYERY             2B82
PLYRID              6
RETRYSTR            12B6
RNDINIT             152E
RNGX                153C
RNGX:NOVERFLOW      1568
RNGXINDEX           2B9A
RNGY                156C
RNGY:NOVERFLOW      1598
RNGYINDEX           2B9C
SCRCYCCT            1ECB
SCRHEIGH            1E0
SCRINIT             101C
SCRINTCT            1ECA
SCRIRQ              1
SCRISR              108C
SCRTIM              14
SCRTRAP             1
SCRUPD              109A
SCRWIDTH            280
SHADDERINIT         1DEA
SHADDERPLOT         1DEE
SHADDERRANGE        2BA0
SHADDERUPDT         1DEC
STACUR              2B8C
STADM               2
STADMI              1C76
STADMP              1CE4
STADMP:END          1DE4
STADMU              1C78
STADMU:END          1CDE
STADMU:X2           1CC8
STAEMPTY            1A7E
STAGP               1
STAGPI              1BFE
STAGPP              1C4A
STAGPP:END          1C70
STAGPU              1C0E
STAGPU:CLASS        1C26
STAGPU:CP1          1C36
STAGPU:CP2          1C40
STAINIT             19EE
STAIRID             4
STAIRSINIT          17E8
STAIRSPLOT          1890
STAIRSPLOT:END      1908
STAIRSPLOT:KEYOBTEINED  18E2
STAIRSUPDT          1808
STAIRSUPDT:END      188A
STAIRSUPDT:ENDD     1884
STAIRSUPDT:ENEMYADD  1848
STAIRSUPDT:NOKEY    1878
STAIRSX             2B88
STAIRSY             2B8A
STAMM               0
STAMMI              1A80
STAMMP              1B18
STAMMP:END          1BF8
STAMMU              1AA2
STAMMU:END          1B12
STAMMU:X2           1AF2
STANEXT             2B8E
STAPLOT             1A56
STAPLOT:PLTTBL      1A72
START               1EA0
START:LOOP          1EA8
START:WINT          1EAE
STAUPD              1A00
STAUPD:DOUPD        1A26
STAUPD:INITBL       1A3E
STAUPD:UPDTBL       1A4A
SUBTITLESTR         126F
SUSSERTOD           1212
SYSINIT             1000
TILEDARK            745B6D
TILEDDARK           30252D
TILEDETA            957EA0
TILEDIM             20
TILELIGH            CCE0EA
TITLESTRING         1256
TORCHRANGE          2B98
TORCHSHADDER        2B92
TORCHWEAK10         12CD
TORCHWEAK11         12EC
TORCHWEAK20         12FB
TORCHWEAK21         131C
UTILCOLL            1512
UTILCOLL:NOCOL      152C
UTILFILL            CD
UTILPEN             0
UTILTEXT            196
UTILTILE            2C0
WALLID              2
XVALUES             1332
YVALUES             1350
